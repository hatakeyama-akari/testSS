/*


  Shapespark 3D visualization viewer

  Copyright (C) 2014-present Shapespark

  The viewer uses the following open source libraries:

    Three.js: https://github.com/mrdoob/three.js,
    Copyright 2010-2015 three.js authors, MIT License

    PlayCanvas (GLSL shaders code): https://github.com/playcanvas/engine
    Copyright (C) 2011-2015 PlayCanvas Ltd., MIT License

    WebXR Polyfill: https://github.com/immersive-web/webxr-polyfill,
    Copyright (C) 2017 Google Inc, Apache 2.0 License

    Web Font Loader: https://github.com/typekit/webfontloader
    Copyright (C) 2010-2017 Adobe Systems Incorporated, Google Incorporated, Apache 2.0 License

    Basis Universal GPU Texture Codec: https://github.com/BinomialLLC/basis_universal
    Copyright (C) 2019 Binomial LLC., Apache License

  and the following open fonts:

    Noto Sans: https://fonts.google.com/specimen/Noto+Sans?query=noto+sans
    Copyright (C) Google Inc., Apache 2.0 License

    Font Awesome: https://fontawesome.com/
    Copyright (C) 2017 Fonticons Inc, SIL Open Font License
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];if(!(f in c))return;c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var f=a.split(".");a=1===f.length;d=f[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<f.length-1;g++){var e=f[g];if(!(e in d))return;d=d[e]}f=f[f.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[f]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&($jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(f):
$jscomp.POLYFILL_PREFIX+f),f=$jscomp.propertyToPolyfillSymbol[f],$jscomp.defineProperty(d,f,{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(f,g){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(f){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(f||"")+"_"+c++,f)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,f){c=b(c,d);f&&Reflect.setPrototypeOf(c,f.prototype);return c}}return function(c,d,f){void 0===f&&(f=c);f=$jscomp.objectCreate(f.prototype||Object.prototype);return Function.prototype.apply.call(c,f,d)||
f}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var f=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,f){function g(e){e.done?d(e.value):Promise.resolve(e.value).then(b,c).then(g,f)}g(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(a){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(f){return!1}}}return null},"es6","es5");
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(e){return e instanceof f?e:new f(function(k,h){k(e)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var k=this;this.asyncExecuteFunction(function(){k.executeBatch_()})}this.batch_.push(e)};
var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(e){d(e,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var k=0;k<e.length;++k){var h=e[k];e[k]=null;try{h()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(e){this.asyncExecuteFunction(function(){throw e;})};var f=function(e){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var k=this.createResolveAndReject_();
try{e(k.resolve,k.reject)}catch(h){k.reject(h)}};f.prototype.createResolveAndReject_=function(){function e(l){return function(r){h||(h=!0,l.call(k,r))}}var k=this,h=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}};f.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof f)this.settleSameAsPromise_(e);else{a:switch(typeof e){case "object":var k=null!=e;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(e):
this.fulfill_(e)}};f.prototype.resolveToNonPromiseObj_=function(e){var k=void 0;try{k=e.then}catch(h){this.reject_(h);return}"function"==typeof k?this.settleSameAsThenable_(k,e):this.fulfill_(e)};f.prototype.reject_=function(e){this.settle_(2,e)};f.prototype.fulfill_=function(e){this.settle_(1,e)};f.prototype.settle_=function(e,k){if(0!=this.state_)throw Error("Cannot settle("+e+", "+k+"): Promise already settled in state"+this.state_);this.state_=e;this.result_=k;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};f.prototype.scheduleUnhandledRejectionCheck_=function(){var e=this;d(function(){if(e.notifyUnhandledRejection_()){var k=$jscomp.global.console;"undefined"!==typeof k&&k.error(e.result_)}},1)};f.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var e=$jscomp.global.CustomEvent,k=$jscomp.global.Event,h=$jscomp.global.dispatchEvent;if("undefined"===typeof h)return!0;"function"===typeof e?e=new e("unhandledrejection",{cancelable:!0}):
"function"===typeof k?e=new k("unhandledrejection",{cancelable:!0}):(e=$jscomp.global.document.createEvent("CustomEvent"),e.initCustomEvent("unhandledrejection",!1,!0,e));e.promise=this;e.reason=this.result_;return h(e)};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)g.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var g=new b;f.prototype.settleSameAsPromise_=function(e){var k=this.createResolveAndReject_();
e.callWhenSettled_(k.resolve,k.reject)};f.prototype.settleSameAsThenable_=function(e,k){var h=this.createResolveAndReject_();try{e.call(k,h.resolve,h.reject)}catch(l){h.reject(l)}};f.prototype.then=function(e,k){function h(m,u){return"function"==typeof m?function(n){try{l(m(n))}catch(w){r(w)}}:u}var l,r,q=new f(function(m,u){l=m;r=u});this.callWhenSettled_(h(e,l),h(k,r));return q};f.prototype.catch=function(e){return this.then(void 0,e)};f.prototype.callWhenSettled_=function(e,k){function h(){switch(l.state_){case 1:e(l.result_);
break;case 2:k(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?g.asyncExecute(h):this.onSettledCallbacks_.push(h);this.isRejectionHandled_=!0};f.resolve=c;f.reject=function(e){return new f(function(k,h){h(e)})};f.race=function(e){return new f(function(k,h){for(var l=$jscomp.makeIterator(e),r=l.next();!r.done;r=l.next())c(r.value).callWhenSettled_(k,h)})};f.all=function(e){var k=$jscomp.makeIterator(e),h=k.next();return h.done?c([]):new f(function(l,
r){function q(n){return function(w){m[n]=w;u--;0==u&&l(m)}}var m=[],u=0;do m.push(void 0),u++,c(h.value).callWhenSettled_(q(m.length-1),r),h=k.next();while(!h.done)})};return f},"es6","es3");$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,f={next:function(){if(!d&&c<a.length){var g=c++;return{value:b(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,f){return c==a&&"q"==d&&f==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var l=Object.seal({}),r=Object.seal({}),q=new a([[l,2],[r,3]]);if(2!=q.get(l)||3!=q.get(r))return!1;q.delete(l);q.set(r,4);return!q.has(l)&&4==q.get(r)}catch(m){return!1}}function c(){}function d(l){var r=typeof l;return"object"===r&&null!==l||"function"===r}function f(l){if(!$jscomp.owns(l,e)){var r=new c;$jscomp.defineProperty(l,e,{value:r})}}function g(l){if(!$jscomp.ISOLATE_POLYFILLS){var r=Object[l];r&&(Object[l]=
function(q){if(q instanceof c)return q;Object.isExtensible(q)&&f(q);return r(q)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var e="$jscomp_hidden_"+Math.random();g("freeze");g("preventExtensions");g("seal");var k=0,h=function(l){this.id_=(k+=Math.random()+1).toString();if(l){l=$jscomp.makeIterator(l);for(var r;!(r=l.next()).done;)r=r.value,this.set(r[0],r[1])}};h.prototype.set=function(l,r){if(!d(l))throw Error("Invalid WeakMap key");
f(l);if(!$jscomp.owns(l,e))throw Error("WeakMap key fail: "+l);l[e][this.id_]=r;return this};h.prototype.get=function(l){return d(l)&&$jscomp.owns(l,e)?l[e][this.id_]:void 0};h.prototype.has=function(l){return d(l)&&$jscomp.owns(l,e)&&$jscomp.owns(l[e],this.id_)};h.prototype.delete=function(l){return d(l)&&$jscomp.owns(l,e)&&$jscomp.owns(l[e],this.id_)?delete l[e][this.id_]:!1};return h},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),l=new a($jscomp.makeIterator([[h,"s"]]));if("s"!=l.get(h)||1!=l.size||l.get({x:4})||l.set({x:4},"t")!=l||2!=l.size)return!1;var r=l.entries(),q=r.next();if(q.done||q.value[0]!=h||"s"!=q.value[1])return!1;q=r.next();return q.done||4!=q.value[0].x||"t"!=q.value[1]||!r.next().done?!1:!0}catch(m){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,d=function(h){this.data_={};this.head_=e();this.size=0;if(h){h=$jscomp.makeIterator(h);for(var l;!(l=h.next()).done;)l=l.value,this.set(l[0],l[1])}};d.prototype.set=function(h,l){h=0===h?0:h;var r=f(this,h);r.list||(r.list=this.data_[r.id]=[]);r.entry?r.entry.value=l:(r.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:h,value:l},r.list.push(r.entry),
this.head_.previous.next=r.entry,this.head_.previous=r.entry,this.size++);return this};d.prototype.delete=function(h){h=f(this,h);return h.entry&&h.list?(h.list.splice(h.index,1),h.list.length||delete this.data_[h.id],h.entry.previous.next=h.entry.next,h.entry.next.previous=h.entry.previous,h.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=e();this.size=0};d.prototype.has=function(h){return!!f(this,h).entry};d.prototype.get=function(h){return(h=
f(this,h).entry)&&h.value};d.prototype.entries=function(){return g(this,function(h){return[h.key,h.value]})};d.prototype.keys=function(){return g(this,function(h){return h.key})};d.prototype.values=function(){return g(this,function(h){return h.value})};d.prototype.forEach=function(h,l){for(var r=this.entries(),q;!(q=r.next()).done;)q=q.value,h.call(l,q[1],q[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var f=function(h,l){var r=l&&typeof l;"object"==r||"function"==r?c.has(l)?r=c.get(l):
(r=""+ ++k,c.set(l,r)):r="p_"+l;var q=h.data_[r];if(q&&$jscomp.owns(h.data_,r))for(h=0;h<q.length;h++){var m=q[h];if(l!==l&&m.key!==m.key||l===m.key)return{id:r,list:q,index:h,entry:m}}return{id:r,list:q,index:-1,entry:void 0}},g=function(h,l){var r=h.head_;return $jscomp.iteratorPrototype(function(){if(r){for(;r.head!=h.head_;)r=r.previous;for(;r.next!=r.head;)return r=r.next,{done:!1,value:l(r)};r=null}return{done:!0,value:void 0}})},e=function(){var h={};return h.previous=h.next=h.head=h},k=0;
return d},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var f=d.length;c=c||0;for(0>c&&(c=Math.max(c+f,0));c<f;c++){var g=d[c];if(g===b||Object.is(g,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),f=new a($jscomp.makeIterator([d]));if(!f.has(d)||1!=f.size||f.add(d)!=f||1!=f.size||f.add({x:4})!=f||2!=f.size)return!1;var g=f.entries(),e=g.next();if(e.done||e.value[0]!=d||e.value[1]!=d)return!1;e=g.next();return e.done||e.value[0]==d||4!=e.value[0].x||e.value[1]!=e.value[0]?!1:g.next().done}catch(k){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var f;!(f=d.next()).done;)this.add(f.value)}this.size=this.map_.size};c.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};c.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};c.prototype.clear=function(){this.map_.clear();this.size=0};c.prototype.has=
function(d){return this.map_.has(d)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(d,f){var g=this;this.map_.forEach(function(e){return d.call(f,e,e,g)})};return c},"es6","es3");
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var f in d)$jscomp.owns(d,f)&&(a[f]=d[f])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.polyfill("Object.setPrototypeOf",function(a){return a||$jscomp.setPrototypeOf},"es6","es5");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,f=0;f<d;f++){var g=a[f];if(b.call(c,g,f,a))return{i:f,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
$jscomp.polyfill("Math.sign",function(a){return a?a:function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1}},"es6","es3");$jscomp.polyfill("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var f=this.length||0;0>c&&(c=Math.max(0,f+c));if(null==d||d>f)d=f;d=Number(d);0>d&&(d=Math.max(0,f+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");
$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push(b[d]);return c}},"es8","es3");
$jscomp.polyfill("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push([d,b[d]]);return c}},"es8","es3");$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var f=d.length,g=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var e=0;e<g&&c<f;)if(d[c++]!=b[e++])return!1;return e>=g}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var f=b.length;0<f&&0<c;)if(d[--c]!=b[--f])return!1;return 0>=f}},"es6","es3");$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return[b,c]})}},"es6","es3");(function(){function a(P,da,Ba){return P.call.apply(P.bind,arguments)}function b(P,da,Ba){if(!P)throw Error();if(2<arguments.length){var T=Array.prototype.slice.call(arguments,2);return function(){var wa=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(wa,T);return P.apply(da,wa)}}return function(){return P.apply(da,arguments)}}function c(P,da,Ba){c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:b;return c.apply(null,arguments)}function d(P,
da){this.a=P;this.m=da||P;this.c=this.m.document}function f(P,da,Ba,T){da=P.c.createElement(da);if(Ba)for(var wa in Ba)Ba.hasOwnProperty(wa)&&("style"==wa?da.style.cssText=Ba[wa]:da.setAttribute(wa,Ba[wa]));T&&da.appendChild(P.c.createTextNode(T));return da}function g(P,da,Ba){(P=P.c.getElementsByTagName(da)[0])||(P=document.documentElement);P.insertBefore(Ba,P.lastChild)}function e(P){P.parentNode&&P.parentNode.removeChild(P)}function k(P,da,Ba){da=da||[];Ba=Ba||[];for(var T=P.className.split(/\s+/),
wa=0;wa<da.length;wa+=1){for(var Ha=!1,Fa=0;Fa<T.length;Fa+=1)if(da[wa]===T[Fa]){Ha=!0;break}Ha||T.push(da[wa])}da=[];for(wa=0;wa<T.length;wa+=1){Ha=!1;for(Fa=0;Fa<Ba.length;Fa+=1)if(T[wa]===Ba[Fa]){Ha=!0;break}Ha||da.push(T[wa])}P.className=da.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function h(P,da){P=P.className.split(/\s+/);for(var Ba=0,T=P.length;Ba<T;Ba++)if(P[Ba]==da)return!0;return!1}function l(P){if("string"===typeof P.f)return P.f;var da=P.m.location.protocol;"about:"==da&&
(da=P.a.location.protocol);return"https:"==da?"https:":"http:"}function r(P){return P.m.location.hostname||P.a.location.hostname}function q(P,da,Ba){function T(){la&&wa&&Ha&&(la(Fa),la=null)}da=f(P,"link",{rel:"stylesheet",href:da,media:"all"});var wa=!1,Ha=!0,Fa=null,la=Ba||null;pa?(da.onload=function(){wa=!0;T()},da.onerror=function(){wa=!0;Fa=Error("Stylesheet failed to load");T()}):setTimeout(function(){wa=!0;T()},0);g(P,"head",da)}function m(P,da,Ba,T){var wa=P.c.getElementsByTagName("head")[0];
if(wa){var Ha=f(P,"script",{src:da}),Fa=!1;Ha.onload=Ha.onreadystatechange=function(){Fa||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(Fa=!0,Ba&&Ba(null),Ha.onload=Ha.onreadystatechange=null,"HEAD"==Ha.parentNode.tagName&&wa.removeChild(Ha))};wa.appendChild(Ha);setTimeout(function(){Fa||(Fa=!0,Ba&&Ba(Error("Script load timeout")))},T||5E3);return Ha}return null}function u(){this.a=0;this.c=null}function n(P){P.a++;return function(){P.a--;v(P)}}function w(P,da){P.c=da;
v(P)}function v(P){0==P.a&&P.c&&(P.c(),P.c=null)}function y(P){this.a=P||"-"}function C(P,da){this.c=P;this.f=4;this.a="n";(P=(da||"n4").match(/^([nio])([1-9])$/i))&&(this.a=P[1],this.f=parseInt(P[2],10))}function A(P){return E(P)+" "+(P.f+"00 300px ")+I(P.c)}function I(P){var da=[];P=P.split(/,\s*/);for(var Ba=0;Ba<P.length;Ba++){var T=P[Ba].replace(/['"]/g,"");-1!=T.indexOf(" ")||/^\d/.test(T)?da.push("'"+T+"'"):da.push(T)}return da.join(",")}function D(P){return P.a+P.f}function E(P){var da="normal";
"o"===P.a?da="oblique":"i"===P.a&&(da="italic");return da}function O(P,da){this.c=P;this.f=P.m.document.documentElement;this.h=da;this.a=new y("-");this.j=!1!==da.events;this.g=!1!==da.classes}function S(P){P.g&&k(P.f,[P.a.c("wf","loading")]);U(P,"loading")}function W(P){if(P.g){var da=h(P.f,P.a.c("wf","active")),Ba=[],T=[P.a.c("wf","loading")];da||Ba.push(P.a.c("wf","inactive"));k(P.f,Ba,T)}U(P,"inactive")}function U(P,da,Ba){if(P.j&&P.h[da])if(Ba)P.h[da](Ba.c,D(Ba));else P.h[da]()}function va(){this.c=
{}}function ta(P,da,Ba){var T=[],wa;for(wa in da)if(da.hasOwnProperty(wa)){var Ha=P.c[wa];Ha&&T.push(Ha(da[wa],Ba))}return T}function qa(P,da){this.c=P;this.f=da;this.a=f(this.c,"span",{"aria-hidden":"true"},this.f)}function ha(P){g(P.c,"body",P.a)}function F(P){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+I(P.c)+";font-style:"+(E(P)+";font-weight:"+
(P.f+"00;"))}function J(P,da,Ba,T,wa,Ha){this.g=P;this.j=da;this.a=T;this.c=Ba;this.f=wa||3E3;this.h=Ha||void 0}function Z(P,da,Ba,T,wa,Ha,Fa){this.v=P;this.B=da;this.c=Ba;this.a=T;this.s=Fa||"BESbswy";this.f={};this.w=wa||3E3;this.u=Ha||null;this.o=this.j=this.h=this.g=null;this.g=new qa(this.c,this.s);this.h=new qa(this.c,this.s);this.j=new qa(this.c,this.s);this.o=new qa(this.c,this.s);P=new C(this.a.c+",serif",D(this.a));P=F(P);this.g.a.style.cssText=P;P=new C(this.a.c+",sans-serif",D(this.a));
P=F(P);this.h.a.style.cssText=P;P=new C("serif",D(this.a));P=F(P);this.j.a.style.cssText=P;P=new C("sans-serif",D(this.a));P=F(P);this.o.a.style.cssText=P;ha(this.g);ha(this.h);ha(this.j);ha(this.o)}function M(){if(null===Aa){var P=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);Aa=!!P&&(536>parseInt(P[1],10)||536===parseInt(P[1],10)&&11>=parseInt(P[2],10))}return Aa}function ma(P,da,Ba){for(var T in ca)if(ca.hasOwnProperty(T)&&da===P.f[ca[T]]&&Ba===P.f[ca[T]])return!0;return!1}
function ea(P){var da=P.g.a.offsetWidth,Ba=P.h.a.offsetWidth,T;(T=da===P.f.serif&&Ba===P.f["sans-serif"])||(T=M()&&ma(P,da,Ba));T?L()-P.A>=P.w?M()&&ma(P,da,Ba)&&(null===P.u||P.u.hasOwnProperty(P.a.c))?Q(P,P.v):Q(P,P.B):ya(P):Q(P,P.v)}function ya(P){setTimeout(c(function(){ea(this)},P),50)}function Q(P,da){setTimeout(c(function(){e(this.g.a);e(this.h.a);e(this.j.a);e(this.o.a);da(this.a)},P),0)}function fa(P,da,Ba){this.c=P;this.a=da;this.f=0;this.o=this.j=!1;this.s=Ba}function K(P){0==--P.f&&P.j&&
(P.o?(P=P.a,P.g&&k(P.f,[P.a.c("wf","active")],[P.a.c("wf","loading"),P.a.c("wf","inactive")]),U(P,"active")):W(P.a))}function R(P){this.j=P;this.a=new va;this.h=0;this.f=this.g=!0}function ka(P,da,Ba,T,wa){var Ha=0==--P.h;(P.f||P.g)&&setTimeout(function(){var Fa=wa||null,la=T||{};if(0===Ba.length&&Ha)W(da.a);else{da.f+=Ba.length;Ha&&(da.j=Ha);var Ua,Xa=[];for(Ua=0;Ua<Ba.length;Ua++){var La=Ba[Ua],db=la[La.c],pb=da.a,Bb=La;pb.g&&k(pb.f,[pb.a.c("wf",Bb.c,D(Bb).toString(),"loading")]);U(pb,"fontloading",
Bb);pb=null;null===Ca&&(Ca=window.FontFace?(Bb=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(Bb[1],10):!0:!1);Ca?pb=new J(c(da.g,da),c(da.h,da),da.c,La,da.s,db):pb=new Z(c(da.g,da),c(da.h,da),da.c,La,da.s,Fa,db);Xa.push(pb)}for(Ua=0;Ua<Xa.length;Ua++)Xa[Ua].start()}},0)}function ba(P,da,Ba){var T=[],wa=Ba.timeout;S(da);T=ta(P.a,Ba,P.c);var Ha=new fa(P.c,da,wa);P.h=T.length;da=0;for(Ba=T.length;da<Ba;da++)T[da].load(function(Fa,la,Ua){ka(P,Ha,Fa,la,Ua)})}function ja(P,da){this.c=
P;this.a=da}function na(P,da,Ba){var T=l(P.c);P=(P.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return T+"//"+P+"/"+da+".js"+(Ba?"?v="+Ba:"")}function ra(P,da){this.c=P;this.a=da}function za(P,da,Ba){P?this.c=P:this.c=da+Oa;this.a=[];this.f=[];this.g=Ba||""}function Da(P,da){for(var Ba=da.length,T=0;T<Ba;T++){var wa=da[T].split(":");3==wa.length&&P.f.push(wa.pop());var Ha="";2==wa.length&&""!=wa[1]&&(Ha=":");P.a.push(wa.join(Ha))}}function ia(P){if(0==P.a.length)throw Error("No fonts to load!");
if(-1!=P.c.indexOf("kit="))return P.c;for(var da=P.a.length,Ba=[],T=0;T<da;T++)Ba.push(P.a[T].replace(/ /g,"+"));da=P.c+"?family="+Ba.join("%7C");0<P.f.length&&(da+="&subset="+P.f.join(","));0<P.g.length&&(da+="&text="+encodeURIComponent(P.g));return da}function V(P){this.f=P;this.a=[];this.c={}}function xa(P){for(var da=P.f.length,Ba=0;Ba<da;Ba++){var T=P.f[Ba].split(":"),wa=T[0].replace(/\+/g," "),Ha=["n4"];if(2<=T.length){var Fa=T[1];var la=[];if(Fa){Fa=Fa.split(",");for(var Ua=Fa.length,Xa=0;Xa<
Ua;Xa++){var La=Fa[Xa];if(La.match(/^[\w-]+$/)){var db=wb.exec(La.toLowerCase());if(null==db)La="";else{La=db[2];La=null==La||""==La?"n":cb[La];db=db[1];if(null==db||""==db)db="4";else{var pb=$a[db];db=pb?pb:isNaN(db)?"4":db.substr(0,1)}La=[La,db].join("")}}else La="";La&&la.push(La)}}0<la.length&&(Ha=la);3==T.length&&(T=T[2],la=[],T=T?T.split(","):la,0<T.length&&(T=Ma[T[0]])&&(P.c[wa]=T))}P.c[wa]||(T=Ma[wa])&&(P.c[wa]=T);for(T=0;T<Ha.length;T+=1)P.a.push(new C(wa,Ha[T]))}}function Ea(P,da){this.c=
P;this.a=da}function Ia(P,da){this.c=P;this.a=da}function Qa(P,da){this.c=P;this.f=da;this.a=[]}var L=Date.now||function(){return+new Date},pa=!!window.FontFace;y.prototype.c=function(P){for(var da=[],Ba=0;Ba<arguments.length;Ba++)da.push(arguments[Ba].replace(/[\W_]+/g,"").toLowerCase());return da.join(this.a)};J.prototype.start=function(){var P=this.c.m.document,da=this,Ba=L(),T=new Promise(function(Ha,Fa){function la(){L()-Ba>=da.f?Fa():P.fonts.load(A(da.a),da.h).then(function(Ua){1<=Ua.length?
Ha():setTimeout(la,25)},function(){Fa()})}la()}),wa=new Promise(function(Ha,Fa){setTimeout(Fa,da.f)});Promise.race([wa,T]).then(function(){da.g(da.a)},function(){da.j(da.a)})};var ca={D:"serif",C:"sans-serif"},Aa=null;Z.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=L();ea(this)};var Ca=null;fa.prototype.g=function(P){var da=this.a;da.g&&k(da.f,[da.a.c("wf",P.c,D(P).toString(),"active")],[da.a.c("wf",P.c,D(P).toString(),"loading"),da.a.c("wf",
P.c,D(P).toString(),"inactive")]);U(da,"fontactive",P);this.o=!0;K(this)};fa.prototype.h=function(P){var da=this.a;if(da.g){var Ba=h(da.f,da.a.c("wf",P.c,D(P).toString(),"active")),T=[],wa=[da.a.c("wf",P.c,D(P).toString(),"loading")];Ba||T.push(da.a.c("wf",P.c,D(P).toString(),"inactive"));k(da.f,T,wa)}U(da,"fontinactive",P);K(this)};R.prototype.load=function(P){this.c=new d(this.j,P.context||this.j);this.g=!1!==P.events;this.f=!1!==P.classes;ba(this,new O(this.c,P),P)};ja.prototype.load=function(P){function da(){if(Ha["__mti_fntLst"+
T]){var Fa=Ha["__mti_fntLst"+T](),la=[],Ua;if(Fa)for(var Xa=0;Xa<Fa.length;Xa++){var La=Fa[Xa].fontfamily;void 0!=Fa[Xa].fontStyle&&void 0!=Fa[Xa].fontWeight?(Ua=Fa[Xa].fontStyle+Fa[Xa].fontWeight,la.push(new C(La,Ua))):la.push(new C(La))}P(la)}else setTimeout(function(){da()},50)}var Ba=this,T=Ba.a.projectId,wa=Ba.a.version;if(T){var Ha=Ba.c.m;m(this.c,na(Ba,T,wa),function(Fa){Fa?P([]):(Ha["__MonotypeConfiguration__"+T]=function(){return Ba.a},da())}).id="__MonotypeAPIScript__"+T}else P([])};ra.prototype.load=
function(P){var da,Ba=this.a.urls||[],T=this.a.families||[],wa=this.a.testStrings||{},Ha=new u;var Fa=0;for(da=Ba.length;Fa<da;Fa++)q(this.c,Ba[Fa],n(Ha));var la=[];Fa=0;for(da=T.length;Fa<da;Fa++)if(Ba=T[Fa].split(":"),Ba[1])for(var Ua=Ba[1].split(","),Xa=0;Xa<Ua.length;Xa+=1)la.push(new C(Ba[0],Ua[Xa]));else la.push(new C(Ba[0]));w(Ha,function(){P(la,wa)})};var Oa="//fonts.googleapis.com/css",Ma={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",
khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},$a={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},cb={i:"i",italic:"i",n:"n",normal:"n"},wb=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,
xb={Arimo:!0,Cousine:!0,Tinos:!0};Ea.prototype.load=function(P){var da=new u,Ba=this.c,T=new za(this.a.api,l(Ba),this.a.text),wa=this.a.families;Da(T,wa);var Ha=new V(wa);xa(Ha);q(Ba,ia(T),n(da));w(da,function(){P(Ha.a,Ha.c,xb)})};Ia.prototype.load=function(P){var da=this.a.id,Ba=this.c.m;da?m(this.c,(this.a.api||"https://use.typekit.net")+"/"+da+".js",function(T){if(T)P([]);else if(Ba.Typekit&&Ba.Typekit.config&&Ba.Typekit.config.fn){T=Ba.Typekit.config.fn;for(var wa=[],Ha=0;Ha<T.length;Ha+=2)for(var Fa=
T[Ha],la=T[Ha+1],Ua=0;Ua<la.length;Ua++)wa.push(new C(Fa,la[Ua]));try{Ba.Typekit.load({events:!1,classes:!1,async:!0})}catch(Xa){}P(wa)}},2E3):P([])};Qa.prototype.load=function(P){var da=this.f.id,Ba=this.c.m,T=this;da?(Ba.__webfontfontdeckmodule__||(Ba.__webfontfontdeckmodule__={}),Ba.__webfontfontdeckmodule__[da]=function(wa,Ha){wa=0;for(var Fa=Ha.fonts.length;wa<Fa;++wa){var la=Ha.fonts[wa],Ua=T.a,Xa=Ua.push,La=la.name;la="font-weight:"+la.weight+";font-style:"+la.style;var db=4,pb="n",Bb=null;
la&&((Bb=la.match(/(normal|oblique|italic)/i))&&Bb[1]&&(pb=Bb[1].substr(0,1).toLowerCase()),(Bb=la.match(/([1-9]00|normal|bold)/i))&&Bb[1]&&(/bold/i.test(Bb[1])?db=7:/[1-9]00/.test(Bb[1])&&(db=parseInt(Bb[1].substr(0,1),10))));Xa.call(Ua,new C(La,pb+db))}P(T.a)},m(this.c,l(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+r(this.c)+"/"+da+".js",function(wa){wa&&P([])})):P([])};var zb=new R(window);zb.a.c.custom=function(P,da){return new ra(da,P)};zb.a.c.fontdeck=function(P,da){return new Qa(da,P)};
zb.a.c.monotype=function(P,da){return new ja(da,P)};zb.a.c.typekit=function(P,da){return new Ia(da,P)};zb.a.c.google=function(P,da){return new Ea(da,P)};var eb={load:c(zb.load,zb)};"function"===typeof define&&define.amd?define(function(){return eb}):"undefined"!==typeof module&&module.exports?module.exports=eb:(window.WebFont=eb,window.WebFontConfig&&zb.load(window.WebFontConfig))})();var THREE={REVISION:"71"};"object"===typeof module&&(module.exports=THREE);void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});THREE.log=function(){console.log.apply(console,arguments)};THREE.warn=function(){console.warn.apply(console,arguments)};THREE.error=function(){console.error.apply(console,arguments)};THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;
THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;
THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;
THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(f,g,e){0>e&&(e+=1);1<e&&--e;return e<1/6?f+6*(g-f)*e:
.5>e?g:e<2/3?f+6*(g-f)*(2/3-e):f};b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;this.r=d(c,b,a+1/3);this.g=d(c,b,a);this.b=d(c,b,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))return a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this;if(/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.test(a))return a=/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.exec(a),this.r=Math.min(100,
parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this;if(/^#([0-9a-f]{6})$/i.test(a))return a=/^#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this;if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return a=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this;if(/^(\w+)$/i.test(a))return this.setHex(THREE.ColorKeywords[a]),this},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;
return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);
return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,f=Math.max(b,c,d),g=Math.min(b,c,d),e,k=(g+f)/2;if(g===f)g=e=0;else{var h=f-g;g=.5>=k?h/(f+g):h/(2-f-g);switch(f){case b:e=(c-d)/h+(c<d?6:0);break;case c:e=(d-b)/h+2;break;case d:e=(b-c)/h+4}e/=6}a.h=e;a.s=g;a.l=k;return a},getStyle:function(){return"rgb("+(255*this.r|0)+
","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,
b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;
this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),f=Math.cos(a._z/2),g=Math.sin(a._x/2),e=Math.sin(a._y/2),k=Math.sin(a._z/2);"XYZ"===a.order?(this._x=g*d*f+c*e*k,this._y=c*e*f-g*d*k,this._z=c*d*k+g*e*f,this._w=c*d*f-g*e*k):"YXZ"===a.order?(this._x=g*d*f+c*e*k,this._y=c*e*f-g*d*k,this._z=
c*d*k-g*e*f,this._w=c*d*f+g*e*k):"ZXY"===a.order?(this._x=g*d*f-c*e*k,this._y=c*e*f+g*d*k,this._z=c*d*k+g*e*f,this._w=c*d*f-g*e*k):"ZYX"===a.order?(this._x=g*d*f-c*e*k,this._y=c*e*f+g*d*k,this._z=c*d*k-g*e*f,this._w=c*d*f+g*e*k):"YZX"===a.order?(this._x=g*d*f+c*e*k,this._y=c*e*f+g*d*k,this._z=c*d*k-g*e*f,this._w=c*d*f-g*e*k):"XZY"===a.order&&(this._x=g*d*f-c*e*k,this._y=c*e*f-g*d*k,this._z=c*d*k+g*e*f,this._w=c*d*f+g*e*k);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,
b){b/=2;var c=Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],f=b[1],g=b[5],e=b[9],k=b[2],h=b[6];b=b[10];var l=c+g+b;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(h-e)*c,this._y=(d-k)*c,this._z=(f-a)*c):c>g&&c>b?(c=2*Math.sqrt(1+c-g-b),this._w=(h-e)/c,this._x=.25*c,this._y=(a+f)/c,this._z=(d+k)/c):g>b?(c=2*Math.sqrt(1+g-c-b),this._w=(d-k)/c,this._x=(a+f)/c,this._y=
.25*c,this._z=(e+h)/c):(c=2*Math.sqrt(1+b-c-g),this._w=(f-a)/c,this._x=(d+k)/c,this._y=(e+h)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,f=a._z;a=a._w;var g=b._x,e=b._y,k=b._z;b=b._w;this._x=c*b+a*g+d*k-f*e;this._y=d*b+a*e+f*g-c*k;this._z=f*b+a*k+c*e-d*g;this._w=a*b-c*g-d*e-f*k;this.onChangeCallback();return this},multiplyVector3:function(a){THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,f=this._z,g=this._w,e=g*a._w+c*a._x+d*a._y+f*a._z;0>e?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,e=-e):this.copy(a);if(1<=e)return this._w=g,this._x=c,this._y=d,this._z=f,this;a=Math.acos(e);var k=Math.sqrt(1-e*e);if(.001>Math.abs(k))return this._w=.5*(g+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(f+this._z),this;e=Math.sin((1-b)*a)/k;b=
Math.sin(b*a)/k;this._w=g*e+this._w*b;this._x=c*e+this._x*b;this._y=d*e+this._y*b;this._z=f*e+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,
b){if(void 0!==b)return THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},
subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);
this.y<a.y&&(this.y=a.y);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=
Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},
distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===
a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=
a;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,
c));return this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var f=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*
c+a[8]*d+a[12])*f;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*f;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*f;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,f=a.x,g=a.y,e=a.z;a=a.w;var k=a*b+g*d-e*c,h=a*c+e*b-f*d,l=a*d+f*c-g*b;b=-f*b-g*c-e*d;this.x=k*a+b*-f+h*-e-l*-g;this.y=h*a+b*-g+l*-f-k*-e;this.z=l*a+b*-e+k*-g-h*-f;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),
unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=
a):this.z=this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,
b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):
Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);b=this.x;var c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=
d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var f=b.x,g=b.y;b=b.z;this.x=d*b-a*g;this.y=a*f-c*b;this.z=c*g-d*f;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new THREE.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;
return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setEulerFromRotationMatrix:function(a,b){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},
setEulerFromQuaternion:function(a,b){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,
b){THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;
return this},setFromMatrixColumn:function(a,b){a*=4;b=b.elements;this.x=b[a];this.y=b[a+1];this.z=b[a+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+
2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=
a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,f=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*f;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*f;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*f;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*f;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>
b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],f=a[1],g=a[5],e=a[9];var k=a[2];var h=a[6];var l=a[10];if(.01>Math.abs(c-f)&&.01>Math.abs(d-k)&&.01>Math.abs(e-h)){if(.1>Math.abs(c+f)&&.1>Math.abs(d+k)&&.1>Math.abs(e+h)&&.1>Math.abs(b+g+l-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;g=(g+1)/2;l=(l+1)/2;c=(c+f)/4;d=(d+k)/4;e=(e+h)/4;b>g&&b>l?.01>b?(h=0,c=k=.707106781):
(h=Math.sqrt(b),k=c/h,c=d/h):g>l?.01>g?(h=.707106781,k=0,c=.707106781):(k=Math.sqrt(g),h=c/k,c=e/k):.01>l?(k=h=.707106781,c=0):(c=Math.sqrt(l),h=d/c,k=e/c);this.set(h,k,c,a);return this}a=Math.sqrt((h-e)*(h-e)+(d-k)*(d-k)+(f-c)*(f-c));.001>Math.abs(a)&&(a=1);this.x=(h-e)/a;this.y=(d-k)/a;this.z=(f-c)/a;this.w=Math.acos((b+g+l-1)/2);return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&
(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},
fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};
THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(a){this._x=
a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,f=a.elements;a=f[0];var g=f[4],e=f[8],k=f[1],h=f[5],l=f[9],r=f[2],q=f[6];f=f[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(e,-1,1)),.99999>Math.abs(e)?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-g,a)):(this._x=Math.atan2(q,h),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(e,f),this._z=Math.atan2(k,
h)):(this._y=Math.atan2(-r,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(q,-1,1)),.99999>Math.abs(q)?(this._y=Math.atan2(-r,f),this._z=Math.atan2(-g,h)):(this._y=0,this._z=Math.atan2(k,a))):"ZYX"===b?(this._y=Math.asin(-d(r,-1,1)),.99999>Math.abs(r)?(this._x=Math.atan2(q,f),this._z=Math.atan2(k,a)):(this._x=0,this._z=Math.atan2(-g,h))):"YZX"===b?(this._z=Math.asin(d(k,-1,1)),.99999>Math.abs(k)?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-r,a)):(this._x=0,this._y=Math.atan2(e,f))):"XZY"===b?(this._z=
Math.asin(-d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(q,h),this._y=Math.atan2(e,a)):(this._x=Math.atan2(-l,f),this._y=0)):THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);this.setFromRotationMatrix(a,c,d);return this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,
b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?
a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,
b){b=b||new THREE.Vector3;return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);c=b.dot(b);c=b.dot(a)/c;d&&(c=THREE.Math.clamp(c,0,1));return c}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);
this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,
this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&
this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,
this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};
THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},
center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<
this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<
this.min.z||a.min.z>this.max.z?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);
this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);
a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};
THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,f,g,e,k,h){var l=this.elements;l[0]=a;l[3]=b;l[6]=c;l[1]=d;l[4]=f;l[7]=g;l[2]=e;l[5]=k;l[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},
multiplyVector3Array:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var f=0;f<d;f+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=
a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],f=a[3],g=a[4],e=a[5],k=a[6],h=a[7];a=a[8];return b*g*a-b*e*h-c*f*a+c*e*k+d*f*h-d*g*k},getInverse:function(a,b){a=a.elements;var c=this.elements;c[0]=a[10]*a[5]-a[6]*a[9];c[1]=-a[10]*a[1]+a[2]*a[9];c[2]=a[6]*a[1]-a[2]*a[5];c[3]=-a[10]*a[4]+a[6]*a[8];c[4]=a[10]*a[0]-a[2]*a[8];c[5]=-a[6]*a[0]+a[2]*a[4];c[6]=a[9]*a[4]-a[5]*a[8];c[7]=-a[9]*a[0]+a[1]*a[8];c[8]=a[5]*a[0]-a[1]*a[4];
a=a[0]*c[0]+a[1]*c[3]+a[2]*c[6];if(0===a){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");THREE.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/a);return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];
a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};
THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,f,g,e,k,h,l,r,q,m,u,n,w){var v=this.elements;v[0]=a;v[4]=b;v[8]=c;v[12]=d;v[1]=f;v[5]=g;v[9]=e;v[13]=k;v[2]=h;v[6]=l;v[10]=r;v[14]=q;v[3]=m;v[7]=u;v[11]=n;v[15]=w;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},
copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){var d=this.elements;a.set(d[0],d[1],d[2]);b.set(d[4],d[5],d[6]);c.set(d[8],d[9],d[10]);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a=new THREE.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),f=1/a.set(b[4],b[5],b[6]).length(),
g=1/a.set(b[8],b[9],b[10]).length();c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*f;c[5]=b[5]*f;c[6]=b[6]*f;c[8]=b[8]*g;c[9]=b[9]*g;c[10]=b[10]*g;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,f=a.z,g=Math.cos(c);c=Math.sin(c);var e=Math.cos(d);d=Math.sin(d);var k=Math.cos(f);f=Math.sin(f);if("XYZ"===a.order){a=g*k;var h=
g*f,l=c*k,r=c*f;b[0]=e*k;b[4]=-e*f;b[8]=d;b[1]=h+l*d;b[5]=a-r*d;b[9]=-c*e;b[2]=r-a*d;b[6]=l+h*d;b[10]=g*e}else"YXZ"===a.order?(a=e*k,h=e*f,l=d*k,r=d*f,b[0]=a+r*c,b[4]=l*c-h,b[8]=g*d,b[1]=g*f,b[5]=g*k,b[9]=-c,b[2]=h*c-l,b[6]=r+a*c,b[10]=g*e):"ZXY"===a.order?(a=e*k,h=e*f,l=d*k,r=d*f,b[0]=a-r*c,b[4]=-g*f,b[8]=l+h*c,b[1]=h+l*c,b[5]=g*k,b[9]=r-a*c,b[2]=-g*d,b[6]=c,b[10]=g*e):"ZYX"===a.order?(a=g*k,h=g*f,l=c*k,r=c*f,b[0]=e*k,b[4]=l*d-h,b[8]=a*d+r,b[1]=e*f,b[5]=r*d+a,b[9]=h*d-l,b[2]=-d,b[6]=c*e,b[10]=g*
e):"YZX"===a.order?(a=g*e,h=g*d,l=c*e,r=c*d,b[0]=e*k,b[4]=r-a*f,b[8]=l*f+h,b[1]=f,b[5]=g*k,b[9]=-c*k,b[2]=-d*k,b[6]=h*f+l,b[10]=a-r*f):"XZY"===a.order&&(a=g*e,h=g*d,l=c*e,r=c*d,b[0]=e*k,b[4]=-f,b[8]=d*k,b[1]=a*f+r,b[5]=g*k,b[9]=h*f-l,b[2]=l*f-h,b[6]=c*k,b[10]=r*f+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},setRotationFromQuaternion:function(a){THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},
makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,f=a.z,g=a.w,e=c+c,k=d+d,h=f+f;a=c*e;var l=c*k;c*=h;var r=d*k;d*=h;f*=h;e*=g;k*=g;g*=h;b[0]=1-(r+f);b[4]=l-g;b[8]=c+k;b[1]=l+g;b[5]=1-(a+f);b[9]=d-e;b[2]=c-k;b[6]=d+e;b[10]=1-(a+r);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,f,g){var e=this.elements;c.subVectors(d,f).normalize();0===c.length()&&(c.z=1);a.crossVectors(g,
c).normalize();0===a.length()&&(c.x+=1E-4,a.crossVectors(g,c).normalize());b.crossVectors(c,a);e[0]=a.x;e[4]=b.x;e[8]=c.x;e[1]=a.y;e[5]=b.y;e[9]=c.y;e[2]=a.z;e[6]=b.z;e[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var f=c[4],g=
c[8],e=c[12],k=c[1],h=c[5],l=c[9],r=c[13],q=c[2],m=c[6],u=c[10],n=c[14],w=c[3],v=c[7],y=c[11];c=c[15];var C=d[0],A=d[4],I=d[8],D=d[12],E=d[1],O=d[5],S=d[9],W=d[13],U=d[2],va=d[6],ta=d[10],qa=d[14],ha=d[3],F=d[7],J=d[11];d=d[15];b[0]=a*C+f*E+g*U+e*ha;b[4]=a*A+f*O+g*va+e*F;b[8]=a*I+f*S+g*ta+e*J;b[12]=a*D+f*W+g*qa+e*d;b[1]=k*C+h*E+l*U+r*ha;b[5]=k*A+h*O+l*va+r*F;b[9]=k*I+h*S+l*ta+r*J;b[13]=k*D+h*W+l*qa+r*d;b[2]=q*C+m*E+u*U+n*ha;b[6]=q*A+m*O+u*va+n*F;b[10]=q*I+m*S+u*ta+n*J;b[14]=q*D+m*W+u*qa+n*d;b[3]=
w*C+v*E+y*U+c*ha;b[7]=w*A+v*O+y*va+c*F;b[11]=w*I+v*S+y*ta+c*J;b[15]=w*D+v*W+y*qa+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=
a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var f=0;f<d;f+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],f=a[12],g=a[1],e=a[5],k=a[9],h=a[13],l=a[2],r=a[6],q=a[10],m=a[14];return a[3]*(+f*k*r-d*h*r-f*e*q+c*h*q+d*e*m-c*k*m)+a[7]*(+b*k*m-b*h*q+f*g*q-d*g*m+d*h*l-f*k*l)+a[11]*(+b*h*r-b*e*m-f*g*r+c*g*m+f*e*l-c*h*l)+a[15]*(-d*e*l-b*k*r+b*e*q+d*g*r-c*g*q+c*k*l)},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=
a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");
var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements;a=d[0];var f=d[4],g=d[8],e=d[12],k=d[1],h=d[5],l=d[9],r=d[13],q=d[2],m=d[6],u=d[10],n=d[14],w=d[3],v=d[7],y=d[11];d=d[15];c[0]=l*n*v-r*u*v+r*m*y-h*n*y-l*m*d+h*u*d;c[4]=e*u*v-g*n*v-e*m*y+f*n*y+g*m*d-f*u*d;c[8]=g*r*v-e*l*v+e*h*y-f*r*y-g*h*d+f*l*d;c[12]=e*l*m-g*r*m-e*h*u+f*r*u+g*h*n-f*l*n;c[1]=r*u*w-l*
n*w-r*q*y+k*n*y+l*q*d-k*u*d;c[5]=g*n*w-e*u*w+e*q*y-a*n*y-g*q*d+a*u*d;c[9]=e*l*w-g*r*w-e*k*y+a*r*y+g*k*d-a*l*d;c[13]=g*r*q-e*l*q+e*k*u-a*r*u-g*k*n+a*l*n;c[2]=h*n*w-r*m*w+r*q*v-k*n*v-h*q*d+k*m*d;c[6]=e*m*w-f*n*w-e*q*v+a*n*v+f*q*d-a*m*d;c[10]=f*r*w-e*h*w+e*k*v-a*r*v-f*k*d+a*h*d;c[14]=e*h*q-f*r*q-e*k*m+a*r*m+f*k*n-a*h*n;c[3]=l*m*w-h*u*w-l*q*v+k*u*v+h*q*y-k*m*y;c[7]=f*u*w-g*m*w+g*q*v-a*u*v-f*q*y+a*m*y;c[11]=g*h*w-f*l*w-g*k*v+a*l*v+f*k*y-a*h*y;c[15]=f*l*q-g*h*q+g*k*m-a*l*m-f*k*u+a*h*u;c=a*c[0]+k*c[4]+q*
c[8]+w*c[12];if(0==c){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");THREE.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(a){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(a,b){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,
c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,f=a.x,g=a.y;a=a.z;var e=d*f,k=d*g;this.set(e*f+c,e*g-b*a,e*a+b*
g,0,e*g+b*a,k*g+c,k*a-b*f,0,e*a-b*g,k*a+b*f,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new THREE.Vector3,b=new THREE.Matrix4;return function(c,d,f){var g=this.elements,e=a.set(g[0],g[1],g[2]).length(),k=a.set(g[4],g[5],g[6]).length(),h=a.set(g[8],g[9],g[10]).length();0>this.determinant()&&(e=-e);c.x=
g[12];c.y=g[13];c.z=g[14];b.elements.set(this.elements);c=1/e;g=1/k;var l=1/h;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=g;b.elements[5]*=g;b.elements[6]*=g;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);f.x=e;f.y=k;f.z=h;return this}}(),makeFrustum:function(a,b,c,d,f,g){var e=this.elements;e[0]=2*f/(b-a);e[4]=0;e[8]=(b+a)/(b-a);e[12]=0;e[1]=0;e[5]=2*f/(d-c);e[9]=(d+c)/(d-c);e[13]=0;e[2]=0;e[6]=0;e[10]=-(g+f)/(g-f);e[14]=-2*g*f/(g-f);e[3]=0;e[7]=
0;e[11]=-1;e[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.degToRad(.5*a));var f=-a;return this.makeFrustum(f*b,a*b,f,a,c,d)},makeOrthographic:function(a,b,c,d,f,g){var e=this.elements,k=b-a,h=c-d,l=g-f;e[0]=2/k;e[4]=0;e[8]=0;e[12]=-((b+a)/k);e[1]=0;e[5]=2/h;e[9]=0;e[13]=-((c+d)/h);e[2]=0;e[6]=0;e[10]=-2/l;e[14]=-((g+f)/l);e[3]=0;e[7]=0;e[11]=0;e[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],
a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};
THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,f){f=f||new THREE.Vector3;f.subVectors(d,c);a.subVectors(b,c);f.cross(a);b=f.lengthSq();return 0<b?f.multiplyScalar(1/Math.sqrt(b)):f.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,f,g,e,k){a.subVectors(e,f);b.subVectors(g,f);c.subVectors(d,f);d=a.dot(a);f=a.dot(b);g=a.dot(c);var h=b.dot(b);e=b.dot(c);var l=d*h-f*f;k=k||new THREE.Vector3;if(0==l)return k.set(-2,-1,-1);l=1/l;h=(h*g-f*e)*l;d=(d*e-f*g)*l;return k.set(1-h-d,d,h)}}();
THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,f){b=THREE.Triangle.barycoordFromPoint(b,c,d,f,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||
new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},
clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){b=b||new THREE.Vector3;b.subVectors(a,this.origin);
a=b.dot(this.direction);return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,f,g,e){a.copy(d).add(f).multiplyScalar(.5);
b.copy(f).sub(d).normalize();c.copy(this.origin).sub(a);var k=.5*d.distanceTo(f),h=-this.direction.dot(b),l=c.dot(this.direction),r=-c.dot(b),q=c.lengthSq(),m=Math.abs(1-h*h);if(0<m){d=h*r-l;f=h*l-r;var u=k*m;0<=d?f>=-u?f<=u?(k=1/m,d*=k,f*=k,h=d*(d+h*f+2*l)+f*(h*d+f+2*r)+q):(f=k,d=Math.max(0,-(h*f+l)),h=-d*d+f*(f+2*r)+q):(f=-k,d=Math.max(0,-(h*f+l)),h=-d*d+f*(f+2*r)+q):f<=-u?(d=Math.max(0,-(-h*k+l)),f=0<d?-k:Math.min(Math.max(-k,-r),k),h=-d*d+f*(f+2*r)+q):f<=u?(d=0,f=Math.min(Math.max(-k,-r),k),h=
f*(f+2*r)+q):(d=Math.max(0,-(h*k+l)),f=0<d?k:Math.min(Math.max(-k,-r),k),h=-d*d+f*(f+2*r)+q)}else f=0<h?-k:k,d=Math.max(0,-(h*f+l)),h=-d*d+f*(f+2*r)+q;g&&g.copy(this.direction).multiplyScalar(d).add(this.origin);e&&e.copy(b).multiplyScalar(f).add(a);return h}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},intersectSphere:function(){var a=new THREE.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),f=a.dot(a)-d*d;b=b.radius*
b.radius;if(f>b)return null;b=Math.sqrt(b-f);f=d-b;d+=b;return 0>f&&0>d?null:0>f?this.at(d,c):this.at(f,c)}}(),isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,
b)},isIntersectionBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var f=1/this.direction.z,g=this.origin;if(0<=c){var e=(a.min.x-g.x)*c;c*=a.max.x-g.x}else e=(a.max.x-g.x)*c,c*=a.min.x-g.x;if(0<=d){var k=(a.min.y-g.y)*d;d*=a.max.y-g.y}else k=(a.max.y-g.y)*d,d*=a.min.y-g.y;if(e>d||k>c)return null;if(k>e||e!==e)e=k;if(d<c||c!==c)c=d;0<=f?(k=(a.min.z-g.z)*f,a=(a.max.z-g.z)*
f):(k=(a.max.z-g.z)*f,a=(a.min.z-g.z)*f);if(e>a||k>c)return null;if(k>e||e!==e)e=k;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=e?e:c,b)},intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(f,g,e,k,h){b.subVectors(g,f);c.subVectors(e,f);d.crossVectors(b,c);g=this.direction.dot(d);if(0<g){if(k)return null;k=1}else if(0>g)k=-1,g=-g;else return null;a.subVectors(this.origin,f);f=k*this.direction.dot(c.crossVectors(a,c));if(0>
f)return null;e=k*this.direction.dot(b.cross(a));if(0>e||f+e>g)return null;f=-k*a.dot(d);return 0>f?null:this.at(f/g,h)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};
THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var f=c=0,g=b.length;f<g;f++)c=Math.max(c,d.distanceToSquared(b[f]));this.radius=Math.sqrt(c);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);b=b||new THREE.Vector3;b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,f){d=a.subVectors(f,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,
c);return this}}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,
b){a=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(a)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){c=c||new THREE.Vector3;var d=b.delta(a),f=this.normal.dot(d);if(0==f){if(0==this.distanceToPoint(b.start))return c.copy(b.start)}else if(f=-(b.start.dot(this.normal)+this.constant)/f,!(0>f||1<f))return c.copy(d).multiplyScalar(f).add(b.start)}}(),
coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(d,f){f=f||c.getNormalMatrix(d);f=a.copy(this.normal).applyMatrix3(f);var g=this.coplanarPoint(b);g.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(f,g);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&
a.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};
THREE.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var f=0;36>f;f++)8==f||13==f||18==f||23==f?b[f]="-":14==f?b[f]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[f]=a[19==f?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,f){return d+(a-b)*(f-d)/(c-b)},smoothstep:function(a,b,c){if(a<=
b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return Math.floor(this.randFloat(a,b))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=
180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();
a=.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};
THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&
c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,f=0;f<d;f++)c[f]=b[f];for(f=0;f<d;f++)c[f].call(this,a)}}}};
THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.name="";this.parent=void 0;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},
scale:{enumerable:!0,value:d}});this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);
THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=
new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);
this.position.add(a.multiplyScalar(c));return this}}(),translate:function(a,b){THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,
b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",
a),this;a instanceof THREE.Object3D?(void 0!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getChildByName:function(a){THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
return this.getObjectByName(a)},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var f=this.children[c].getObjectByProperty(a,b);if(void 0!==f)return f}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=
new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,
b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverseVisible(a)}},traverseAncestors:function(a){this.parent&&(a(this.parent),
this.parent.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},
clone:function(a,b){void 0===a&&(a=new THREE.Object3D);void 0===b&&(b=!0);a.name=this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=
this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(!0===b)for(b=0;b<this.children.length;b++)a.add(this.children[b].clone());return a}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;
THREE.Face3=function(a,b,c,d,f,g){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=f instanceof THREE.Color?f:new THREE.Color;this.vertexColors=f instanceof Array?f:[];this.vertexTangents=[];this.materialIndex=void 0!==g?g:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.materialIndex=this.materialIndex;for(var b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();b=0;for(c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();b=0;for(c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};
THREE.BufferAttribute=function(a,b){this.array=a;this.itemSize=b;this.needsUpdate=!1};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,f=this.itemSize;d<f;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},setX:function(a,b){this.array[a*this.itemSize]=b;return this},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},setXY:function(a,
b,c){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,f){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=f;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};
THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.name="";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,b){this.attributes[a]=b;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),
b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(a));return a},computeBoundingBox:function(){var a=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var b=this.attributes.position.array;if(b){var c=this.boundingBox;c.makeEmpty();for(var d=0,f=b.length;d<
f;d+=3)a.set(b[d],b[d+1],b[d+2]),c.expandByPoint(a)}if(void 0===b||0===b.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&
(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;if(c){a.makeEmpty();for(var d=this.boundingSphere.center,f=0,g=c.length;f<g;f+=3)b.set(c[f],c[f+1],c[f+2]),a.expandByPoint(b);a.center(d);var e=0;f=0;for(g=c.length;f<g;f+=3)b.set(c[f],c[f+1],c[f+2]),e=Math.max(e,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(e);isNaN(this.boundingSphere.radius)&&THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),
computeVertexNormals:function(){var a=this.attributes;if(a.position){var b=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(b.length),3));else for(var c=a.normal.array,d=0,f=c.length;d<f;d++)c[d]=0;c=a.normal.array;var g=new THREE.Vector3,e=new THREE.Vector3,k=new THREE.Vector3,h=new THREE.Vector3,l=new THREE.Vector3;if(a.index)for(var r=a.index.array,q=0<this.offsets.length?this.offsets:[{start:0,count:r.length,index:0}],m=0,u=q.length;m<
u;++m){f=q[m].start;var n=q[m].count;var w=q[m].index;d=f;for(f+=n;d<f;d+=3){n=3*(w+r[d]);var v=3*(w+r[d+1]);var y=3*(w+r[d+2]);g.fromArray(b,n);e.fromArray(b,v);k.fromArray(b,y);h.subVectors(k,e);l.subVectors(g,e);h.cross(l);c[n]+=h.x;c[n+1]+=h.y;c[n+2]+=h.z;c[v]+=h.x;c[v+1]+=h.y;c[v+2]+=h.z;c[y]+=h.x;c[y+1]+=h.y;c[y+2]+=h.z}}else for(d=0,f=b.length;d<f;d+=9)g.fromArray(b,d),e.fromArray(b,d+3),k.fromArray(b,d+6),h.subVectors(k,e),l.subVectors(g,e),h.cross(l),c[d]=h.x,c[d+1]=h.y,c[d+2]=h.z,c[d+3]=
h.x,c[d+4]=h.y,c[d+5]=h.z,c[d+6]=h.x,c[d+7]=h.y,c[d+8]=h.z;this.normalizeNormals();a.normal.needsUpdate=!0}},computeTangents:function(){function a(ja,na,ra){q.fromArray(d,3*ja);m.fromArray(d,3*na);u.fromArray(d,3*ra);n.fromArray(g,2*ja);w.fromArray(g,2*na);v.fromArray(g,2*ra);y=m.x-q.x;C=u.x-q.x;A=m.y-q.y;I=u.y-q.y;D=m.z-q.z;E=u.z-q.z;O=w.x-n.x;S=v.x-n.x;W=w.y-n.y;U=v.y-n.y;va=1/(O*U-S*W);ta.set((U*y-W*C)*va,(U*A-W*I)*va,(U*D-W*E)*va);qa.set((O*C-S*y)*va,(O*I-S*A)*va,(O*E-S*D)*va);h[ja].add(ta);h[na].add(ta);
h[ra].add(ta);l[ja].add(qa);l[na].add(qa);l[ra].add(qa)}function b(ja){fa.fromArray(f,3*ja);K.copy(fa);ka=h[ja];ya.copy(ka);ya.sub(fa.multiplyScalar(fa.dot(ka))).normalize();Q.crossVectors(K,ka);ba=Q.dot(l[ja]);R=0>ba?-1:1;k[4*ja]=ya.x;k[4*ja+1]=ya.y;k[4*ja+2]=ya.z;k[4*ja+3]=R}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");
else{var c=this.attributes.index.array,d=this.attributes.position.array,f=this.attributes.normal.array,g=this.attributes.uv.array,e=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*e),4));for(var k=this.attributes.tangent.array,h=[],l=[],r=0;r<e;r++)h[r]=new THREE.Vector3,l[r]=new THREE.Vector3;var q=new THREE.Vector3,m=new THREE.Vector3,u=new THREE.Vector3,n=new THREE.Vector2,w=new THREE.Vector2,v=new THREE.Vector2,y,C,A,I,D,E,
O,S,W,U,va,ta=new THREE.Vector3,qa=new THREE.Vector3,ha;0===this.drawcalls.length&&this.addDrawCall(0,c.length,0);var F=this.drawcalls;r=0;for(ha=F.length;r<ha;++r){var J=F[r].start;var Z=F[r].count;var M=F[r].index;e=J;for(J+=Z;e<J;e+=3){Z=M+c[e];var ma=M+c[e+1];var ea=M+c[e+2];a(Z,ma,ea)}}var ya=new THREE.Vector3,Q=new THREE.Vector3,fa=new THREE.Vector3,K=new THREE.Vector3,R,ka,ba;r=0;for(ha=F.length;r<ha;++r)for(J=F[r].start,Z=F[r].count,M=F[r].index,e=J,J+=Z;e<J;e+=3)Z=M+c[e],ma=M+c[e+1],ea=M+
c[e+2],b(Z),b(ma),b(ea)}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,f=0,g=a.length;f<g;f+=3)b=a[f],c=a[f+1],d=a[f+2],b=1/Math.sqrt(b*b+c*c+d*d),a[f]*=b,a[f+1]*=b,a[f+2]*=b},clone:function(){var a=new THREE.BufferGeometry;for(b in this.attributes)a.addAttribute(b,this.attributes[b].clone());var b=0;for(var c=this.offsets.length;b<c;b++){var d=this.offsets[b];a.offsets.push({start:d.start,index:d.index,count:d.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();
THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(a){void 0===a&&(a=new THREE.Camera);THREE.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a};
THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.zoom=1;this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,f,g){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=f;this.height=g;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight;a=Math.tan(THREE.Math.degToRad(.5*a))*this.near;var c=-a,d=b*c;b=Math.abs(b*a-d);c=Math.abs(a-c);this.projectionMatrix.makeFrustum(d+this.x*b/this.fullWidth,d+(this.x+this.width)*b/this.fullWidth,a-(this.y+this.height)*c/this.fullHeight,a-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,
this.aspect,this.near,this.far)};THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.OrthographicCamera=function(a,b,c,d,f,g){THREE.Camera.call(this);this.zoom=1;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==f?f:.1;this.far=void 0!==g?g:2E3;this.updateProjectionMatrix()};
THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)};
THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};
THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;
THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.clone=function(a,b){void 0===a&&(a=new THREE.Mesh(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,a,b);return a};THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=null;this.autoUpdate=!0};
THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(a){void 0===a&&(a=new THREE.Scene);THREE.Object3D.prototype.clone.call(this,a);null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone());a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};
THREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),f;for(f in d)b[f]=d[f]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var f=a[c][d];b[c][d]=f&&void 0!==f.clone?f.clone():f instanceof Array?f.slice():f}}return b}};
THREE.BoxBufferGeometry=function(a,b,c,d,f,g){function e(m,u,n,w,v,y,C,A,I,D){var E=y/I,O=C/D,S=y/2,W=C/2,U=A/2;C=I+1;var va=D+1;y=0;var ta,qa,ha=new THREE.Vector3;for(qa=0;qa<va;qa++){var F=qa*O-W;for(ta=0;ta<C;ta++)ha[m]=(ta*E-S)*w,ha[u]=F*v,ha[n]=U,h.push(ha.x,ha.y,ha.z),ha[m]=0,ha[u]=0,ha[n]=0<A?1:-1,l.push(ha.x,ha.y,ha.z),r.push(ta/I),r.push(1-qa/D),y+=1}for(qa=0;qa<D;qa++)for(ta=0;ta<I;ta++)m=q+ta+C*(qa+1),u=q+(ta+1)+C*(qa+1),n=q+(ta+1)+C*qa,k.push(q+ta+C*qa,m,n),k.push(m,u,n);q+=y}THREE.BufferGeometry.call(this);
this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:f,depthSegments:g};d=Math.floor(d)||1;f=Math.floor(f)||1;g=Math.floor(g)||1;var k=[],h=[],l=[],r=[],q=0;e("z","y","x",-1,-1,c,b,a,g,f);e("z","y","x",1,-1,c,b,-a,g,f);e("x","z","y",1,1,a,c,b,d,g);e("x","z","y",1,-1,a,c,-b,d,g);e("x","y","z",1,-1,a,b,c,d,f);e("x","y","z",-1,-1,a,b,-c,d,f);console.assert(65536>=h.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(k),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(h),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(l),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(r),2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;
THREE.SphereBufferGeometry=function(a,b,c,d,f,g,e){THREE.BufferGeometry.call(this);this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:f,thetaStart:g,thetaLength:e};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;f=void 0!==f?f:2*Math.PI;g=void 0!==g?g:0;e=void 0!==e?e:Math.PI;var k=g+e,h,l,r=0,q=[],m=new THREE.Vector3,u=new THREE.Vector3,n=[],w=[],v=[],y=[];for(l=0;l<=c;l++){var C=[],A=l/c;for(h=0;h<=b;h++){var I=h/b;m.x=-a*Math.cos(d+
I*f)*Math.sin(g+A*e);m.y=a*Math.cos(g+A*e);m.z=a*Math.sin(d+I*f)*Math.sin(g+A*e);w.push(m.x,m.y,m.z);u.set(m.x,m.y,m.z).normalize();v.push(u.x,u.y,u.z);y.push(I,1-A);C.push(r++)}q.push(C)}for(l=0;l<c;l++)for(h=0;h<b;h++)a=q[l][h+1],d=q[l][h],f=q[l+1][h],e=q[l+1][h+1],(0!==l||0<g)&&n.push(a,d,e),(l!==c-1||k<Math.PI)&&n.push(d,f,e);console.assert(65536>=w.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(n),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(w),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(v),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(y),2))};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;
THREE.PlaneBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var f=a/2,g=b/2;c=c||1;d=d||1;var e=c+1,k=d+1,h=a/c,l=b/d;b=new Float32Array(e*k*3);a=new Float32Array(e*k*3);for(var r=new Float32Array(e*k*2),q=0,m=0,u=0;u<k;u++)for(var n=u*l-g,w=0;w<e;w++)b[q]=w*h-f,b[q+1]=-n,a[q+2]=1,r[m]=w/c,r[m+1]=1-u/d,q+=3,m+=2;q=0;f=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(u=0;u<d;u++)for(w=
0;w<c;w++)g=w+e*(u+1),k=w+1+e*(u+1),h=w+1+e*u,f[q]=w+e*u,f[q+1]=g,f[q+2]=h,f[q+3]=g,f[q+4]=k,f[q+5]=h,q+=6;this.addAttribute("index",new THREE.BufferAttribute(f,1));this.addAttribute("position",new THREE.BufferAttribute(b,3));this.addAttribute("normal",new THREE.BufferAttribute(a,3));this.addAttribute("uv",new THREE.BufferAttribute(r,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;
THREE.CylinderBufferGeometry=function(a,b,c,d,f,g,e,k){function h(v){var y,C=new THREE.Vector2,A=new THREE.Vector3,I=!0===v?a:b,D=!0===v?1:-1;var E=u;for(y=1;y<=d;y++)r.push(0,w*D,0),q.push(0,D,0),m.push(.5,.5),u++;var O=u;for(y=0;y<=d;y++){var S=y/d*k+e,W=Math.cos(S);S=Math.sin(S);A.x=I*S;A.y=w*D;A.z=I*W;r.push(A.x,A.y,A.z);q.push(0,D,0);C.x=.5*W+.5;C.y=.5*S*D+.5;m.push(C.x,C.y);u++}for(y=0;y<d;y++)C=E+y,A=O+y,!0===v?l.push(A,A+1,C):l.push(A+1,A,C)}THREE.BufferGeometry.call(this);this.parameters=
{radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:f,openEnded:g,thetaStart:e,thetaLength:k};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;f=Math.floor(f)||1;g=void 0!==g?g:!1;e=void 0!==e?e:0;k=void 0!==k?k:2*Math.PI;var l=[],r=[],q=[],m=[],u=0,n=[],w=c/2;(function(){var v,y,C=new THREE.Vector3,A=new THREE.Vector3,I=(b-a)/c;for(y=0;y<=f;y++){var D=[],E=y/f,O=E*(b-a)+a;for(v=0;v<=d;v++){var S=v/d,W=S*k+e,U=Math.sin(W);W=Math.cos(W);A.x=O*U;A.y=-E*c+w;
A.z=O*W;r.push(A.x,A.y,A.z);C.set(U,I,W).normalize();q.push(C.x,C.y,C.z);m.push(S,1-E);D.push(u++)}n.push(D)}for(v=0;v<d;v++)for(y=0;y<f;y++)C=n[y+1][v],A=n[y+1][v+1],I=n[y][v+1],l.push(n[y][v],C,I),l.push(C,A,I)})();!1===g&&(0<a&&h(!0),0<b&&h(!1));console.assert(65536>=r.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(l),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(r),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(q),
3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(m),2))};THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;
THREE.TorusBufferGeometry=function(a,b,c,d,f){THREE.BufferGeometry.call(this);this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:f};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||6;f=f||2*Math.PI;var g=[],e=[],k=[],h=[],l=new THREE.Vector3,r=new THREE.Vector3,q=new THREE.Vector3,m,u;for(m=0;m<=c;m++)for(u=0;u<=d;u++){var n=u/d*f,w=m/c*Math.PI*2;r.x=(a+b*Math.cos(w))*Math.cos(n);r.y=(a+b*Math.cos(w))*Math.sin(n);r.z=b*Math.sin(w);e.push(r.x,r.y,r.z);l.x=a*Math.cos(n);l.y=a*
Math.sin(n);q.subVectors(r,l).normalize();k.push(q.x,q.y,q.z);h.push(u/d);h.push(m/c)}for(m=1;m<=c;m++)for(u=1;u<=d;u++)a=(d+1)*(m-1)+u-1,b=(d+1)*(m-1)+u,f=(d+1)*m+u,g.push((d+1)*m+u-1,a,f),g.push(a,b,f);console.assert(65536>=e.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(g),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(e),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(k),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(h),
2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;(function(){function a(){var c={},d=window.location.hash;d&&d.substring(1).split("&").forEach(function(f){var g=f.indexOf("=");0<=g?c[f.substring(0,g)]=f.substring(g+1):c[f]=void 0});return c}function b(c){return c in a()}window.WALK={EDIT_MODE:b("editor"),DEBUG:b("debug"),DEBUG_SHARED_BUFFERS:b("debugbuffers"),ALWAYS_RENDER:!1,LOG_INFO:b("log"),LOG_TO_SERVER:!1,LOG_TIME:!1,PROGRESSIVE_LOADER_AFTER_SEC:30,CONTEXT_LOST_RESTORE_LIMIT:4,DYNAMIC_LIGHTS:!1,HEAD_LIGHT:!1,RETRIES_ON_LOAD_ERROR:3,DEFAULT_ANISOTROPY:4,
NO_ANISOTROPY:1,FORCE_FXAA:!1,FONT_FAMILIES_TO_LOAD:[],MAX_TWO_POINTERS_IN_LINE_DIFF:40,CAMERA_WALK_NEAR:.01,CAMERA_ORBIT_NEAR:.05,CAMERA_MIN_FAR:100,SKY_DISTANCE_TO_SCENE:100,CAMERA_DEFAULT_FOV:70,CAMERA_DEFAULT_MOVE_MAX_SPEED:1.11,CAMERA_LOOK_SPEED:Math.PI/1500,CAMERA_ARROWS_TURN_SPEED:Math.PI/2,CAMERA_SCROLL_SPEED:.5,CAMERA_FULL_ACCELERATION_TIME:.5,CAMERA_FULL_DECELERATION_TIME:.166,CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE:1,MAX_GROUND_SEARCH_DEPTH:5.5,COVER_JSON_URL:"./cover.json",AUTO_TOUR_IN_VIEW_STILL_TIME_MS:3E3,
CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE:.7,KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE:.1,MIN_DISTANCE_TO_CEILING:.1,LIGHT_PROBE_MIRROR_SIZE:512,LIGHT_PROBE_MAX_MIP_SIZE:128,LIGHT_PROBE_MIN_MIP_SIZE:4,LIGHT_PROBE_GLOSS_FOR_MIP:[.99,.9,.85,.7,.4,.25],LIGHT_VISIBILITY_MAP_DOWNSAMPLE:2,LIGHT_DISTANCE_PROBE_SIZE:512,DEBUG_LIGHT_PROBE_MIPS:!1,ENABLE_AUTO_EXPOSURE_CONTROLS:!1,EDITOR_COVER_WIDTH:1920,EDITOR_COVER_HEIGHT:1080,MAX_PANORAMA_SIZE:8192,OBJECT_VISIBILITY_PROBE_SIZE:128,DEFAULT_SKY_NAME:"default",EDITOR_CONTROLLED_SKY_NAME:"sky0",
EDITOR_SELECTION_COLOR:(new THREE.Color(5021401)).convertGammaToLinear(),ALLOW_MOBILE_VR:!0,VR_FALLBACK_CAMERA_HEIGHT:1.6,LOAD_PRIORITY:{CORE_RESOURCE:0,COLORMAP:1,UV0:1,DIFFUSE:2,LIGHTMAP:3,SKY:4,SPECULARITY:5,VIDEO:6},MERGE_TRANSPARENT_DISABLED:b("nomergetransparent"),urlHashContains:b,urlHashGetArgument:function(c){var d=a();return c in d&&void 0!==d[c]?decodeURI(d[c]):null},urlHashRemoveArgument:function(c){var d=a();return Object.keys(d).filter(function(f){return f!==c}).map(function(f){var g=
d[f];return f+(void 0===g?"":"="+g)}).join("&")},isLocalhost:function(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname},TELEPORT_TO_VIEW_MAX_TIME:3,TELEPORT_TO_POINT_MAX_TIME:4.5,TELEPORT_TO_VIEW_ACCELERATION:4,GAZE_POINTER_SHOW_LOADING_AFTER_S:2.5,GAZE_POINTER_ACTIVATE_AFTER_S:4.5,SPRITE_ANCHOR_FONT_SIZE:128,POINTER_PRIORITY:{TRANSFORM_CONTROLS:1,EDITOR_SELECTOR:2,INTERACTION_DISPATCHER:3},BASIS_DECODE_WORKERS:Math.min(4,navigator.hardwareConcurrency||4)};window.WebXRConfig=
{cardboardConfig:{ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:null,CARDBOARD_UI_DISABLED:!1,K_FILTER:.98,ROTATE_INSTRUCTIONS_DISABLED:!1,PREDICTION_TIME_S:.04,YAW_ONLY:!1,BUFFER_SCALE:1,DIRTY_SUBMIT_FRAME_BINDINGS:!1}};window.GLC={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,
INT:5124,UNSIGNED_INT:5125,FLOAT:5126,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,
CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,HALF_FLOAT_OES:36193,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4x4_KHR:37808};window.$=function(c){return document.getElementById(c)}})();/*
 Copyright (C) 2014-present Shapespark
*/
(function(){function a(c,d,f){return function(){c!==d.length&&(f(d[c]),WALK.defer(a(c+1,d,f)))}}var b=2*Math.PI;WALK.defer=function(c){setTimeout(c,0)};WALK.iterateAsync=function(c,d){WALK.defer(a(0,c,d))};WALK.find=function(c,d){for(var f=0;f<c.length;f+=1){var g=c[f];if(d(g))return g}};WALK.filter=function(c,d){for(var f=c.length,g=[],e=0;e<f;e+=1)d(c[e])&&g.push(c[e]);return g};WALK.indexOfMax=function(c,d){if(0===c.length)return null;for(var f=0,g=d?d(c[0]):c[0],e=1;e<c.length;e+=1){var k=d?d(c[e]):
c[e];k>g&&(f=e,g=k)}return f};WALK.any=function(c,d){for(var f=c.length,g=0;g<f;g+=1)if(d(c[g]))return!0;return!1};WALK.removeFromArray=function(c,d){c=d.indexOf(c);console.assert(-1!==c);return d.splice(c,1)};WALK.copyProperties=function(c,d,f){for(var g=0;g<d.length;g+=1){var e=d[g],k=c[e];void 0!==k&&(f[e]=k)}};WALK.normalizeRotation=function(c){c%=b;return c>Math.PI?-b+c:c<-Math.PI?b+c:c};WALK.setTextContent=function(c,d){void 0!==c.textContent?c.textContent=d:void 0!==c.innerText?c.innerText=
d:console.warn("textContent and innerText properties are missing")};WALK.getOriginFromUrl=function(c){var d=document.createElement("a");d.href=c;return d.protocol+"//"+d.host};WALK.log2=function(c){return Math.log(c)/Math.log(2)};WALK.mipsCount=function(c,d){return WALK.log2(d)-WALK.log2(c)+1};WALK.LIGHT_PROBE_MIPS_COUNT=WALK.mipsCount(WALK.LIGHT_PROBE_MIN_MIP_SIZE,WALK.LIGHT_PROBE_MAX_MIP_SIZE);WALK.isModifierPressed=function(c){return c.ctrlKey||c.altKey||c.metaKey};WALK.round=function(c,d){void 0===
d&&(d=3);return+(Math.round(c+"e+"+d)+"e-"+d)};WALK.preloadImage=function(c){var d=new Image;d.src=c;return d};WALK.onVideoDataReady=function(c,d){function f(){c.readyState>=c.HAVE_CURRENT_DATA&&(c.removeEventListener("playing",f),c.removeEventListener("timeupdate",f),d(c))}c.readyState>=c.HAVE_CURRENT_DATA?d(c):(c.addEventListener("playing",f),c.addEventListener("timeupdate",f))};WALK.cloneObject=function(c){return JSON.parse(JSON.stringify(c))};WALK.readOnlyCopy=function(c){return"object"===typeof c?
Object.freeze(WALK.cloneObject(c)):c};WALK.deepEqual=function(c,d){if(c===d)return!0;if("object"!==typeof c||null===c||"object"!==typeof d||null===d||Object.keys(c).length!==Object.keys(d).length)return!1;for(var f=$jscomp.makeIterator(Object.keys(c)),g=f.next();!g.done;g=f.next())if(g=g.value,!d.hasOwnProperty(g)||!WALK.deepEqual(c[g],d[g]))return!1;return!0}})();(function(){function a(f,g,e){WALK.ICONS[f]={name:f,value:g,fontFamily:e}}function b(f,g){a(f,g,"FontAwesomeSolid")}function c(f,g){a(f,g,"FontAwesomeRegular")}function d(f,g){a(f,g,"FontAwesomeBrands")}WALK.ICONS={};b("address-book","\uf2b9");b("address-card","\uf2bb");b("area-chart","\uf1fe");b("arrows","\uf0b2");b("arrow-up","\uf062");b("arrow-down","\uf063");b("assistive-listening-systems","\uf2a2");b("asterisk","\uf069");b("audio-description","\uf29e");b("at","\uf1fa");b("bars","\uf0c9");b("bell",
"\uf0f3");b("book","\uf02d");b("bookmark","\uf02e");b("bullhorn","\uf0a1");b("calculator","\uf1ec");b("camera","\uf030");b("chart-bar","\uf080");b("chart-pie","\uf200");b("chevron-up","\uf077");b("chevron-down","\uf078");b("cloud","\uf0c2");b("cog","\uf013");b("comment","\uf075");c("compass","\uf14e");c("credit-card","\uf09d");b("crosshairs","\uf05b");b("desktop","\uf108");b("download","\uf019");b("envelope","\uf0e0");b("external-link","\uf35d");c("eye","\uf06e");b("eye-dropper","\uf1fb");b("film",
"\uf008");b("flag","\uf024");b("folder","\uf07b");b("gift","\uf06b");b("headphones","\uf025");b("highlighter","\uf591");b("home","\uf015");c("image","\uf03e");b("sign-in","\uf2f6");b("info","\uf129");c("lightbulb","\uf0eb");b("magic","\uf0d0");b("magnet","\uf076");b("map-marker","\uf3c5");b("map-pin","\uf276");b("map-signs","\uf277");b("paint-brush","\uf1fc");b("pencil","\uf303");b("pen","\uf304");b("phone","\uf095");b("question","\uf128");b("share","\uf064");b("share-alt","\uf1e0");b("shopping-cart",
"\uf07a");b("sliders","\uf1de");b("star","\uf005");c("sticky-note","\uf249");b("sync","\uf2f1");c("edit","\uf044");b("tachometer","\uf3fd");b("tag","\uf02b");b("video","\uf03d");b("wrench","\uf0ad");b("palette","\uf53f");b("paint-roller","\uf5aa");b("play","\uf04b");b("plus","\uf067");d("youtube","\uf167");d("vimeo","\uf40a");d("facebook","\uf09a");d("twitter","\uf099");d("instagram","\uf16d");d("linkedin","\uf08c");d("skype","\uf17e");d("whatsapp","\uf232");d("facebook-messenger","\uf39f");d("telegram",
"\uf2c6");d("slack","\uf198")})();(function(){function a(h,l){return function(r){k.finished(h);l(r)}}function b(h){this.method=h;this.binaryResult=!1;this.dataContentType=this.data=null;"GET"===h?(this.retriesLeft=WALK.RETRIES_ON_LOAD_ERROR,this.retryDelay=.5+Math.random()):this.retryDelay=this.retriesLeft=0}function c(h,l,r,q,m){setTimeout(function(){d(h,l,r,q,m)},l.retryDelay);l.retryScheduled()}function d(h,l,r,q,m){function u(){var w=n.status||0;w="GET"===l.method&&(500<=w||0===w)?0!==l.retriesLeft:!1;console.warn("Failed to "+
l.method+": "+h+" ("+n.status+")"+(w?", retrying in "+l.retryDelay+"s":""));if(w)c(h,l,r,q,m);else if(void 0!==q){try{var v=JSON.parse(n.responseText).message}catch(y){v=void 0}q(n.status,v)}l=n=null}var n=new XMLHttpRequest;void 0!==m&&n.addEventListener("progress",m,!1);n.addEventListener("load",function(){if(200<=n.status&&300>n.status||0===n.status){if(void 0!==r)if(l.binaryResult)r(n.response);else{var w=n.getResponseHeader("content-type"),v=n.responseText;v&&-1!==w.indexOf("text/plain")?r(v):
v?r(JSON.parse(v)):r()}l=n=null}else u()},!1);n.addEventListener("error",u,!1);n.addEventListener("abort",u,!1);n.open(l.method,h,!0);l.binaryResult&&(n.responseType="arraybuffer");l.dataContentType&&n.setRequestHeader("Content-Type",l.dataContentType);"POST"===l.method&&n.setRequestHeader("X-Requested-By","Shapespark");n.send(l.data)}function f(h,l,r,q,m){function u(){h(l,r,q,m)}return function(){console.warn("Failed to get: "+l+(u?", retrying in "+r.retryDelay+"s":""));0<r.retriesLeft?(setTimeout(u,
r.retryDelay),r.retryScheduled()):m()}}function g(h,l,r,q){var m=new Image;m.onload=function(){r(m);m=null};m.onerror=f(g,h,l,r,q);m.crossOrigin="anonymous";m.src=h}function e(h,l,r,q){var m=document.createElement("video");m.autoplay=!0;m.muted=!0;m.loop=!0;m.setAttribute("playsinline","");m.setAttribute("webkit-playsinline","");m.crossOrigin="anonymous";m.onerror=f(e,h,l,r,q);WALK.onVideoDataReady(m,function(){m.onerror=void 0;r(m);m=null});m.src=h;m.play().catch(function(){})}var k=new function(){function h(){for(q+=
1;q<l.length;q+=1){var m=l[q];if(0<m.length){for(var u=0;u<m.length;u+=1)r[q]+=1,WALK.defer(m[u]);m.length=0;break}}}var l=[],r=[],q=Infinity;(function(){var m=0,u;for(u in WALK.LOAD_PRIORITY)WALK.LOAD_PRIORITY.hasOwnProperty(u)&&(m=Math.max(m,WALK.LOAD_PRIORITY[u]));for(u=0;u<=m;u+=1)l[u]=[],r[u]=0})();this.add=function(m,u){m<=q?(r[m]+=1,q=m,WALK.defer(u)):(l[m].push(u),0===r[q]&&h())};this.finished=function(m){--r[m];var u=r[m];console.assert(0<=u);m===q&&0===u&&h()}};b.prototype={constructor:b,
retryScheduled:function(){console.assert(0<this.retriesLeft);--this.retriesLeft;this.retryDelay*=2}};WALK.ajaxGet=function(h,l,r,q,m){var u=new b("GET");u.binaryResult=l;d(h,u,r,q,m)};WALK.queueAjaxGet=function(h,l,r,q,m,u){k.add(h,function(){WALK.ajaxGet(l,r,a(h,q),a(h,m),u)})};WALK.ajaxPost=function(h,l,r,q,m,u){var n=new b("POST");n.data=r;n.dataContentType=l;d(h,n,q,m,u)};WALK.queueImageGet=function(h,l,r,q){k.add(h,function(){var m=new b("GET");g(l,m,a(h,r),a(h,q))})};WALK.queueVideoGet=function(h,
l,r,q){k.add(h,function(){var m=new b("GET");e(l,m,a(h,r),a(h,q))})}})();(function(){function a(c,d){for(c=c.toString();c.length<d;)c="0"+c;return c}function b(c){var d=console[c].bind(console);console[c]=function(){for(var f="",g="",e=0;e<arguments.length;++e)g+=(0===e?"":" ")+arguments[e];WALK.LOG_TIME&&(f=new Date,f=a(f.getHours(),2)+":"+a(f.getMinutes(),2)+":"+a(f.getSeconds(),2)+","+a(f.getMilliseconds(),3)+" ");e=f+c.toUpperCase()+" "+g;WALK.LOG_TO_SERVER&&WALK.ajaxPost("/log","application/json",JSON.stringify({message:e}));d(f+g)}}WALK.log=WALK.LOG_INFO?function(c){for(var d=
[],f=0;f<arguments.length;++f)d[f-0]=arguments[f];console.log.apply(console,$jscomp.arrayFromIterable(d))}:function(){};if(WALK.LOG_TO_SERVER||WALK.LOG_TIME)b("log"),b("info"),b("warn"),b("error")})();/*

 nosleep.js
 Copyright (c) 2017, Rich Tibbett

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 webxr-polyfill
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 cardboard-vr-display
 Copyright (c) 2015-2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 webvr-polyfill-dpdb 
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 wglu-preserve-state
 Copyright (c) 2016, Brandon Jones.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(a,b){"object"===typeof exports&&"undefined"!==typeof module?module.exports=b():"function"===typeof define&&define.amd?define(b):a.WebXRPolyfill=b()})(this,function(){function a(){var p=new J(16);J!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0);p[0]=1;p[5]=1;p[10]=1;p[15]=1;return p}function b(p){p[0]=1;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=1;p[6]=0;p[7]=0;p[8]=0;p[9]=0;p[10]=1;p[11]=0;p[12]=0;p[13]=0;p[14]=0;p[15]=1;return p}function c(p,
x){var G=x[0],H=x[1],Y=x[2],sa=x[3],ua=x[4],Ja=x[5],Sa=x[6],Va=x[7],Ta=x[8],fb=x[9],sb=x[10],jb=x[11],kb=x[12],ib=x[13],tb=x[14];x=x[15];var ab=G*Ja-H*ua,Wa=G*Sa-Y*ua,lb=G*Va-sa*ua,mb=H*Sa-Y*Ja,Ya=H*Va-sa*Ja,Gb=Y*Va-sa*Sa,Mb=Ta*ib-fb*kb,Nb=Ta*tb-sb*kb,Kb=Ta*x-jb*kb,Ob=fb*tb-sb*ib,Pb=fb*x-jb*ib,Lb=sb*x-jb*tb,ob=ab*Lb-Wa*Pb+lb*Ob+mb*Kb-Ya*Nb+Gb*Mb;if(!ob)return null;ob=1/ob;p[0]=(Ja*Lb-Sa*Pb+Va*Ob)*ob;p[1]=(Y*Pb-H*Lb-sa*Ob)*ob;p[2]=(ib*Gb-tb*Ya+x*mb)*ob;p[3]=(sb*Ya-fb*Gb-jb*mb)*ob;p[4]=(Sa*Kb-ua*Lb-
Va*Nb)*ob;p[5]=(G*Lb-Y*Kb+sa*Nb)*ob;p[6]=(tb*lb-kb*Gb-x*Wa)*ob;p[7]=(Ta*Gb-sb*lb+jb*Wa)*ob;p[8]=(ua*Pb-Ja*Kb+Va*Mb)*ob;p[9]=(H*Kb-G*Pb-sa*Mb)*ob;p[10]=(kb*Ya-ib*lb+x*ab)*ob;p[11]=(fb*lb-Ta*Ya-jb*ab)*ob;p[12]=(Ja*Nb-ua*Ob-Sa*Mb)*ob;p[13]=(G*Ob-H*Nb+Y*Mb)*ob;p[14]=(ib*Wa-kb*mb-tb*ab)*ob;p[15]=(Ta*mb-fb*Wa+sb*ab)*ob;return p}function d(p,x,G){var H=x[0],Y=x[1],sa=x[2],ua=x[3],Ja=x[4],Sa=x[5],Va=x[6],Ta=x[7],fb=x[8],sb=x[9],jb=x[10],kb=x[11],ib=x[12],tb=x[13],ab=x[14];x=x[15];var Wa=G[0],lb=G[1],mb=G[2],
Ya=G[3];p[0]=Wa*H+lb*Ja+mb*fb+Ya*ib;p[1]=Wa*Y+lb*Sa+mb*sb+Ya*tb;p[2]=Wa*sa+lb*Va+mb*jb+Ya*ab;p[3]=Wa*ua+lb*Ta+mb*kb+Ya*x;Wa=G[4];lb=G[5];mb=G[6];Ya=G[7];p[4]=Wa*H+lb*Ja+mb*fb+Ya*ib;p[5]=Wa*Y+lb*Sa+mb*sb+Ya*tb;p[6]=Wa*sa+lb*Va+mb*jb+Ya*ab;p[7]=Wa*ua+lb*Ta+mb*kb+Ya*x;Wa=G[8];lb=G[9];mb=G[10];Ya=G[11];p[8]=Wa*H+lb*Ja+mb*fb+Ya*ib;p[9]=Wa*Y+lb*Sa+mb*sb+Ya*tb;p[10]=Wa*sa+lb*Va+mb*jb+Ya*ab;p[11]=Wa*ua+lb*Ta+mb*kb+Ya*x;Wa=G[12];lb=G[13];mb=G[14];Ya=G[15];p[12]=Wa*H+lb*Ja+mb*fb+Ya*ib;p[13]=Wa*Y+lb*Sa+mb*sb+
Ya*tb;p[14]=Wa*sa+lb*Va+mb*jb+Ya*ab;p[15]=Wa*ua+lb*Ta+mb*kb+Ya*x;return p}function f(p,x,G){var H=x[0],Y=x[1],sa=x[2],ua=x[3],Ja=H+H,Sa=Y+Y,Va=sa+sa;x=H*Ja;var Ta=H*Sa;H*=Va;var fb=Y*Sa;Y*=Va;sa*=Va;Ja*=ua;Sa*=ua;ua*=Va;p[0]=1-(fb+sa);p[1]=Ta+ua;p[2]=H-Sa;p[3]=0;p[4]=Ta-ua;p[5]=1-(x+sa);p[6]=Y+Ja;p[7]=0;p[8]=H+Sa;p[9]=Y-Ja;p[10]=1-(x+fb);p[11]=0;p[12]=G[0];p[13]=G[1];p[14]=G[2];p[15]=1;return p}function g(p,x){p[0]=x[12];p[1]=x[13];p[2]=x[14];return p}function e(p,x){var G=x[0]+x[5]+x[10];0<G?(G=
2*Math.sqrt(G+1),p[3]=.25*G,p[0]=(x[6]-x[9])/G,p[1]=(x[8]-x[2])/G,p[2]=(x[1]-x[4])/G):x[0]>x[5]&&x[0]>x[10]?(G=2*Math.sqrt(1+x[0]-x[5]-x[10]),p[3]=(x[6]-x[9])/G,p[0]=.25*G,p[1]=(x[1]+x[4])/G,p[2]=(x[8]+x[2])/G):x[5]>x[10]?(G=2*Math.sqrt(1+x[5]-x[0]-x[10]),p[3]=(x[8]-x[2])/G,p[0]=(x[1]+x[4])/G,p[1]=.25*G,p[2]=(x[6]+x[9])/G):(G=2*Math.sqrt(1+x[10]-x[0]-x[5]),p[3]=(x[1]-x[4])/G,p[0]=(x[8]+x[2])/G,p[1]=(x[6]+x[9])/G,p[2]=.25*G);return p}function k(p,x,G,H,Y){x=1/Math.tan(x/2);p[0]=x/G;p[1]=0;p[2]=0;p[3]=
0;p[4]=0;p[5]=x;p[6]=0;p[7]=0;p[8]=0;p[9]=0;p[11]=-1;p[12]=0;p[13]=0;p[15]=0;null!=Y&&Infinity!==Y?(G=1/(H-Y),p[10]=(Y+H)*G,p[14]=2*Y*H*G):(p[10]=-1,p[14]=-2*H);return p}function h(){var p=new J(3);J!=Float32Array&&(p[0]=0,p[1]=0,p[2]=0);return p}function l(p){var x=new J(3);x[0]=p[0];x[1]=p[1];x[2]=p[2];return x}function r(p,x,G){var H=new J(3);H[0]=p;H[1]=x;H[2]=G;return H}function q(p,x){p[0]=x[0];p[1]=x[1];p[2]=x[2];return p}function m(p,x,G){p[0]=x[0]+G[0];p[1]=x[1]+G[1];p[2]=x[2]+G[2];return p}
function u(p,x,G){p[0]=x[0]*G;p[1]=x[1]*G;p[2]=x[2]*G;return p}function n(p,x){var G=x[0],H=x[1],Y=x[2];G=G*G+H*H+Y*Y;0<G&&(G=1/Math.sqrt(G),p[0]=x[0]*G,p[1]=x[1]*G,p[2]=x[2]*G);return p}function w(p,x){return p[0]*x[0]+p[1]*x[1]+p[2]*x[2]}function v(p,x,G){var H=x[0],Y=x[1];x=x[2];var sa=G[0],ua=G[1];G=G[2];p[0]=Y*G-x*ua;p[1]=x*sa-H*G;p[2]=H*ua-Y*sa;return p}function y(p,x,G){var H=G[0],Y=G[1],sa=G[2],ua=x[0],Ja=x[1];x=x[2];var Sa=Y*x-sa*Ja,Va=sa*ua-H*x,Ta=H*Ja-Y*ua;G=2*G[3];p[0]=ua+Sa*G+2*(Y*Ta-
sa*Va);p[1]=Ja+Va*G+2*(sa*Sa-H*Ta);p[2]=x+Ta*G+2*(H*Va-Y*Sa);return p}function C(){var p=new J(9);J!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[5]=0,p[6]=0,p[7]=0);p[0]=1;p[4]=1;p[8]=1;return p}function A(){var p=new J(4);J!=Float32Array&&(p[0]=0,p[1]=0,p[2]=0,p[3]=0);return p}function I(){var p=new J(4);J!=Float32Array&&(p[0]=0,p[1]=0,p[2]=0);p[3]=1;return p}function D(p,x,G){var H=x[0],Y=x[1],sa=x[2];x=x[3];var ua=G[0],Ja=G[1],Sa=G[2];G=G[3];p[0]=H*G+x*ua+Y*Sa-sa*Ja;p[1]=Y*G+x*Ja+sa*ua-H*Sa;p[2]=sa*
G+x*Sa+H*Ja-Y*ua;p[3]=x*G-H*ua-Y*Ja-sa*Sa;return p}function E(p,x,G,H){var Y=x[0],sa=x[1],ua=x[2];x=x[3];var Ja=G[0],Sa=G[1],Va=G[2];G=G[3];var Ta=Y*Ja+sa*Sa+ua*Va+x*G;0>Ta&&(Ta=-Ta,Ja=-Ja,Sa=-Sa,Va=-Va,G=-G);if(1E-6<1-Ta){var fb=Math.acos(Ta);var sb=Math.sin(fb);Ta=Math.sin((1-H)*fb)/sb;H=Math.sin(H*fb)/sb}else Ta=1-H;p[0]=Ta*Y+H*Ja;p[1]=Ta*sa+H*Sa;p[2]=Ta*ua+H*Va;p[3]=Ta*x+H*G;return p}function O(p,x){var G=x[0],H=x[1],Y=x[2];x=x[3];var sa=G*G+H*H+Y*Y+x*x;sa=sa?1/sa:0;p[0]=-G*sa;p[1]=-H*sa;p[2]=
-Y*sa;p[3]=x*sa;return p}function S(p,x){p=new Event(p,x);p[wa]={frame:x.frame,inputSource:x.inputSource};Object.setPrototypeOf(p,S.prototype);Object.defineProperty(p,"frame",{get:function(){return this[wa].frame}});Object.defineProperty(p,"inputSource",{get:function(){return this[wa].inputSource}});return p}function W(p,x){p=new Event(p,x);p[Ha]={session:x.session};Object.setPrototypeOf(p,W.prototype);Object.defineProperty(p,"session",{get:function(){return this[Ha].session}});return p}function U(p,
x){p=new Event(p,x);p[Fa]={session:x.session,added:x.added,removed:x.removed};Object.setPrototypeOf(p,U.prototype);Object.defineProperty(p,"session",{get:function(){return this[Fa].session}});Object.defineProperty(p,"added",{get:function(){return this[Fa].added}});Object.defineProperty(p,"removed",{get:function(){return this[Fa].removed}});return p}function va(p,x){p=new Event(p,x);p[pb]={referenceSpace:x.referenceSpace,transform:x.transform||null};Object.setPrototypeOf(p,va.prototype);Object.defineProperty(p,
"referenceSpace",{get:function(){return this[pb].referenceSpace}});Object.defineProperty(p,"transform",{get:function(){return this[pb].transform}});return p}function ta(p,x,G){function H(Sa,Va,Ta){return Sa<Va?Va:Sa>Ta?Ta:Sa}var Y=x[0]*x[0],sa=x[1]*x[1],ua=x[2]*x[2],Ja=x[3]*x[3];"XYZ"===G?(p[0]=Math.atan2(2*(x[0]*x[3]-x[1]*x[2]),Ja-Y-sa+ua),p[1]=Math.asin(H(2*(x[0]*x[2]+x[1]*x[3]),-1,1)),p[2]=Math.atan2(2*(x[2]*x[3]-x[0]*x[1]),Ja+Y-sa-ua)):"YXZ"===G?(p[0]=Math.asin(H(2*(x[0]*x[3]-x[1]*x[2]),-1,1)),
p[1]=Math.atan2(2*(x[0]*x[2]+x[1]*x[3]),Ja-Y-sa+ua),p[2]=Math.atan2(2*(x[0]*x[1]+x[2]*x[3]),Ja-Y+sa-ua)):"ZXY"===G?(p[0]=Math.asin(H(2*(x[0]*x[3]+x[1]*x[2]),-1,1)),p[1]=Math.atan2(2*(x[1]*x[3]-x[2]*x[0]),Ja-Y-sa+ua),p[2]=Math.atan2(2*(x[2]*x[3]-x[0]*x[1]),Ja-Y+sa-ua)):"ZYX"===G?(p[0]=Math.atan2(2*(x[0]*x[3]+x[2]*x[1]),Ja-Y-sa+ua),p[1]=Math.asin(H(2*(x[1]*x[3]-x[0]*x[2]),-1,1)),p[2]=Math.atan2(2*(x[0]*x[1]+x[2]*x[3]),Ja+Y-sa-ua)):"YZX"===G?(p[0]=Math.atan2(2*(x[0]*x[3]-x[2]*x[1]),Ja-Y+sa-ua),p[1]=
Math.atan2(2*(x[1]*x[3]-x[0]*x[2]),Ja+Y-sa-ua),p[2]=Math.asin(H(2*(x[0]*x[1]+x[2]*x[3]),-1,1))):"XZY"===G?(p[0]=Math.atan2(2*(x[0]*x[3]+x[1]*x[2]),Ja-Y+sa-ua),p[1]=Math.atan2(2*(x[0]*x[2]+x[1]*x[3]),Ja+Y-sa-ua),p[2]=Math.asin(H(2*(x[2]*x[3]-x[0]*x[1]),-1,1))):console.log("No order given for quaternion to euler conversion.")}var qa="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{},ha=Symbol("@@webxr-polyfill/EventTarget"),F=function(){this[ha]=
{listeners:new Map}};F.prototype.addEventListener=function(p,x){if("string"!==typeof p)throw Error("`type` must be a string");if("function"!==typeof x)throw Error("`listener` must be a function");var G=this[ha].listeners.get(p)||[];G.push(x);this[ha].listeners.set(p,G)};F.prototype.removeEventListener=function(p,x){if("string"!==typeof p)throw Error("`type` must be a string");if("function"!==typeof x)throw Error("`listener` must be a function");p=this[ha].listeners.get(p)||[];for(var G=p.length;0<=
G;G--)p[G]===x&&p.pop()};F.prototype.dispatchEvent=function(p,x){for(var G=this[ha].listeners.get(p)||[],H=[],Y=0;Y<G.length;Y++)H[Y]=G[Y];G=$jscomp.makeIterator(H);for(H=G.next();!H.done;H=G.next())H=H.value,H(x);if("function"===typeof this["on"+p])this["on"+p](x)};var J="undefined"!==typeof Float32Array?Float32Array:Array;(function(){var p=h();return function(x,G,H,Y,sa,ua){G||(G=3);H||(H=0);for(Y=Y?Math.min(Y*G+H,x.length):x.length;H<Y;H+=G)p[0]=x[H],p[1]=x[H+1],p[2]=x[H+2],sa(p,p,ua),x[H]=p[0],
x[H+1]=p[1],x[H+2]=p[2];return x}})();(function(){var p=A();return function(x,G,H,Y,sa,ua){G||(G=4);H||(H=0);for(Y=Y?Math.min(Y*G+H,x.length):x.length;H<Y;H+=G)p[0]=x[H],p[1]=x[H+1],p[2]=x[H+2],p[3]=x[H+3],sa(p,p,ua),x[H]=p[0],x[H+1]=p[1],x[H+2]=p[2],x[H+3]=p[3];return x}})();var Z=function(p){var x=new J(4);x[0]=p[0];x[1]=p[1];x[2]=p[2];x[3]=p[3];return x},M=function(p,x){p[0]=x[0];p[1]=x[1];p[2]=x[2];p[3]=x[3];return p},ma=function(p,x){var G=x[0],H=x[1],Y=x[2];x=x[3];var sa=G*G+H*H+Y*Y+x*x;0<sa&&
(sa=1/Math.sqrt(sa),p[0]=G*sa,p[1]=H*sa,p[2]=Y*sa,p[3]=x*sa);return p};(function(){var p=h(),x=r(1,0,0),G=r(0,1,0);return function(H,Y,sa){var ua=w(Y,sa);if(-.999999>ua){v(p,x,Y);sa=p[0];ua=p[1];var Ja=p[2];1E-6>Math.sqrt(sa*sa+ua*ua+Ja*Ja)&&v(p,G,Y);n(p,p);Y=Math.PI;Y*=.5;sa=Math.sin(Y);H[0]=sa*p[0];H[1]=sa*p[1];H[2]=sa*p[2];H[3]=Math.cos(Y);return H}if(.999999<ua)return H[0]=0,H[1]=0,H[2]=0,H[3]=1,H;v(p,Y,sa);H[0]=p[0];H[1]=p[1];H[2]=p[2];H[3]=1+ua;return ma(H,H)}})();(function(){var p=I(),x=I();
return function(G,H,Y,sa,ua,Ja){E(p,H,ua,Ja);E(x,Y,sa,Ja);E(G,p,x,2*Ja*(1-Ja));return G}})();(function(){var p=C();return function(x,G,H,Y){p[0]=H[0];p[3]=H[1];p[6]=H[2];p[1]=Y[0];p[4]=Y[1];p[7]=Y[2];p[2]=-G[0];p[5]=-G[1];p[8]=-G[2];G=p[0]+p[4]+p[8];if(0<G)G=Math.sqrt(G+1),x[3]=.5*G,G=.5/G,x[0]=(p[5]-p[7])*G,x[1]=(p[6]-p[2])*G,x[2]=(p[1]-p[3])*G;else{H=0;p[4]>p[0]&&(H=1);p[8]>p[3*H+H]&&(H=2);Y=(H+1)%3;var sa=(H+2)%3;G=Math.sqrt(p[3*H+H]-p[3*Y+Y]-p[3*sa+sa]+1);x[H]=.5*G;G=.5/G;x[3]=(p[3*Y+sa]-p[3*
sa+Y])*G;x[Y]=(p[3*Y+H]+p[3*H+Y])*G;x[sa]=(p[3*sa+H]+p[3*H+sa])*G}return ma(x,x)}})();if(!("DOMPointReadOnly"in window)){var ea=Symbol("@@webxr-polyfill/DOMPointReadOnly"),ya=function(p,x,G,H){if(1===arguments.length)this[ea]={x:p.x,y:p.y,z:p.z,w:p.w};else if(4===arguments.length)this[ea]={x:p,y:x,z:G,w:H};else throw new TypeError("Must supply either 1 or 4 arguments");};ya.fromPoint=function(p){return new ya(p.x,p.y,p.z,p.w)};$jscomp.global.Object.defineProperties(ya.prototype,{x:{configurable:!0,
enumerable:!0,get:function(){return this[ea].x}},y:{configurable:!0,enumerable:!0,get:function(){return this[ea].y}},z:{configurable:!0,enumerable:!0,get:function(){return this[ea].z}},w:{configurable:!0,enumerable:!0,get:function(){return this[ea].w}}});window.DOMPointReadOnly=ya}var Q=Symbol("@@webxr-polyfill/XRRigidTransform"),fa=function(){this[Q]={matrix:null,position:null,orientation:null,inverse:null};if(0===arguments.length)this[Q].matrix=b(new Float32Array(16));else if(1===arguments.length)arguments[0]instanceof
Float32Array?this[Q].matrix=arguments[0]:(this[Q].position=this._getPoint(arguments[0]),this[Q].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(2===arguments.length)this[Q].position=this._getPoint(arguments[0]),this[Q].orientation=this._getPoint(arguments[1]);else throw Error("Too many arguments!");if(this[Q].matrix){var p=h();g(p,this[Q].matrix);this[Q].position=DOMPointReadOnly.fromPoint({x:p[0],y:p[1],z:p[2]});p=I();e(p,this[Q].matrix);this[Q].orientation=DOMPointReadOnly.fromPoint({x:p[0],
y:p[1],z:p[2],w:p[3]})}else{this[Q].matrix=b(new Float32Array(16));p=this[Q].matrix;var x=this[Q].orientation.x,G=this[Q].orientation.y,H=this[Q].orientation.z,Y=this[Q].orientation.w,sa=new J(4);sa[0]=x;sa[1]=G;sa[2]=H;sa[3]=Y;f(p,sa,r(this[Q].position.x,this[Q].position.y,this[Q].position.z))}};fa.prototype._getPoint=function(p){return p instanceof DOMPointReadOnly?p:DOMPointReadOnly.fromPoint(p)};$jscomp.global.Object.defineProperties(fa.prototype,{matrix:{configurable:!0,enumerable:!0,get:function(){return this[Q].matrix}},
position:{configurable:!0,enumerable:!0,get:function(){return this[Q].position}},orientation:{configurable:!0,enumerable:!0,get:function(){return this[Q].orientation}},inverse:{configurable:!0,enumerable:!0,get:function(){if(null===this[Q].inverse){var p=b(new Float32Array(16));c(p,this[Q].matrix);this[Q].inverse=new fa(p);this[Q].inverse[Q].inverse=this}return this[Q].inverse}}});var K=Symbol("@@webxr-polyfill/XRSpace"),R=function(p,x){this[K]={specialType:void 0===p?null:p,inputSource:void 0===
x?null:x,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}};R.prototype._ensurePoseUpdated=function(p,x){x!=this[K].lastFrameId&&(this[K].lastFrameId=x,this._onPoseUpdate(p))};R.prototype._onPoseUpdate=function(p){"viewer"==this[K].specialType&&(this._baseMatrix=p.getBasePoseMatrix())};R.prototype._getSpaceRelativeTransform=function(p){if(!this._inverseBaseMatrix||!p._baseMatrix)return null;var x=new Float32Array(16);d(x,this._inverseBaseMatrix,p._baseMatrix);return new fa(x)};$jscomp.global.Object.defineProperties(R.prototype,
{_specialType:{configurable:!0,enumerable:!0,get:function(){return this[K].specialType}},_inputSource:{configurable:!0,enumerable:!0,get:function(){return this[K].inputSource}},_baseMatrix:{configurable:!0,enumerable:!0,set:function(p){this[K].baseMatrix=p;this[K].inverseBaseMatrix=null},get:function(){!this[K].baseMatrix&&this[K].inverseBaseMatrix&&(this[K].baseMatrix=new Float32Array(16),c(this[K].baseMatrix,this[K].inverseBaseMatrix));return this[K].baseMatrix}},_inverseBaseMatrix:{configurable:!0,
enumerable:!0,set:function(p){this[K].inverseBaseMatrix=p;this[K].baseMatrix=null},get:function(){!this[K].inverseBaseMatrix&&this[K].baseMatrix&&(this[K].inverseBaseMatrix=new Float32Array(16),c(this[K].inverseBaseMatrix,this[K].baseMatrix));return this[K].inverseBaseMatrix}}});var ka=Symbol("@@webxr-polyfill/XRReferenceSpace"),ba=["viewer","local","local-floor","bounded-floor","unbounded"],ja=function(p,x){x=void 0===x?null:x;if(!ba.includes(p))throw Error("XRReferenceSpaceType must be one of "+
ba);var G=R.call(this,p)||this;if("bounded-floor"===p&&!x)throw Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");"bounded-floor"!==p&&"local-floor"!==p||x||(x=b(new Float32Array(16)),x[13]=1.6);G._inverseBaseMatrix=x||b(new Float32Array(16));G[ka]={type:p,transform:x,originOffset:b(new Float32Array(16))};return G};$jscomp.inherits(ja,R);ja.prototype._transformBasePoseMatrix=function(p,x){d(p,this._inverseBaseMatrix,x)};ja.prototype._originOffsetMatrix=
function(){return this[ka].originOffset};ja.prototype._adjustForOriginOffset=function(p){var x=new Float32Array(16);c(x,this[ka].originOffset);d(p,x,p)};ja.prototype._getSpaceRelativeTransform=function(p){p=R.prototype._getSpaceRelativeTransform.call(this,p);this._adjustForOriginOffset(p.matrix);return new XRRigidTransform(p.matrix)};ja.prototype.getOffsetReferenceSpace=function(p){var x=new ja(this[ka].type,this[ka].transform,this[ka].bounds);d(x[ka].originOffset,this[ka].originOffset,p.matrix);
return x};var na=Symbol("@@webxr-polyfill/XR"),ra=["inline","immersive-vr","immersive-ar"],za={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},Da=function(p){var x=F.call(this)||this;x[na]={device:null,devicePromise:p,immersiveSession:null,inlineSessions:new Set};p.then(function(G){x[na].device=G});return x};$jscomp.inherits(Da,F);Da.prototype.isSessionSupported=
function(p){var x=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){return 1==G.nextAddress?x[na].device?G.jumpTo(2):G.yield(x[na].devicePromise,2):"inline"!=p?G.return(Promise.resolve(x[na].device.isSessionSupported(p))):G.return(Promise.resolve(!0))})};Da.prototype.requestSession=function(p,x){var G=this,H,Y,sa,ua,Ja,Sa,Va,Ta,fb,sb,jb,kb,ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress){if(G[na].device)return tb.jumpTo(2);if("inline"!=p)throw Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");
return tb.yield(G[na].devicePromise,2)}if(5!=tb.nextAddress){if(!ra.includes(p))throw new TypeError("The provided value '"+p+"' is not a valid enum value of type XRSessionMode");H=za[p];Y=H.requiredFeatures.concat(x&&x.requiredFeatures?x.requiredFeatures:[]);sa=H.optionalFeatures.concat(x&&x.optionalFeatures?x.optionalFeatures:[]);ua=new Set;Ja=!1;Sa=$jscomp.makeIterator(Y);for(Va=Sa.next();!Va.done;Va=Sa.next())Ta=Va.value,G[na].device.isFeatureSupported(Ta)?ua.add(Ta):(console.error("The required feature '"+
Ta+"' is not supported"),Ja=!0);if(Ja)throw new DOMException("Session does not support some required features","NotSupportedError");fb=$jscomp.makeIterator(sa);for(Va=fb.next();!Va.done;Va=fb.next())sb=Va.value,G[na].device.isFeatureSupported(sb)?ua.add(sb):console.log("The optional feature '"+sb+"' is not supported");return tb.yield(G[na].device.requestSession(p,ua),5)}jb=tb.yieldResult;kb=new XRSession(G[na].device,p,jb);"inline"==p?G[na].inlineSessions.add(kb):G[na].immersiveSession=kb;ib=function(){"inline"==
p?G[na].inlineSessions.delete(kb):G[na].immersiveSession=null;kb.removeEventListener("end",ib)};kb.addEventListener("end",ib);return tb.return(kb)})};if(!1==="performance"in qa){var ia=Date.now();var V=function(){return Date.now()-ia}}else V=function(){return performance.now()};var xa=V,Ea=Symbol("@@webxr-polyfill/XRPose"),Ia=function(p,x){this[Ea]={transform:p,emulatedPosition:x}};$jscomp.global.Object.defineProperties(Ia.prototype,{transform:{configurable:!0,enumerable:!0,get:function(){return this[Ea].transform}},
emulatedPosition:{configurable:!0,enumerable:!0,get:function(){return this[Ea].emulatedPosition}}});var Qa=Symbol("@@webxr-polyfill/XRViewerPose"),L=function(p,x,G){p=Ia.call(this,p,void 0===G?!1:G)||this;p[Qa]={views:x};return p};$jscomp.inherits(L,Ia);$jscomp.global.Object.defineProperties(L.prototype,{views:{configurable:!0,enumerable:!0,get:function(){return this[Qa].views}}});var pa=Symbol("@@webxr-polyfill/XRViewport"),ca=function(p){this[pa]={target:p}};$jscomp.global.Object.defineProperties(ca.prototype,
{x:{configurable:!0,enumerable:!0,get:function(){return this[pa].target.x}},y:{configurable:!0,enumerable:!0,get:function(){return this[pa].target.y}},width:{configurable:!0,enumerable:!0,get:function(){return this[pa].target.width}},height:{configurable:!0,enumerable:!0,get:function(){return this[pa].target.height}}});var Aa=["left","right","none"],Ca=Symbol("@@webxr-polyfill/XRView"),Oa=function(p,x,G,H){if(!Aa.includes(G))throw Error("XREye must be one of: "+Aa);var Y=Object.create(null),sa=new ca(Y);
this[Ca]={device:p,eye:G,viewport:sa,temp:Y,sessionId:H,transform:x}};Oa.prototype._getViewport=function(p){if(this[Ca].device.getViewport(this[Ca].sessionId,this.eye,p,this[Ca].temp))return this[Ca].viewport};$jscomp.global.Object.defineProperties(Oa.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this[Ca].eye}},projectionMatrix:{configurable:!0,enumerable:!0,get:function(){return this[Ca].device.getProjectionMatrix(this.eye)}},transform:{configurable:!0,enumerable:!0,get:function(){return this[Ca].transform}}});
var Ma=Symbol("@@webxr-polyfill/XRFrame"),$a=0,cb=function(p,x,G){this[Ma]={id:++$a,active:!1,animationFrame:!1,device:p,session:x,sessionId:G}};cb.prototype.getViewerPose=function(p){if(!this[Ma].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[Ma].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.","InvalidStateError");var x=this[Ma].device,
G=this[Ma].session;G[la].viewerSpace._ensurePoseUpdated(x,this[Ma].id);p._ensurePoseUpdated(x,this[Ma].id);var H=p._getSpaceRelativeTransform(G[la].viewerSpace),Y=[];G=$jscomp.makeIterator(G[la].viewSpaces);for(var sa=G.next();!sa.done;sa=G.next()){sa=sa.value;sa._ensurePoseUpdated(x,this[Ma].id);var ua=p._getSpaceRelativeTransform(sa);sa=new Oa(x,ua,sa.eye,this[Ma].sessionId);Y.push(sa)}return new L(H,Y,!1)};cb.prototype.getPose=function(p,x){if(!this[Ma].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.",
"InvalidStateError");var G=this[Ma].device;if("target-ray"===p._specialType||"grip"===p._specialType)return G.getInputPose(p._inputSource,x,p._specialType);p._ensurePoseUpdated(G,this[Ma].id);x._ensurePoseUpdated(G,this[Ma].id);return(p=x._getSpaceRelativeTransform(p))?new XRPose(p,!1):null};$jscomp.global.Object.defineProperties(cb.prototype,{session:{configurable:!0,enumerable:!0,get:function(){return this[Ma].session}}});var wb=Symbol("@@webxr-polyfill/XRRenderState"),xb=Object.freeze({depthNear:.1,
depthFar:1E3,inlineVerticalFieldOfView:null,baseLayer:null}),zb=function(p){p=void 0===p?{}:p;p=Object.assign({},xb,p);this[wb]={config:p}};$jscomp.global.Object.defineProperties(zb.prototype,{depthNear:{configurable:!0,enumerable:!0,get:function(){return this[wb].config.depthNear}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this[wb].config.depthFar}},inlineVerticalFieldOfView:{configurable:!0,enumerable:!0,get:function(){return this[wb].config.inlineVerticalFieldOfView}},baseLayer:{configurable:!0,
enumerable:!0,get:function(){return this[wb].config.baseLayer}}});var eb=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),P=Symbol("@@webxr-polyfill/xr-compatible"),da=Symbol("@@webxr-polyfill/XRWebGLLayer"),Ba=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),T=function(p,x,G){G=void 0===G?{}:G;G=Object.assign({},Ba,G);if(!(p instanceof Xa))throw Error("session must be a XRSession");if(p.ended)throw Error("InvalidStateError");
if(x[eb]&&!0!==x[P])throw Error("InvalidStateError");var H=x.getParameter(x.FRAMEBUFFER_BINDING);this[da]={context:x,config:G,framebuffer:H,session:p}};T.prototype.getViewport=function(p){return p._getViewport(this)};T.getNativeFramebufferScaleFactor=function(p){if(!p)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return p[la].ended?0:1};$jscomp.global.Object.defineProperties(T.prototype,{context:{configurable:!0,enumerable:!0,get:function(){return this[da].context}},
antialias:{configurable:!0,enumerable:!0,get:function(){return this[da].config.antialias}},ignoreDepthValues:{configurable:!0,enumerable:!0,get:function(){return!0}},framebuffer:{configurable:!0,enumerable:!0,get:function(){return this[da].framebuffer}},framebufferWidth:{configurable:!0,enumerable:!0,get:function(){return this[da].context.drawingBufferWidth}},framebufferHeight:{configurable:!0,enumerable:!0,get:function(){return this[da].context.drawingBufferHeight}},_session:{configurable:!0,enumerable:!0,
get:function(){return this[da].session}}});var wa=Symbol("@@webxr-polyfill/XRInputSourceEvent"),Ha=Symbol("@@webxr-polyfill/XRSessionEvent"),Fa=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),la=Symbol("@@webxr-polyfill/XRSession"),Ua=function(p){return R.call(this,p)||this};$jscomp.inherits(Ua,R);Ua.prototype._onPoseUpdate=function(p){this._inverseBaseMatrix=p.getBaseViewMatrix(this._specialType)};$jscomp.global.Object.defineProperties(Ua.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this._specialType}}});
var Xa=function(p,x,G){var H=F.call(this)||this;var Y="inline"!=x,sa=new zb({inlineVerticalFieldOfView:Y?null:.5*Math.PI});H[la]={device:p,mode:x,immersive:Y,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:G,activeRenderState:sa,pendingRenderState:null,viewerSpace:new ja("viewer"),viewSpaces:[],currentInputSources:[]};Y?H[la].viewSpaces.push(new Ua("left"),new Ua("right")):H[la].viewSpaces.push(new Ua("none"));H[la].onDeviceFrame=function(){if(!H[la].ended&&
!H[la].suspended){H[la].deviceFrameHandle=null;H[la].startDeviceFrameLoop();if(null!==H[la].pendingRenderState&&(H[la].activeRenderState=new zb(H[la].pendingRenderState),H[la].pendingRenderState=null,H[la].activeRenderState.baseLayer))H[la].device.onBaseLayerSet(H[la].id,H[la].activeRenderState.baseLayer);if(null!==H[la].activeRenderState.baseLayer){var ua=new cb(p,H,H[la].id),Ja=H[la].currentFrameCallbacks=H[la].frameCallbacks;H[la].frameCallbacks=[];ua[Ma].active=!0;ua[Ma].animationFrame=!0;H[la].device.onFrameStart(H[la].id,
H[la].activeRenderState);H._checkInputSourcesChange();for(var Sa=xa(),Va=0;Va<Ja.length;Va++)try{Ja[Va].cancelled||"function"!==typeof Ja[Va].callback||Ja[Va].callback(Sa,ua)}catch(Ta){console.error(Ta)}H[la].currentFrameCallbacks=null;ua[Ma].active=!1;H[la].device.onFrameEnd(H[la].id)}}};H[la].startDeviceFrameLoop=function(){null===H[la].deviceFrameHandle&&(H[la].deviceFrameHandle=H[la].device.requestAnimationFrame(H[la].onDeviceFrame))};H[la].stopDeviceFrameLoop=function(){var ua=H[la].deviceFrameHandle;
null!==ua&&(H[la].device.cancelAnimationFrame(ua),H[la].deviceFrameHandle=null)};H[la].onPresentationEnd=function(ua){ua!==H[la].id?(H[la].suspended=!1,H[la].startDeviceFrameLoop(),H.dispatchEvent("focus",{session:H})):(H[la].ended=!0,H[la].stopDeviceFrameLoop(),p.removeEventListener("@@webxr-polyfill/vr-present-end",H[la].onPresentationEnd),p.removeEventListener("@@webxr-polyfill/vr-present-start",H[la].onPresentationStart),p.removeEventListener("@@webxr-polyfill/input-select-start",H[la].onSelectStart),
p.removeEventListener("@@webxr-polyfill/input-select-end",H[la].onSelectEnd),H.dispatchEvent("end",W("end",{session:H})))};p.addEventListener("@@webxr-polyfill/vr-present-end",H[la].onPresentationEnd);H[la].onPresentationStart=function(ua){ua!==H[la].id&&(H[la].suspended=!0,H[la].stopDeviceFrameLoop(),H.dispatchEvent("blur",{session:H}))};p.addEventListener("@@webxr-polyfill/vr-present-start",H[la].onPresentationStart);H[la].onSelectStart=function(ua){ua.sessionId===H[la].id&&H[la].dispatchInputSourceEvent("selectstart",
ua.inputSource)};p.addEventListener("@@webxr-polyfill/input-select-start",H[la].onSelectStart);H[la].onSelectEnd=function(ua){ua.sessionId===H[la].id&&(H[la].dispatchInputSourceEvent("selectend",ua.inputSource),H[la].dispatchInputSourceEvent("select",ua.inputSource))};p.addEventListener("@@webxr-polyfill/input-select-end",H[la].onSelectEnd);H[la].onSqueezeStart=function(ua){ua.sessionId===H[la].id&&H[la].dispatchInputSourceEvent("squeezestart",ua.inputSource)};p.addEventListener("@@webxr-polyfill/input-squeeze-start",
H[la].onSqueezeStart);H[la].onSqueezeEnd=function(ua){ua.sessionId===H[la].id&&(H[la].dispatchInputSourceEvent("squeezeend",ua.inputSource),H[la].dispatchInputSourceEvent("squeeze",ua.inputSource))};p.addEventListener("@@webxr-polyfill/input-squeeze-end",H[la].onSqueezeEnd);H[la].dispatchInputSourceEvent=function(ua,Ja){var Sa=new cb(p,H,H[la].id);Ja=S(ua,{frame:Sa,inputSource:Ja});Sa[Ma].active=!0;H.dispatchEvent(ua,Ja);Sa[Ma].active=!1};H[la].startDeviceFrameLoop();H.onblur=void 0;H.onfocus=void 0;
H.onresetpose=void 0;H.onend=void 0;H.onselect=void 0;H.onselectstart=void 0;H.onselectend=void 0;return H};$jscomp.inherits(Xa,F);Xa.prototype.requestReferenceSpace=function(p){var x=this,G,H;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Y){if(1==Y.nextAddress){if(x[la].ended)return Y.return();if(!ba.includes(p))throw new TypeError("XRReferenceSpaceType must be one of "+ba);if(!x[la].device.doesSessionSupportReferenceSpace(x[la].id,p))throw new DOMException("The "+p+" reference space is not supported by this session.",
"NotSupportedError");return"viewer"===p?Y.return(x[la].viewerSpace):Y.yield(x[la].device.requestFrameOfReferenceTransform(p),2)}G=Y.yieldResult;if("bounded-floor"===p){if(!G)throw new DOMException(p+" XRReferenceSpace not supported by this device.","NotSupportedError");H=x[la].device.requestStageBounds();if(!H)throw new DOMException(p+" XRReferenceSpace not supported by this device.","NotSupportedError");throw new DOMException("The WebXR polyfill does not support the "+p+" reference space yet.","NotSupportedError");
}return Y.return(new ja(p,G))})};Xa.prototype.requestAnimationFrame=function(p){if(!this[la].ended){var x=++this[la].frameHandle;this[la].frameCallbacks.push({handle:x,callback:p,cancelled:!1});return x}};Xa.prototype.cancelAnimationFrame=function(p){var x=this[la].frameCallbacks,G=x.findIndex(function(H){return H&&H.handle===p});-1<G&&(x[G].cancelled=!0,x.splice(G,1));if(x=this[la].currentFrameCallbacks)G=x.findIndex(function(H){return H&&H.handle===p}),-1<G&&(x[G].cancelled=!0)};Xa.prototype.end=
function(){var p=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(x){if(p[la].ended)return x.return();p[la].immersive&&(p[la].ended=!0,p[la].device.removeEventListener("@@webxr-polyfill/vr-present-start",p[la].onPresentationStart),p[la].device.removeEventListener("@@webxr-polyfill/vr-present-end",p[la].onPresentationEnd),p[la].device.removeEventListener("@@webxr-polyfill/input-select-start",p[la].onSelectStart),p[la].device.removeEventListener("@@webxr-polyfill/input-select-end",p[la].onSelectEnd),
p.dispatchEvent("end",W("end",{session:p})));p[la].stopDeviceFrameLoop();return x.return(p[la].device.endSession(p[la].id))})};Xa.prototype.updateRenderState=function(p){if(this[la].ended)throw Error("Can't call updateRenderState on an XRSession that has already ended.");if(p.baseLayer&&p.baseLayer._session!==this)throw Error("Called updateRenderState with a base layer that was created by a different session.");if(null!==p.inlineVerticalFieldOfView&&void 0!==p.inlineVerticalFieldOfView){if(this[la].immersive)throw Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.");
p.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,p.inlineVerticalFieldOfView))}if(null===this[la].pendingRenderState){var x=this[la].activeRenderState;this[la].pendingRenderState={depthNear:x.depthNear,depthFar:x.depthFar,inlineVerticalFieldOfView:x.inlineVerticalFieldOfView,baseLayer:x.baseLayer}}Object.assign(this[la].pendingRenderState,p)};Xa.prototype._checkInputSourcesChange=function(){for(var p=[],x=[],G=this.inputSources,H=this[la].currentInputSources,Y=$jscomp.makeIterator(G),sa=Y.next();!sa.done;sa=
Y.next())sa=sa.value,H.includes(sa)||p.push(sa);H=$jscomp.makeIterator(H);for(Y=H.next();!Y.done;Y=H.next())Y=Y.value,G.includes(Y)||x.push(Y);(0<p.length||0<x.length)&&this.dispatchEvent("inputsourceschange",U("inputsourceschange",{session:this,added:p,removed:x}));this[la].currentInputSources.length=0;p=$jscomp.makeIterator(G);for(sa=p.next();!sa.done;sa=p.next())this[la].currentInputSources.push(sa.value)};$jscomp.global.Object.defineProperties(Xa.prototype,{renderState:{configurable:!0,enumerable:!0,
get:function(){return this[la].activeRenderState}},environmentBlendMode:{configurable:!0,enumerable:!0,get:function(){return this[la].device.environmentBlendMode||"opaque"}},inputSources:{configurable:!0,enumerable:!0,get:function(){return this[la].device.getInputSources()}}});var La=Symbol("@@webxr-polyfill/XRInputSource"),db=function(p){this[La]={impl:p,gripSpace:new R("grip",this),targetRaySpace:new R("target-ray",this)}};$jscomp.global.Object.defineProperties(db.prototype,{handedness:{configurable:!0,
enumerable:!0,get:function(){return this[La].impl.handedness}},targetRayMode:{configurable:!0,enumerable:!0,get:function(){return this[La].impl.targetRayMode}},gripSpace:{configurable:!0,enumerable:!0,get:function(){var p=this[La].impl.targetRayMode;return"gaze"===p||"screen"===p?null:this[La].gripSpace}},targetRaySpace:{configurable:!0,enumerable:!0,get:function(){return this[La].targetRaySpace}},profiles:{configurable:!0,enumerable:!0,get:function(){return this[La].impl.profiles}},gamepad:{configurable:!0,
enumerable:!0,get:function(){return this[La].impl.gamepad}}});var pb=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Bb={XRSystem:Da,XRSession:Xa,XRSessionEvent:W,XRFrame:cb,XRView:Oa,XRViewport:ca,XRViewerPose:L,XRWebGLLayer:T,XRSpace:R,XRReferenceSpace:ja,XRReferenceSpaceEvent:va,XRInputSource:db,XRInputSourceEvent:S,XRInputSourcesChangeEvent:U,XRRenderState:zb,XRRigidTransform:fa,XRPose:Ia},sc=function(p){if("function"===typeof p.prototype.makeXRCompatible)return!1;p.prototype.makeXRCompatible=
function(){this[P]=!0;return Promise.resolve()};return!0},tc=function(p){var x=p.prototype.getContext;p.prototype.getContext=function(G,H){if(G=x.call(this,G,H))G[eb]=!0,H&&"xrCompatible"in H&&(G[P]=H.xrCompatible);return G}},Ic=function(p){var x=!1;p=p.navigator.userAgent||p.navigator.vendor||p.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(p)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(p.substr(0,
4)))x=!0;return x},kc="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Zc=function(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p["default"]:p}(function(p,x){return x={exports:{}},p(x,x.exports),x.exports}(function(p,x){(function(G,H){p.exports=H()})(kc,function(){function G(t,z,B,N){this.gl=t;this.cardboardUI=z;this.bufferScale=B;this.dirtySubmitFrameBindings=N;this.ctxAttribs=t.getContextAttributes();this.instanceExt=
t.getExtension("ANGLE_instanced_arrays");this.meshHeight=this.meshWidth=20;this.bufferWidth=t.drawingBufferWidth;this.bufferHeight=t.drawingBufferHeight;this.realBindFramebuffer=t.bindFramebuffer;this.realEnable=t.enable;this.realDisable=t.disable;this.realColorMask=t.colorMask;this.realClearColor=t.clearColor;this.realViewport=t.viewport;Ya()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(t.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(t.canvas.__proto__,
"height"));this.isPatched=!1;this.lastBoundFramebuffer=null;this.stencilTest=this.scissorTest=this.blend=this.depthTest=this.cullFace=!1;this.viewport=[0,0,0,0];this.colorMask=[!0,!0,!0,!0];this.clearColor=[0,0,0,0];this.attribs={position:0,texCoord:1};this.program=uc(t,"attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}",
"precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}",this.attribs);this.uniforms=vc(t,this.program);this.viewportOffsetScale=new Float32Array(8);this.setTextureBounds();this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.indexCount=0;this.renderTarget=t.createTexture();this.framebuffer=t.createFramebuffer();this.stencilBuffer=this.depthBuffer=this.depthStencilBuffer=null;this.ctxAttribs.depth&&
this.ctxAttribs.stencil?this.depthStencilBuffer=t.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=t.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=t.createRenderbuffer());this.patch();this.onResize()}function H(t){this.gl=t;this.attribs={position:0};this.program=uc(t,"attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",
this.attribs);this.uniforms=vc(t,this.program);this.vertexBuffer=t.createBuffer();this.arrowVertexCount=this.arrowOffset=this.gearVertexCount=this.gearOffset=0;this.projMat=new Float32Array(16);this.listener=null;this.onResize()}function Y(t){this.coefficients=t}function sa(t){this.width=t.width||Tb();this.height=t.height||Ub();this.widthMeters=t.widthMeters;this.heightMeters=t.heightMeters;this.bevelMeters=t.bevelMeters}function ua(t,z){this.viewer=lc.CardboardV2;this.updateDeviceParams(t);this.distortion=
new Y(this.viewer.distortionCoefficients);for(t=0;t<z.length;t++){var B=z[t];lc[B.id]=new Ja(B)}}function Ja(t){this.id=t.id;this.label=t.label;this.fov=t.fov;this.interLensDistance=t.interLensDistance;this.baselineLensDistance=t.baselineLensDistance;this.screenLensDistance=t.screenLensDistance;this.distortionCoefficients=t.distortionCoefficients;this.inverseCoefficients=t.inverseCoefficients}function Sa(t,z){this.dpdb=Jc;this.recalculateDeviceParams_();if(t){this.onDeviceParamsUpdated=z;var B=new XMLHttpRequest,
N=this;B.open("GET",t,!0);B.addEventListener("load",function(){N.loading=!1;200<=B.status&&299>=B.status?(N.dpdb=JSON.parse(B.response),N.recalculateDeviceParams_()):console.error("Error loading online DPDB!")});B.send()}}function Va(t){this.xdpi=t.xdpi;this.ydpi=t.ydpi;this.bevelMm=t.bevelMm}function Ta(t,z){this.set(t,z)}function fb(t,z){this.kFilter=t;this.isDebug=z;this.currentAccelMeasurement=new Ta;this.currentGyroMeasurement=new Ta;this.previousGyroMeasurement=new Ta;Ya()?this.filterQ=new gb(-1,
0,0,1):this.filterQ=new gb(1,0,0,1);this.previousFilterQ=new gb;this.previousFilterQ.copy(this.filterQ);this.accelQ=new gb;this.isOrientationInitialized=!1;this.estimatedGravity=new ub;this.measuredGravity=new ub;this.gyroIntegralQ=new gb}function sb(t,z){this.predictionTimeS=t;this.isDebug=z;this.previousQ=new gb;this.previousTimestampS=null;this.deltaQ=new gb;this.outQ=new gb}function jb(t,z,B,N){this.yawOnly=B;this.accelerometer=new ub;this.gyroscope=new ub;this.filter=new fb(t,N);this.posePredictor=
new sb(z,N);this.isFirefoxAndroid=Nb();this.isIOS=Ya();t=Kb();this.isDeviceMotionInRadians=!this.isIOS&&t&&66>t;this.isWithoutDeviceMotion=Pb()||Ob();this.filterToWorldQ=new gb;Ya()?this.filterToWorldQ.setFromAxisAngle(new ub(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new ub(1,0,0),-Math.PI/2);this.inverseWorldToScreenQ=new gb;this.worldToScreenQ=new gb;this.originalPoseAdjustQ=new gb;this.originalPoseAdjustQ.setFromAxisAngle(new ub(0,0,1),-window.orientation*Math.PI/180);this.setScreenTransform_();
ob()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);this.resetQ=new gb;this.orientationOut_=new Float32Array(4);this.start()}function kb(){this.loadIcon_();var t=document.createElement("div"),z=t.style;z.position="fixed";z.top=0;z.right=0;z.bottom=0;z.left=0;z.backgroundColor="gray";z.fontFamily="sans-serif";z.zIndex=1E6;var B=document.createElement("img");B.src=this.icon;z=B.style;z.marginLeft="25%";z.marginTop="25%";z.width="50%";t.appendChild(B);B=document.createElement("div");z=B.style;
z.textAlign="center";z.fontSize="16px";z.lineHeight="24px";z.margin="24px 25%";z.width="50%";B.innerHTML="Place your phone into your Cardboard viewer.";t.appendChild(B);var N=document.createElement("div");z=N.style;z.backgroundColor="#CFD8DC";z.position="fixed";z.bottom=0;z.width="100%";z.height="48px";z.padding="14px 24px";z.boxSizing="border-box";z.color="#656A6B";t.appendChild(N);var oa=document.createElement("div");oa.style.float="left";oa.innerHTML="No Cardboard viewer?";var X=document.createElement("a");
X.href="https://www.google.com/get/cardboard/get-cardboard/";X.innerHTML="get one";X.target="_blank";z=X.style;z.float="right";z.fontWeight=600;z.textTransform="uppercase";z.borderLeft="1px solid gray";z.paddingLeft="24px";z.textDecoration="none";z.color="#656A6B";N.appendChild(oa);N.appendChild(X);this.overlay=t;this.text=B;this.hide()}function ib(t){try{this.selectedKey=localStorage.getItem("WEBVR_CARDBOARD_VIEWER")}catch(z){console.error("Failed to load viewer profile: %s",z)}this.selectedKey||
(this.selectedKey=t||"CardboardV1");this.dialog=this.createDialog_(ua.Viewers);this.root=null;this.onChangeCallbacks_=[]}function tb(t){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:t.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:t.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:t.canPresent},maxLayers:{writable:!1,enumerable:!0,value:t.maxLayers},hasOrientation:{enumerable:!0,get:function(){Qb("VRDisplayCapabilities.prototype.hasOrientation",
"VRDisplay.prototype.getFrameData");return t.hasOrientation}}})}function ab(t){t=t||{};t="wakelock"in t?t.wakelock:!0;this.isPolyfilled=!0;this.displayId=Kc++;this.displayName="";this.depthNear=.01;this.depthFar=1E4;this.isPresenting=!1;Object.defineProperty(this,"isConnected",{get:function(){Qb("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay");return!1}});this.capabilities=new tb({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1});
this.stageParameters=null;this.waitingForPresent_=!1;this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=this.fullscreenElementCachedStyle_=this.fullscreenWrapper_=this.fullscreenElement_=this.originalParent_=this.layer_=null;t&&mc()&&(this.wakelock_=new Lc)}function Wa(t){var z=wc({},Mc);t=wc(z,t||{});ab.call(this,{wakelock:t.MOBILE_WAKE_LOCK});this.config=t;this.displayName="Cardboard VRDisplay";this.capabilities=new tb({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,
canPresent:!0,maxLayers:1});this.stageParameters=null;this.bufferScale_=this.config.BUFFER_SCALE;this.poseSensor_=new Nc(this.config);this.cardboardUI_=this.distorter_=null;this.dpdb_=new Sa(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this));this.deviceInfo_=new ua(this.dpdb_.getDeviceParams(),t.ADDITIONAL_VIEWERS);this.viewerSelector_=new ib(t.DEFAULT_VIEWER);this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());
this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new kb);Ya()&&window.addEventListener("resize",this.onResize_.bind(this))}var lb=function(){function t(z,B){for(var N=0;N<B.length;N++){var oa=B[N];oa.enumerable=oa.enumerable||!1;oa.configurable=!0;"value"in oa&&(oa.writable=!0);Object.defineProperty(z,oa.key,oa)}}return function(z,B,N){B&&t(z.prototype,B);N&&t(z,N);return z}}(),mb=function(){return function(t,z){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){var B=
[],N=!0,oa=!1,X=void 0;try{for(var aa=t[Symbol.iterator](),Ga;!(N=(Ga=aa.next()).done)&&(B.push(Ga.value),!z||B.length!==z);N=!0);}catch(Na){oa=!0,X=Na}finally{try{if(!N&&aa["return"])aa["return"]()}finally{if(oa)throw X;}}return B}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),Ya=function(){var t=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return t}}(),Gb=function(){var t=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&
-1!==navigator.userAgent.indexOf("Chrome");return function(){return t}}(),Mb=function(){var t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return t}}(),Nb=function(){var t=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return t}}(),Kb=function(){var t=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),z=t?parseInt(t[1],10):null;return function(){return z}}(),Ob=function(){var t=!1;t=Ya()&&Mb()&&-1!==navigator.userAgent.indexOf("13_4");
return function(){return t}}(),Pb=function(){var t=!1;if(65===Kb()){var z=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(z){z=z[1].split(".");z=mb(z,4);var B=z[3];t=3325===parseInt(z[2],10)&&148>parseInt(B,10)}}return function(){return t}}(),Lb=function(){var t=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return t}}(),ob=function(){var t=90==window.orientation||-90==window.orientation;return Lb()?!t:t},Tb=function(){return Math.max(window.screen.width,window.screen.height)*
window.devicePixelRatio},Ub=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},Oc=function(t){if(Gb())return!1;if(t.requestFullscreen)t.requestFullscreen();else if(t.webkitRequestFullscreen)t.webkitRequestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.msRequestFullscreen)t.msRequestFullscreen();else return!1;return!0},xc=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();
else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},uc=function(t,z,B,N){var oa=t.createShader(t.VERTEX_SHADER);t.shaderSource(oa,z);t.compileShader(oa);z=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(z,B);t.compileShader(z);B=t.createProgram();t.attachShader(B,oa);t.attachShader(B,z);for(var X in N)t.bindAttribLocation(B,N[X],X);t.linkProgram(B);t.deleteShader(oa);t.deleteShader(z);return B},
vc=function(t,z){for(var B={},N=t.getProgramParameter(z,t.ACTIVE_UNIFORMS),oa,X=0;X<N;X++)oa=t.getActiveUniform(z,X).name.replace("[0]",""),B[oa]=t.getUniformLocation(z,oa);return B},mc=function(){var t=!1,z=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(z)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(z.substr(0,
4)))t=!0;return t},wc=function(t,z){for(var B in z)z.hasOwnProperty(B)&&(t[B]=z[B]);return t},nc=function(t){if(Ya()){var z=t.style.width,B=t.style.height;t.style.width=parseInt(z)+1+"px";t.style.height=parseInt(B)+"px";setTimeout(function(){t.style.width=z;t.style.height=B},100)}window.canvas=t},Pc=function(){function t(X,aa,Ga,Na,Ka,Pa){var Ra=Na||null;Na=Pa.depthNear;Pa=Pa.depthFar;var Za=Math.tan(Ra?Ra.upDegrees*z:B),hb=Math.tan(Ra?Ra.downDegrees*z:B),vb=Math.tan(Ra?Ra.leftDegrees*z:B);Ra=Math.tan(Ra?
Ra.rightDegrees*z:B);var bb=2/(vb+Ra),qb=2/(Za+hb);X[0]=bb;X[1]=0;X[2]=0;X[3]=0;X[4]=0;X[5]=qb;X[6]=0;X[7]=0;X[8]=-((vb-Ra)*bb*.5);X[9]=(Za-hb)*qb*.5;X[10]=Pa/(Na-Pa);X[11]=-1;X[12]=0;X[13]=0;X[14]=Pa*Na/(Na-Pa);X[15]=0;X=Ga.orientation||N;Ga=Ga.position||oa;hb=X[0];bb=X[1];qb=X[2];Pa=X[3];var Db=hb+hb;Ra=bb+bb;Za=qb+qb;X=hb*Db;Na=hb*Ra;hb*=Za;vb=bb*Ra;bb*=Za;qb*=Za;Db*=Pa;Ra*=Pa;Pa*=Za;aa[0]=1-(vb+qb);aa[1]=Na+Pa;aa[2]=hb-Ra;aa[3]=0;aa[4]=Na-Pa;aa[5]=1-(X+qb);aa[6]=bb+Db;aa[7]=0;aa[8]=hb+Ra;aa[9]=
bb-Db;aa[10]=1-(X+vb);aa[11]=0;aa[12]=Ga[0];aa[13]=Ga[1];aa[14]=Ga[2];aa[15]=1;if(Ka)if(Ga=Ka[0],X=Ka[1],Ka=Ka[2],aa===aa)aa[12]=aa[0]*Ga+aa[4]*X+aa[8]*Ka+aa[12],aa[13]=aa[1]*Ga+aa[5]*X+aa[9]*Ka+aa[13],aa[14]=aa[2]*Ga+aa[6]*X+aa[10]*Ka+aa[14],aa[15]=aa[3]*Ga+aa[7]*X+aa[11]*Ka+aa[15];else{Na=aa[0];Pa=aa[1];Za=aa[2];hb=aa[3];vb=aa[4];Ra=aa[5];bb=aa[6];qb=aa[7];Db=aa[8];var Hb=aa[9];var Ib=aa[10];var Jb=aa[11];aa[0]=Na;aa[1]=Pa;aa[2]=Za;aa[3]=hb;aa[4]=vb;aa[5]=Ra;aa[6]=bb;aa[7]=qb;aa[8]=Db;aa[9]=Hb;
aa[10]=Ib;aa[11]=Jb;aa[12]=Na*Ga+vb*X+Db*Ka+aa[12];aa[13]=Pa*Ga+Ra*X+Hb*Ka+aa[13];aa[14]=Za*Ga+bb*X+Ib*Ka+aa[14];aa[15]=hb*Ga+qb*X+Jb*Ka+aa[15]}Ka=aa[0];Ga=aa[1];X=aa[2];Na=aa[3];Pa=aa[4];Za=aa[5];hb=aa[6];vb=aa[7];Ra=aa[8];bb=aa[9];qb=aa[10];Db=aa[11];Hb=aa[12];Ib=aa[13];Jb=aa[14];var Sb=aa[15],Vb=Ka*Za-Ga*Pa,Wb=Ka*hb-X*Pa,Xb=Ka*vb-Na*Pa,Yb=Ga*hb-X*Za,Zb=Ga*vb-Na*Za,$b=X*vb-Na*hb,ac=Ra*Ib-bb*Hb,bc=Ra*Jb-qb*Hb,cc=Ra*Sb-Db*Hb,dc=bb*Jb-qb*Ib,ec=bb*Sb-Db*Ib,fc=qb*Sb-Db*Jb,Ab=Vb*fc-Wb*ec+Xb*dc+Yb*cc-
Zb*bc+$b*ac;Ab&&(Ab=1/Ab,aa[0]=(Za*fc-hb*ec+vb*dc)*Ab,aa[1]=(X*ec-Ga*fc-Na*dc)*Ab,aa[2]=(Ib*$b-Jb*Zb+Sb*Yb)*Ab,aa[3]=(qb*Zb-bb*$b-Db*Yb)*Ab,aa[4]=(hb*cc-Pa*fc-vb*bc)*Ab,aa[5]=(Ka*fc-X*cc+Na*bc)*Ab,aa[6]=(Jb*Xb-Hb*$b-Sb*Wb)*Ab,aa[7]=(Ra*$b-qb*Xb+Db*Wb)*Ab,aa[8]=(Pa*ec-Za*cc+vb*ac)*Ab,aa[9]=(Ga*cc-Ka*ec-Na*ac)*Ab,aa[10]=(Hb*Zb-Ib*Xb+Sb*Vb)*Ab,aa[11]=(bb*Xb-Ra*Zb-Db*Vb)*Ab,aa[12]=(Za*bc-Pa*dc-hb*ac)*Ab,aa[13]=(Ka*dc-Ga*bc+X*ac)*Ab,aa[14]=(Ib*Wb-Hb*Yb-Jb*Vb)*Ab,aa[15]=(Ra*Yb-bb*Wb+qb*Vb)*Ab)}var z=Math.PI/
180,B=.25*Math.PI,N=new Float32Array([0,0,0,1]),oa=new Float32Array([0,0,0]);return function(X,aa,Ga){if(!X||!aa)return!1;X.pose=aa;X.timestamp=aa.timestamp;t(X.leftProjectionMatrix,X.leftViewMatrix,aa,Ga._getFieldOfView("left"),Ga._getEyeOffset("left"),Ga);t(X.rightProjectionMatrix,X.rightViewMatrix,aa,Ga._getFieldOfView("right"),Ga._getEyeOffset("right"),Ga);return!0}}(),yc=function(t){var z=t.indexOf("://");z=t.indexOf("/",-1!==z?z+3:0);-1===z&&(z=t.length);return t.substring(0,z)},oc=function(){var t=
{};return function(z,B){void 0===t[z]&&(console.warn("webvr-polyfill: "+B),t[z]=!0)}}(),Qb=function(t,z){oc(t,t+" has been deprecated. This may not work on native WebVR displays. "+(z?"Please use "+z+" instead.":""))},gc=function(t,z,B){if(z){for(var N=[],oa=null,X=0;X<z.length;++X){var aa=z[X];switch(aa){case t.TEXTURE_BINDING_2D:case t.TEXTURE_BINDING_CUBE_MAP:var Ga=z[++X];if(Ga<t.TEXTURE0||Ga>t.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");
N.push(null,null);break}oa||(oa=t.getParameter(t.ACTIVE_TEXTURE));t.activeTexture(Ga);N.push(t.getParameter(aa),null);break;case t.ACTIVE_TEXTURE:oa=t.getParameter(t.ACTIVE_TEXTURE);N.push(null);break;default:N.push(t.getParameter(aa))}}B(t);for(X=0;X<z.length;++X){aa=z[X];B=N[X];switch(aa){case t.ACTIVE_TEXTURE:break;case t.ARRAY_BUFFER_BINDING:t.bindBuffer(t.ARRAY_BUFFER,B);break;case t.COLOR_CLEAR_VALUE:t.clearColor(B[0],B[1],B[2],B[3]);break;case t.COLOR_WRITEMASK:t.colorMask(B[0],B[1],B[2],B[3]);
break;case t.CURRENT_PROGRAM:t.useProgram(B);break;case t.ELEMENT_ARRAY_BUFFER_BINDING:t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,B);break;case t.FRAMEBUFFER_BINDING:t.bindFramebuffer(t.FRAMEBUFFER,B);break;case t.RENDERBUFFER_BINDING:t.bindRenderbuffer(t.RENDERBUFFER,B);break;case t.TEXTURE_BINDING_2D:Ga=z[++X];if(Ga<t.TEXTURE0||Ga>t.TEXTURE31)break;t.activeTexture(Ga);t.bindTexture(t.TEXTURE_2D,B);break;case t.TEXTURE_BINDING_CUBE_MAP:Ga=z[++X];if(Ga<t.TEXTURE0||Ga>t.TEXTURE31)break;t.activeTexture(Ga);
t.bindTexture(t.TEXTURE_CUBE_MAP,B);break;case t.VIEWPORT:t.viewport(B[0],B[1],B[2],B[3]);break;case t.BLEND:case t.CULL_FACE:case t.DEPTH_TEST:case t.SCISSOR_TEST:case t.STENCIL_TEST:B?t.enable(aa):t.disable(aa);break;default:console.log("No GL restore behavior for 0x"+aa.toString(16))}oa&&t.activeTexture(oa)}}else B(t)};G.prototype.destroy=function(){var t=this.gl;this.unpatch();t.deleteProgram(this.program);t.deleteBuffer(this.vertexBuffer);t.deleteBuffer(this.indexBuffer);t.deleteTexture(this.renderTarget);
t.deleteFramebuffer(this.framebuffer);this.depthStencilBuffer&&t.deleteRenderbuffer(this.depthStencilBuffer);this.depthBuffer&&t.deleteRenderbuffer(this.depthBuffer);this.stencilBuffer&&t.deleteRenderbuffer(this.stencilBuffer);this.cardboardUI&&this.cardboardUI.destroy()};G.prototype.onResize=function(){var t=this.gl,z=this;gc(t,[t.RENDERBUFFER_BINDING,t.TEXTURE_BINDING_2D,t.TEXTURE0],function(B){z.realBindFramebuffer.call(B,B.FRAMEBUFFER,null);z.scissorTest&&z.realDisable.call(B,B.SCISSOR_TEST);
z.realColorMask.call(B,!0,!0,!0,!0);z.realViewport.call(B,0,0,B.drawingBufferWidth,B.drawingBufferHeight);z.realClearColor.call(B,0,0,0,1);B.clear(B.COLOR_BUFFER_BIT);z.realBindFramebuffer.call(B,B.FRAMEBUFFER,z.framebuffer);B.bindTexture(B.TEXTURE_2D,z.renderTarget);B.texImage2D(B.TEXTURE_2D,0,z.ctxAttribs.alpha?B.RGBA:B.RGB,z.bufferWidth,z.bufferHeight,0,z.ctxAttribs.alpha?B.RGBA:B.RGB,B.UNSIGNED_BYTE,null);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR);B.texParameteri(B.TEXTURE_2D,
B.TEXTURE_MIN_FILTER,B.LINEAR);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_2D,z.renderTarget,0);z.ctxAttribs.depth&&z.ctxAttribs.stencil?(B.bindRenderbuffer(B.RENDERBUFFER,z.depthStencilBuffer),B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_STENCIL,z.bufferWidth,z.bufferHeight),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_STENCIL_ATTACHMENT,B.RENDERBUFFER,
z.depthStencilBuffer)):z.ctxAttribs.depth?(B.bindRenderbuffer(B.RENDERBUFFER,z.depthBuffer),B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_COMPONENT16,z.bufferWidth,z.bufferHeight),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,B.RENDERBUFFER,z.depthBuffer)):z.ctxAttribs.stencil&&(B.bindRenderbuffer(B.RENDERBUFFER,z.stencilBuffer),B.renderbufferStorage(B.RENDERBUFFER,B.STENCIL_INDEX8,z.bufferWidth,z.bufferHeight),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.STENCIL_ATTACHMENT,B.RENDERBUFFER,
z.stencilBuffer));!B.checkFramebufferStatus(B.FRAMEBUFFER)===B.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!");z.realBindFramebuffer.call(B,B.FRAMEBUFFER,z.lastBoundFramebuffer);z.scissorTest&&z.realEnable.call(B,B.SCISSOR_TEST);z.realColorMask.apply(B,z.colorMask);z.realViewport.apply(B,z.viewport);z.realClearColor.apply(B,z.clearColor)});if(this.cardboardUI)this.cardboardUI.onResize()};G.prototype.patch=function(){if(!this.isPatched){var t=this,z=this.gl.canvas,B=this.gl;Ya()||(z.width=
Tb()*this.bufferScale,z.height=Ub()*this.bufferScale,Object.defineProperty(z,"width",{configurable:!0,enumerable:!0,get:function(){return t.bufferWidth},set:function(N){t.bufferWidth=N;t.realCanvasWidth.set.call(z,N);t.onResize()}}),Object.defineProperty(z,"height",{configurable:!0,enumerable:!0,get:function(){return t.bufferHeight},set:function(N){t.bufferHeight=N;t.realCanvasHeight.set.call(z,N);t.onResize()}}));this.lastBoundFramebuffer=B.getParameter(B.FRAMEBUFFER_BINDING);null==this.lastBoundFramebuffer&&
(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(B.FRAMEBUFFER,this.framebuffer));this.gl.bindFramebuffer=function(N,oa){t.lastBoundFramebuffer=oa?oa:t.framebuffer;t.realBindFramebuffer.call(B,N,t.lastBoundFramebuffer)};this.cullFace=B.getParameter(B.CULL_FACE);this.depthTest=B.getParameter(B.DEPTH_TEST);this.blend=B.getParameter(B.BLEND);this.scissorTest=B.getParameter(B.SCISSOR_TEST);this.stencilTest=B.getParameter(B.STENCIL_TEST);B.enable=function(N){switch(N){case B.CULL_FACE:t.cullFace=
!0;break;case B.DEPTH_TEST:t.depthTest=!0;break;case B.BLEND:t.blend=!0;break;case B.SCISSOR_TEST:t.scissorTest=!0;break;case B.STENCIL_TEST:t.stencilTest=!0}t.realEnable.call(B,N)};B.disable=function(N){switch(N){case B.CULL_FACE:t.cullFace=!1;break;case B.DEPTH_TEST:t.depthTest=!1;break;case B.BLEND:t.blend=!1;break;case B.SCISSOR_TEST:t.scissorTest=!1;break;case B.STENCIL_TEST:t.stencilTest=!1}t.realDisable.call(B,N)};this.colorMask=B.getParameter(B.COLOR_WRITEMASK);B.colorMask=function(N,oa,X,
aa){t.colorMask[0]=N;t.colorMask[1]=oa;t.colorMask[2]=X;t.colorMask[3]=aa;t.realColorMask.call(B,N,oa,X,aa)};this.clearColor=B.getParameter(B.COLOR_CLEAR_VALUE);B.clearColor=function(N,oa,X,aa){t.clearColor[0]=N;t.clearColor[1]=oa;t.clearColor[2]=X;t.clearColor[3]=aa;t.realClearColor.call(B,N,oa,X,aa)};this.viewport=B.getParameter(B.VIEWPORT);B.viewport=function(N,oa,X,aa){t.viewport[0]=N;t.viewport[1]=oa;t.viewport[2]=X;t.viewport[3]=aa;t.realViewport.call(B,N,oa,X,aa)};this.isPatched=!0;nc(z)}};
G.prototype.unpatch=function(){if(this.isPatched){var t=this.gl,z=this.gl.canvas;Ya()||(Object.defineProperty(z,"width",this.realCanvasWidth),Object.defineProperty(z,"height",this.realCanvasHeight));z.width=this.bufferWidth;z.height=this.bufferHeight;t.bindFramebuffer=this.realBindFramebuffer;t.enable=this.realEnable;t.disable=this.realDisable;t.colorMask=this.realColorMask;t.clearColor=this.realClearColor;t.viewport=this.realViewport;this.lastBoundFramebuffer==this.framebuffer&&t.bindFramebuffer(t.FRAMEBUFFER,
null);this.isPatched=!1;setTimeout(function(){nc(z)},1)}};G.prototype.setTextureBounds=function(t,z){t||(t=[0,0,.5,1]);z||(z=[.5,0,.5,1]);this.viewportOffsetScale[0]=t[0];this.viewportOffsetScale[1]=t[1];this.viewportOffsetScale[2]=t[2];this.viewportOffsetScale[3]=t[3];this.viewportOffsetScale[4]=z[0];this.viewportOffsetScale[5]=z[1];this.viewportOffsetScale[6]=z[2];this.viewportOffsetScale[7]=z[3]};G.prototype.submitFrame=function(){var t=this.gl,z=this,B=[];this.dirtySubmitFrameBindings||B.push(t.CURRENT_PROGRAM,
t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING,t.TEXTURE_BINDING_2D,t.TEXTURE0);gc(t,B,function(N){z.realBindFramebuffer.call(N,N.FRAMEBUFFER,null);var oa=0,X=0;z.instanceExt&&(oa=N.getVertexAttrib(z.attribs.position,z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),X=N.getVertexAttrib(z.attribs.texCoord,z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE));z.cullFace&&z.realDisable.call(N,N.CULL_FACE);z.depthTest&&z.realDisable.call(N,N.DEPTH_TEST);z.blend&&z.realDisable.call(N,N.BLEND);z.scissorTest&&
z.realDisable.call(N,N.SCISSOR_TEST);z.stencilTest&&z.realDisable.call(N,N.STENCIL_TEST);z.realColorMask.call(N,!0,!0,!0,!0);z.realViewport.call(N,0,0,N.drawingBufferWidth,N.drawingBufferHeight);if(z.ctxAttribs.alpha||Ya())z.realClearColor.call(N,0,0,0,1),N.clear(N.COLOR_BUFFER_BIT);N.useProgram(z.program);N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,z.indexBuffer);N.bindBuffer(N.ARRAY_BUFFER,z.vertexBuffer);N.enableVertexAttribArray(z.attribs.position);N.enableVertexAttribArray(z.attribs.texCoord);N.vertexAttribPointer(z.attribs.position,
2,N.FLOAT,!1,20,0);N.vertexAttribPointer(z.attribs.texCoord,3,N.FLOAT,!1,20,8);z.instanceExt&&(0!=oa&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,0),0!=X&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,0));N.activeTexture(N.TEXTURE0);N.uniform1i(z.uniforms.diffuse,0);N.bindTexture(N.TEXTURE_2D,z.renderTarget);N.uniform4fv(z.uniforms.viewportOffsetScale,z.viewportOffsetScale);N.drawElements(N.TRIANGLES,z.indexCount,N.UNSIGNED_SHORT,0);z.cardboardUI&&z.cardboardUI.renderNoState();
z.realBindFramebuffer.call(z.gl,N.FRAMEBUFFER,z.framebuffer);z.ctxAttribs.preserveDrawingBuffer||(z.realClearColor.call(N,0,0,0,0),N.clear(N.COLOR_BUFFER_BIT));z.dirtySubmitFrameBindings||z.realBindFramebuffer.call(N,N.FRAMEBUFFER,z.lastBoundFramebuffer);z.cullFace&&z.realEnable.call(N,N.CULL_FACE);z.depthTest&&z.realEnable.call(N,N.DEPTH_TEST);z.blend&&z.realEnable.call(N,N.BLEND);z.scissorTest&&z.realEnable.call(N,N.SCISSOR_TEST);z.stencilTest&&z.realEnable.call(N,N.STENCIL_TEST);z.realColorMask.apply(N,
z.colorMask);z.realViewport.apply(N,z.viewport);!z.ctxAttribs.alpha&&z.ctxAttribs.preserveDrawingBuffer||z.realClearColor.apply(N,z.clearColor);z.instanceExt&&(0!=oa&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,oa),0!=X&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,X))});Ya()&&(t=t.canvas,t.width!=z.bufferWidth||t.height!=z.bufferHeight)&&(z.bufferWidth=t.width,z.bufferHeight=t.height,z.onResize())};G.prototype.updateDeviceInfo=function(t){var z=this.gl,B=this;gc(z,[z.ARRAY_BUFFER_BINDING,
z.ELEMENT_ARRAY_BUFFER_BINDING],function(N){var oa=B.computeMeshVertices_(B.meshWidth,B.meshHeight,t);N.bindBuffer(N.ARRAY_BUFFER,B.vertexBuffer);N.bufferData(N.ARRAY_BUFFER,oa,N.STATIC_DRAW);B.indexCount||(oa=B.computeMeshIndices_(B.meshWidth,B.meshHeight),N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,B.indexBuffer),N.bufferData(N.ELEMENT_ARRAY_BUFFER,oa,N.STATIC_DRAW),B.indexCount=oa.length)})};G.prototype.computeMeshVertices_=function(t,z,B){for(var N=new Float32Array(2*t*z*5),oa=B.getLeftEyeVisibleTanAngles(),
X=B.getLeftEyeNoLensTanAngles(),aa=B.getLeftEyeVisibleScreenRect(X),Ga=0,Na=0;2>Na;Na++){for(var Ka=0;Ka<z;Ka++)for(var Pa=0;Pa<t;Pa++,Ga++){var Ra=Pa/(t-1),Za=Ka/(z-1),hb=Ra,vb=Za,bb=oa[0];Ra=bb+(oa[2]-bb)*Ra;bb=oa[3];var qb=bb+(oa[1]-bb)*Za;Za=Math.sqrt(Ra*Ra+qb*qb);bb=B.distortion.distortInverse(Za);qb=qb*bb/Za;Ra=(Ra*bb/Za-X[0])/(X[2]-X[0]);Za=(qb-X[3])/(X[1]-X[3]);Ra=2*(aa.x+Ra*aa.width-.5);Za=2*(aa.y+Za*aa.height-.5);N[5*Ga]=Ra;N[5*Ga+1]=Za;N[5*Ga+2]=hb;N[5*Ga+3]=vb;N[5*Ga+4]=Na}Ka=oa[2]-oa[0];
oa[0]=-(Ka+oa[0]);oa[2]=Ka-oa[2];Ka=X[2]-X[0];X[0]=-(Ka+X[0]);X[2]=Ka-X[2];aa.x=1-(aa.x+aa.width)}return N};G.prototype.computeMeshIndices_=function(t,z){for(var B=new Uint16Array(2*(t-1)*(z-1)*6),N=t/2,oa=z/2,X=0,aa=0,Ga=0;2>Ga;Ga++)for(var Na=0;Na<z;Na++)for(var Ka=0;Ka<t;Ka++,X++)0!=Ka&&0!=Na&&(Ka<=N==Na<=oa?(B[aa++]=X,B[aa++]=X-t-1,B[aa++]=X-t,B[aa++]=X-t-1,B[aa++]=X,B[aa++]=X-1):(B[aa++]=X-1,B[aa++]=X-t,B[aa++]=X,B[aa++]=X-t,B[aa++]=X-1,B[aa++]=X-t-1));return B};G.prototype.getOwnPropertyDescriptor_=
function(t,z){t=Object.getOwnPropertyDescriptor(t,z);if(void 0===t.get||void 0===t.set)t.configurable=!0,t.enumerable=!0,t.get=function(){return this.getAttribute(z)},t.set=function(B){this.setAttribute(z,B)};return t};var zc=Math.PI/180;H.prototype.destroy=function(){var t=this.gl;this.listener&&t.canvas.removeEventListener("click",this.listener,!1);t.deleteProgram(this.program);t.deleteBuffer(this.vertexBuffer)};H.prototype.listen=function(t,z){var B=this.gl.canvas;this.listener=function(N){var oa=
B.clientWidth/2,X=N.touches?N.touches[0].clientX:N.clientX,aa=N.touches?N.touches[0].clientY:N.clientY;X>oa-42&&X<oa+42&&aa>B.clientHeight-42?t(N):42>X&&42>aa&&z(N)};B.addEventListener("click",this.listener,!1);B.addEventListener("touchstart",this.listener,!1)};H.prototype.onResize=function(){var t=this.gl,z=this;gc(t,[t.ARRAY_BUFFER_BINDING],function(B){function N(hb,vb){var bb=(90-hb)*zc;hb=Math.cos(bb);bb=Math.sin(bb);X.push(.3125*hb*Pa+aa,.3125*bb*Pa+Pa);X.push(vb*hb*Pa+aa,vb*bb*Pa+Pa)}function oa(hb,
vb){X.push(Ra+hb,B.drawingBufferHeight-Ra-vb)}var X=[],aa=B.drawingBufferWidth/2,Ga=B.drawingBufferWidth/(Math.max(screen.width,screen.height)*window.devicePixelRatio)*window.devicePixelRatio,Na=4*Ga/2,Ka=42*Ga,Pa=28*Ga/2,Ra=14*Ga;X.push(aa-Na,Ka);X.push(aa-Na,B.drawingBufferHeight);X.push(aa+Na,Ka);X.push(aa+Na,B.drawingBufferHeight);z.gearOffset=X.length/2;for(Ka=0;6>=Ka;Ka++){var Za=60*Ka;N(Za,1);N(Za+12,1);N(Za+20,.75);N(Za+40,.75);N(Za+48,1)}z.gearVertexCount=X.length/2-z.gearOffset;z.arrowOffset=
X.length/2;Ka=Na/Math.sin(45*zc);oa(0,Pa);oa(Pa,0);oa(Pa+Ka,Ka);oa(Ka,Pa+Ka);oa(Ka,Pa-Ka);oa(0,Pa);oa(Pa,2*Pa);oa(Pa+Ka,2*Pa-Ka);oa(Ka,Pa-Ka);oa(0,Pa);oa(Ka,Pa-Na);oa(28*Ga,Pa-Na);oa(Ka,Pa+Na);oa(28*Ga,Pa+Na);z.arrowVertexCount=X.length/2-z.arrowOffset;B.bindBuffer(B.ARRAY_BUFFER,z.vertexBuffer);B.bufferData(B.ARRAY_BUFFER,new Float32Array(X),B.STATIC_DRAW)})};H.prototype.render=function(){var t=this.gl,z=this;gc(t,[t.CULL_FACE,t.DEPTH_TEST,t.BLEND,t.SCISSOR_TEST,t.STENCIL_TEST,t.COLOR_WRITEMASK,
t.VIEWPORT,t.CURRENT_PROGRAM,t.ARRAY_BUFFER_BINDING],function(B){B.disable(B.CULL_FACE);B.disable(B.DEPTH_TEST);B.disable(B.BLEND);B.disable(B.SCISSOR_TEST);B.disable(B.STENCIL_TEST);B.colorMask(!0,!0,!0,!0);B.viewport(0,0,B.drawingBufferWidth,B.drawingBufferHeight);z.renderNoState()})};H.prototype.renderNoState=function(){var t=this.gl;t.useProgram(this.program);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.enableVertexAttribArray(this.attribs.position);t.vertexAttribPointer(this.attribs.position,
2,t.FLOAT,!1,8,0);t.uniform4f(this.uniforms.color,1,1,1,1);var z=this.projMat,B=t.drawingBufferWidth,N=t.drawingBufferHeight,oa=1/(0-B),X=1/(0-N),aa=1/-1023.9;z[0]=-2*oa;z[1]=0;z[2]=0;z[3]=0;z[4]=0;z[5]=-2*X;z[6]=0;z[7]=0;z[8]=0;z[9]=0;z[10]=2*aa;z[11]=0;z[12]=(0+B)*oa;z[13]=(N+0)*X;z[14]=1024.1*aa;z[15]=1;t.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat);t.drawArrays(t.TRIANGLE_STRIP,0,4);t.drawArrays(t.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount);t.drawArrays(t.TRIANGLE_STRIP,
this.arrowOffset,this.arrowVertexCount)};Y.prototype.distortInverse=function(t){for(var z=0,B=1,N=t-this.distort(z);1E-4<Math.abs(B-z);){var oa=t-this.distort(B);N=B-(B-z)/(oa-N)*oa;z=B;B=N;N=oa}return B};Y.prototype.distort=function(t){for(var z=t*t,B=0,N=0;N<this.coefficients.length;N++)B=z*(B+this.coefficients[N]);return(B+1)*t};var Eb=Math.PI/180,Fb=180/Math.PI,ub=function(t,z,B){this.x=t||0;this.y=z||0;this.z=B||0};ub.prototype={constructor:ub,set:function(t,z,B){this.x=t;this.y=z;this.z=B;return this},
copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=this.length();0!==t?this.multiplyScalar(1/t):this.z=this.y=this.x=0;return this},multiplyScalar:function(t){this.x*=t;this.y*=t;this.z*=t},applyQuaternion:function(t){var z=this.x,B=this.y,N=this.z,oa=t.x,X=t.y,aa=t.z;t=t.w;var Ga=t*z+X*N-aa*B,Na=t*B+aa*z-oa*N,Ka=t*N+oa*B-X*z;z=-oa*z-X*B-aa*N;this.x=Ga*t+z*-oa+Na*-aa-Ka*-X;this.y=
Na*t+z*-X+Ka*-oa-Ga*-aa;this.z=Ka*t+z*-aa+Ga*-X-Na*-oa;return this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},crossVectors:function(t,z){var B=t.x,N=t.y;t=t.z;var oa=z.x,X=z.y;z=z.z;this.x=N*z-t*X;this.y=t*oa-B*z;this.z=B*X-N*oa;return this}};var gb=function(t,z,B,N){this.x=t||0;this.y=z||0;this.z=B||0;this.w=void 0!==N?N:1};gb.prototype={constructor:gb,set:function(t,z,B,N){this.x=t;this.y=z;this.z=B;this.w=N;return this},copy:function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w;
return this},setFromEulerXYZ:function(t,z,B){var N=Math.cos(t/2),oa=Math.cos(z/2),X=Math.cos(B/2);t=Math.sin(t/2);z=Math.sin(z/2);B=Math.sin(B/2);this.x=t*oa*X+N*z*B;this.y=N*z*X-t*oa*B;this.z=N*oa*B+t*z*X;this.w=N*oa*X-t*z*B;return this},setFromEulerYXZ:function(t,z,B){var N=Math.cos(t/2),oa=Math.cos(z/2),X=Math.cos(B/2);t=Math.sin(t/2);z=Math.sin(z/2);B=Math.sin(B/2);this.x=t*oa*X+N*z*B;this.y=N*z*X-t*oa*B;this.z=N*oa*B-t*z*X;this.w=N*oa*X+t*z*B;return this},setFromAxisAngle:function(t,z){z/=2;
var B=Math.sin(z);this.x=t.x*B;this.y=t.y*B;this.z=t.z*B;this.w=Math.cos(z);return this},multiply:function(t){return this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,z){var B=t.x,N=t.y,oa=t.z;t=t.w;var X=z.x,aa=z.y,Ga=z.z;z=z.w;this.x=B*z+t*X+N*Ga-oa*aa;this.y=N*z+t*aa+oa*X-B*Ga;this.z=oa*z+t*Ga+B*aa-N*X;this.w=t*z-B*X-N*aa-oa*Ga;return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;this.normalize();return this},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*
this.y+this.z*this.z+this.w*this.w);0===t?(this.z=this.y=this.x=0,this.w=1):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t);return this},slerp:function(t,z){if(0===z)return this;if(1===z)return this.copy(t);var B=this.x,N=this.y,oa=this.z,X=this.w,aa=X*t.w+B*t.x+N*t.y+oa*t.z;0>aa?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,aa=-aa):this.copy(t);if(1<=aa)return this.w=X,this.x=B,this.y=N,this.z=oa,this;t=Math.acos(aa);var Ga=Math.sqrt(1-aa*aa);if(.001>Math.abs(Ga))return this.w=.5*(X+this.w),this.x=
.5*(B+this.x),this.y=.5*(N+this.y),this.z=.5*(oa+this.z),this;aa=Math.sin((1-z)*t)/Ga;z=Math.sin(z*t)/Ga;this.w=X*aa+this.w*z;this.x=B*aa+this.x*z;this.y=N*aa+this.y*z;this.z=oa*aa+this.z*z;return this},setFromUnitVectors:function(){var t,z;return function(B,N){void 0===t&&(t=new ub);z=B.dot(N)+1;1E-6>z?(z=0,Math.abs(B.x)>Math.abs(B.z)?t.set(-B.y,B.x,0):t.set(0,-B.z,B.y)):t.crossVectors(B,N);this.x=t.x;this.y=t.y;this.z=t.z;this.w=z;this.normalize();return this}}()};var Qc=new sa({widthMeters:.11,
heightMeters:.062,bevelMeters:.004}),Rc=new sa({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),lc={CardboardV1:new Ja({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Ja({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,
interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-9.904169E-4,6.183535E-5,-1.6981803E-6]})};ua.prototype.updateDeviceParams=function(t){this.device=this.determineDevice_(t)||this.device};ua.prototype.getDevice=function(){return this.device};ua.prototype.setViewer=function(t){this.viewer=t;this.distortion=new Y(this.viewer.distortionCoefficients)};
ua.prototype.determineDevice_=function(t){if(!t){if(Ya())return console.warn("Using fallback iOS device measurements."),Rc;console.warn("Using fallback Android device measurements.");return Qc}var z=.0254/t.xdpi,B=.0254/t.ydpi,N=Tb(),oa=Ub();return new sa({widthMeters:z*N,heightMeters:B*oa,bevelMeters:.001*t.bevelMm})};ua.prototype.getDistortedFieldOfViewLeftEye=function(){var t=this.viewer,z=this.device,B=this.distortion,N=t.screenLensDistance,oa=t.interLensDistance/2,X=t.baselineLensDistance-z.bevelMeters,
aa=z.heightMeters-X;z=Fb*Math.atan(B.distort((z.widthMeters-t.interLensDistance)/2/N));oa=Fb*Math.atan(B.distort(oa/N));X=Fb*Math.atan(B.distort(X/N));B=Fb*Math.atan(B.distort(aa/N));return{leftDegrees:Math.min(z,t.fov),rightDegrees:Math.min(oa,t.fov),downDegrees:Math.min(X,t.fov),upDegrees:Math.min(B,t.fov)}};ua.prototype.getLeftEyeVisibleTanAngles=function(){var t=this.viewer,z=this.device,B=this.distortion,N=Math.tan(-Eb*t.fov),oa=Math.tan(Eb*t.fov),X=Math.tan(Eb*t.fov),aa=Math.tan(-Eb*t.fov),
Ga=z.widthMeters/4,Na=z.heightMeters/2,Ka=t.interLensDistance/2-Ga,Pa=-(t.baselineLensDistance-z.bevelMeters-Na),Ra=t.screenLensDistance;t=B.distort((Ka-Ga)/Ra);z=B.distort((Pa+Na)/Ra);Ga=B.distort((Ka+Ga)/Ra);B=B.distort((Pa-Na)/Ra);Na=new Float32Array(4);Na[0]=Math.max(N,t);Na[1]=Math.min(oa,z);Na[2]=Math.min(X,Ga);Na[3]=Math.max(aa,B);return Na};ua.prototype.getLeftEyeNoLensTanAngles=function(){var t=this.viewer,z=this.device,B=this.distortion,N=new Float32Array(4),oa=B.distortInverse(Math.tan(-Eb*
t.fov)),X=B.distortInverse(Math.tan(Eb*t.fov)),aa=B.distortInverse(Math.tan(Eb*t.fov));B=B.distortInverse(Math.tan(-Eb*t.fov));var Ga=z.widthMeters/4,Na=z.heightMeters/2,Ka=t.interLensDistance/2-Ga;z=-(t.baselineLensDistance-z.bevelMeters-Na);t=t.screenLensDistance;N[0]=Math.max(oa,(Ka-Ga)/t);N[1]=Math.min(X,(z+Na)/t);N[2]=Math.min(aa,(Ka+Ga)/t);N[3]=Math.max(B,(z-Na)/t);return N};ua.prototype.getLeftEyeVisibleScreenRect=function(t){var z=this.viewer,B=this.device,N=z.screenLensDistance,oa=(B.widthMeters-
z.interLensDistance)/2;z=z.baselineLensDistance-B.bevelMeters;var X=(t[0]*N+oa)/B.widthMeters,aa=(t[3]*N+z)/B.heightMeters;return{x:X,y:aa,width:(t[2]*N+oa)/B.widthMeters-X,height:(t[1]*N+z)/B.heightMeters-aa}};ua.prototype.getFieldOfViewLeftEye=function(t){return t?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()};ua.prototype.getFieldOfViewRightEye=function(t){t=this.getFieldOfViewLeftEye(t);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,
downDegrees:t.downDegrees}};ua.prototype.getUndistortedFieldOfViewLeftEye=function(){var t=this.getUndistortedParams_();return{leftDegrees:Fb*Math.atan(t.outerDist),rightDegrees:Fb*Math.atan(t.innerDist),downDegrees:Fb*Math.atan(t.bottomDist),upDegrees:Fb*Math.atan(t.topDist)}};ua.prototype.getUndistortedViewportLeftEye=function(){var t=this.getUndistortedParams_(),z=this.device,B=this.viewer.screenLensDistance,N=z.width/(z.widthMeters/B);z=z.height/(z.heightMeters/B);B=Math.round((t.eyePosX-t.outerDist)*
N);var oa=Math.round((t.eyePosY-t.bottomDist)*z);return{x:B,y:oa,width:Math.round((t.eyePosX+t.innerDist)*N)-B,height:Math.round((t.eyePosY+t.topDist)*z)-oa}};ua.prototype.getUndistortedParams_=function(){var t=this.viewer,z=this.device,B=t.screenLensDistance,N=t.interLensDistance/2/B,oa=z.heightMeters/B,X=z.widthMeters/B/2-N;z=(t.baselineLensDistance-z.bevelMeters)/B;t=this.distortion.distortInverse(Math.tan(Eb*t.fov));return{outerDist:Math.min(X,t),innerDist:Math.min(N,t),topDist:Math.min(oa-z,
t),bottomDist:Math.min(z,t),eyePosX:X,eyePosY:z}};ua.Viewers=lc;var Jc={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},
{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],
dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],
bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},
{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},
{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,
316.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},
{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},
{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},
{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},
{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],
dpi:[196.7,205.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,
437.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,
431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],
bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,
256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,
bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,
518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},
{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],
dpi:307.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1E3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1E3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2001]}],
dpi:[410.9,415.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],
dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};Sa.prototype.getDeviceParams=function(){return this.deviceParams};Sa.prototype.recalculateDeviceParams_=function(){var t=this.calcDeviceParams_();
if(t){if(this.deviceParams=t,this.onDeviceParamsUpdated)this.onDeviceParamsUpdated(this.deviceParams)}else console.error("Failed to recalculate device parameters.")};Sa.prototype.calcDeviceParams_=function(){var t=this.dpdb;if(!t)return console.error("DPDB not available."),null;if(1!=t.format)return console.error("DPDB has unexpected format version."),null;if(!t.devices||!t.devices.length)return console.error("DPDB does not have a devices section."),null;var z=navigator.userAgent||navigator.vendor||
window.opera,B=Tb(),N=Ub();if(!t.devices)return console.error("DPDB has no devices section."),null;for(var oa=0;oa<t.devices.length;oa++){var X=t.devices[oa];if(!X.rules)console.warn("Device["+oa+"] has no rules section.");else if("ios"!=X.type&&"android"!=X.type)console.warn("Device["+oa+"] has invalid type.");else if(Ya()==("ios"==X.type)){for(var aa=!1,Ga=0;Ga<X.rules.length;Ga++)if(this.ruleMatches_(X.rules[Ga],z,B,N)){aa=!0;break}if(aa)return new Va({xdpi:X.dpi[0]||X.dpi,ydpi:X.dpi[1]||X.dpi,
bevelMm:X.bw})}}console.warn("No DPDB device match.");return null};Sa.prototype.ruleMatches_=function(t,z,B,N){if(!t.ua&&!t.res)return!1;t.ua&&"SM"===t.ua.substring(0,2)&&(t.ua=t.ua.substring(0,7));if(t.ua&&0>z.indexOf(t.ua))return!1;if(t.res){if(!t.res[0]||!t.res[1])return!1;z=t.res[0];t=t.res[1];if(Math.min(B,N)!=Math.min(z,t)||Math.max(B,N)!=Math.max(z,t))return!1}return!0};Ta.prototype.set=function(t,z){this.sample=t;this.timestampS=z};Ta.prototype.copy=function(t){this.set(t.sample,t.timestampS)};
fb.prototype.addAccelMeasurement=function(t,z){this.currentAccelMeasurement.set(t,z)};fb.prototype.addGyroMeasurement=function(t,z){this.currentGyroMeasurement.set(t,z);t=z-this.previousGyroMeasurement.timestampS;isNaN(t)||.001>=t||1<t||this.run_();this.previousGyroMeasurement.copy(this.currentGyroMeasurement)};fb.prototype.run_=function(){if(this.isOrientationInitialized){var t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);
this.gyroIntegralQ.multiply(t);this.filterQ.copy(this.previousFilterQ);this.filterQ.multiply(t);t=new gb;t.copy(this.filterQ);t.inverse();this.estimatedGravity.set(0,0,-1);this.estimatedGravity.applyQuaternion(t);this.estimatedGravity.normalize();this.measuredGravity.copy(this.currentAccelMeasurement.sample);this.measuredGravity.normalize();t=new gb;t.setFromUnitVectors(this.estimatedGravity,this.measuredGravity);t.inverse();if(this.isDebug){var z=console,B=z.log;if(1<t.w){console.warn("getQuaternionAngle: w > 1");
var N=0}else N=2*Math.acos(t.w);B.call(z,"Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Fb*N,this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1))}z=new gb;z.copy(this.filterQ);z.multiply(t);this.filterQ.slerp(z,1-this.kFilter);this.previousFilterQ.copy(this.filterQ)}else this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),
this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0};fb.prototype.getOrientation=function(){return this.filterQ};fb.prototype.accelToQuaternion_=function(t){var z=new ub;z.copy(t);z.normalize();t=new gb;t.setFromUnitVectors(new ub(0,0,-1),z);t.inverse();return t};fb.prototype.gyroToQuaternionDelta_=function(t,z){var B=new gb,N=new ub;N.copy(t);N.normalize();B.setFromAxisAngle(N,t.length()*z);return B};sb.prototype.getPrediction=function(t,z,B){if(!this.previousTimestampS)return this.previousQ.copy(t),
this.previousTimestampS=B,t;var N=new ub;N.copy(z);N.normalize();z=z.length();if(z<20*Eb)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Fb*z).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;this.deltaQ.setFromAxisAngle(N,z*this.predictionTimeS);this.outQ.copy(this.previousQ);this.outQ.multiply(this.deltaQ);this.previousQ.copy(t);this.previousTimestampS=B;return this.outQ};jb.prototype.getPosition=function(){return null};jb.prototype.getOrientation=function(){var t=
void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var B=(new gb).setFromAxisAngle(new ub(0,0,-1),0),N=new gb;-90===window.orientation?N.setFromAxisAngle(new ub(0,1,0),Math.PI/-2):N.setFromAxisAngle(new ub(0,1,0),Math.PI/2);return B.multiply(N)}();this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var B=new gb;B.setFromAxisAngle(new ub(1,0,0),-Math.PI/2);return B}();t=this._deviceOrientationQ;
var z=new gb;z.copy(t);z.multiply(this.deviceOrientationFilterToWorldQ);z.multiply(this.resetQ);z.multiply(this.worldToScreenQ);z.multiplyQuaternions(this.deviceOrientationFixQ,z);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_}t=this.filter.getOrientation();t=this.posePredictor.getPrediction(t,this.gyroscope,this.previousTimestampS);z=new gb;z.copy(this.filterToWorldQ);
z.multiply(this.resetQ);z.multiply(t);z.multiply(this.worldToScreenQ);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_};jb.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation());this.resetQ.x=0;this.resetQ.y=0;this.resetQ.z*=-1;this.resetQ.normalize();ob()&&this.resetQ.multiply(this.inverseWorldToScreenQ);this.resetQ.multiply(this.originalPoseAdjustQ)};
jb.prototype.onDeviceOrientation_=function(t){this._deviceOrientationQ=this._deviceOrientationQ||new gb;var z=t.alpha,B=t.beta;t=t.gamma;z=(z||0)*Math.PI/180;B=(B||0)*Math.PI/180;t=(t||0)*Math.PI/180;this._deviceOrientationQ.setFromEulerYXZ(B,z,-t)};jb.prototype.onDeviceMotion_=function(t){this.updateDeviceMotion_(t)};jb.prototype.updateDeviceMotion_=function(t){var z=t.accelerationIncludingGravity,B=t.rotationRate;t=t.timeStamp/1E3;var N=t-this.previousTimestampS;0>N?oc("fusion-pose-sensor:invalid:non-monotonic",
"Invalid timestamps detected: non-monotonic timestamp from devicemotion"):.001>=N||1<N?oc("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."):(this.accelerometer.set(-z.x,-z.y,-z.z),B&&(Lb()?this.gyroscope.set(-B.beta,B.alpha,B.gamma):this.gyroscope.set(B.alpha,B.beta,B.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,t)),this.filter.addAccelMeasurement(this.accelerometer,
t));this.previousTimestampS=t};jb.prototype.onOrientationChange_=function(t){this.setScreenTransform_()};jb.prototype.onMessage_=function(t){(t=t.data)&&t.type&&"devicemotion"===t.type.toLowerCase()&&this.updateDeviceMotion_(t.deviceMotionEvent)};jb.prototype.setScreenTransform_=function(){this.worldToScreenQ.set(0,0,0,1);switch(window.orientation){case 90:this.worldToScreenQ.setFromAxisAngle(new ub(0,0,1),-Math.PI/2);break;case -90:this.worldToScreenQ.setFromAxisAngle(new ub(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ);
this.inverseWorldToScreenQ.inverse()};jb.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this);this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this);this.onMessageCallback_=this.onMessage_.bind(this);this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this);var t;if(t=Ya()){t=window.self!==window.top;var z=yc(document.referrer),B=yc(window.location.href);t=t&&z!==B}t&&window.addEventListener("message",this.onMessageCallback_);window.addEventListener("orientationchange",
this.onOrientationChangeCallback_);this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)};jb.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_);window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_);window.removeEventListener("orientationchange",this.onOrientationChangeCallback_);window.removeEventListener("message",
this.onMessageCallback_)};var Sc=new ub(1,0,0),Tc=new ub(0,0,1),pc=new gb;pc.setFromAxisAngle(Sc,-Math.PI/2);pc.multiply((new gb).setFromAxisAngle(Tc,Math.PI/2));var Nc=function(){function t(z){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.config=z;this.fusionSensor=this.sensor=null;this._out=new Float32Array(4);this.api=null;this.errors=[];this._sensorQ=new gb;this._outQ=new gb;this._onSensorRead=this._onSensorRead.bind(this);this._onSensorError=this._onSensorError.bind(this);
this.init()}lb(t,[{key:"init",value:function(){var z=null;try{z=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"}),z.addEventListener("error",this._onSensorError)}catch(B){this.errors.push(B),"SecurityError"===B.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===B.name?this.useDeviceMotion():
console.error(B)}z&&(this.api="sensor",this.sensor=z,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion";this.fusionSensor=new jb(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG);this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();
if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var z=this.sensor.quaternion;this._sensorQ.set(z[0],z[1],z[2],z[3]);z=this._outQ;z.copy(pc);z.multiply(this._sensorQ);this.config.YAW_ONLY&&(z.x=z.z=0,z.normalize());this._out[0]=z.x;this._out[1]=z.y;this._out[2]=z.z;this._out[3]=z.w;return this._out}},{key:"_onSensorError",value:function(z){this.errors.push(z.error);"NotAllowedError"===z.error.name?console.error("Permission to access sensor was denied"):
"NotReadableError"===z.error.name?console.error("Sensor could not be read"):console.error(z.error);this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]);return t}();kb.prototype.show=function(t){t||this.overlay.parentElement?t&&(this.overlay.parentElement&&this.overlay.parentElement!=t&&this.overlay.parentElement.removeChild(this.overlay),t.appendChild(this.overlay)):document.body.appendChild(this.overlay);this.overlay.style.display="block";t=this.overlay.querySelector("img").style;
ob()?(t.width="20%",t.marginLeft="40%",t.marginTop="3%"):(t.width="50%",t.marginLeft="25%",t.marginTop="25%")};kb.prototype.hide=function(){this.overlay.style.display="none"};kb.prototype.showTemporarily=function(t,z){this.show(z);this.timer=setTimeout(this.hide.bind(this),t)};kb.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)};kb.prototype.update=function(){this.disableShowTemporarily();!ob()&&mc()?this.show():this.hide()};kb.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+
encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};
ib.prototype.show=function(t){this.root=t;t.appendChild(this.dialog);this.dialog.querySelector("#"+this.selectedKey).checked=!0;this.dialog.style.display="block"};ib.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog);this.dialog.style.display="none"};ib.prototype.getCurrentViewer=function(){return ua.Viewers[this.selectedKey]};ib.prototype.getSelectedKey_=function(){var t=this.dialog.querySelector("input[name=field]:checked");return t?t.id:null};
ib.prototype.onChange=function(t){this.onChangeCallbacks_.push(t)};ib.prototype.fireOnChange_=function(t){for(var z=0;z<this.onChangeCallbacks_.length;z++)this.onChangeCallbacks_[z](t)};ib.prototype.onSave_=function(){if((this.selectedKey=this.getSelectedKey_())&&ua.Viewers[this.selectedKey]){this.fireOnChange_(ua.Viewers[this.selectedKey]);try{localStorage.setItem("WEBVR_CARDBOARD_VIEWER",this.selectedKey)}catch(t){console.error("Failed to save viewer profile: %s",t)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")};
ib.prototype.createDialog_=function(t){var z=document.createElement("div");z.classList.add("webvr-polyfill-viewer-selector");z.style.display="none";var B=document.createElement("div"),N=B.style;N.position="fixed";N.left=0;N.top=0;N.width="100%";N.height="100%";N.background="rgba(0, 0, 0, 0.3)";B.addEventListener("click",this.hide.bind(this));var oa=document.createElement("div");N=oa.style;N.boxSizing="border-box";N.position="fixed";N.top="24px";N.left="50%";N.marginLeft="-140px";N.width="280px";N.padding=
"24px";N.overflow="hidden";N.background="#fafafa";N.fontFamily="'Roboto', sans-serif";N.boxShadow="0px 5px 20px #666";oa.appendChild(this.createH1_("Select your viewer"));for(var X in t)oa.appendChild(this.createChoice_(X,t[X].label));oa.appendChild(this.createButton_("Save",this.onSave_.bind(this)));z.appendChild(B);z.appendChild(oa);return z};ib.prototype.createH1_=function(t){var z=document.createElement("h1"),B=z.style;B.color="black";B.fontSize="20px";B.fontWeight="bold";B.marginTop=0;B.marginBottom=
"24px";z.innerHTML=t;return z};ib.prototype.createChoice_=function(t,z){var B=document.createElement("div");B.style.marginTop="8px";B.style.color="black";var N=document.createElement("input");N.style.fontSize="30px";N.setAttribute("id",t);N.setAttribute("type","radio");N.setAttribute("value",t);N.setAttribute("name","field");var oa=document.createElement("label");oa.style.marginLeft="4px";oa.setAttribute("for",t);oa.innerHTML=z;B.appendChild(N);B.appendChild(oa);return B};ib.prototype.createButton_=
function(t,z){var B=document.createElement("button");B.innerHTML=t;t=B.style;t.float="right";t.textTransform="uppercase";t.color="#1094f7";t.fontSize="14px";t.letterSpacing=0;t.border=0;t.background="none";t.marginTop="16px";B.addEventListener("click",z);return B};var Uc="undefined"!==typeof window?window:"undefined"!==typeof kc?kc:"undefined"!==typeof self?self:{},Lc=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t["default"]:t}(function(t,z){return z={exports:{}},
t(z,z.exports),z.exports}(function(t,z){(function(B,N){t.exports=N()})(Uc,function(){return function(B){function N(X){if(oa[X])return oa[X].exports;var aa=oa[X]={i:X,l:!1,exports:{}};B[X].call(aa.exports,aa,aa.exports,N);aa.l=!0;return aa.exports}var oa={};N.m=B;N.c=oa;N.d=function(X,aa,Ga){N.o(X,aa)||Object.defineProperty(X,aa,{configurable:!1,enumerable:!0,get:Ga})};N.n=function(X){var aa=X&&X.__esModule?function(){return X["default"]}:function(){return X};N.d(aa,"a",aa);return aa};N.o=function(X,
aa){return Object.prototype.hasOwnProperty.call(X,aa)};N.p="";return N(N.s=0)}([function(B,N,oa){var X=function(){function Na(Ka,Pa){for(var Ra=0;Ra<Pa.length;Ra++){var Za=Pa[Ra];Za.enumerable=Za.enumerable||!1;Za.configurable=!0;"value"in Za&&(Za.writable=!0);Object.defineProperty(Ka,Za.key,Za)}}return function(Ka,Pa,Ra){Pa&&Na(Ka.prototype,Pa);Ra&&Na(Ka,Ra);return Ka}}(),aa=oa(1),Ga="undefined"!==typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||
[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream;N=function(){function Na(){if(!(this instanceof Na))throw new TypeError("Cannot call a class as a function");Ga?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",aa),this.noSleepVideo.addEventListener("timeupdate",function(Ka){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}
X(Na,[{key:"enable",value:function(){Ga?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15E3)):this.noSleepVideo.play()}},{key:"disable",value:function(){Ga?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]);return Na}();B.exports=N},function(B,N,oa){B.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})})),
Kc=1E3,Vc=[0,0,.5,1],Wc=[.5,0,.5,1],Xc=window.requestAnimationFrame,Yc=window.cancelAnimationFrame;ab.prototype.getFrameData=function(t){return Pc(t,this._getPose(),this)};ab.prototype.getPose=function(){Qb("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData");return this._getPose()};ab.prototype.resetPose=function(){Qb("VRDisplay.prototype.resetPose");return this._resetPose()};ab.prototype.getImmediatePose=function(){Qb("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData");
return this._getPose()};ab.prototype.requestAnimationFrame=function(t){return Xc(t)};ab.prototype.cancelAnimationFrame=function(t){return Yc(t)};ab.prototype.wrapForFullscreen=function(t){if(Ya())return t;this.fullscreenWrapper_||(this.fullscreenWrapper_=document.createElement("div"),this.fullscreenWrapper_.setAttribute("style",["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important; left: 0 !important; right: 0 !important; border: 0; margin: 0; padding: 0; z-index: 999999 !important; position: fixed"].join("; ")+
";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper"));if(this.fullscreenElement_==t)return this.fullscreenWrapper_;this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_));this.fullscreenElement_=t;(this.originalParent_=t.parentElement)||document.body.appendChild(t);this.fullscreenWrapper_.parentElement||(t=this.fullscreenElement_.parentElement,t.insertBefore(this.fullscreenWrapper_,
this.fullscreenElement_),t.removeChild(this.fullscreenElement_));this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild);this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");this.fullscreenElement_&&this.fullscreenElement_.setAttribute("style",["position: absolute; top: 0; left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0; margin: 0; padding: 0"].join("; ")+
";");return this.fullscreenWrapper_};ab.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var t=this.fullscreenElement_;this.fullscreenElementCachedStyle_?t.setAttribute("style",this.fullscreenElementCachedStyle_):t.removeAttribute("style");this.fullscreenElementCachedStyle_=this.fullscreenElement_=null;var z=this.fullscreenWrapper_.parentElement;this.fullscreenWrapper_.removeChild(t);this.originalParent_===z?z.insertBefore(t,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(t);
z.removeChild(this.fullscreenWrapper_);return t}};ab.prototype.requestPresent=function(t){var z=this.isPresenting,B=this;t instanceof Array||(Qb("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),t=[t]);return new Promise(function(N,oa){if(B.capabilities.canPresent)if(0==t.length||t.length>B.capabilities.maxLayers)oa(Error("Invalid number of layers."));else{var X=t[0];if(X.source){var aa=X.leftBounds||Vc,Ga=X.rightBounds||Wc;if(z){var Na=B.layer_;
Na.source!==X.source&&(Na.source=X.source);for(X=0;4>X;X++)Na.leftBounds[X]=aa[X],Na.rightBounds[X]=Ga[X];B.wrapForFullscreen(B.layer_.source);B.updatePresent_();N()}else{B.layer_={predistorted:X.predistorted,source:X.source,leftBounds:aa.slice(0),rightBounds:Ga.slice(0)};B.waitingForPresent_=!1;if(B.layer_&&B.layer_.source){var Ka=B.wrapForFullscreen(B.layer_.source);B.addFullscreenListeners_(Ka,function(){B.isPresenting=Ka===(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
document.msFullscreenElement);B.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Pa){console.error("screen.orientation.lock() failed due to",Pa.message)}),B.waitingForPresent_=!1,B.beginPresent_(),N()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),B.removeFullscreenWrapper(),B.disableWakeLock(),B.endPresent_(),B.removeFullscreenListeners_());B.fireVRDisplayPresentChange_()},function(){B.waitingForPresent_&&
(B.removeFullscreenWrapper(),B.removeFullscreenListeners_(),B.disableWakeLock(),B.waitingForPresent_=!1,B.isPresenting=!1,oa(Error("Unable to present.")))});if(Oc(Ka))B.enableWakeLock(),B.waitingForPresent_=!0;else if(Ya()||Gb())B.enableWakeLock(),B.isPresenting=!0,B.beginPresent_(),B.fireVRDisplayPresentChange_(),N()}B.waitingForPresent_||Ya()||(xc(),oa(Error("Unable to present.")))}}else N()}else oa(Error("VRDisplay is not capable of presenting."))})};ab.prototype.exitPresent=function(){var t=this.isPresenting,
z=this;this.isPresenting=!1;this.layer_=null;this.disableWakeLock();return new Promise(function(B,N){t?(!xc()&&Ya()&&(z.endPresent_(),z.fireVRDisplayPresentChange_()),Gb()&&(z.removeFullscreenWrapper(),z.removeFullscreenListeners_(),z.endPresent_(),z.fireVRDisplayPresentChange_()),B()):N(Error("Was not presenting to VRDisplay."))})};ab.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]};ab.prototype.fireVRDisplayPresentChange_=function(){var t=new CustomEvent("vrdisplaypresentchange",
{detail:{display:this}});window.dispatchEvent(t)};ab.prototype.fireVRDisplayConnect_=function(){var t=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(t)};ab.prototype.addFullscreenListeners_=function(t,z,B){this.removeFullscreenListeners_();this.fullscreenEventTarget_=t;this.fullscreenChangeHandler_=z;this.fullscreenErrorHandler_=B;z&&(document.fullscreenEnabled?t.addEventListener("fullscreenchange",z,!1):document.webkitFullscreenEnabled?t.addEventListener("webkitfullscreenchange",
z,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",z,!1):document.msFullscreenEnabled&&t.addEventListener("msfullscreenchange",z,!1));B&&(document.fullscreenEnabled?t.addEventListener("fullscreenerror",B,!1):document.webkitFullscreenEnabled?t.addEventListener("webkitfullscreenerror",B,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",B,!1):document.msFullscreenEnabled&&t.addEventListener("msfullscreenerror",B,!1))};ab.prototype.removeFullscreenListeners_=
function(){if(this.fullscreenEventTarget_){var t=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var z=this.fullscreenChangeHandler_;t.removeEventListener("fullscreenchange",z,!1);t.removeEventListener("webkitfullscreenchange",z,!1);document.removeEventListener("mozfullscreenchange",z,!1);t.removeEventListener("msfullscreenchange",z,!1)}this.fullscreenErrorHandler_&&(z=this.fullscreenErrorHandler_,t.removeEventListener("fullscreenerror",z,!1),t.removeEventListener("webkitfullscreenerror",
z,!1),document.removeEventListener("mozfullscreenerror",z,!1),t.removeEventListener("msfullscreenerror",z,!1));this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=null}};ab.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()};ab.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()};ab.prototype.beginPresent_=function(){};ab.prototype.endPresent_=function(){};ab.prototype.submitFrame=function(t){};ab.prototype.getEyeParameters=
function(t){return null};var Mc={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};Wa.prototype=Object.create(ab.prototype);Wa.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,
angularAcceleration:null}};Wa.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()};Wa.prototype._getFieldOfView=function(t){if("left"==t)t=this.deviceInfo_.getFieldOfViewLeftEye();else if("right"==t)t=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",t),null;return t};Wa.prototype._getEyeOffset=function(t){if("left"==t)t=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else if("right"==t)t=[.5*this.deviceInfo_.viewer.interLensDistance,
0,0];else return console.error("Invalid eye provided: %s",t),null;return t};Wa.prototype.getEyeParameters=function(t){var z=this._getEyeOffset(t),B=this._getFieldOfView(t);t={offset:z,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};Object.defineProperty(t,"fieldOfView",{enumerable:!0,get:function(){Qb("VRFieldOfView","VRFrameData's projection matrices");return B}});return t};Wa.prototype.onDeviceParamsUpdated_=function(t){this.config.DEBUG&&
console.log("DPDB reported that device params were updated.");this.deviceInfo_.updateDeviceParams(t);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)};Wa.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)};Wa.prototype.beginPresent_=function(){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl"));
t||(t=this.layer_.source.getContext("webgl2"));t&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(t.canvas.width=Tb()*this.bufferScale_,t.canvas.height=Ub()*this.bufferScale_,this.cardboardUI_=new H(t)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new H(t)),this.distorter_=new G(t,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(z){this.viewerSelector_.show(this.layer_.source.parentElement);
z.stopPropagation();z.preventDefault()}.bind(this),function(z){this.exitPresent();z.stopPropagation();z.preventDefault()}.bind(this)),this.rotateInstructions_&&(ob()&&mc()?this.rotateInstructions_.showTemporarily(3E3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",
this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())};Wa.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null);this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null);this.rotateInstructions_&&this.rotateInstructions_.hide();this.viewerSelector_.hide();window.removeEventListener("orientationchange",this.orientationHandler);window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)};Wa.prototype.updatePresent_=
function(){this.endPresent_();this.beginPresent_()};Wa.prototype.submitFrame=function(t){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){(t=this.layer_.source.getContext("webgl"))||(t=this.layer_.source.getContext("experimental-webgl"));t||(t=this.layer_.source.getContext("webgl2"));t=t.canvas;if(t.width!=this.lastWidth||t.height!=this.lastHeight)this.cardboardUI_.onResize();this.lastWidth=t.width;this.lastHeight=t.height;this.cardboardUI_.render()}};
Wa.prototype.onOrientationChange_=function(t){this.viewerSelector_.hide();this.rotateInstructions_&&this.rotateInstructions_.update();this.onResize_()};Wa.prototype.onResize_=function(t){this.layer_&&((t=this.layer_.source.getContext("webgl"))||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2")),t.canvas.setAttribute("style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;"),
nc(t.canvas))};Wa.prototype.onViewerChanged_=function(t){this.deviceInfo_.setViewer(t);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_);this.fireVRDisplayDeviceParamsChange_()};Wa.prototype.fireVRDisplayDeviceParamsChange_=function(){var t=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(t)};Wa.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=
new Float32Array(16);this.rightViewMatrix=new Float32Array(16);this.pose=null};Wa.VRDisplay=ab;return Wa})})),rb=function(p){var x=F.call(this)||this;x.global=p;x.onWindowResize=x.onWindowResize.bind(x);x.global.window.addEventListener("resize",x.onWindowResize);x.environmentBlendMode="opaque";return x};$jscomp.inherits(rb,F);rb.prototype.onBaseLayerSet=function(p,x){throw Error("Not implemented");};rb.prototype.isSessionSupported=function(p){throw Error("Not implemented");};rb.prototype.isFeatureSupported=
function(p){throw Error("Not implemented");};rb.prototype.requestSession=function(p,x){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){throw Error("Not implemented");})};rb.prototype.requestAnimationFrame=function(p){throw Error("Not implemented");};rb.prototype.onFrameStart=function(p){throw Error("Not implemented");};rb.prototype.onFrameEnd=function(p){throw Error("Not implemented");};rb.prototype.doesSessionSupportReferenceSpace=function(p,x){throw Error("Not implemented");};rb.prototype.requestStageBounds=
function(){throw Error("Not implemented");};rb.prototype.requestFrameOfReferenceTransform=function(p,x){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){return G.return(void 0)})};rb.prototype.cancelAnimationFrame=function(p){throw Error("Not implemented");};rb.prototype.endSession=function(p){throw Error("Not implemented");};rb.prototype.getViewport=function(p,x,G,H){throw Error("Not implemented");};rb.prototype.getProjectionMatrix=function(p){throw Error("Not implemented");};rb.prototype.getBasePoseMatrix=
function(){throw Error("Not implemented");};rb.prototype.getBaseViewMatrix=function(p){throw Error("Not implemented");};rb.prototype.getInputSources=function(){throw Error("Not implemented");};rb.prototype.getInputPose=function(p,x,G){throw Error("Not implemented");};rb.prototype.onWindowResize=function(){this.onWindowResize()};var Ac={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],
axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},qc={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},$c={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,
2:0}},"Gear VR Controller":{mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":{mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,
0,1]}},"Oculus Touch (Right)":Ac,"Oculus Touch (Left)":Ac,"OpenVR Gamepad":{mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,
3]}}}},"Spatial Controller (Spatial Interaction Source) 045E-065A":qc,"Spatial Controller (Spatial Interaction Source) 045E-065D":{mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},"Windows Mixed Reality (Right)":qc,"Windows Mixed Reality (Left)":qc},Bc=r(.155,-.465,-.15),ad=r(-.155,-.465,-.15),bd=r(0,0,-.25),cd=r(0,0,
.05),Cc=r(-.08,.14,.08),Dc=180/Math.PI,Rb=function(){this.hand="right";this.headElbowOffset=Bc;this.controllerQ=I();this.lastControllerQ=I();this.headQ=I();this.headPos=h();this.elbowPos=h();this.wristPos=h();this.lastTime=this.time=null;this.rootQ=I();this.position=h()};Rb.prototype.setHandedness=function(p){this.hand!=p&&(this.hand=p,this.headElbowOffset="left"==this.hand?ad:Bc)};Rb.prototype.update=function(p,x){this.time=xa();p&&(M(this.lastControllerQ,this.controllerQ),M(this.controllerQ,p));
x&&(g(this.headPos,x),e(this.headQ,x));p=this.getHeadYawOrientation_();x=this.quatAngle_(this.lastControllerQ,this.controllerQ);.61<x/((this.time-this.lastTime)/1E3)?E(this.rootQ,this.rootQ,p,Math.min(x/.175,1)):M(this.rootQ,p);p=r(0,0,-1);y(p,p,this.controllerQ);p=w(p,[0,1,0]);p=this.clamp_((p-.12)/.87,0,1);var G=Z(this.rootQ);O(G,G);D(G,G,this.controllerQ);x=this.elbowPos;q(x,this.headPos);m(x,x,this.headElbowOffset);var H=l(Cc);u(H,H,p);m(x,x,H);H=this.quatAngle_(G,I())*Dc;var Y=(1-Math.pow(H/
180,4))*(.4+.24*p);H=I();E(H,H,G,Y);Y=O(I(),H);G=Z(G);D(G,G,Y);Y=this.wristPos;q(Y,cd);y(Y,Y,H);m(Y,Y,bd);y(Y,Y,G);m(Y,Y,x);x=l(Cc);u(x,x,p);m(this.position,this.wristPos,x);y(this.position,this.position,this.rootQ);this.lastTime=this.time};Rb.prototype.getPosition=function(){return this.position};Rb.prototype.getHeadYawOrientation_=function(){var p=h();ta(p,this.headQ,"YXZ");var x=I(),G=p[1]*Dc;p=.5*Math.PI/180;var H=0*p;G*=p;var Y=0*p;p=Math.sin(H);H=Math.cos(H);var sa=Math.sin(G);G=Math.cos(G);
var ua=Math.sin(Y);Y=Math.cos(Y);x[0]=p*G*Y-H*sa*ua;x[1]=H*sa*Y+p*G*ua;x[2]=H*G*ua-p*sa*Y;x[3]=H*G*Y+p*sa*ua;return x};Rb.prototype.clamp_=function(p,x,G){return Math.min(Math.max(p,x),G)};Rb.prototype.quatAngle_=function(p,x){var G=[0,0,-1],H=[0,0,-1];y(G,G,p);y(H,H,x);p=r(G[0],G[1],G[2]);H=r(H[0],H[1],H[2]);n(p,p);n(H,H);H=w(p,H);H=1<H?0:-1>H?Math.PI:Math.acos(H);return H};var Cb=Symbol("@@webxr-polyfill/XRRemappedGamepad"),Ec={pressed:!1,touched:!1,value:0};Object.freeze(Ec);var rc=function(p,
x,G){G||(G={});if(G.userAgentOverrides)for(var H in G.userAgentOverrides)if(navigator.userAgent.includes(H)){H=G.userAgentOverrides[H];for(var Y in H)Y in G?Object.assign(G[Y],H[Y]):G[Y]=H[Y];break}Y=Array(G.axes&&G.axes.length?G.axes.length:p.axes.length);H=Array(G.buttons&&G.buttons.length?G.buttons.length:p.buttons.length);var sa=null;if(G.gripTransform){var ua=G.gripTransform.orientation||[0,0,0,1];sa=a();f(sa,ma(ua,ua),G.gripTransform.position||[0,0,0])}ua=null;if(G.targetRayTransform){var Ja=
G.targetRayTransform.orientation||[0,0,0,1];ua=a();f(ua,ma(Ja,Ja),G.targetRayTransform.position||[0,0,0])}Ja=G.profiles;G.displayProfiles&&x.displayName in G.displayProfiles&&(Ja=G.displayProfiles[x.displayName]);this[Cb]={gamepad:p,map:G,profiles:Ja||[p.id],mapping:G.mapping||p.mapping,axes:Y,buttons:H,gripTransform:sa,targetRayTransform:ua};this._update()};rc.prototype._update=function(){for(var p=this[Cb].gamepad,x=this[Cb].map,G=this[Cb].axes,H=0;H<G.length;++H)G[H]=x.axes&&H in x.axes?null===
x.axes[H]?0:p.axes[x.axes[H]]:p.axes[H];if(x.axes&&x.axes.invert){H=$jscomp.makeIterator(x.axes.invert);for(var Y=H.next();!Y.done;Y=H.next())Y=Y.value,Y<G.length&&(G[Y]*=-1)}G=this[Cb].buttons;for(H=0;H<G.length;++H)G[H]=x.buttons&&H in x.buttons?null===x.buttons[H]?Ec:p.buttons[x.buttons[H]]:p.buttons[H]};$jscomp.global.Object.defineProperties(rc.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return""}},_profiles:{configurable:!0,enumerable:!0,get:function(){return this[Cb].profiles}},
index:{configurable:!0,enumerable:!0,get:function(){return-1}},connected:{configurable:!0,enumerable:!0,get:function(){return this[Cb].gamepad.connected}},timestamp:{configurable:!0,enumerable:!0,get:function(){return this[Cb].gamepad.timestamp}},mapping:{configurable:!0,enumerable:!0,get:function(){return this[Cb].mapping}},axes:{configurable:!0,enumerable:!0,get:function(){return this[Cb].axes}},buttons:{configurable:!0,enumerable:!0,get:function(){return this[Cb].buttons}},hapticActuators:{configurable:!0,
enumerable:!0,get:function(){return this[Cb].gamepad.hapticActuators}}});var hc=function(p,x,G,H){G=void 0===G?0:G;H=void 0===H?-1:H;this.polyfill=p;this.display=x;this.gamepad=this.nativeGamepad=null;this.inputSource=new db(this);this.lastPosition=h();this.emulatedPosition=!1;this.basePoseMatrix=a();this.outputMatrix=a();this.primaryButtonIndex=G;this.primaryActionPressed=!1;this.primarySqueezeButtonIndex=H;this.primarySqueezeActionPressed=!1;this.handedness="";this.targetRayMode="gaze";this.armModel=
null};hc.prototype.updateFromGamepad=function(p){this.nativeGamepad!==p&&(this.gamepad=(this.nativeGamepad=p)?new rc(p,this.display,$c[p.id]):null);this.handedness=""===p.hand?"none":p.hand;this.gamepad&&this.gamepad._update();p.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!p.pose.hasPosition):""===p.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)};hc.prototype.updateBasePoseMatrix=function(){if(this.nativeGamepad&&this.nativeGamepad.pose){var p=this.nativeGamepad.pose,
x=p.position,G=p.orientation;if(!x&&!G)return;x?(this.lastPosition[0]=x[0],this.lastPosition[1]=x[1],this.lastPosition[2]=x[2]):p.hasPosition?x=this.lastPosition:(this.armModel||(this.armModel=new Rb),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(G,this.polyfill.getBasePoseMatrix()),x=this.armModel.getPosition());f(this.basePoseMatrix,G,x)}else p=this.basePoseMatrix,x=this.polyfill.getBasePoseMatrix(),p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p[4]=x[4],p[5]=x[5],p[6]=x[6],
p[7]=x[7],p[8]=x[8],p[9]=x[9],p[10]=x[10],p[11]=x[11],p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15];return this.basePoseMatrix};hc.prototype.getXRPose=function(p,x){this.updateBasePoseMatrix();switch(x){case "target-ray":p._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&this.gamepad[Cb].targetRayTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[Cb].targetRayTransform);break;case "grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;p._transformBasePoseMatrix(this.outputMatrix,
this.basePoseMatrix);this.gamepad&&this.gamepad[Cb].gripTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[Cb].gripTransform);break;default:return null}p._adjustForOriginOffset(this.outputMatrix);return new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)};$jscomp.global.Object.defineProperties(hc.prototype,{profiles:{configurable:!0,enumerable:!0,get:function(){return this.gamepad?this.gamepad._profiles:[]}}});var Fc={highRefreshRate:!0},Gc={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},
dd=0,ed=function(p,x,G){G=void 0===G?{}:G;this.mode=p;this.enabledFeatures=x;this.outputContext=null;this.immersive="immersive-vr"==p||"immersive-ar"==p;this.baseLayer=this.ended=null;this.id=++dd;this.modifiedCanvasLayer=!1;this.outputContext&&(this.renderContext=this.outputContext.canvas.getContext(G.renderContextType||"2d"))},nb=function(p,x){var G=x.capabilities.canPresent;var H=rb.call(this,p)||this;H.display=x;H.frame=new p.VRFrameData;H.sessions=new Map;H.immersiveSession=null;H.canPresent=
G;H.baseModelMatrix=a();H.gamepadInputSources={};H.tempVec3=new Float32Array(3);H.onVRDisplayPresentChange=H.onVRDisplayPresentChange.bind(H);p.window.addEventListener("vrdisplaypresentchange",H.onVRDisplayPresentChange);H.CAN_USE_GAMEPAD=p.navigator&&"getGamepads"in p.navigator;H.HAS_BITMAP_SUPPORT=!(!p.ImageBitmapRenderingContext||!p.createImageBitmap);return H};$jscomp.inherits(nb,rb);nb.prototype.onBaseLayerSet=function(p,x){var G=this,H=this.sessions.get(p),Y=x.context.canvas;if(H.immersive){p=
this.display.getEyeParameters("left");var sa=this.display.getEyeParameters("right");Y.width=2*Math.max(p.renderWidth,sa.renderWidth);Y.height=Math.max(p.renderHeight,sa.renderHeight);this.display.requestPresent([{source:Y,attributes:Fc}]).then(function(){G.global.document.body.contains(Y)||(H.modifiedCanvasLayer=!0,G.global.document.body.appendChild(Y),Y.style.display="block",Y.style.position="absolute",Y.style.width=Y.style.height="1px",Y.style.top=Y.style.left="0px");H.baseLayer=x})}else H.baseLayer=
x};nb.prototype.isSessionSupported=function(p){return"immersive-ar"==p||"immersive-vr"==p&&!1===this.canPresent?!1:!0};nb.prototype.isFeatureSupported=function(p){switch(p){case "viewer":return!0;case "local":return!0;case "local-floor":return!0;case "bounded":return!1;case "unbounded":return!1;default:return!1}};nb.prototype.requestSession=function(p,x){var G=this,H,Y,sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){if(1==ua.nextAddress){if(!G.isSessionSupported(p))return ua.return(Promise.reject());
H="immersive-vr"==p;if(!H)return ua.jumpTo(2);Y=G.global.document.createElement("canvas");Y.getContext("webgl");return ua.yield(G.display.requestPresent([{source:Y,attributes:Fc}]),2)}sa=new ed(p,x,{renderContextType:G.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});G.sessions.set(sa.id,sa);H&&(G.immersiveSession=sa,G.dispatchEvent("@@webxr-polyfill/vr-present-start",sa.id));return ua.return(Promise.resolve(sa.id))})};nb.prototype.requestAnimationFrame=function(p){return this.display.requestAnimationFrame(p)};
nb.prototype.getPrimaryButtonIndex=function(p){var x=0,G=p.id.toLowerCase(),H;for(H in Gc)if(G.includes(H)){x=Gc[H];break}return Math.min(x,p.buttons.length-1)};nb.prototype.onFrameStart=function(p,x){this.display.depthNear=x.depthNear;this.display.depthFar=x.depthFar;this.display.getFrameData(this.frame);p=this.sessions.get(p);if(p.immersive&&this.CAN_USE_GAMEPAD){var G=this.gamepadInputSources;this.gamepadInputSources={};for(var H=this.global.navigator.getGamepads(),Y=0;Y<H.length;++Y){var sa=H[Y];
if(sa&&0<sa.displayId){var ua=G[Y];ua||(ua=new hc(this,this.display,this.getPrimaryButtonIndex(sa)));ua.updateFromGamepad(sa);this.gamepadInputSources[Y]=ua;if(-1!=ua.primaryButtonIndex){var Ja=sa.buttons[ua.primaryButtonIndex].pressed;Ja&&!ua.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:p.id,inputSource:ua.inputSource}):!Ja&&ua.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:p.id,inputSource:ua.inputSource});ua.primaryActionPressed=
Ja}-1!=ua.primarySqueezeButtonIndex&&((sa=sa.buttons[ua.primarySqueezeButtonIndex].pressed)&&!ua.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:p.id,inputSource:ua.inputSource}):!sa&&ua.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:p.id,inputSource:ua.inputSource}),ua.primarySqueezeActionPressed=sa)}}}!p.immersive&&p.baseLayer&&(p=p.baseLayer.context.canvas,k(this.frame.leftProjectionMatrix,x.inlineVerticalFieldOfView,
p.width/p.height,x.depthNear,x.depthFar))};nb.prototype.onFrameEnd=function(p){p=this.sessions.get(p);if(!p.ended&&p.baseLayer){if(p.outputContext&&(!p.immersive||this.display.capabilities.hasExternalDisplay)){var x=p.baseLayer.context.canvas,G=p.immersive&&this.display.capabilities.hasExternalDisplay?x.width/2:x.width,H=x.height,Y=p.outputContext.canvas,sa=Y.width;Y=Y.height;var ua=p.renderContext;this.HAS_BITMAP_SUPPORT?x.transferToImageBitmap?ua.transferFromImageBitmap(x.transferToImageBitmap()):
this.global.createImageBitmap(x,0,0,G,H,{resizeWidth:sa,resizeHeight:Y}).then(function(Ja){return ua.transferFromImageBitmap(Ja)}):ua.drawImage(x,0,0,G,H,0,0,sa,Y)}p.immersive&&p.baseLayer&&this.display.submitFrame()}};nb.prototype.cancelAnimationFrame=function(p){this.display.cancelAnimationFrame(p)};nb.prototype.endSession=function(p){var x=this,G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){G=x.sessions.get(p);if(G.ended)return H.return();if(G.immersive)return H.return(x.display.exitPresent());
G.ended=!0;H.jumpToEnd()})};nb.prototype.doesSessionSupportReferenceSpace=function(p,x){p=this.sessions.get(p);return p.ended?!1:p.enabledFeatures.has(x)};nb.prototype.requestStageBounds=function(){if(this.display.stageParameters){var p=this.display.stageParameters.sizeX,x=this.display.stageParameters.sizeZ,G=[];G.push(-p/2);G.push(-x/2);G.push(p/2);G.push(-x/2);G.push(p/2);G.push(x/2);G.push(-p/2);G.push(x/2);return G}return null};nb.prototype.requestFrameOfReferenceTransform=function(p,x){var G=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){return("local-floor"===p||"bounded-floor"===p)&&G.display.stageParameters&&G.display.stageParameters.sittingToStandingTransform?H.return(G.display.stageParameters.sittingToStandingTransform):H.return(null)})};nb.prototype.getProjectionMatrix=function(p){if("left"===p)return this.frame.leftProjectionMatrix;if("right"===p)return this.frame.rightProjectionMatrix;if("none"===p)return this.frame.leftProjectionMatrix;throw Error("eye must be of type 'left' or 'right'");
};nb.prototype.getViewport=function(p,x,G,H){p=this.sessions.get(p);var Y=G.context.canvas;G=Y.width;Y=Y.height;if(!p.immersive)return H.x=H.y=0,H.width=G,H.height=Y,!0;if("left"===x||"none"===x)H.x=0;else if("right"===x)H.x=G/2;else return!1;H.y=0;H.width=G/2;H.height=Y;return!0};nb.prototype.getBasePoseMatrix=function(){var p=this.frame.pose,x=p.position;p=p.orientation;if(!x&&!p)return this.baseModelMatrix;x||(x=this.tempVec3,x[0]=x[1]=x[2]=0);f(this.baseModelMatrix,p,x);return this.baseModelMatrix};
nb.prototype.getBaseViewMatrix=function(p){if("left"===p||"none"===p)return this.frame.leftViewMatrix;if("right"===p)return this.frame.rightViewMatrix;throw Error("eye must be of type 'left' or 'right'");};nb.prototype.getInputSources=function(){var p=[],x;for(x in this.gamepadInputSources)p.push(this.gamepadInputSources[x].inputSource);return p};nb.prototype.getInputPose=function(p,x,G){if(!x)return null;for(var H in this.gamepadInputSources){var Y=this.gamepadInputSources[H];if(Y.inputSource===
p)return Y.getXRPose(x,G)}return null};nb.prototype.onWindowResize=function(){};nb.prototype.onVRDisplayPresentChange=function(p){var x=this;this.display.isPresenting||this.sessions.forEach(function(G){if(G.immersive&&!G.ended){if(G.modifiedCanvasLayer){var H=G.baseLayer.context.canvas;document.body.removeChild(H);H.setAttribute("style","")}x.immersiveSession===G&&(x.immersiveSession=null);x.dispatchEvent("@@webxr-polyfill/vr-present-end",G.id)}})};$jscomp.global.Object.defineProperties(nb.prototype,
{depthNear:{configurable:!0,enumerable:!0,get:function(){return this.display.depthNear},set:function(p){this.display.depthNear=p}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this.display.depthFar},set:function(p){this.display.depthFar=p}}});var Hc=function(p,x){x=new Zc(x||{});p=nb.call(this,p,x)||this;p.display=x;p.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),
pose:null,timestamp:null};return p};$jscomp.inherits(Hc,nb);var fd=0,gd=function(p,x){this.mode=p;this.enabledFeatures=x;this.baseLayer=this.ended=null;this.id=++fd},yb=function(p){p=rb.call(this,p)||this;p.sessions=new Map;p.projectionMatrix=a();p.identityMatrix=a();return p};$jscomp.inherits(yb,rb);yb.prototype.onBaseLayerSet=function(p,x){this.sessions.get(p).baseLayer=x};yb.prototype.isSessionSupported=function(p){return"inline"==p};yb.prototype.isFeatureSupported=function(p){switch(p){case "viewer":return!0;
default:return!1}};yb.prototype.requestSession=function(p,x){var G=this,H;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Y){if(!G.isSessionSupported(p))return Y.return(Promise.reject());H=new gd(p,x);G.sessions.set(H.id,H);return Y.return(Promise.resolve(H.id))})};yb.prototype.requestAnimationFrame=function(p){return window.requestAnimationFrame(p)};yb.prototype.cancelAnimationFrame=function(p){window.cancelAnimationFrame(p)};yb.prototype.onFrameStart=function(p,x){p=this.sessions.get(p);
p.baseLayer&&(p=p.baseLayer.context.canvas,k(this.projectionMatrix,x.inlineVerticalFieldOfView,p.width/p.height,x.depthNear,x.depthFar))};yb.prototype.onFrameEnd=function(p){};yb.prototype.endSession=function(p){var x=this,G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){G=x.sessions.get(p);G.ended=!0;H.jumpToEnd()})};yb.prototype.doesSessionSupportReferenceSpace=function(p,x){p=this.sessions.get(p);return p.ended?!1:p.enabledFeatures.has(x)};yb.prototype.requestStageBounds=function(){return null};
yb.prototype.requestFrameOfReferenceTransform=function(p,x){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){return G.return(null)})};yb.prototype.getProjectionMatrix=function(p){return this.projectionMatrix};yb.prototype.getViewport=function(p,x,G,H){this.sessions.get(p);x=G.context.canvas;p=x.width;x=x.height;H.x=H.y=0;H.width=p;H.height=x;return!0};yb.prototype.getBasePoseMatrix=function(){return this.identityMatrix};yb.prototype.getBaseViewMatrix=function(p){return this.identityMatrix};
yb.prototype.getInputSources=function(){return[]};yb.prototype.getInputPose=function(p,x,G){return null};yb.prototype.onWindowResize=function(){};var hd=function(p){var x,G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(H){switch(H.nextAddress){case 1:x=null;if(!("getVRDisplays"in p.navigator)){H.jumpTo(2);break}H.setCatchFinallyBlocks(3);return H.yield(p.navigator.getVRDisplays(),5);case 5:(G=H.yieldResult)&&G.length&&(x=new nb(p,G[0]));H.leaveTryBlock(2);break;case 3:H.enterCatchBlock();
case 2:return H.return(x)}})},id=function(p,x){var G,H;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Y){return 1==Y.nextAddress?x.webvr?Y.yield(hd(p),3):Y.jumpTo(2):2!=Y.nextAddress&&(G=Y.yieldResult)?Y.return(G):(H=Ic(p))&&x.cardboard||!H&&x.allowCardboardOnDesktop?(p.VRFrameData||(p.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=new Float32Array(16);this.leftProjectionMatrix=new Float32Array(16);
this.pose=null}),Y.return(new Hc(p,x.cardboardConfig))):Y.return(new yb(p))})},jd={global:qa,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},ic=["navigator","HTMLCanvasElement","WebGLRenderingContext"],jc=function(p){p=void 0===p?{}:p;this.config=Object.freeze(Object.assign({},jd,p));this.global=this.config.global;this.nativeWebXR="xr"in this.global.navigator;this.injected=!1;this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)};jc.prototype._injectPolyfill=
function(p){if(!ic.every(function(H){return!!p[H]}))throw Error("Global must have the following attributes : "+ic);for(var x=$jscomp.makeIterator(Object.keys(Bb)),G=x.next();!G.done;G=x.next())G=G.value,void 0!==p[G]?console.warn(G+" already defined on global."):p[G]=Bb[G];sc(p.WebGLRenderingContext)&&(tc(p.HTMLCanvasElement),p.OffscreenCanvas&&tc(p.OffscreenCanvas),p.WebGL2RenderingContext&&sc(p.WebGL2RenderingContext),window.isSecureContext||console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));
this.injected=!0;this._patchNavigatorXR()};jc.prototype._patchNavigatorXR=function(){var p=id(this.global,this.config);this.xr=new Bb.XRSystem(p);Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})};jc.prototype._injectCompatibilityShims=function(p){if(!ic.every(function(G){return!!p[G]}))throw Error("Global must have the following attributes : "+ic);if(p.navigator.xr&&"supportsSession"in p.navigator.xr&&!("isSessionSupported"in p.navigator.xr)){var x=p.navigator.xr.supportsSession;
p.navigator.xr.isSessionSupported=function(G){return x.call(this,G).then(function(){return!0}).catch(function(){return!1})};p.navigator.xr.supportsSession=function(G){console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves.");return x.call(this,G)}}};return jc});(function(){var a=function(b,c,d,f,g,e){this.name=b;this.parentTexture=c;this.uvOffsetScale=new THREE.Vector4(d,f,g,e);this.isCutout=!1};a.prototype={addLoadedListener:function(b){this.parentTexture.addLoadedListener(b)},get hasAlpha(){return this.parentTexture.hasAlpha}};WALK.Texture=function(b,c,d,f,g,e,k,h){this.webFormats=this.stdExt=this.rawExt=this.name=this.id=null;this.isCube=!1;this.image=void 0!==b?b:WALK.Texture.DEFAULT_IMAGE;this.height=this.width=null;this.mipmaps=[];this.wrapS=void 0!==
c?c:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==d?d:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==f?f:GLC.LINEAR;this.minFilter=void 0!==g?g:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==h?h:1;this.isRgbm=this.isCutout=this.hasAlpha=this.isAnimated=!1;this.format=void 0!==e?e:GLC.RGBA;this.type=void 0!==k?k:GLC.UNSIGNED_BYTE;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._atlasEntries=null;this._needsUpdate=!1;this.releaseOnLoadedToGpu=!0;this.loaded=!1;this._loadedListeners=
[];this.fromEditor=!1;this.__webglSlot=this.__webglTexture=null};WALK.Texture.DEFAULT_IMAGE=void 0;WALK.Texture.prototype={constructor:WALK.Texture,sleepAnimation:function(){console.assert(!1)},wakeAnimation:function(){console.assert(!1)},get needsUpdate(){return this._needsUpdate},set needsUpdate(b){this._needsUpdate=b},isAtlas:function(){return null!==this._atlasEntries},enableAtlas:function(){console.assert(!this.isAtlas());this._atlasEntries={}},getAtlasEntry:function(b,c,d,f,g){var e=this._atlasEntries[b];
if(e)return e;console.assert(!this.loaded);e=new a(b,this,c,d,f,g);return this._atlasEntries[b]=e},forEachAtlasEntry:function(b){for(var c in this._atlasEntries)this._atlasEntries.hasOwnProperty(c)&&b(this._atlasEntries[c])},clone:function(b){void 0===b&&(b=new WALK.Texture);b.isCube=b.isCube;b.image=this.image;b.mipmaps=this.mipmaps.slice(0);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.minFilter=this.minFilter;b.anisotropy=this.anisotropy;b.isCutout=this.isCutout;b.isAnimated=
this.isAnimated;b.hasAlpha=this.hasAlpha;b.format=this.format;b.type=this.type;b.generateMipmaps=this.generateMipmaps;b.premultiplyAlpha=this.premultiplyAlpha;b.flipY=this.flipY;b.unpackAlignment=this.unpackAlignment;return b},serialize:function(){var b={id:this.id,name:this.name,stdExt:this.stdExt,webFormats:this.webFormats,alpha:this.hasAlpha};this.rawExt&&(b.rawExt=this.rawExt);this.isRgbm&&(b.rgbm=!0);this.video&&(b.video=!0);return b},dispose:function(){this._loadedListeners=[];this.dispatchEvent({type:"dispose"})},
addLoadedListener:function(b){this.loaded?b():this._loadedListeners.push(b)},notifyLoaded:function(){this.loaded=!0;for(var b=this._loadedListeners,c=0;c<b.length;c+=1)b[c]();b.length=0}};THREE.EventDispatcher.prototype.apply(WALK.Texture.prototype)})();(function(){WALK.CompressedTexture=function(a,b,c,d,f,g,e,k,h,l){WALK.Texture.call(this,null,g,e,k,h,d,f,l);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};WALK.CompressedTexture.prototype=Object.create(WALK.Texture.prototype);WALK.CompressedTexture.prototype.constructor=WALK.CompressedTexture;WALK.CompressedTexture.prototype.clone=function(){var a=new WALK.CompressedTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.DataTexture=function(a,b,c,d,f,g,e,k,h,l){WALK.Texture.call(this,null,g,e,k,h,d,f,l);this.image={data:a,width:b,height:c}};WALK.DataTexture.prototype=Object.create(WALK.Texture.prototype);WALK.DataTexture.prototype.constructor=WALK.DataTexture;WALK.DataTexture.prototype.clone=function(){var a=new WALK.DataTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.VideoTexture=function(a,b,c,d,f,g,e,k,h){var l=this;WALK.Texture.call(this,a,b,c,d,f,g,e,k,h);this.generateMipmaps=!1;this.isAnimated=!0;this.releaseOnLoadedToGpu=!1;this._isPlaying=!0;this._pauseRequested=this._isSleeping=!1;this._videoSrc=null;this._pausedTime=0;this._handlePaused=function(){l._pauseRequested?l._pauseRequested=!1:l._isSleeping=!0;l._isPlaying||(l.video.src="")};this._handleEnded=function(){l._isPlaying=!1;l._isSleeping=!1}};WALK.VideoTexture.prototype=Object.create(WALK.Texture.prototype);
WALK.VideoTexture.prototype.constructor=WALK.VideoTexture;WALK.VideoTexture.prototype._srcAtPausedPosition=function(){return this._videoSrc+"#t="+this._pausedTime};WALK.VideoTexture.prototype._pauseVideo=function(){this._pausedTime=this.video.currentTime;this.video.pause()};Object.defineProperty(WALK.VideoTexture.prototype,"video",{get:function(){return this.image},set:function(a){this.image=a;this._videoSrc=a.src;this._isPlaying=!a.paused&&!a.ended;a.addEventListener("pause",this._handlePaused);
a.addEventListener("ended",this._handleEnded);this._isSleeping&&this._isPlaying&&this._pauseVideo()}});Object.defineProperty(WALK.VideoTexture.prototype,"muted",{get:function(){return this.video.muted},set:function(a){this.video.muted=a}});Object.defineProperty(WALK.VideoTexture.prototype,"loop",{get:function(){return this.video.loop},set:function(a){this.video.loop=a}});Object.defineProperty(WALK.VideoTexture.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying}});WALK.VideoTexture.prototype.play=
function(){var a=this;if(!this._isPlaying)if(this._isSleeping)this._isPlaying=!0;else{var b=this.video;b.src=this._srcAtPausedPosition();var c=b.play();c?(this._isPlaying=!0,c.catch(function(){a._isPlaying=!1})):this._isPlaying=!b.paused&&!b.ended}};WALK.VideoTexture.prototype.pause=function(){this._isPlaying&&(this._isPlaying=!1,this._isSleeping||(this._pauseRequested=!0,this._pauseVideo()))};WALK.VideoTexture.prototype.sleepAnimation=function(){this._isSleeping||(this._isPlaying&&this.video&&this._pauseVideo(),
this._isSleeping=!0)};WALK.VideoTexture.prototype.wakeAnimation=function(){this._isSleeping&&(this._isPlaying&&this.video&&(this.video.src=this._srcAtPausedPosition(),this.video.play()),this._isSleeping=!1)};Object.defineProperty(WALK.VideoTexture.prototype,"needsUpdate",{get:function(){return this._needsUpdate||this.isPlaying&&this.video&&!0!==this.video.seeking&&this.video.readyState>=this.video.HAVE_CURRENT_DATA},set:function(a){this._needsUpdate=a}})})();(function(){WALK.WebGLRenderTarget=function(a,b,c){this.y=this.x=0;this.width=a;this.height=b;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==c.wrapT?c.wrapT:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==c.magFilter?c.magFilter:GLC.LINEAR;this.minFilter=void 0!==c.minFilter?c.minFilter:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=void 0!==c.format?c.format:
GLC.RGBA;this.type=void 0!==c.type?c.type:GLC.UNSIGNED_BYTE;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=c.generateMipmaps||!1;this.shareDepthFrom=void 0!==c.shareDepthFrom?c.shareDepthFrom:null;this.isCube=!1;this.__webglSlot=this.__webglTexture=this.__webglRenderbuffer=this.__webglFramebuffer=null};WALK.WebGLRenderTarget.prototype={constructor:WALK.WebGLRenderTarget,dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetVR=function(a){this.__webglFramebuffer=a;this.height=this.width=this.y=this.x=null;this.isCube=!1};WALK.WebGLRenderTargetVR.prototype={constructor:WALK.WebGLRenderTargetVR,dispose:function(){this.__webglFramebuffer=null;this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTargetVR.prototype)})();(function(){WALK.WebGLRenderTargetCube=function(a,b,c){WALK.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0;this.isCube=!0;this.__webglFramebuffer=[];this.__webglRenderbuffer=[]};WALK.WebGLRenderTargetCube.prototype=Object.create(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetCube.prototype.constructor=WALK.WebGLRenderTargetCube})();(function(){var a=WALK.DEBUG;WALK.CutoutTextureDetector=function(b){var c={format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1},d=[b.createRenderTarget(1024,1024,c),b.createRenderTarget(512,512,c)];c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvOffsetScale:{type:"v4",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_fragment.glsl")};var f=new THREE.ShaderPass(c,
"map");f.material.depthTest=!1;f.material.depthWrite=!1;var g=new THREE.Vector2,e=new THREE.Vector4;f.uniforms.mapUvStep.value=g;f.uniforms.mapUvOffsetScale.value=e;c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvScale:{type:"v2",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_combine_fragment.glsl")};var k=new THREE.ShaderPass(c,"map");k.material.depthTest=!1;k.material.depthWrite=!1;var h=new THREE.Vector2;
k.uniforms.mapUvScale.value=h;k.uniforms.mapUvStep.value=g;var l=new Uint8Array(4096),r=null;a&&(r=new WALK.Timer);this.isCutoutTexture=function(q){var m=void 0!==q.parentTexture;if(m){var u=q.parentTexture;var n=q.uvOffsetScale.x;var w=q.uvOffsetScale.y;var v=q.uvOffsetScale.z;var y=q.uvOffsetScale.w}else u=q,n=w=0,v=y=1;if(!u.hasAlpha||u.video)q.isCutout=!1;else{a&&r.reset();b.enableScissorTest(!0);var C=u.width*v,A=u.height*y;g.set(1/C,1/A);e.set(n,w,v,y);C=Math.max(Math.floor(C/2),1);A=Math.max(Math.floor(A/
2),1);b.setRenderTarget(d[0]);b.setViewport(0,0,C,A);b.setScissor(0,0,C,A);f.render(b,d[0],u);for(var I=1,D=d[0];1!==C&&1!==A;){g.set(1/D.width,1/D.height);h.set(C/D.width,A/D.height);C=Math.floor(C/2);A=Math.floor(A/2);var E=d[I];b.setRenderTarget(E);b.setViewport(0,0,C,A);b.setScissor(0,0,C,A);k.render(b,E,D);D=E;I=(I+1)%2}b.readPixels(C,A,l);D=I=0;C=Math.max(C,A);for(A=0;A<C;++A)I+=l[4*A],D+=l[4*A+1];I=100*I/(255*C);D=100*D/(255*C);q.isCutout=20>I||50<D;a&&(C="",m&&(C+="From atlas: "+u.name+" ["+
n+", "+w+", "+v+", "+y+"]\n"),console.log(q.name+" "+u.width+"x"+u.height+"\n "+C+"Is cutout: "+q.isCutout+"\n Partialy transparent regions: "+I+"%\n Fully transparent pixels: "+D+"%\n Time: "+r.elapsedSec()));b.enableScissorTest(!1)}};this.dispose=function(){d[0].dispose();d[1].dispose();f.dispose();k.dispose()}}})();WALK.SHADERS={};WALK.SHADERS["aabb_query_fragment.glsl"]="//AUTO GENERATED\nvarying vec3 vPositionW;\nuniform int axis;\nvec4 encodeFloat(in float x) {\nfloat xabs = abs(x);\nfloat r = floor(xabs);\nfloat g = fract(xabs);\nreturn vec4(r / 255.0, g, 0.0, 0.0);\n}\nvoid main() {\nvec3 viewW = cameraPosition - vPositionW;\nif (axis == 0) {\ngl_FragColor = encodeFloat(viewW.x);\n} else if (axis == 1) {\ngl_FragColor = encodeFloat(viewW.y);\n} else if (axis == 2) {\ngl_FragColor = encodeFloat(viewW.z);\n}\n}\n";
WALK.SHADERS["aabb_query_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarying vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["accumulate_fragment.glsl"]="//AUTO GENERATED\nuniform float weight;\nuniform sampler2D inputBuffer;\nvarying vec2 vUv;\nvoid main() {\nvec3 inputColor = texture2D(inputBuffer, vUv).rgb;\ngl_FragColor = vec4(inputColor, weight);\n}\n";WALK.SHADERS["accumulate_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["alpha_stats_combine_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec2 mapUvScale;\nvarying vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvScale- mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nvec4 p0 = texture2D(map, uv);\nvec4 p1 = texture2D(map, uv + vec2(0.0, mapUvStep.y));\nvec4 p2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0));\nvec4 p3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y));\ngl_FragColor = vec4((p0.r + p1.r + p2.r + p3.r) / 4.0,\n(p0.g + p1.g + p2.g + p3.g) / 4.0, 0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec4 mapUvOffsetScale;\nvarying vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvOffsetScale.zw + mapUvOffsetScale.xy - mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nconst float bias = -1.0;\nfloat a0 = texture2D(map, uv, bias).a;\nfloat a1 = texture2D(map, uv + vec2(0.0, mapUvStep.y), bias).a;\nfloat a2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0), bias).a;\nfloat a3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y), bias).a;\nfloat fully_transparent_count = step(0.0, -a0) + step(0.0, -a1) +\nstep(0.0, -a2) + step(0.0, -a3);\nfloat partialy_transparent_count =\nstep(0.0, -abs(clamp(a0, 0.05, 0.95) - a0)) +\nstep(0.0, -abs(clamp(a1, 0.05, 0.95) - a1)) +\nstep(0.0, -abs(clamp(a2, 0.05, 0.95) - a2)) +\nstep(0.0, -abs(clamp(a3, 0.05, 0.95) - a3));\ngl_FragColor = vec4(step(4.0, partialy_transparent_count),\nfully_transparent_count / 4.0,\n0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["anchor_sprite_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main() {\nvUv = uv;\nvec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\nvec2 scale;\nscale.x = length(modelMatrix[0].xyz);\nscale.y = length(modelMatrix[1].xyz);\nvec2 alignedPosition = position.xy * scale;\nmvPosition.xy += alignedPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["anchor_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarying vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarying vec3 vNormalV;\nvarying vec3 vPositionV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvec3 normal = sphericalDecode(sphericalNormal);\nvec3 normalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nnormalW = normalize(normalW);\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE)\nvec3 anchorCenterW = vec3(modelMatrix[3].xyz);\nvec3 cameraUpW = vec3(modelViewMatrix[0].y,\nmodelViewMatrix[1].y,\nmodelViewMatrix[2].y);\nvec3 forwardW = normalize(anchorCenterW - cameraPosition);\nvec3 rightW = cross(forwardW, cameraUpW);\nrightW.z = 0.0;\nrightW = normalize(rightW);\nvec3 upW = cross(rightW, forwardW);\nvUv = vec2(dot(normalW, rightW) * 0.5 + 0.5, dot(normalW, upW) * 0.5 + 0.5);\n#endif\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = normalW;\nvPositionW = positionW;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["cubemap_filter_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\nuniform samplerCube envMap;\nuniform float mipSize;\nuniform float face;\nuniform float gloss;\nvoid main(void) {\nvec2 st = 2.0 * floor(gl_FragCoord.xy) / (mipSize - 1.0) - 1.0;\nvec3 vec;\nif (face == 0.0) {\nvec = vec3(1, -st.y, -st.x);\n} else if (face == 1.0) {\nvec = vec3(-1, -st.y, st.x);\n} else if (face == 2.0) {\nvec = vec3(st.x, 1, st.y);\n} else if (face == 3.0) {\nvec = vec3(st.x, -1, -st.y);\n} else if (face == 4.0) {\nvec = vec3(st.x, -st.y, 1);\n} else {\nvec = vec3(-st.x, -st.y, -1);\n}\nmat3 vecSpace = matrixFromVector(normalize(vec));\nvec3 color = vec3(0.0);\nconst int samples = 200;\nvec3 vect;\nfor(int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nvect = hemisphereSample_cos(\nvec2(float(i) / float(samples), rand), vecSpace, vec, gloss);\ncolor += hdrDecode(textureCube(envMap, vect));\n}\ncolor /= float(samples);\ngl_FragColor = hdrEncode(color);\n}\n";
WALK.SHADERS["cubemap_filter_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["cube_to_equirect_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform samplerCube panoramaCube;\nvarying vec2 vUv;\nvoid main() {\nvec2 uv = vUv;\nfloat longitude = uv.x * 2. * PI;\nfloat latitude = uv.y * PI;\nvec3 dir = vec3(\nsin(longitude) * sin(latitude),\ncos(longitude) * sin(latitude),\ncos(latitude));\ngl_FragColor = textureCube(panoramaCube, normalize(dir));\n}\n";
WALK.SHADERS["cube_to_equirect_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main()  {\nvUv = vec2(uv.x, uv.y - 1.0);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["editor_light_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform vec3 color;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 lVector = normalize(vViewPosition.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormal), lVector), 0.0);\nvec3 lightColor = color * pointDiffuse;\nlightColor = mix(lightColor, highlight, highlightMix);\ngl_FragColor.xyz = min(linearToGamma(lightColor), 1.0);\n}\n";
WALK.SHADERS["editor_light_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 normal = sphericalDecode(sphericalNormal);\nvNormal = normalize(normalMatrix * normal);\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvViewPosition = -mvPosition.xyz;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["equirect_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nuniform sampler2D map;\nuniform float exposure;\nuniform float cameraGamma;\nvarying vec2 vUv;\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D texture, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(texture, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(texture, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\n#ifdef USE_RGBM_MAP\nvec4 colorRgbm = texture2D(map, vUv);\nvec3 colorLinear = hdrDecode(colorRgbm);\n#else\nvec3 colorLinear = gammaToLinear(texture2D(map, vUv).xyz);\n#endif\n#ifdef HDR_OUTPUT\n#ifdef USE_RGBM_MAP\ngl_FragColor = colorRgbm;\n#else\ngl_FragColor = hdrEncode(10.0 * colorLinear);\n#endif\n#else\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\nvec3 colorGamma =  linearToGammaUnreal(colorExposed);\n#ifdef USE_COLORMAP\ngl_FragColor.xyz = colormap(colorMap, colorGamma);\n#else\ngl_FragColor.xyz = colorGamma;\n#endif\n#endif\n}\n";
WALK.SHADERS["equirect_sky_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["gaze_pointer_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nconst float pointRadius = 0.01;\nconst float pointBorder = 0.005;\nconst float timerRadius = 0.04;\nconst float timerBorder = 0.02;\nconst vec3 timerColor =  vec3(0.298, 0.619, 0.851);\nvarying vec2 coords;\nuniform float circleSpan;\nvoid main() {\nfloat dist =  sqrt(dot(coords, coords));\nif (dist < pointRadius) {\nfloat a = 1.0 - smoothstep(pointRadius - pointBorder, pointRadius, dist);\ngl_FragColor= vec4(1.0, 1.0, 1.0, a);\n} else if (-atan(coords.x, -coords.y) < circleSpan) {\nfloat a2 = smoothstep(timerRadius - timerBorder, timerRadius, dist) -\nsmoothstep(timerRadius, timerRadius + timerBorder, dist);\ngl_FragColor = vec4(timerColor, a2);\n} else {\ndiscard;\n}\n}\n";
WALK.SHADERS["gaze_pointer_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 coords;\nvoid main() {\ncoords = vec2(position.x, position.y);\nvec4 outPosition = projectionMatrix *  modelViewMatrix * vec4(position, 1.0);\noutPosition.z = -0.1;\ngl_Position = outPosition;\n}\n";WALK.SHADERS["light_visibility_dilate_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D lightVisibilityMap;\nvarying vec2 vUv;\nuniform vec2 sizeInv;\nvoid main() {\nvec4 zero = vec4(0.0);\nvec4 visibility = texture2D(lightVisibilityMap, vUv);\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv - vec2(sizeInv.x, 0.0));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv - vec2(0.0, sizeInv.y));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + vec2(sizeInv.x, 0.0));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + vec2(0.0, sizeInv.y));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + sizeInv);\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv - sizeInv);\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + vec2(sizeInv.x, -sizeInv.y));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + vec2(-sizeInv.x, sizeInv.y));\ngl_FragColor = visibility;\n}\n";
WALK.SHADERS["light_visibility_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\n#define SPOT_PROPERTIES_NEEDED\n#define POINT_LIGHT_TYPE 0.0\n#define SPOT_LIGHT_TYPE 1.0\nuniform sampler2D lightAttrMap;\nuniform float lightsCount;\nstruct Light {\nvec3 positionW;\nfloat strength; // TODO: rename to intensity\nfloat size; // radius\nvec3 color;\n#ifdef SPOT_PROPERTIES_NEEDED\nfloat type; // POINT_LIGHT_TYPE or SPOT_LIGHT_TYPE\nvec3 spotDirectionW;\nfloat spotHalfAngle;\n#endif\n};\nconst float lightAttrFragments = 4.0;\nvoid readLightProperties(in float lightId, out Light light) {\nfloat lightAttrFragmentOffset = 1.0 / (lightAttrFragments * lightsCount);\nvec2 offset = vec2(lightId / lightsCount + 0.5 * lightAttrFragmentOffset,\n0.0);\nvec4 lightAttr = texture2D(lightAttrMap, offset);\nlight.positionW.xyz = lightAttr.xyz;\nlight.size = lightAttr.w;\noffset.x += lightAttrFragmentOffset;\nlightAttr = texture2D(lightAttrMap, offset);\nlight.color.xyz = lightAttr.xyz;\nlight.strength = lightAttr.w;\n#ifdef SPOT_PROPERTIES_NEEDED\noffset.x += lightAttrFragmentOffset;\nlightAttr = texture2D(lightAttrMap, offset);\nlight.type = lightAttr.x;\nlight.spotDirectionW.xyz = lightAttr.yzw;\noffset.x += lightAttrFragmentOffset;\nlightAttr = texture2D(lightAttrMap, offset);\nlight.spotHalfAngle = lightAttr.x;\n#endif\n}\n#define LENGTH_EPSILON 0.001\nuniform samplerCube objectDistanceMap;\nuniform sampler2D combineWithMap;\nuniform float objectId;\nuniform float lightId;\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\nvarying vec2 vUv2;\nvoid markAsReached(vec4 currentVisibility) {\nconst float fragmentReached = 0.01;\ngl_FragColor = max(currentVisibility, fragmentReached);\n}\nvoid main(void){\nvec4 currentVisibility = texture2D(combineWithMap, vUv2);\nLight light;\nreadLightProperties(lightId, light);\nvec3 normalW = normalize(vNormalW);\nvec3 toLightW = light.positionW - vPositionW;\nvec3 toLastVisiblePointW = toLightW + normalW * light.size;\nif (dot(normalW, toLastVisiblePointW) <= 0.0) {\nmarkAsReached(currentVisibility);\nreturn;\n}\nfloat lightDistance = length(toLightW);\nfloat spotStrengthFactor = 1.0;\nif (lightDistance >= LENGTH_EPSILON && light.type == SPOT_LIGHT_TYPE) {\nfloat spotHeight = dot(light.spotDirectionW, -toLightW);\nif (spotHeight < LENGTH_EPSILON) {\nmarkAsReached(currentVisibility);\nreturn;\n}\nfloat cosPointDir = spotHeight / lightDistance;\nfloat spotSlantHeight = spotHeight / cos(light.spotHalfAngle);\nfloat spotSinHalfFalloffRange = light.size / spotSlantHeight;\nfloat pointDirAngle = acos(cosPointDir);\nfloat spotHalfFalloffRange;\nif (spotSinHalfFalloffRange > 1.0) {\nspotHalfFalloffRange = light.spotHalfAngle / 6.0;\n} else {\nspotHalfFalloffRange =\nmin(asin(spotSinHalfFalloffRange), light.spotHalfAngle / 6.0);\n}\nfloat spotFalloffBegin = light.spotHalfAngle - spotHalfFalloffRange;\nif (pointDirAngle < spotFalloffBegin) {\nspotStrengthFactor = cos(pointDirAngle);\n} else {\nfloat linearFalloffWeight =\n(pointDirAngle - spotFalloffBegin) / (2.0 * spotHalfFalloffRange);\nspotStrengthFactor = mix(cos(spotFalloffBegin), 0.0, linearFalloffWeight);\n}\nif (spotStrengthFactor <= 0.0) {\nmarkAsReached(currentVisibility);\nreturn;\n}\n}\nvec3 cubeDir = -toLightW / lightDistance;\nfloat bias = 0.05;\nfloat visibility = 0.0;\nfloat diskRadius = 1.0 - light.size / (2.0 * lightDistance);\ndiskRadius = 0.97;\nmat3 cubeDirSpace = matrixFromVector(cubeDir);\nconst int samples = 50;\nvec3 newCubeDir;\nfor(int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nnewCubeDir = hemisphereSample_cos(vec2(float(i) / float(samples), rand),\ncubeDirSpace, cubeDir, diskRadius);\nvec4 objectDistance = textureCube(objectDistanceMap, newCubeDir);\nfloat collisionObjectId = objectDistance.x;\nfloat collisionDistance = objectDistance.y;\nif (objectId == collisionObjectId ||\ncollisionDistance > lightDistance - bias) {\nvisibility += 1.0;\n}\n}\nvisibility /= float(samples);\nvisibility *= spotStrengthFactor;\nif (visibility != 0.0) {\nconst float channelTaken = 1025.0;\nvec4 outputVisibility = min(channelTaken * currentVisibility, channelTaken);\nfloat visibilityChannel = float(lightId) + clamp(visibility, 0.001, 0.999);\ngl_FragColor = max(outputVisibility, visibilityChannel);\n} else {\nmarkAsReached(currentVisibility);\n}\n}\n";
WALK.SHADERS["light_visibility_free_channel_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D lightVisibilityMap;\nvarying vec2 vUv;\nuniform vec2 sizeInv;\nuniform float threshold;\nvoid main() {\nvec2 corner = vUv - sizeInv;\nvec2 uv = corner + 0.5 * sizeInv;\nvec4 visibility0 = texture2D(lightVisibilityMap, uv);\nvec4 visibility1 = texture2D(lightVisibilityMap, uv + vec2(0.0, sizeInv.y));\nvec4 visibility2 = texture2D(lightVisibilityMap, uv + vec2(sizeInv.x, 0.0));\nvec4 visibility3 = texture2D(lightVisibilityMap,\nuv + vec2(sizeInv.x, sizeInv.y));\ngl_FragColor = step(threshold, visibility0) + step(threshold, visibility1) +\nstep(threshold, visibility2) + step(threshold, visibility3);\n}\n";
WALK.SHADERS["light_visibility_vertex.glsl"]="//AUTO GENERATED\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\nvarying vec2 vUv2;\nvoid main() {\nvNormalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\nvPositionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvUv2 = uv2;\ngl_Position = vec4(2.0 * uv2.x - 1.0, 2.0 * uv2.y - 1.0, 1.0, 1.0);\n}\n";WALK.SHADERS["luma_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\nuniform vec3 color;\nvoid main() {\nvec3 receivedLight = getLightIntensity();\nvec3 diffuseLight = receivedLight * color;\nfloat luma = 0.299 * diffuseLight.r +\n0.587 * diffuseLight.g +\n0.114 * diffuseLight.b;\ngl_FragColor.r = fract(luma);\ngl_FragColor.g = floor(luma) / 255.0;\n}\n";
WALK.SHADERS["mirror_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarying vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn (base < 0.5 ? (2.0 * base * blend) :\n(1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r),\nblendOverlay(mirrorColor.g, color.g),\nblendOverlay(mirrorColor.b, color.b), 1.0);\ngl_FragColor = color;\n}\n";
WALK.SHADERS["mirror_vertex.glsl"]="//AUTO GENERATED\nuniform mat4 textureMatrix;\nvarying vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvec4 worldPosition = modelMatrix * vec4(position, 1.0);\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";WALK.SHADERS["object_distance_byte_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarying vec3 vPositionW;\nvoid main(void) {\nfloat cameraDistance = min(distance(cameraPosition, vPositionW), 255.0);\nint x = objectId / 256;\nint y = objectId - 256 * x;\nfloat z = floor(cameraDistance);\nfloat a = fract(cameraDistance);\ngl_FragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nz / 255.0, a);\n}\n";
WALK.SHADERS["object_distance_float_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarying vec3 vPositionW;\nvoid main(void){\nfloat cameraDistance = distance(cameraPosition, vPositionW);\ngl_FragColor = vec4(objectId, cameraDistance, 0.0, 1.0);\n}\n";WALK.SHADERS["object_distance_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarying vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["procedural_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float sinBottomAngle;\nuniform float exponent;\nvarying vec3 vWorldDirection;\n#ifdef HDR_OUTPUT\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D texture, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(texture, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(texture, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\nfloat sinDirection = normalize(vWorldDirection).z;\nfloat w = max(0.0, (sinDirection - sinBottomAngle) / (1.0 - sinBottomAngle));\nvec3 colorGamma = mix(bottomColor, topColor, pow(w, exponent));\n#ifdef HDR_OUTPUT\nvec3 colorLinear = gammaToLinear(colorGamma);\ngl_FragColor = hdrEncode(10.0 * colorLinear);\n#else\n#ifdef USE_COLORMAP\ngl_FragColor.xyz = colormap(colorMap, colorGamma);\n#else\ngl_FragColor.xyz = colorGamma;\n#endif\n#endif\n}\n";
WALK.SHADERS["procedural_sky_vertex.glsl"]="//AUTO GENERATED\nvarying vec3 vWorldDirection;\nvoid main() {\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvWorldDirection = positionW - cameraPosition;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["rotate_gizmo_material_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nuniform float opacity;\nuniform vec3 gizmoPosition;\nuniform float sphereRadius;\nvarying vec4 mPosition;\nvoid discardIfRayIntersectsSphere(vec3 r0, vec3 rd, vec3 s0, float sr) {\nfloat a = dot(rd, rd);\nvec3 s0_r0 = r0 - s0;\nfloat b = 2.0 * dot(rd, s0_r0);\nfloat c = dot(s0_r0, s0_r0) - (sr * sr);\nfloat delta = b * b - 4.0 * a * c;\nif (delta >= 0.0 && -b - sqrt(delta) > 0.0) {\ndiscard;\n}\n}\nvoid main() {\nvec4 outColor;\noutColor.rgb = color;\noutColor.a = opacity;\nvec3 toCamera = normalize(cameraPosition - gizmoPosition);\ndiscardIfRayIntersectsSphere(mPosition.xyz, toCamera, gizmoPosition, sphereRadius);\ngl_FragColor = outColor;\n}\n";
WALK.SHADERS["rotate_gizmo_material_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarying vec4 mPosition;\nvoid main() {\nvec4 p = vec4(position, 1.0);\nmPosition = modelMatrix * p;\nvec4 mvPosition = modelViewMatrix * p;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["standard_material_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_DYNAMIC_LIGHT)\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarying vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarying vec3 vPositionV;\nvarying vec3 vNormalV;\nuniform float bumpScale;\nuniform sampler2D bumpTexture;\nvec2 dBumpdxy() {\nvec2 texdx = dFdx(vUv);\nvec2 texdy = dFdy(vUv);\nfloat Hll = bumpScale * texture2D(bumpTexture, vUv).x;\nfloat dBx = bumpScale * texture2D(bumpTexture, vUv + texdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpTexture, vUv + texdy).x - Hll;\nreturn vec2(dBx, dBy);\n}\nvec3 perturbNormal(in vec3 surfPos, in vec3 surfNorm) {\nvec2 dBdxy = dBumpdxy();\nvec3 vSigmaX = dFdx(surfPos);\nvec3 vSigmaY = dFdy(surfPos);\nvec3 R1 = cross(vSigmaY, surfNorm);\nvec3 R2 = cross(surfNorm, vSigmaX);\nfloat fDet = dot(vSigmaX, R1);\nvec3 vGrad = sign(fDet) * (dBdxy.x * R1 + dBdxy.y * R2);\nreturn normalize(abs(fDet) * surfNorm - vGrad);\n}\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nuniform sampler2D baseColorTexture;\nuniform vec4 baseColorAtlasUvMod;\nuniform float alphaDiscardThreshold;\n#ifdef USE_PARALLAX_CORRECTION\n#endif\n#else\nuniform vec3 baseColor;\n#endif\nuniform float opacity;\nuniform vec4 baseColorCorrection;\nvec3 getBaseColor(out float alpha) {\n#ifdef USE_BASE_COLOR_TEXTURE\n#ifdef USE_PARALLAX_CORRECTION\n#else\nvec2 baseColorUv = vUv;\n#endif\nbaseColorUv = baseColorUv * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\n#ifdef USE_ALPHA_IN_LOWER_HALF\nvec4 baseColorGamma = texture2D(baseColorTexture, vec2(baseColorUv.x, .5 + .5 * baseColorUv.y));\nfloat textureAlpha = texture2D(baseColorTexture, vec2(baseColorUv.x, .5 * baseColorUv.y)).r;\n#else\nvec4 baseColorGamma = texture2D(baseColorTexture, baseColorUv);\nfloat textureAlpha = baseColorGamma.a;\n#endif\nvec3 baseColor = gammaToLinear(baseColorGamma.rgb);\nalpha = opacity * textureAlpha;\n#else // NOT USE_BASE_COLOR_TEXTURE\nalpha = opacity;\n#endif\nvec3 baseColorCorrected = baseColorCorrection.a * baseColor +\nbaseColorCorrection.rgb;\nreturn clamp(baseColorCorrected, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n}\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\n#ifdef USE_ROUGHNESS_TEXTURE\nuniform sampler2D roughnessTexture;\n#else\nuniform float roughness;\n#endif\n#ifdef USE_METALLIC_TEXTURE\nuniform sampler2D metallicTexture;\n#else\nuniform float metallic;\n#endif\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity);\n#if defined(USE_DYNAMIC_LIGHT) || defined(USE_ENVMAP)\nconst float DLT = 0.001;\n#ifdef USE_ENVMAP\nuniform samplerCube envMap;\nuniform float envMipsCount;\n#ifdef HAVE_TEXTURE_LOD\n#else\nuniform samplerCube envMap2;\n#endif\n#endif\nstruct Roughness {\n#ifdef USE_DYNAMIC_LIGHT\n#endif\n#ifdef USE_ENVMAP\nfloat envFresnel; // (1.0 - roughness)^2, used for Fresnel with env map\nfloat envMipLevel0;\nfloat envMipLevel1;\nfloat envMipMixFactor;\n#endif\n};\nRoughness getRoughnessFactors() {\nRoughness r;\n#ifdef USE_ROUGHNESS_TEXTURE\nfloat roughness = texture2D(roughnessTexture, vUv).x;\n#endif // else roughness is a uniform\nfloat roughness2 = roughness * roughness;\n#ifdef USE_DYNAMIC_LIGHT\n#endif\n#ifdef USE_ENVMAP\nfloat maxMipLevel = envMipsCount - 1.0;\nfloat mipSelector = roughness * maxMipLevel;\nr.envMipLevel0 = floor(mipSelector);\nr.envMipLevel1 = min(r.envMipLevel0 + 1.0, maxMipLevel);\nr.envMipMixFactor = fract(mipSelector);\nr.envFresnel = (roughness2 - 2.0 * roughness + 1.0);\n#endif\nreturn r;\n}\n#ifdef USE_ENVMAP\n#ifdef USE_ENVMAP_PROJECT\nuniform vec3 envBoxMin;\nuniform vec3 envBoxMax;\nuniform vec3 envMapPosW;\nconst vec3 infBox = vec3(1000.0);\nvec3 cubeMapProject(vec3 reflectionW) {\nvec3 firstPlaneIntersect = (envBoxMax - vPositionW) / reflectionW;\nvec3 secondPlaneIntersect = (envBoxMin - vPositionW) / reflectionW;\nvec3 furthestPlane = max(firstPlaneIntersect, secondPlaneIntersect);\nvec3 furthestPlaneNonNeg =\nstep(0.0, -furthestPlane) * infBox + abs(furthestPlane);\nfloat distance = min(min(furthestPlaneNonNeg.x, furthestPlaneNonNeg.y),\nfurthestPlaneNonNeg.z);\n/*if (furthestPlane.x > 0.0){\ndistance = furthestPlane.x;\n}\nif (furthestPlane.y > 0.0) {\ndistance = min(distance, furthestPlane.y);\n}\nif (furthestPlane.z > 0.0) {\ndistance = min(distance, furthestPlane.z);\n}*/\nvec3 intersectionPosW = vPositionW + reflectionW * distance;\nreturn intersectionPosW - envMapPosW;\n}\n#endif // USE_ENVMAP_PROJECT\nvec3 fixSeams(vec3 vec, float mipLevel) {\nfloat scale = 1.0 - exp2(mipLevel) / 128.0;\nfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\nif (abs(vec.x) != M) vec.x *= scale;\nif (abs(vec.y) != M) vec.y *= scale;\nif (abs(vec.z) != M) vec.z *= scale;\nreturn vec;\n}\nvec3 getEnvColor(in samplerCube envMap, in Roughness roughness,\nin vec3 reflectionW) {\nvec3 reflectionNormW = normalize(reflectionW);\n#ifdef USE_ENVMAP_PROJECT\nif (envBoxMin.x != envBoxMax.x) {\nreflectionNormW = cubeMapProject(reflectionNormW);\n}\n#endif\nvec3 reflectionNormFixedW = fixSeams(reflectionNormW,\nroughness.envMipLevel0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw0 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel0);\n#else\nvec4 cubeColorRaw0 = textureCube(envMap, reflectionNormFixedW);\n#endif\nvec3 cubeColor0 = hdrDecode(cubeColorRaw0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw1 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel1);\n#else\nvec4 cubeColorRaw1 = textureCube(envMap2, reflectionNormFixedW);\n#endif\nvec3 cubeColor1 = hdrDecode(cubeColorRaw1);\nreturn mix(cubeColor0, cubeColor1, roughness.envMipMixFactor);\n}\nvec3 fresnelSchlickEnv(in vec3 specularColor, in Roughness roughness,\nin float clampCosnv, inout float opacity) {\nfloat fresnel = 1.0 - clampCosnv;\nfloat fresnel2 = fresnel * fresnel;\nfresnel *= fresnel2 * fresnel2;\nfresnel *= roughness.envFresnel;\nopacity = opacity + (1.0 - opacity) * fresnel;\nreturn specularColor + (1.0 - specularColor) * fresnel;\n}\n#endif // USE_ENVMAP\n#ifdef USE_DYNAMIC_LIGHT\n#endif // USE_DYNAMIC_LIGHT\nvec3 getSpecularColor(in vec3 baseColor, float metalic) {\nconst float dielectricF0 = 0.04;\nreturn mix(vec3(dielectricF0), baseColor, metalic);\n}\nfloat getLuminance(in vec3 color) {\nreturn 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n}\nvec4 lerpLightVisibility(in sampler2D map, in vec2 uv, in vec2 size) {\nvec2 fragAddress = uv * size + 0.5;\nvec2 weight = fract(fragAddress);\nvec2 sizeInv = 1.0 / size;\nvec2 uvlb = floor(fragAddress) * sizeInv;\nvec4 lb = texture2D(map, uvlb);\nvec4 lt = texture2D(map, uvlb + vec2(0.0, sizeInv.y));\nvec4 rb = texture2D(map, uvlb + vec2(sizeInv.x, 0.0));\nvec4 rt = texture2D(map, uvlb + vec2(sizeInv.x, sizeInv.y));\nvec4 lb_idx = floor(lb);\nvec4 lt_idx = floor(lt);\nvec4 rb_idx = floor(rb);\nvec4 rt_idx = floor(rt);\nvec4 lt_idx_smaller_eq = step(lt_idx, lb_idx);\nvec4 rb_idx_smaller_eq = step(rb_idx, lb_idx);\nvec4 rt_idx_smaller_eq = step(rt_idx, lb_idx);\nlt = clamp(lt, lb_idx, lb_idx + 0.999 * lt_idx_smaller_eq);\nrb = clamp(rb, lb_idx, lb_idx + 0.999 * rb_idx_smaller_eq);\nrt = clamp(rt, lb_idx, lb_idx + 0.999 * rt_idx_smaller_eq);\nvec4 a = mix(lb, lt, weight.y);\nvec4 b = mix(rb, rt, weight.y);\nreturn mix(a, b, weight.x);\n}\nvec3 getNormalW() {\n#ifdef USE_BUMP_TEXTURE\nvec3 normalPerturbedV = perturbNormal(-vPositionV, normalize(vNormalV));\nreturn normalize(\ninverseTransformDirection(normalPerturbedV, viewMatrix));\n#else\nreturn normalize(vNormalW);\n#endif\n}\nvec3 addSpecular(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 totalSpec = vec3(0.0, 0.0, 0.0);\n#ifdef USE_METALLIC_TEXTURE\nfloat metallic = texture2D(metallicTexture, vUv).x;\n#endif // else metallic is a uniform\nvec3 diffuseIntensity = totalIntensity * (1.0 - mix(0.04, 1.0, metallic));\nvec3 viewW = normalize(cameraPosition - vPositionW);\nvec3 normalW = getNormalW();\nfloat clampCosnv = saturate(dot(normalW, viewW));\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 specularColor = getSpecularColor(baseColor, metallic);\nRoughness roughness = getRoughnessFactors();\n#ifdef USE_ENVMAP\nvec3 envColor = getEnvColor(envMap, roughness, reflectionW);\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\ntotalSpec = envColor * fresnel;\n#endif\n#ifdef USE_DYNAMIC_LIGHT\n#endif\nfloat luminance = getLuminance(totalIntensity);\nreturn (baseColor * diffuseIntensity +\ntotalSpec * mix(0.4, 1.0, luminance));\n}\n#else // NOT (USE_DYNAMIC_LIGHT or USE_ENVMAP)\nvec3 addSpecular(vec3 baseColor, in vec3 lightIntensity, in float opacity) {\nreturn baseColor * lightIntensity;\n}\n#endif\n#ifdef USE_HIGHLIGTH\nuniform vec3 highlight;\nuniform float highlightMix;\n#endif\n#if defined(HDR_OUTPUT)\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D texture, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(texture, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(texture, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\n#ifdef USE_CHROMA_KEY\nuniform vec3 chromaKeyColor;\nuniform vec3 chromaKeyDeltaCoeff;\nconst float k32 = sqrt(3.0) / 2.0;\nvec3 rgb2abi(vec3 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\nreturn vec3(\nr - 0.5 * g - 0.5 * b,\nk32 * (g - b),\n0.3333 * (r + g + b));\n}\nconst float IPI2 = 0.5 / 3.1415926538;\nvec3 rgb2hci(vec3 color) {\nvec3 abi = rgb2abi(color);\nreturn vec3(\natan(abi.y, abi.x) * IPI2,\nlength(abi.xy),\nabi.z);\n}\nfloat chromaKeyShapeFn(vec3 delta, vec3 color, vec3 key) {\nvec3 diff = color - key;\nvec3 v = delta * vec3(\n0.5 - abs(abs(diff.x) - 0.5),\nabs(diff.y),\nabs(diff.z));\nfloat x = max(v.r, max(v.g, v.b));\nreturn x * x;\n}\nfloat chromaKeyEdgeFn(float a) {\nreturn clamp(.2/.5 * (a - 1.0), 0.0, 1.0);\n}\n#endif\nuniform float emissionStrength;\nuniform float exposure;\nuniform float cameraGamma;\nvoid main() {\nfloat alpha;\nvec3 baseColor = getBaseColor(alpha);\n#ifdef USE_CHROMA_KEY\nfloat dist = chromaKeyShapeFn(chromaKeyDeltaCoeff, rgb2hci(baseColor), rgb2hci(chromaKeyColor));\nalpha *= chromaKeyEdgeFn(dist);\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nif (alpha < alphaDiscardThreshold) {\ndiscard;\n}\n#endif\nvec3 lightIntensity = getLightIntensity();\n#ifdef USE_HIGHLIGTH\nbaseColor = mix(baseColor, highlight, highlightMix);\nalpha = mix(alpha, 1.0, highlightMix);\n#endif\nvec3 diffuseSpecular = addSpecularHook(baseColor, lightIntensity, alpha);\n#ifdef USE_HEADLIGHT\nvec3 lightW = normalize(cameraPosition - vPositionW.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormalW), lightW), 0.0);\ndiffuseSpecular *= pointDiffuse;\n#endif\nvec3 diffuseSpecularEmissive = diffuseSpecular + baseColor * emissionStrength;\n#ifdef HDR_OUTPUT\nif (alpha < 0.5) {\ndiscard;\n}\ngl_FragColor = hdrEncode(diffuseSpecularEmissive);\n#else // no HDR_OUTPUT\nvec3 exposedColor = pow(exposure * diffuseSpecularEmissive.xyz,\nvec3(cameraGamma));\nvec3 gammaColor =  linearToGammaUnreal(exposedColor);\n#ifdef USE_COLORMAP\ngl_FragColor.rgb = colormap(colorMap, min(gammaColor, 1.0));\n#else\ngl_FragColor.rgb = gammaColor;\n#endif\ngl_FragColor.a = alpha;\n#endif // no HDR_OUTPUT\n}\n";
WALK.SHADERS["standard_material_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarying vec2 vUv;\nuniform vec4 uvMod;\n#endif\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarying vec3 vPositionV;\nvarying vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_DYNAMIC_LIGHT)\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvUv = uv * uvMod.zw + uvMod.xy;\n#endif\nvec4 transformedPosition = transformPosition();\nvec4 mvPosition = modelViewMatrix * transformedPosition;\n#ifdef USE_LIGHTMAP\nfloat zeroOrOne = min(uv2.x + uv2.y, 1.0);\nvUv2 = uv2 * uv2Mod.zw + uv2Mod.xy * zeroOrOne;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_DYNAMIC_LIGHT)\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_DYNAMIC_LIGHT)\nvNormalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\nvPositionW = (modelMatrix * transformedPosition).xyz;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["static_render_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform sampler2D staticRender;\nuniform vec2 sizeInv;\nvoid main() {\nvec3 colorLinear = texture2D(staticRender, gl_FragCoord.xy * sizeInv).rgb;\ngl_FragColor.rgb = linearToGammaUnreal(colorLinear);\n}\n";
WALK.SHADERS["static_render_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["water.glsl"]="//AUTO GENERATED\n#ifdef USE_NORMAL_TEXTURE\nuniform float time;\nuniform float wavesScale;\nuniform float refractionFactor;\nuniform sampler2D normalTexture;\nvec4 getNoise(in vec2 uv) {\nvec2 uv0 = (uv / 103.0) + vec2(time / 17.0, time / 29.0);\nvec2 uv1 = uv / 107.0 - vec2(time / -19.0, time / 31.0);\nvec2 uv2 = uv / vec2(897.0, 983.0) + vec2(time / 101.0, time / 97.0);\nvec2 uv3 = uv / vec2(991.0, 877.0) - vec2(time / 109.0, time / -113.0);\nvec4 noise = texture2D(normalTexture, uv0) +\ntexture2D(normalTexture, uv1) +\ntexture2D(normalTexture, uv2) +\ntexture2D(normalTexture, uv3);\nreturn noise * 0.5 - 1.0;\n}\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 toEyeW = cameraPosition - vPositionW;\nvec3 viewW = normalize(toEyeW);\nvec4 noise = getNoise(vPositionW.xy * wavesScale);\nvec3 normalW = normalize(noise.xyz);\nfloat clampCosnv = saturate(dot(normalW, viewW));\nRoughness roughness;\nroughness.envMipLevel0 = 0.0;\nroughness.envMipLevel1 = 0.0;\nroughness.envMipMixFactor = 0.0;\nroughness.envFresnel = 1.0;\nconst float waterF0 = 0.02;\nvec3 specularColor = vec3(waterF0);\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 refractionW = refract(-viewW, normalW, 0.75);\nvec3 reflectedEnv = getEnvColor(envMap, roughness, normalize(reflectionW));\nvec3 refractedEnv = refractionFactor *\ngetEnvColor(envMap, roughness, normalize(refractionW));\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\nvec3 totalSpec = reflectedEnv * fresnel + refractedEnv * (1.0 - fresnel);\nvec3 diffuseIntensity = totalIntensity * 0.98;\nfloat luminance = getLuminance(totalIntensity);\nreturn totalSpec * mix(0.4, 1.0, luminance) + baseColor * diffuseIntensity;\n}\n#else // NOT USE_NORMAL_TEXTURE\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nreturn baseColor * totalIntensity;\n}\n#endif\n";
WALK.SHADERS["wireframe_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 lineColor;\nuniform float lineMaxAlpha;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarying vec3 vBaryCentric;\nfloat edgeFactor(){\nvec3 d = fwidth(vBaryCentric);\nvec3 r = smoothstep(vec3(0.0), d * 1.5, vBaryCentric);\nreturn min(min(r.x, r.y), r.z);\n}\nvoid main(void){\nfloat edge = edgeFactor();\nif (edge < 1.0) {\ngl_FragColor.rgb = lineColor;\ngl_FragColor.w = (1.0 - edge) * lineMaxAlpha;\n} else {\ngl_FragColor.rgb = highlight;\ngl_FragColor.w = highlightMix;\n}\n}\n";
WALK.SHADERS["wireframe_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nattribute float order;\nvarying vec3 vBaryCentric;\nvoid main() {\nif (order == 0.0) {\nvBaryCentric = vec3(1.0, 0.0, 0.0);\n} else if (order == 1.0) {\nvBaryCentric = vec3(0.0, 1.0, 0.0);\n} else {\nvBaryCentric = vec3(0.0, 0.0, 1.0);\n}\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";(function(){WALK.Shader=function(b,c){this.id=b;this.code=c};var a=0;WALK.InlineShader=function(b){WALK.Shader.call(this,"inline:"+a,b);a+=1};WALK.getShader=function(b){return new WALK.Shader(b,WALK.SHADERS[b])}})();(function(){var a=0,b=[0,0],c=Object.freeze({uv:b,uv2:b,uv2Mod:[0,0,1/65535,1/65535],t0:[1,0,0,0],t1:[0,1,0,0],t2:[0,0,1,0]}),d=Object.freeze("position sphericalNormal uv uv2 uv2Mod t0 t1 t2".split(" ")),f=new WALK.InlineShader("");WALK.BaseMaterial=function(g,e,k){k=void 0===k?f:k;a+=1;Object.defineProperty(this,"id",{value:a});this.name="";this.side=THREE.FrontSide;this.doNotOverrideSide=!1;this.opacity=1;this.transparent=!1;this.transparentRenderOrder=0;this.blending=THREE.NoBlending;this.blendSrc=
GLC.SRC_ALPHA;this.blendDst=GLC.ONE_MINUS_SRC_ALPHA;this.blendEquation=GLC.FUNC_ADD;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.colorWrite=this.depthWrite=this.depthTest=!0;this._hideFromLightProbes=!1;this._defines=new Set;this._definesString=null;this._textureLodExtension=this._standardDerivativesExtension=!1;this.uniforms={};this.attributes=d;this._vertexShaderBody=g;this._fragmentShaderBody=e;this._fragmentShaderHooks=k;this.defaultAttributeValues=c;this.index0AttributeName=
void 0;this._programNeedsUpdate=this.visible=!0;this.program=null};WALK.BaseMaterial.prototype={constructor:WALK.BaseMaterial,get isAnimated(){return!1},get isPlaying(){return!1},update:function(g){},play:function(){console.assert(!1)},pause:function(){console.assert(!1)},get hideFromLightProbes(){return this._hideFromLightProbes},set hideFromLightProbes(g){this._hideFromLightProbes=g},get programNeedsUpdate(){return this._programNeedsUpdate},set programNeedsUpdate(g){this._definesString=null;this._programNeedsUpdate=
g},hasDefine:function(g){return this._defines.has(g)},addDefine:function(g){this.hasDefine(g)||(this._defines.add(g),this.programNeedsUpdate=!0)},removeDefine:function(g){this.hasDefine(g)&&(this._defines.delete(g),this.programNeedsUpdate=!0)},condDefine:function(g,e){g?this.addDefine(e):this.removeDefine(e);return g},_getDefinesString:function(){if(null===this._definesString){for(var g=[],e=$jscomp.makeIterator(this._defines),k=e.next();!k.done;k=e.next())g.push("#define "+k.value);g.sort();this._definesString=
g.join("\n")}return this._definesString},generateProgramId:function(){return[this._fragmentShaderBody.id,this._fragmentShaderHooks.id,this._getDefinesString(),this._vertexShaderBody.id,this._standardDerivativesExtension?"+":"",this._textureLodExtension?"+":""].join("$")},enableStandardDerivativesExtension:function(){this._standardDerivativesExtension||(this.programNeedsUpdate=this._standardDerivativesExtension=!0)},enableTextureLodExtension:function(){this._textureLodExtension||(this.programNeedsUpdate=
this._textureLodExtension=!0)},generateVertexShader:function(){return["precision highp float;\nprecision highp int;",this._getDefinesString(),"uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec2 sphericalNormal;\nattribute vec2 uv;\nattribute vec2 uv2;\nattribute vec4 uv2Mod;\nattribute vec4 t0;\nattribute vec4 t1;\nattribute vec4 t2;",
this._vertexShaderBody.code].join("\n")},generateFragmentShader:function(){return[this._standardDerivativesExtension?"#extension GL_OES_standard_derivatives : enable":"",this._textureLodExtension?"#extension GL_EXT_shader_texture_lod : require":"","precision "+WALK.DETECTOR.fragmentPrecision+" float;","precision "+WALK.DETECTOR.fragmentPrecision+" int;",this._getDefinesString(),"uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;",this._fragmentShaderBody.code,this._fragmentShaderHooks.code].join("\n")},
dispose:function(){this.dispatchEvent({type:"dispose"})},setUniform:function(g,e,k){this.uniforms[g]={type:e,value:k}},propertyFromUniform:function(g){Object.defineProperty(this,g,{get:function(){return this.uniforms[g].value},set:function(e){this.uniforms[g].value=e}})},hash:function(){console.assert(!1,"hash not implemented")},canMerge:function(g){console.assert(!1,"canMerge not implemented")}};THREE.EventDispatcher.prototype.apply(WALK.BaseMaterial.prototype)})();(function(){WALK.CompressedTextureLoader=function(){this._parser=null};WALK.CompressedTextureLoader.prototype={constructor:WALK.CompressedTextureLoader,load:function(a,b,c,d){var f=this,g=[],e=new WALK.CompressedTexture;e.image=g;WALK.queueAjaxGet(a,b,!0,function(k){k=f._parser(k,!0);if(k.isCubemap)for(var h=k.mipmaps.length/k.mipmapCount,l=0;l<h;l+=1){g[l]={mipmaps:[]};for(var r=0;r<k.mipmapCount;r+=1)g[l].mipmaps.push(k.mipmaps[l*k.mipmapCount+r]),g[l].format=k.format,g[l].width=k.width,g[l].height=
k.height}else e.image.width=k.width,e.image.height=k.height,e.mipmaps=k.mipmaps;1===k.mipmapCount&&(e.minFilter=GLC.LINEAR);e.format=k.format;e.width=k.width;e.height=k.height;c&&c(e)},d);return e}}})();THREE.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:new WALK.InlineShader("void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),fragmentShader:new WALK.InlineShader("uniform sampler2D tDiffuse;\nuniform vec2 resolution;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec4 rgbA = (1.0/2.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));\nvec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));\nfloat lumaB = dot(rgbB, vec4(luma, 0.0));\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\ngl_FragColor = rgbA;\n} else {\ngl_FragColor = rgbB;\n}\n}")};THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:new WALK.InlineShader("varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),fragmentShader:new WALK.InlineShader("uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}")};THREE.EffectComposer=function(a){this.renderer=a;this.renderTarget2=this.renderTarget1=null;this.passes=[];void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader")};
THREE.EffectComposer.prototype={addPass:function(a){this.passes.push(a)},disposeTarget:function(){this.renderTarget1&&(this.renderTarget1.dispose(),this.renderTarget1=null);this.renderTarget2&&(this.renderTarget2.dispose(),this.renderTarget2=null)},configureTarget:function(a,b,c){this.disposeTarget();this.renderTarget1=this.renderer.createRenderTarget(a,b,c);this.renderTarget2=this.renderer.createRenderTarget(a,b,c)},render:function(){var a,b;return function(c){a=this.renderTarget1;b=this.renderTarget2;
var d,f=this.passes.length;for(d=0;d<f;d++){var g=this.passes[d];g.enabled&&(g.render(this.renderer,a,b,c),g.needsSwap&&d!=f-1&&(g=b,b=a,a=g))}}}()};THREE.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse";this.material=new WALK.BaseMaterial(a.vertexShader,a.fragmentShader);this.material.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.uniforms=this.material.uniforms;this.renderToScreen=!1;this.needsSwap=this.enabled=!0;this.clear=!1;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material);this.scene.add(this.quad)};
THREE.ShaderPass.prototype={render:function(a,b,c,d){if(d=this.material.uniforms[this.textureID])d.value=c;this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},dispose:function(){this.material.dispose();this.quad.geometry.dispose()}};THREE.RenderPass=function(a,b,c){this.scene=a;this.camera=b;this.overrideMaterial=c;this.needsSwap=this.clear=this.enabled=!0};THREE.RenderPass.prototype={render:function(a,b,c,d){c=this.scene.overrideMaterial;this.overrideMaterial&&(this.scene.overrideMaterial=this.overrideMaterial);a.render(this.scene,this.camera,b,this.clear);this.scene.overrideMaterial=c}};(function(a){function b(g){return!isNaN(g)&&isFinite(g)}function c(g,e){for(var k=0,h=g.length;k<h;k++)if(g[k]===e)return k;return-1}a.Octree=function(g){g=g||{};this.nodeCount=0;this.INDEX_INSIDE_CROSS=-1;this.INDEX_OUTSIDE_OFFSET=2;this.INDEX_OUTSIDE_POS_X=b(g.INDEX_OUTSIDE_POS_X)?g.INDEX_OUTSIDE_POS_X:0;this.INDEX_OUTSIDE_NEG_X=b(g.INDEX_OUTSIDE_NEG_X)?g.INDEX_OUTSIDE_NEG_X:1;this.INDEX_OUTSIDE_POS_Y=b(g.INDEX_OUTSIDE_POS_Y)?g.INDEX_OUTSIDE_POS_Y:2;this.INDEX_OUTSIDE_NEG_Y=b(g.INDEX_OUTSIDE_NEG_Y)?
g.INDEX_OUTSIDE_NEG_Y:3;this.INDEX_OUTSIDE_POS_Z=b(g.INDEX_OUTSIDE_POS_Z)?g.INDEX_OUTSIDE_POS_Z:4;this.INDEX_OUTSIDE_NEG_Z=b(g.INDEX_OUTSIDE_NEG_Z)?g.INDEX_OUTSIDE_NEG_Z:5;this.INDEX_OUTSIDE_MAP=[];this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0};
this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1};this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1;this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1;this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1;this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1;this.FLAG_POS_Z=
1<<this.INDEX_OUTSIDE_POS_Z+1;this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1;this.utilVec31Search=new a.Vector3;this.utilVec32Search=new a.Vector3;if(this.scene=g.scene)this.visualGeometry=new a.BoxBufferGeometry(1,1,1),this.visualGeometry.addTriangleOrderAttribute(),this.visualMaterial=new WALK.WireframeMaterial(new a.Color(65280));this.depthMax=b(g.depthMax)?g.depthMax:Infinity;this.objectsThreshold=b(g.objectsThreshold)?g.objectsThreshold:8;this.overlapPct=b(g.overlapPct)?g.overlapPct:.15;this.root=
new a.OctreeNode({tree:this,parent:null,position:new a.Vector3})};a.Octree.prototype={add:function(g,e,k){this.root.addObject(new a.OctreeObjectData(g,e,k))},search:function(g,e,k){var h,l=[];this.root.appendObjectsFromNode(l);0<e||(e=Number.MAX_VALUE);if(k instanceof a.Vector3){k=this.utilVec31Search.copy(k).normalize();var r=this.utilVec32Search.set(1,1,1).divide(k)}var q=0;for(h=this.root.nodesIndices.length;q<h;q++){var m=this.root.nodesByIndex[this.root.nodesIndices[q]];m.search(g,e,k,r,l)}return l},
setRoot:function(g){g instanceof a.OctreeNode&&(this.root=g,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};a.OctreeObjectData=function(g,e,k){this.object=g;e?(this.radius=k,this.position=e):(this.radius=this.object.geometry.boundingSphere.radius,this.position=this.object.geometry.boundingSphere.center)};
var d=new a.Vector3,f=new a.Vector3;new a.Vector3;a.OctreeNode=function(g){this.tree=g.tree;this.id=this.tree.nodeCount++;this.position=g.position;this.radius=0<g.radius?g.radius:1;this.indexOctant=g.indexOctant;this.depth=0;this.reset();this.setParent(g.parent);this.overlap=this.radius*this.tree.overlapPct;this.radiusOverlap=this.radius+this.overlap;this.left=this.position.x-this.radiusOverlap;this.right=this.position.x+this.radiusOverlap;this.bottom=this.position.y-this.radiusOverlap;this.top=this.position.y+
this.radiusOverlap;this.back=this.position.z-this.radiusOverlap;this.front=this.position.z+this.radiusOverlap;this.tree.scene&&(this.visual=new a.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual),this.tree.scene.updateMatrixWorld())};a.OctreeNode.prototype={setParent:function(g){g!==this&&this.parent!==g&&(this.parent=g,this.updateProperties())},
updateProperties:function(){var g;this.parent instanceof a.OctreeNode?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0;var e=0;for(g=this.nodesIndices.length;e<g;e++)this.nodesByIndex[this.nodesIndices[e]].updateProperties()},reset:function(g,e){var k,h=this.nodesIndices||[],l=this.nodesByIndex;this.objects=[];this.nodesIndices=[];this.nodesByIndex={};var r=0;for(k=h.length;r<k;r++){var q=l[h[r]];q.setParent(void 0);!0===g&&q.reset(g,e)}!0===e&&this.visual&&this.visual.parent&&
this.visual.parent.remove(this.visual)},addNode:function(g,e){g.indexOctant=e;-1===c(this.nodesIndices,e)&&this.nodesIndices.push(e);this.nodesByIndex[e]=g;g.parent!==this&&g.setParent(this)},removeNode:function(g){var e=c(this.nodesIndices,g);this.nodesIndices.splice(e,1);var k=k||this.nodesByIndex[g];delete this.nodesByIndex[g];k.parent===this&&k.setParent(void 0)},addObject:function(g){var e=this.getOctantIndex(g);-1<e&&0<this.nodesIndices.length?(e=this.branch(e),e.addObject(g)):-1>e&&this.parent instanceof
a.OctreeNode?this.parent.addObject(g):(e=c(this.objects,g),-1===e&&this.objects.push(g),g.node=this,this.checkGrow())},addObjectWithoutCheck:function(g){var e;var k=0;for(e=g.length;k<e;k++){var h=g[k];this.objects.push(h);h.node=this}},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&0<this.tree.objectsThreshold&&this.grow()},grow:function(){var g=[],e=[],k=[],h=[],l=[],r;var q=0;for(r=this.objects.length;q<r;q++){var m=this.objects[q];var u=this.getOctantIndex(m);-1<u?(k.push(m),
h.push(u)):-1>u?(g.push(m),e.push(u)):l.push(m)}0<k.length&&(l=l.concat(this.split(k,h)));0<g.length&&(l=l.concat(this.expand(g,e)));this.objects=l;this.checkMerge()},split:function(g,e){var k;if(this.depth<this.tree.depthMax){g=g||this.objects;e=e||[];var h=[];var l=0;for(k=g.length;l<k;l++){var r=g[l];var q=e[l];-1<q?(q=this.branch(q),q.addObject(r)):h.push(r)}g===this.objects&&(this.objects=h)}else h=this.objects;return h},branch:function(g){if(this.nodesByIndex[g]instanceof a.OctreeNode)var e=
this.nodesByIndex[g];else{e=.5*this.radiusOverlap;var k=e*this.tree.overlapPct;k=e-k;k=d.set(g&1?k:-k,g&2?k:-k,g&4?k:-k);k=(new a.Vector3).addVectors(this.position,k);e=new a.OctreeNode({tree:this.tree,parent:this,position:k,radius:e,indexOctant:g});this.addNode(e,g)}return e},expand:function(g,e){var k,h=this.tree.INDEX_OUTSIDE_MAP;if(this.tree.root.getDepthEnd()<this.tree.depthMax){g=g||this.objects;e=e||[];var l=[];var r=[];var q=0;for(k=h.length;q<k;q++)h[q].count=0;q=0;for(k=g.length;q<k;q++){var m=
g[q];var u=e[q];-1>u?(u=-u-this.tree.INDEX_OUTSIDE_OFFSET,u&this.tree.FLAG_POS_X?h[this.tree.INDEX_OUTSIDE_POS_X].count++:u&this.tree.FLAG_NEG_X&&h[this.tree.INDEX_OUTSIDE_NEG_X].count++,u&this.tree.FLAG_POS_Y?h[this.tree.INDEX_OUTSIDE_POS_Y].count++:u&this.tree.FLAG_NEG_Y&&h[this.tree.INDEX_OUTSIDE_NEG_Y].count++,u&this.tree.FLAG_POS_Z?h[this.tree.INDEX_OUTSIDE_POS_Z].count++:u&this.tree.FLAG_NEG_Z&&h[this.tree.INDEX_OUTSIDE_NEG_Z].count++,r.push(m)):l.push(m)}if(0<r.length){var n=h.slice(0);n.sort(function(y,
C){return C.count-y.count});u=n[0];q=u.index|1;m=n[1];h=n[2];e=(m.index|1)!==q?m:h;k=e.index|1;m=n[2];h=n[3];n=n[4];var w=m.index|1;var v=h.index|1;m=w!==q&&w!==k?m:v!==q&&v!==k?h:n;q=u.x+e.x+m.x;k=u.y+e.y+m.y;e=u.z+e.z+m.z;u=this.getOctantIndexFromPosition(q,k,e);e=this.getOctantIndexFromPosition(-q,-k,-e);k=this.overlap;m=this.radius;q=0<this.tree.overlapPct?k/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*m;h=q*this.tree.overlapPct;k=q+h-(m+k);f.set(u&1?k:-k,u&2?k:-k,u&4?k:-k);u=(new a.Vector3).addVectors(this.position,
f);u=new a.OctreeNode({tree:this.tree,position:u,radius:q});u.addNode(this,e);this.tree.setRoot(u);q=0;for(k=r.length;q<k;q++)this.tree.root.addObject(r[q])}g===this.objects&&(this.objects=l)}else l=g;return l},shrink:function(){this.checkMerge();this.tree.root.checkContract()},checkMerge:function(){for(var g=this,e;g.parent instanceof a.OctreeNode&&g.getObjectCountEnd()<this.tree.objectsThreshold;)e=g,g=g.parent;g!==this&&g.merge(e)},merge:function(g){var e;g=g?"[object Array]"===Object.prototype.toString.call(g)!==
!0?[g]:g:[];var k=0;for(e=g.length;k<e;k++){var h=g[k];this.addObjectWithoutCheck(h.getObjectsEnd());h.reset(!0,!0);this.removeNode(h.indexOctant,h)}this.checkMerge()},checkContract:function(){var g;if(0<this.nodesIndices.length){var e=0;var k=this.objects.length;var h=0;for(g=this.nodesIndices.length;h<g;h++){var l=this.nodesByIndex[this.nodesIndices[h]];var r=l.getObjectCountEnd();k+=r;if(!1===q instanceof a.OctreeNode||r>e){var q=l;e=r}}k-e<this.tree.objectsThreshold&&q instanceof a.OctreeNode&&
this.contract(q)}},contract:function(g){var e;var k=0;for(e=this.nodesIndices.length;k<e;k++){var h=this.nodesByIndex[this.nodesIndices[k]];h!==g&&(g.addObjectWithoutCheck(h.getObjectsEnd()),h.reset(!0,!0))}g.addObjectWithoutCheck(this.objects);this.reset(!1,!0);this.tree.setRoot(g);g.checkContract()},getOctantIndex:function(g){var e=this.position,k=this.radiusOverlap,h=this.overlap,l=0;if(g instanceof a.OctreeObjectData){var r=g.radius;var q=g.position}else g instanceof a.OctreeNode&&(q=g.position,
r=0);var m=q.x-e.x;var u=q.y-e.y;q=q.z-e.z;e=Math.abs(m);var n=Math.abs(u);var w=Math.abs(q);if(Math.max(e,n,w)+r>k)return e+r>k&&(l^=0<m?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),n+r>k&&(l^=0<u?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),w+r>k&&(l^=0<q?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),g.indexOctant=-l-this.tree.INDEX_OUTSIDE_OFFSET,g.indexOctant;if(m-r>-h)l|=1;else if(!(m+r<h))return g.indexOctant=this.tree.INDEX_INSIDE_CROSS,g.indexOctant;if(u-r>-h)l|=2;else if(!(u+r<h))return g.indexOctant=
this.tree.INDEX_INSIDE_CROSS,g.indexOctant;if(q-r>-h)l|=4;else if(!(q+r<h))return g.indexOctant=this.tree.INDEX_INSIDE_CROSS,g.indexOctant;g.indexOctant=l;return g.indexOctant},getOctantIndexFromPosition:function(g,e,k){var h=0;0<g&&(h|=1);0<e&&(h|=2);0<k&&(h|=4);return h},appendObjectsFromNode:function(g){var e,k=this.objects;var h=0;for(e=k.length;h<e;h+=1)g.push(k[h].object)},search:function(g,e,k,h,l){var r;if(!0===this.intersectRay(g,k,e,h)){this.appendObjectsFromNode(l);var q=0;for(r=this.nodesIndices.length;q<
r;q++){var m=this.nodesByIndex[this.nodesIndices[q]];m.search(g,e,k,h,l)}}},intersectRay:function(g,e,k,h){e=(this.left-g.x)*h.x;var l=(this.right-g.x)*h.x,r=(this.bottom-g.y)*h.y,q=(this.top-g.y)*h.y,m=(this.back-g.z)*h.z;h=(this.front-g.z)*h.z;g=Math.min(Math.min(Math.max(e,l),Math.max(r,q)),Math.max(m,h));if(0>g)return!1;e=Math.max(Math.max(Math.min(e,l),Math.min(r,q)),Math.min(m,h));return e>g||e>k?!1:!0},getDepthEnd:function(g){var e;if(0<this.nodesIndices.length){var k=0;for(e=this.nodesIndices.length;k<
e;k++){var h=this.nodesByIndex[this.nodesIndices[k]];g=h.getDepthEnd(g)}}else g=!g||this.depth>g?this.depth:g;return g},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var g,e=this.nodesIndices.length;var k=0;for(g=this.nodesIndices.length;k<g;k++)e+=this.nodesByIndex[this.nodesIndices[k]].getNodeCountRecursive();return e},getObjectsEnd:function(g){var e;g=(g||[]).concat(this.objects);var k=0;for(e=this.nodesIndices.length;k<e;k++){var h=
this.nodesByIndex[this.nodesIndices[k]];g=h.getObjectsEnd(g)}return g},getObjectCountEnd:function(){var g,e=this.objects.length;var k=0;for(g=this.nodesIndices.length;k<g;k++)e+=this.nodesByIndex[this.nodesIndices[k]].getObjectCountEnd();return e},getObjectCountStart:function(){for(var g=this.objects.length,e=this.parent;e instanceof a.OctreeNode;)g+=e.objects.length,e=e.parent;return g},toConsole:function(g){var e;g="string"===typeof g?g:"   ";console.log(this.parent?g+" octree NODE > ":" octree ROOT > ",
this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth);console.log(this.parent?g+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects);console.log(this.parent?g+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex);var k=0;for(e=this.nodesIndices.length;k<e;k++){var h=this.nodesByIndex[this.nodesIndices[k]];h.toConsole(g+"   ")}}}})(THREE);THREE.PolyhedronBufferGeometry=function(a,b,c,d){function f(l){k.push(l.x,l.y,l.z)}function g(l,r){l*=3;r.x=a[l+0];r.y=a[l+1];r.z=a[l+2]}function e(l,r,q,m){0>m&&1===l.x&&(h[r]=l.x-1);0===q.x&&0===q.z&&(h[r]=m/2/Math.PI+.5)}THREE.BufferGeometry.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;var k=[],h=[];(function(l){for(var r=new THREE.Vector3,q=new THREE.Vector3,m=new THREE.Vector3,u=0;u<b.length;u+=3){g(b[u+0],r);g(b[u+1],
q);g(b[u+2],m);var n,w,v=r,y=q,C=m,A=Math.pow(2,l),I=[];for(w=0;w<=A;w++){I[w]=[];var D=v.clone().lerp(C,w/A),E=y.clone().lerp(C,w/A),O=A-w;for(n=0;n<=O;n++)I[w][n]=0===n&&w===A?D:D.clone().lerp(E,n/O)}for(w=0;w<A;w++)for(n=0;n<2*(A-w)-1;n++)v=Math.floor(n/2),0===n%2?(f(I[w][v+1]),f(I[w+1][v]),f(I[w][v])):(f(I[w][v+1]),f(I[w+1][v+1]),f(I[w+1][v]))}})(d);(function(l){for(var r=new THREE.Vector3,q=0;q<k.length;q+=3)r.x=k[q+0],r.y=k[q+1],r.z=k[q+2],r.normalize().multiplyScalar(l),k[q+0]=r.x,k[q+1]=r.y,
k[q+2]=r.z})(c);(function(){for(var l=new THREE.Vector3,r=0;r<k.length;r+=3)l.x=k[r+0],l.y=k[r+1],l.z=k[r+2],h.push(Math.atan2(l.z,-l.x)/2/Math.PI+.5,1-(Math.atan2(-l.y,Math.sqrt(l.x*l.x+l.z*l.z))/Math.PI+.5));l=new THREE.Vector3;r=new THREE.Vector3;for(var q=new THREE.Vector3,m=new THREE.Vector3,u=new THREE.Vector2,n=new THREE.Vector2,w=new THREE.Vector2,v=0,y=0;v<k.length;v+=9,y+=6){l.set(k[v+0],k[v+1],k[v+2]);r.set(k[v+3],k[v+4],k[v+5]);q.set(k[v+6],k[v+7],k[v+8]);u.set(h[y+0],h[y+1]);n.set(h[y+
2],h[y+3]);w.set(h[y+4],h[y+5]);m.copy(l).add(r).add(q).divideScalar(3);var C=Math.atan2(m.z,-m.x);e(u,y+0,l,C);e(n,y+2,r,C);e(w,y+4,q,C)}for(l=0;l<h.length;l+=6)r=h[l+0],q=h[l+2],m=h[l+4],u=Math.min(r,q,m),.9<Math.max(r,q,m)&&.1>u&&(.2>r&&(h[l+0]+=1),.2>q&&(h[l+2]+=1),.2>m&&(h[l+4]+=1))})();this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(k),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(k.slice()),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(h),
2));0===d?this.computeVertexNormals():this.normalizeNormals()};THREE.PolyhedronBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PolyhedronBufferGeometry.prototype.constructor=THREE.PolyhedronBufferGeometry;THREE.IcosahedronBufferGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronBufferGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}};THREE.IcosahedronBufferGeometry.prototype=Object.create(THREE.PolyhedronBufferGeometry.prototype);
THREE.IcosahedronBufferGeometry.prototype.constructor=THREE.IcosahedronBufferGeometry;(function(){WALK.ColorUtils={linearToGamma:function(a){return.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055},gammaToLinear:function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},hdrEncode:function(a,b){var c=Math.sqrt(a.r)/2.82842712,d=Math.sqrt(a.g)/2.82842712;a=Math.sqrt(a.b)/2.82842712;var f=Math.max(Math.max(c,d),a);f=THREE.Math.clamp(f,1/255,1);f=Math.ceil(255*f)/255;b.setRGB(c/f,d/f,a/f);return 1-f}};THREE.Color.prototype.copyGammaToLinear=void 0;THREE.Color.prototype.copyLinearToGamma=
void 0;THREE.Color.prototype.convertLinearToGamma=void 0;THREE.Color.prototype.convertGammaToLinear=function(){this.r=WALK.ColorUtils.gammaToLinear(this.r);this.g=WALK.ColorUtils.gammaToLinear(this.g);this.b=WALK.ColorUtils.gammaToLinear(this.b)};THREE.Color.prototype.roundChannels=function(){this.r=WALK.round(this.r,3);this.g=WALK.round(this.g,3);this.b=WALK.round(this.b,3);return this}})();/*
 Copyright (C) 2017-present Shapespark
*/
(function(){var a=new THREE.Vector3;WALK.Math={toSnorm8:function(b){return Math.round(127*THREE.Math.clamp(b,-1,1))},minBytesToHold:function(b){return 127>=b?1:32767>=b?2:4},anyPositiveRootOfQuadraticEquation:function(b,c,d){d=c*c-4*b*d;if(0>d)return null;d=Math.sqrt(d);var f=(-c-d)/(2*b);if(0<f)return f;b=(-c+d)/(2*b);return 0<b?b:null},spheresUnion:function(b,c){if(c.empty())c.copy(b);else{var d=c.center.distanceTo(b.center);if(b.radius>c.radius){var f=b;b=c}else f=c;var g=(f.radius+b.radius+d)/
2;g<=f.radius?c.copy(f):(d=(g-f.radius)/d,console.assert(0<d),a.copy(b.center).sub(f.center).multiplyScalar(d),c.center.copy(f.center).add(a),c.radius=g)}}}})();(function(){WALK.Euler=function(a,b,c){THREE.Euler.call(this,b,c,a,"ZXY")};WALK.Euler.prototype=Object.create(THREE.Euler.prototype);WALK.Euler.prototype.constructor=WALK.Euler;Object.defineProperty(WALK.Euler.prototype,"yaw",{get:function(){return this.z},set:function(a){this.z=a}});Object.defineProperty(WALK.Euler.prototype,"pitch",{get:function(){return this.x},set:function(a){this.x=a}});Object.defineProperty(WALK.Euler.prototype,"roll",{get:function(){return this.y},set:function(a){this.y=a}});
Object.defineProperty(WALK.Euler.prototype,"yawDeg",{get:function(){return THREE.Math.radToDeg(this.yaw)},set:function(a){this.yaw=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"pitchDeg",{get:function(){return THREE.Math.radToDeg(this.pitch)},set:function(a){this.pitch=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"rollDeg",{get:function(){return THREE.Math.radToDeg(this.roll)},set:function(a){this.roll=THREE.Math.degToRad(a)}});WALK.Euler.prototype.setFromDegTriple=
function(a){var b=THREE.Math.degToRad(a[0]),c=THREE.Math.degToRad(a[1]);a=THREE.Math.degToRad(a[2]);this.set(c,a,b);return this};WALK.Euler.prototype.toDegTriple=function(){return[this.yawDeg,this.pitchDeg,this.rollDeg]};WALK.Euler.prototype.setFromDirection=function(a){this.set(Math.asin(a.z),0,Math.atan2(-a.x,a.y));return this};WALK.Euler.prototype.toQuaternion=function(){var a=new THREE.Quaternion;a.setFromEuler(this);return a};WALK.Euler.prototype.toRotationMatrix=function(){var a=new THREE.Matrix4;
a.makeRotationFromEuler(this);return a}})();(function(){var a=new THREE.Sphere;WALK.Frustum=function(){this.planes=[new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane]};WALK.Frustum.prototype={constructor:WALK.Frustum,setFromMatrix:function(b){var c=this.planes,d=b.elements;b=d[0];var f=d[1],g=d[2],e=d[3],k=d[4],h=d[5],l=d[6],r=d[7],q=d[8],m=d[9],u=d[10],n=d[11],w=d[12],v=d[13],y=d[14];d=d[15];c[0].setComponents(e-b,r-k,n-q,d-w).normalize();c[1].setComponents(e+b,r+k,n+q,d+w).normalize();c[2].setComponents(e+
f,r+h,n+m,d+v).normalize();c[3].setComponents(e-f,r-h,n-m,d-v).normalize();c[4].setComponents(e-g,r-l,n-u,d-y).normalize();c[5].setComponents(e+g,r+l,n+u,d+y).normalize();return this},intersectsObject:function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();b.matrixWorld?(a.copy(c.boundingSphere),a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return this.intersectsSphere(b)},nearPlaneDistanceToCenter:function(b){var c=b.geometry,d=this.planes[5];b.matrixWorld?(a.copy(c.boundingSphere),
a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return d.distanceToPoint(b.center)},intersectsSphere:function(b){var c=this.planes,d=b.center;b=-b.radius;for(var f=0;6>f;f+=1)if(c[f].distanceToPoint(d)<b)return!1;return!0},intersectsBox:function(){var b=new THREE.Vector3,c=new THREE.Vector3;return function(d){for(var f=this.planes,g=0;6>g;g+=1){var e=f[g];b.x=0<e.normal.x?d.min.x:d.max.x;c.x=0<e.normal.x?d.max.x:d.min.x;b.y=0<e.normal.y?d.min.y:d.max.y;c.y=0<e.normal.y?d.max.y:d.min.y;b.z=0<
e.normal.z?d.min.z:d.max.z;c.z=0<e.normal.z?d.max.z:d.min.z;var k=e.distanceToPoint(b);e=e.distanceToPoint(c);if(0>k&&0>e)return!1}return!0}}(),containsPoint:function(b){for(var c=this.planes,d=0;6>d;d+=1)if(0>c[d].distanceToPoint(b))return!1;return!0}}})();(function(){function a(){var b=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return b?parseInt(b[2],10):!1}WALK.Detector=function(b){function c(h){var l=e[h];if(void 0!==l)return l;switch(h){case "EXT_texture_filter_anisotropic":l=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":l=b.getExtension("WEBGL_compressed_texture_s3tc")||b.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||
b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":l=b.getExtension("WEBGL_compressed_texture_pvrtc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":l=b.getExtension("WEBGL_compressed_texture_etc1");break;default:l=b.getExtension(h)}return e[h]=l}function d(h){var l=b.createTexture();b.bindTexture(b.TEXTURE_2D,l);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,2,2,0,b.RGBA,h,null);b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);h=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,h);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,l,0);var r=b.checkFramebufferStatus(b.FRAMEBUFFER)===b.FRAMEBUFFER_COMPLETE;b.deleteTexture(l);b.deleteFramebuffer(h);b.bindTexture(b.TEXTURE_2D,null);b.bindFramebuffer(b.FRAMEBUFFER,null);return r}function f(h,l){h=h.toLowerCase();l=l.toLowerCase();return-1!==h.indexOf(l)}function g(h){return navigator&&
navigator.userAgent?f(navigator.userAgent,h):!1}var e={};this.extension=c;this.https="https:"===window.location.protocol;this.localhost=WALK.isLocalhost();this.ipad=/iPad/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;this.mobile=/mobile|ip(hone|od)|android|silk/i.test(navigator.userAgent)||this.ipad||WALK.urlHashContains("mobile");this.ios=/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||this.ipad;this.android=/Android/.test(navigator.userAgent);
this.inCrossOriginIframe=function(){var h=window.self!==window.top,l=WALK.getOriginFromUrl(document.referrer),r=WALK.getOriginFromUrl(window.location.href);return h&&l!==r}();this.antialiasNative=b.getContextAttributes().antialias&&1<b.getParameter(b.SAMPLES);this.antialiasSamples=b.getParameter(b.SAMPLES);this.antialiasPostprocess=!this.mobile;this.floatTextures=c("OES_texture_float");this.floatTexturesInterpolate=c("OES_texture_float_linear");this.halfFloatTextures=c("OES_texture_half_float");this.halfFloatTexturesInterpolate=
c("OES_texture_half_float_linear");this.standardDerivatives=c("OES_standard_derivatives");this.maxAnisotropy=function(){var h=c("EXT_texture_filter_anisotropic");return null!==h?b.getParameter(h.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}();this.indexUint=c("OES_element_index_uint");this.instances=c("ANGLE_instanced_arrays");this.fragmentPrecision=void 0===b.getShaderPrecisionFormat||0<b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT).precision?"highp":0<b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,
b.MEDIUM_FLOAT).precision?"mediump":"lowp";var k=4096>b.getParameter(b.MAX_TEXTURE_SIZE)?"Your graphics card does not have sufficient capabilities, texture sizes 4096x4096 need to be supported.":null;this.missingCapabilities=k;this.maxRenderBufferSize=b.getParameter(b.MAX_RENDERBUFFER_SIZE);k=this.floatTextures?d(b.FLOAT):!1;this.floatTargets=k;k=this.halfFloatTextures?d(this.halfFloatTextures.HALF_FLOAT_OES):!1;this.dynamicLights=(this.halfFloatTargets=k)&&this.floatTargets&&this.halfFloatTexturesInterpolate;
this.dxtTextures=function(){try{if(WALK.urlHashContains("nodxt"))return!1;for(var h=c("WEBGL_compressed_texture_s3tc"),l=b.getParameter(b.COMPRESSED_TEXTURE_FORMATS),r=!1,q=!1,m=0;m<l.length;m+=1)r=r||l[m]===h.COMPRESSED_RGB_S3TC_DXT1_EXT,q=q||l[m]===h.COMPRESSED_RGBA_S3TC_DXT5_EXT;return r&&q}catch(u){}return!1}();k=WALK.urlHashContains("nopvr")?!1:c("WEBGL_compressed_texture_pvrtc");this.pvrtcTextures=k;k=WALK.urlHashContains("noetc1")?!1:c("WEBGL_compressed_texture_etc1")&&this.mobile;this.etc1Textures=
k;this.astcTextures=!1;this.firefox=g("firefox");this.opera=g("opera")||g("OPR/");this.ie=g("msie")||(navigator&&navigator.appVersion?f(navigator.appVersion,"trident/"):!1);this.edge=g("edge/");this.safari=g("safari/")&&!(g("chrome/")||g("chromium/"));this.mac=g("macintosh")&&!this.ipad;this.BASIS_DECODE_WORKERS=this.safari||this.ios?0:Math.min(4,navigator.hardwareConcurrency||4);this.textureLod=c("EXT_shader_texture_lod")&&(!this.firefox||!this.android);this.mirrorCubeMaps=!this.mobile||WALK.urlHashContains("mobilehi");
this.disableTextureSlotReuse=this.mac||83===a();this.reportToConsole=function(){WALK.log("Using "+this.fragmentPrecision+" fragment precision.");this.dxtTextures||WALK.log("DXT textures not supported.");this.textureLod||WALK.log("Texture fetch level of detail not supported.");this.floatTextures?(this.floatTexturesInterpolate||WALK.log("Float textures interpolation not supported."),this.floatTargets||WALK.log("Float render targets not supported")):WALK.log("Float textures not supported.");this.halfFloatTextures?
(this.halfFloatTexturesInterpolate||WALK.log("Half float textures interpolation not supported."),this.halfFloatTargets||WALK.log("Half float render targets not supported")):WALK.log("Half float textures not supported");this.antialiasNative?WALK.log("Native anti-aliasing supported with "+this.antialiasSamples+" samples."):WALK.log("Native anti-aliasing not supported");this.disableTextureSlotReuse&&WALK.log("WebGL texture slot reuse disabled.");this.indexUint||WALK.log("Uint index not supported");this.instances||
WALK.log("Instanced geometry not supported")}}})();(function(){WALK.Viewer=function(a,b,c){function d(){return null}function f(L){c.isMaterialEditable(L)||console.assert(!1,"Can't access material, call ViewerApi.setMaterialEditable('"+L+"') before the scene is loaded.")}function g(){for(var L=[],pa=$jscomp.makeIterator(ha.materials),ca=pa.next();!ca.done;ca=pa.next())ca=ca.value,c.isMaterialEditable(ca.name)&&L.push(ca);return L}function e(){for(var L=[],pa=$jscomp.makeIterator(ha.nodeConfigs),ca=pa.next();!ca.done;ca=pa.next())ca=ca.value,c.isNodeTypeEditable(ca.name)&&
L.push(ca.name);return L}function k(L){f(L);for(var pa=$jscomp.makeIterator(ha.materials),ca=pa.next();!ca.done;ca=pa.next())if(ca=ca.value,ca.name===L)return ca;return null}function h(){ia.copy(F.cameraWorldPosition());return ia}function l(){V.yaw=F.getYawAngle();V.pitch=F.getPitchAngle();V.roll=0;return V}function r(){return ha.boundingBox}function q(L){var pa=[];f(L);for(var ca=$jscomp.makeIterator(ha.gpuMeshes),Aa=ca.next();!Aa.done;Aa=ca.next())Aa=Aa.value,Aa.material.name===L&&pa.push(Aa);return pa}
function m(L){return(L=ha.findNodeConfig(L))?L.nodes.slice(0):[]}function u(L,pa){pa.material=L;ya.requestFrame()}function n(L,pa){console.warn("setMaterialForNode() is deprecated, use setMaterialForMesh() instead");u(L,pa)}function w(L,pa,ca){var Aa;(Aa="string"===typeof L?ha.findViewByName(L):L)?(!0===pa?pa=0:!1===pa&&(pa=void 0),Z.isRunning()&&(pa=0,Z.stop()),ca?(J.activateSky(Aa),J.updateHiddenMeshes(Aa)):J.switchToView(Aa,pa)):console.error("Unknown view: "+L)}function v(L){L=void 0===L?{}:L;
var pa=L.isPanorama||!1,ca=L.width||(pa?4E3:window.innerWidth),Aa=L.height||(pa?2E3:window.innerHeight);if(L.toDataUrl)return ma.screenToDataUrl(pa,ca,Aa);ma.screenToLocalImage(pa,ca,Aa)}function y(L){ha.addAuxiliaryObject(L);L!==L.colliderMesh&&qa.uploadNewBuffers(L.colliderMesh);M.addDynamicObstacle(L.colliderMesh)}function C(L,pa){for(var ca=[],Aa=1;Aa<arguments.length;++Aa)ca[Aa-1]=arguments[Aa];try{return L.apply(null,$jscomp.arrayFromIterable(ca))}catch(Ca){console.error(Ca)}return!1}function A(L,
pa){for(var ca=[],Aa=1;Aa<arguments.length;++Aa)ca[Aa-1]=arguments[Aa];if(L){Aa=$jscomp.makeIterator(L);for(var Ca=Aa.next();!Ca.done;Ca=Aa.next())C.apply(null,[Ca.value].concat($jscomp.arrayFromIterable(ca)))}}function I(){R=!0;A(ra.pageFirstInteraction);ra.pageFirstInteraction=[];document.removeEventListener("mousedown",I);document.removeEventListener("touchend",I);document.removeEventListener("keydown",I)}function D(L,pa){L=new WALK.Anchor(ha,L);za.push(L);xa&&y(L);ra.anchorClicked[L.colliderMesh.id]=
pa;ka=!0;ya.requestFrame();return L}function E(L){delete ra.anchorClicked[L.colliderMesh.id];xa&&(ha.removeAuxiliaryObject(L),M.removeDynamicObstacle(L.colliderMesh));WALK.removeFromArray(L,za);L.dispose();ya.requestFrame()}function O(L,pa){L=new WALK.Avatar(ha,L,pa);Da.push(L);ha.addAuxiliaryObject(L,!0);A(ra.avatarListChanged);ya.requestFrame();return L}function S(L){ha.removeAuxiliaryObject(L);WALK.removeFromArray(L,Da);L.dispose();A(ra.avatarListChanged);ya.requestFrame()}function W(L){return WALK.find(Da,
function(pa){return pa.uuid===L})}function U(){for(var L=$jscomp.makeIterator(ha.getAnimatedMaterials()),pa=L.next();!pa.done;pa=L.next())pa.value.sleepAnimation()}function va(){for(var L=$jscomp.makeIterator(ha.getAnimatedMaterials()),pa=L.next();!pa.done;pa=L.next())pa.value.wakeAnimation();ya.requestFrame()}function ta(L,pa){var ca=L[pa];if(ca)return ca;ca=[];return L[pa]=ca}var qa,ha=null,F,J,Z,M,ma,ea,ya,Q,fa,K,R=!1,ka=!1,ba=!1,ja=null,na=null,ra={pageFirstInteraction:[],viewerConfigLoaded:[],
sceneReadyToDisplay:[],sceneLoadComplete:[],anchorClicked:{},materialPickerClicked:{},nodeTypeClicked:{},anyNodeTypeClicked:[],materialClicked:{},materialHoverChanged:{},viewSwitchStarted:[],viewSwitchDone:[],vrChange:[],beforeRender:[],anchorsVisibilityChanged:[],apiUserStateChanged:{},anyApiUserStateChanged:[],meetingJoined:[],avatarListChanged:[]},za=[],Da=[],ia=new THREE.Vector3,V=new WALK.Euler;document.addEventListener("mousedown",I);document.addEventListener("touchend",I);document.addEventListener("keydown",
I);var xa=!0;Object.defineProperty(this,"anchorsVisible",{get:function(){return xa},set:function(L){L!==xa&&((xa=L)?za.forEach(function(pa){return y(pa)}):za.forEach(function(pa){ha.removeAuxiliaryObject(pa);M.removeDynamicObstacle(pa.colliderMesh)}),this.requestFrame(),A(ra.anchorsVisibilityChanged,xa))}});var Ea=function(){function L($a,cb,wb){ca.set($a.x,$a.y,Ma.z).sub(Ma);$a=ca.length();$a>cb&&(ca.normalize().multiplyScalar($a-cb),wb.add(ca))}var pa=new THREE.Vector3,ca=new THREE.Vector3,Aa=new THREE.Vector3,
Ca=new WALK.View,Oa=new THREE.Sphere,Ma;return function($a){Ma=F.cameraWorldPosition();var cb=Ca.position;cb.copy(Ma);$a instanceof WALK.LightInstance&&"sun"===$a.light.type?(WALK.sunRotationToPosition(ha,$a.rotation,pa),$a=pa):$a instanceof WALK.Node?(WALK.computeNodeBoundingSphere($a,Oa),$a=Oa.center,L($a,1+Oa.radius,cb)):($a=$a.position,L($a,1,cb));Aa.copy($a).sub(cb).normalize();Ca.rotation.setFromDirection(Aa);J.switchToView(Ca)}}();this.openMaterialPicker=function(L,pa,ca,Aa){ja=new WALK.MaterialPicker(L,
ca,Aa,ha,F,ea,fa);ja.meshes.forEach(function(Ca){ha.addAuxiliaryObject(Ca);M.addDynamicObstacle(Ca);ra.materialPickerClicked[Ca.id]=pa});ya.requestFrame()};this._vrChange=function(L){A(ra.vrChange,L)};this._update=function(L){A(ra.beforeRender,L)};this._clickListener=function(L,pa,ca){if(!ka)return!1;if(ja){var Aa=ra.materialPickerClicked[L.id];if(Aa)return C(Aa,L.material,ja.meshes.indexOf(L)),!0;ja.meshes.forEach(function(Oa){ha.removeAuxiliaryObject(Oa);M.removeDynamicObstacle(Oa);delete ra.materialPickerClicked[Oa.id]});
ya.requestFrame();ja.dispose();ja=null;return!0}if(Aa=ra.anchorClicked[L.id])return C(Aa,L.anchor,pa,ca),!0;Aa=function(Oa,Ma){if(Oa){Oa=$jscomp.makeIterator(Oa);for(var $a=Oa.next();!$a.done;$a=Oa.next())if(C($a.value,Ma,pa,ca))return!0}return!1};for(var Ca=L.node;Ca;){if(Aa(ra.nodeTypeClicked[Ca.config.name],L.node))return!0;Ca=Ca.parent}return L.node&&Aa(ra.anyNodeTypeClicked,L.node)?!0:L.material?Aa(ra.materialClicked[L.material.name],L.material):!1};this._createHoverListener=function(){var L=
ra.materialHoverChanged,pa=[];return 0===Object.keys(L).length?null:function(ca,Aa){if(ca.material)for(var Ca=$jscomp.makeIterator(L[ca.material.name]||pa),Oa=Ca.next();!Oa.done;Oa=Ca.next())if(C(Oa.value,ca.material,Aa))return!0;return!1}};this._teleportStarted=function(L){L=L.view;null!==L&&A(ra.viewSwitchStarted,L.name,L)};this._teleportDone=function(L){L=L.view;null!==L&&A(ra.viewSwitchDone,L.name,L)};this._viewerConfigLoaded=function(L){Q=L;A(ra.viewerConfigLoaded,Q);ra.viewerConfigLoaded=[]};
this._sceneReadyToDisplay=function(L,pa,ca,Aa,Ca,Oa,Ma,$a,cb,wb,xb){qa=L;ha=pa;F=ca;J=Aa;Z=Ca;M=Oa;ma=Ma;ea=$a;fa=cb;K=wb;ya=xb;this.getEditableMaterials=g;this.getEditableNodeTypes=e;this.findMaterial=k;this.findMeshesWithMaterial=q;this.findNodesOfType=m;this.getCameraPosition=h;this.getCameraRotation=l;this.getSceneBoundingBox=r;this.setMaterialForNode=n;this.setMaterialForMesh=u;this.switchToView=w;this.captureImage=v;this.addAnchor=D;this.removeAnchor=E;this.addAvatar=O;this.removeAvatar=S;this.findAvatar=
W;this.seeItem=Ea;this.sleepAnimatedMaterials=U;this.wakeAnimatedMaterials=va;A(ra.sceneReadyToDisplay,ha);ra.sceneReadyToDisplay=[];J.addEventListener("teleportStarted",this._teleportStarted.bind(this));J.addEventListener("teleportDone",this._teleportDone.bind(this))};this._contextLost=function(){ba=!1;Q=ha=J=Z=M=ma=K=ya=null;this.wakeAnimatedMaterials=this.sleepAnimatedMaterials=this.findAvatar=this.removeAnchor=this.addAvatar=this.addAnchor=this.captureImage=this.switchToView=this.setMaterialForMesh=
this.setMaterialForNode=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d};this._sceneLoadComplete=function(){A(ra.sceneLoadComplete);ra.sceneLoadComplete=[];ba=!0;for(var L=$jscomp.makeIterator(za),pa=L.next();!pa.done;pa=L.next())pa.value.enableLightProbe()};this.openUrl=function(L,pa){pa||a?window.open(L):window.location.href=L};this.onPageFirstInteraction=function(L){R?L():ra.pageFirstInteraction.push(L)};this.onViewerConfigLoaded=
function(L){Q?L(Q):ra.viewerConfigLoaded.push(L)};this.isSceneReadyToDisplay=function(){return null!==ha};this.onSceneReadyToDisplay=function(L){ha?L(ha):ra.sceneReadyToDisplay.push(L)};this.onSceneLoadComplete=function(L){ba?L(ha):ra.sceneLoadComplete.push(L)};this.requestFrame=function(){ya&&ya.requestFrame()};this.setNodeTypeEditable=function(L){console.assert(null===ha,"setNodeTypeEditable must be called before the scene is loaded");c.setNodeTypeEditable(L)};this.setMaterialEditable=function(L){console.assert(null===
ha,"setMaterialEditable must be called before the scene is loaded");c.setMaterialEditable(L)};this.setAllMaterialsEditable=function(){console.assert(null===ha,"setAllMaterialsEditable must be called before the scene is loaded");c.setAllMaterialsEditable()};this.onNodeTypeClicked=function(L,pa){"function"===typeof L?ra.anyNodeTypeClicked.push(L):ta(ra.nodeTypeClicked,L).push(pa);ka=!0};this.removeOnNodeTypeClicked=function(L,pa){"function"===typeof L?WALK.removeFromArray(L,ra.anyNodeTypeClicked):WALK.removeFromArray(pa,
ra.nodeTypeClicked[L])};this.onMaterialClicked=function(L,pa){this.setMaterialEditable(L);ta(ra.materialClicked,L).push(pa);ka=!0};this.onMaterialHoverChanged=function(L,pa){this.setMaterialEditable(L);ta(ra.materialHoverChanged,L).push(pa)};this.onViewSwitchStarted=function(L){ra.viewSwitchStarted.push(L)};this.onViewSwitchDone=function(L){ra.viewSwitchDone.push(L)};this.onVrChange=function(L){ra.vrChange.push(L)};this.onBeforeRender=function(L){ra.beforeRender.push(L)};this.createTextureFromHtmlImage=
function(L,pa){function ca(){Ca.needsUpdate=!0;Ca.width=L.naturalWidth;Ca.height=L.naturalHeight;THREE.Math.isPowerOfTwo(Ca.width)&&THREE.Math.isPowerOfTwo(Ca.height)||(Ca.minFilter=GLC.LINEAR);Ca.notifyLoaded()}function Aa(){ca();Oa&&Oa();L.onload=Oa}pa=void 0===pa?!1:pa;var Ca=new WALK.Texture;Ca.image=L;Ca.wrapS=Ca.wrapT=GLC.REPEAT;Ca.minFilter=GLC.LINEAR_MIPMAP_LINEAR;Ca.anisotropy=WALK.DEFAULT_ANISOTROPY;Ca.format=pa?GLC.RGBA:GLC.RGB;Ca.hasAlpha=pa;var Oa=null;L.complete&&0!==L.naturalHeight?
ca():(Oa=L.onload,L.onload=Aa);return Ca};this.createTextureFromHtmlVideo=function(L){var pa=new WALK.VideoTexture;pa.video=L;pa.minFilter=GLC.LINEAR;pa.anisotropy=WALK.DEFAULT_ANISOTROPY;pa.format=GLC.RGB;pa.generateMipmaps=!1;L.setAttribute("playsinline","");L.setAttribute("webkit-playsinline","");L.crossOrigin="anonymous";WALK.onVideoDataReady(L,function(ca){pa.width=ca.videoWidth;pa.height=ca.videoHeight;THREE.Math.isPowerOfTwo(pa.width)&&THREE.Math.isPowerOfTwo(pa.height)?(pa.wrapS=GLC.REPEAT,
pa.wrapT=GLC.REPEAT):(pa.wrapS=GLC.CLAMP_TO_EDGE,pa.wrapT=GLC.CLAMP_TO_EDGE);pa.notifyLoaded()});return pa};this.addAnchor=function(){console.assert(!1,"Can't add anchors until the scene is ready to display")};this.removeAnchor=function(){console.assert(!1,"Can't remove anchors until the scene is ready to display")};this.addAvatar=function(){console.assert(!1,"Can't add avatars until the scene is ready to display")};this.removeAvatar=function(){console.assert(!1,"Can't remove avatars until the scene is ready to display")};
this.findAvatar=function(){console.assert(!1,"Can't find avatars until the scene is ready to display")};this.sleepAnimatedMaterials=function(){console.assert(!1,"Can't sleep animated materials until the scene is ready to display")};this.wakeAnimatedMaterials=function(){console.assert(!1,"Can't wake animated materials until the scene is ready to display")};this.onAnchorsVisibilityChanged=function(L){ra.anchorsVisibilityChanged.push(L)};this.removeAnchorsVisibilityChangedListener=function(L){ra.anchorsVisibilityChanged=
ra.anchorsVisibilityChanged.filter(function(pa){return pa!==L})};this.seeItem=this.captureImage=this.switchToView=this.setMaterialForNode=this.getSceneBoundingBox=this.getCameraRotation=this.getCameraPosition=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d;this.getViewerAssetUrl=function(L){return WALK.getViewerAssetUrl(L)};this.addMenuButton=function(L){return b.addExtraButton(L)};this.removeMenuButton=function(L){b.removeExtraButton(L)};
this.getMenuButtonIcon=function(L){return b.getExtraButonIcon(L)};Object.defineProperty(this,"menuVisible",{get:function(){return b.visible},set:function(L){b.visible=L}});this.onMenuVisibilityChanged=function(L){b.addEventListener("visibilityChanged",function(){L()})};this.play=function(){WALK.play()};var Ia={};this.apiUserChangeState=function(L,pa){WALK.deepEqual(Ia[L],pa)||(Ia[L]=WALK.readOnlyCopy(pa),pa=WALK.cloneObject(pa),A(ra.apiUserStateChanged[L],L,pa),A(ra.anyApiUserStateChanged,L,pa))};
this.onApiUserStateChanged=function(L,pa){"function"===typeof L?ra.anyApiUserStateChanged.push(L):ta(ra.apiUserStateChanged,L).push(pa)};this.removeOnApiUserStateChanged=function(L,pa){"function"===typeof L?WALK.removeFromArray(L,ra.anyApiUserStateChanged):WALK.removeFromArray(pa,ra.apiUserStateChanged[L])};this.getApiUserState=function(L){if(void 0===L)return WALK.cloneObject(Ia);L=Ia[L];return void 0===L?void 0:WALK.cloneObject(L)};this._meetingJoined=function(L){console.assert(null===na);na=L;
A(ra.meetingJoined,na)};this._onMeetingJoined=function(L){ra.meetingJoined.push(L);null!==na&&L(na)};this._removeOnMeetingJoined=function(L){WALK.removeFromArray(L,ra.meetingJoined)};this._onAvatarListChanged=function(L){ra.avatarListChanged.push(L)};this._removeOnAvatarListChanged=function(L){WALK.removeFromArray(L,ra.avatarListChanged)};this._createPointerEventHelper=function(L){return new WALK.PointerEventHelper(K,L)};this._disableControls=function(){F.disable()};this._enableControls=function(){F.enable()};
var Qa=new WALK.RayIntersection;this._findIntersectionAtPosition=function(L,pa){M.findIntersectionAtPosition(L,pa,!0,Qa);return Qa}}})();(function(){function a(d){for(var f=0,g=0;g<d.length;g+=1)d[g].id>=f&&(f=d[g].id+1);return f}function b(d,f){for(var g=0;g<d.length;g+=1)if(d[g].name===f)return!1;return!0}function c(d,f){for(var g=d,e=2;!b(f,g);e+=1)g=d+e.toString();return g}WALK.EditorHooks=function(d,f,g,e,k,h,l,r){function q(){WALK.USER_MSG.info("Failed to load texture")}var m={geometryFacesCnt:d.nodes.reduce(function(v,y){return v+y.facesInSubtree()},0)},u=new WALK.TextureLoader("./",WALK.DETECTOR,function(v){r.requestFrame()},
q,q,!0,!1),n=new WALK.SkyLoader(u),w=k.transformControls;this.getExtensionManager=function(){return h};this.getCameraPosition=function(){var v=g.cameraWorldPosition();return[v.x,v.y,v.z]};this.getCameraRotation=function(){return[THREE.Math.radToDeg(g.getYawAngle()),THREE.Math.radToDeg(g.getPitchAngle())]};this.getCamera=function(){return d.camera};this.getSceneStats=function(){return m};this.getMaterials=function(){return d.sortedMaterials()};this.getLights=function(){return d.lights};this.getLightProbes=
function(){return d.lightProbes};this.getCameraVolumes=function(){return d.cameraVolumes};this.getNodes=function(){return d.nodes};this.addLight=function(v,y,C){v=new WALK.Light({name:c(v,d.lights),type:y,doNotImport:!0});v.addInstance(C);d.addLight(v)};this.removeLight=function(v){d.removeLight(v)};this.renameLight=function(v,y){y=y.trim()||"light";v.name="";v.name=c(y,d.lights)};this.addLightInstance=function(v,y){v.addInstance(y)};this.removeLightInstance=function(v,y){v.removeInstance(y)};this.addLightProbe=
function(v){var y=a(d.lightProbes);v=new WALK.LightProbe({id:y,position:v});v.enableBoundingBox();d.addLightProbe(v);1===d.lightProbes.length&&d.enableLightProbesForMaterials()};this.removeLightProbe=function(v){d.removeLightProbe(v);0===d.lightProbes.length&&d.disableLightProbesForMaterials()};this.getCameraVolumeTypes=function(){return WALK.CameraVolume.CameraVolumeTypes};this.addCameraVolume=function(v,y){var C=(new THREE.Vector3).fromArray(this.getCameraPosition()),A=this.getCameraRotation();
A=(new THREE.Vector3(0,3,0)).applyEuler(new WALK.Euler(A[0]/180*Math.PI,A[1]/180*Math.PI,0));var I=a(d.cameraVolumes),D=d.addCameraVolume,E=WALK.CameraVolume;y||(y=v[0].toUpperCase()+v.slice(1)+I);D.call(d,new E({id:I,name:y,type:v,position:C.add(A).toArray(),rotation:[0,0,0],scale:[1,1,1],exposure:d.camera.defaultExposure,gamma:d.camera.defaultGamma}))};this.removeCameraVolume=function(v){d.removeCameraVolume(v)};this.shiftCameraVolume=function(v,y){d.shiftCameraVolume(v,y)};this.getViews=function(){return d.views.filter(function(v){return!v.internal})};
this.markScreenshotArea=function(v){l.markArea(v)};this.unmarkScreenshotArea=function(){l.unmarkArea()};this.screenToBuffer=function(v,y,C){return l.screenToBuffer(v,y,C)};this.addViewFromCamera=function(v,y){var C=[];console.assert("fps"===y||"top"===y||"orbit"===y);var A=g.cameraWorldPosition(),I=g.orbit;C[0]=THREE.Math.radToDeg(g.getYawAngle());C[1]=THREE.Math.radToDeg(g.getPitchAngle());v={id:a(d.views),name:c(v.trim()||"view",d.views),rotation:C};"fps"===y?(v.mode="fps",v.sky=WALK.EDITOR_CONTROLLED_SKY_NAME,
v.position=A.toArray()):"top"===y?(v.mode="orbit",v.sky=WALK.DEFAULT_SKY_NAME,v.panPrimary=!0,v.noPitchRotate=!0,v.rotation[1]=-90,v.minUpAngle=0,v.maxUpAngle=Math.PI/2,I.isEnabled()?(v.target=I.target.toArray(),v.distance=I.getCameraDistance()):(v.target=[A.x,A.y,d.boundingBox.min.z],v.distance=Math.max(A.z-d.boundingBox.min.z,1))):(v.mode="orbit",v.sky=WALK.DEFAULT_SKY_NAME,v.panPrimary=!1,v.noPitchRotate=!1,I.isEnabled()?(v.target=I.target.toArray(),v.distance=I.getCameraDistance(),v.minUpAngle=
-I.getMaxPitchAngle(),v.maxUpAngle=-I.getMinPitchAngle()):(y=d.boundingBox.center(),v.target=y.toArray(),y.sub(A),v.distance=y.length(),y.normalize(),v.rotation=[THREE.Math.radToDeg(Math.atan2(-y.x,y.y)),THREE.Math.radToDeg(Math.asin(y.z))],v.minUpAngle=0,v.maxUpAngle=Math.PI/2));A=new WALK.View(v);d.addView(A);return A};this.resetViewFromCamera=function(v){var y=g.cameraWorldPosition();"fps"===v.mode?v.position.copy(y):(v.target.copy(g.orbit.target),v.distance=y.distanceTo(v.target));"fps"!==v.mode&&
v.isTop()||(v.rotation.pitch=g.getPitchAngle());v.setYaw(g.getYawAngle())};this.removeView=function(v){d.removeView(v)};this.shiftView=function(v,y){d.shiftView(v,y)};this.activateSkyForView=function(v){e.activateSky(v)};this.switchToView=function(v){e.switchToView(v);$("walk-canvas").focus()};this.renameView=function(v,y){y=y.trim()||"view";v.name="";v.setName(c(y,d.views))};this.updateHiddenMeshes=function(v){e.updateHiddenMeshes(v)};this.getSky=function(){return d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)};
this.loadTexture=function(v){v=u.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,v,!0,!0,WALK.DEFAULT_ANISOTROPY);v.fromEditor=!0;return v};this.materialTextureUpdated=function(v,y){var C=new Set,A="";v.textureNeedsUv0(y)&&d.visitMeshesWithMaterial(v,function(I){0===I.geometry.vertexCnt||I.uv0InBuffers()||C.has(I.node.type)||(C.add(I.node.type),5<C.size||(""!==A&&(A+=", "),A+="'"+I.node.type+"'"))});return 0<C.size&&"Texture "+y+" won't be correctly mapped. The following objects lack base color UV mapping coming from the 3D modeling tool: "+
A+(5<C.size?" (plus "+(C.size-5)+" more).":".")};this.changeSkyTexture=function(v){var y=d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);y.isEquirect?n.loadSkyTexture(y,v):(d.removeSkyMesh(y),n.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"equirect",texture:v},d));d.adjustSkiesAndCameraFarToSpanWholeScene()};this.removeSkyTexture=function(){var v=d.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);v.isEquirect&&(d.removeSkyMesh(v),n.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"procedural"},
d));d.adjustSkiesAndCameraFarToSpanWholeScene()};this.getColorMapName=function(){return d.camera.colorMap?d.camera.colorMap.name:null};this.loadColorMap=function(v){v=u.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,v,!1,!1,WALK.NO_ANISOTROPY);v.flipY=!1;return v};this.getSceneJson=function(){return d.serialize()};this.getCoverJson=function(){var v=f.cover;v.extensions=h.getConfig();return v};this.disableSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};this.enableMaterialSelection=
function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.MATERIAL)};this.enableLightSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT)};this.enableLightProbeSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE)};this.enableExtensionSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.EXTENSION)};this.enablePositionSelection=function(v){k.setDistanceToObject(v);k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.POSITION)};
this.enableNodeSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.NODE)};this.enableCameraVolumeSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME)};this.selectMaterial=function(v){k.selectMaterial(v,!1)};this.replaceMaterial=function(v,y){v=d.replaceMaterial(v,y);v.isAnimated&&v.play();k.selectMaterial(v,!0);return v};this.selectLight=function(v){k.selectLight(v)};this.selectLightInstance=function(v){k.selectLightInstance(v,!1)};this.selectLightProbe=
function(v){k.selectLightProbe(v,!1)};this.selectCameraVolume=function(v){k.selectEditorCameraVolume(v)};this.selectExtension=function(v){k.selectExtension(v,!1)};this.selectNodes=function(v,y){k.selectNodes(v,y)};this.setMaterialSelectedCallback=function(v){k.setMaterialSelectedCallback(v)};this.setLightInstanceSelectedCallback=function(v){k.setLightInstanceSelectedCallback(v)};this.setLightProbeSelectedCallback=function(v){k.setLightProbeSelectedCallback(v)};this.setNodeSelectedCallback=function(v){k.setNodeSelectedCallback(v)};
this.setExtensionSelectedCallback=function(v){k.setExtensionSelectedCallback(v)};this.setPositionSelectedCallback=function(v){k.setPositionSelectedCallback(v)};this.setItemModifiedCallback=function(v){w.setItemModifiedCallback(v)};this.setViewSelectedCallback=function(v){e.addEventListener("teleportStarted",function(y){null!==y.view&&v(y.view)})};this.coverModified=function(v){f.updateCover(v)};this.autoTourModified=function(){f.refresh()};this.hasLightMap=function(){return d.hasLightMap()};this.getAutoTour=
function(){return d.autoTour};this.getDisableProgressiveLoader=function(){return d.disableProgressiveLoader};this.setDisableProgressiveLoader=function(v){d.disableProgressiveLoader=v};this.getSceneScaleHtmlWarning=function(){var v=d.boundingBox;return!v.empty()&&(v=v.size(),200<v.x||200<v.y||200<v.z)?"The scene has unusually large dimensions: <strong>"+Math.round(v.x)+"m x "+Math.round(v.y)+"m x "+Math.round(v.z)+'m</strong>.</br></br>Shapespark assumes real-world scale, 1 meter in the scene should correspond to 1 meter in the real world. If the scale of the scene is invalid, either re-scale the model or change the scale in the import dialog, otherwise you can disable this message.</br></br>For more information consult <a href="/assets/help.html#importing-the-scene">Importing the scene</a> section of the help.':
null};this.getTransformMode=function(){return w.mode};this.setTransformMode=function(v){w.setTransformMode(v)};this.getSupportedTransformModes=function(){return w.supportedModes};this.seeItem=function(v){WALK.getViewer().seeItem(v)}};WALK.SceneLoadConfig=function(){this.assetsUrl="./";this.onSceneLoaded=null;this.enableCollisions=!0;this.forcedInitialCameraRotation=this.forcedInitialCameraPosition=null}})();(function(){function a(){var c=new THREE.BufferGeometry,d=new Float32Array(288);c.addAttribute("position",new THREE.BufferAttribute(d,3));var f=0;[[[-1,-1,-1],[-1,-.6,-1],[-.6,-1,-1]],[[-1,-1,-1],[-1,-1,-.6],[-1,-.6,-1]],[[-1,-1,-1],[-.6,-1,-1],[-1,-1,-.6]],[[-.6,-1,-1],[-1,-.6,-1],[-1,-1,-.6]],[[-1,-1,1],[-.6,-1,1],[-1,-.6,1]],[[-1,-1,1],[-1,-.6,1],[-1,-1,.6]],[[-1,-1,1],[-1,-1,.6],[-.6,-1,1]],[[-.6,-1,1],[-1,-1,.6],[-1,-.6,1]],[[1,-1,-1],[.6,-1,-1],[1,-.6,-1]],[[1,-1,-1],[1,-.6,-1],[1,-1,-.6]],
[[1,-1,-1],[1,-1,-.6],[.6,-1,-1]],[[.6,-1,-1],[1,-1,-.6],[1,-.6,-1]],[[-1,1,-1],[-.6,1,-1],[-1,.6,-1]],[[-1,1,-1],[-1,.6,-1],[-1,1,-.6]],[[-1,1,-1],[-1,1,-.6],[-.6,1,-1]],[[-.6,1,-1],[-1,1,-.6],[-1,.6,-1]],[[1,1,1],[.6,1,1],[1,.6,1]],[[1,1,1],[1,.6,1],[1,1,.6]],[[1,1,1],[1,1,.6],[.6,1,1]],[[.6,1,1],[1,1,.6],[1,.6,1]],[[1,-1,1],[1,-.6,1],[.6,-1,1]],[[1,-1,1],[1,-1,.6],[1,-.6,1]],[[1,-1,1],[.6,-1,1],[1,-1,.6]],[[.6,-1,1],[1,-.6,1],[1,-1,.6]],[[1,1,-1],[1,.6,-1],[.6,1,-1]],[[1,1,-1],[1,1,-.6],[1,.6,
-1]],[[1,1,-1],[.6,1,-1],[1,1,-.6]],[[.6,1,-1],[1,.6,-1],[1,1,-.6]],[[-1,1,1],[-1,.6,1],[-.6,1,1]],[[-1,1,1],[-1,1,.6],[-1,.6,1]],[[-1,1,1],[-.6,1,1],[-1,1,.6]],[[-.6,1,1],[-1,.6,1],[-1,1,.6]]].forEach(function(g){for(var e=0;3>e;e+=1)for(var k=0;3>k;k+=1)d[f]=g[e][k],f+=1});c.computeVertexNormals();c.convertNormalsToSpherical();return c}function b(){var c=new WALK.StandardMaterial;c.disableLightProbe=!0;c.headLight=!0;c.baseColor=WALK.EDITOR_SELECTION_COLOR;c.setUniforms();return c}WALK.LightControls=
function(c,d){function f(E){if("spot"===E.type){var O=THREE.Math.degToRad(E.angle);E=1*Math.cos(O/2);O=new THREE.CylinderBufferGeometry(0,1*Math.sin(O/2),E,32,1);v.makeTranslation(0,-E/2,0);w.makeRotationZ(Math.PI);y.multiplyMatrices(w,v);O.applyMatrix(y);O.convertNormalsToSpherical()}else O="area"===E.type?A:C;return O}function g(E,O,S){var W=new WALK.LightMaterial(E);S=new THREE.Mesh(S,W);S.visibilityId=null;var U=new THREE.Mesh(I,D);S.add(U);if("sun"!==E.type){var va=O.rotation.toQuaternion().multiply(S.quaternion);
S.setRotationFromQuaternion(va);S.position.copy(O.position);"area"===E.type?(W.side=THREE.DoubleSide,S.scale.set(E.width,1,E.height),W=Math.max(E.width,E.height)/2,U.scale.set(W/E.width,W,W/E.height)):S.scale.set(E.size,E.size,E.size)}else E=c.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME).radius,E=1*Math.PI*E*1.5/360,WALK.sunRotationToPosition(c,O.rotation,S.position),S.scale.set(E,E,E);S.userData.lightInstance=O;S.updateMatrixWorld();u.lightInstanceMeshes.push(S);n&&c.addAuxiliaryObject(S)}function e(E){var O=
f(E);E.forEachLightInstance(function(S){g(E,S,O)})}function k(E){for(var O=0;O<u.lightInstanceMeshes.length;O+=1){var S=u.lightInstanceMeshes[O];if(S.userData.lightInstance===E)return S}return null}function h(E){for(var O=[],S=0;S<u.lightInstanceMeshes.length;S+=1){var W=u.lightInstanceMeshes[S];W.userData.lightInstance.light===E?(n&&c.removeAuxiliaryObject(W),W.geometry!==C&&W.geometry!==A&&W.geometry.dispose(),W.material.dispose()):O.push(W)}u.lightInstanceMeshes=O}function l(E){E=E.target;h(E);
e(E)}function r(E){E=E.instance;var O=E.light;var S=O.instances[0]!==E?k(O.instances[0]).geometry:f(O);g(O,E,S);d.requestFrame()}function q(E){E=E.instance.light;h(E);e(E);d.requestFrame()}function m(E){e(E);E.addEventListener("updated",l);E.addEventListener("instanceAdded",r);E.addEventListener("instanceRemoved",q)}var u=this,n=!1,w=new THREE.Matrix4,v=new THREE.Matrix4,y=new THREE.Matrix4,C=new THREE.SphereBufferGeometry(1,32,16);C.convertNormalsToSpherical();var A=new THREE.PlaneBufferGeometry(1,
1);w.makeRotationX(-Math.PI/2);A.applyMatrix(w);A.convertNormalsToSpherical();var I=a(),D=b();this.lightInstanceMeshes=[];this.getLightInstanceMaterial=function(E){return k(E).material};this.showLights=function(){if(!n){n=!0;for(var E=0;E<this.lightInstanceMeshes.length;E+=1)c.addAuxiliaryObject(this.lightInstanceMeshes[E]);d.requestFrame()}};this.showSelectionMesh=function(E){this.lightInstanceMeshes.forEach(function(O){O.children[0].visible=O.userData.lightInstance.light===E?!0:!1})};this.hideLights=
function(){if(n){n=!1;for(var E=0;E<this.lightInstanceMeshes.length;E+=1)c.removeAuxiliaryObject(this.lightInstanceMeshes[E]);d.requestFrame()}};c.lights.forEach(m);c.addEventListener("lightAdded",function(E){m(E.light);d.requestFrame()});c.addEventListener("lightRemoved",function(E){h(E.light);d.requestFrame()})}})();(function(){WALK.LightProbeControls=function(a,b){function c(w,v){v.position.addVectors(w.boxMin,w.boxMax).multiplyScalar(.5).sub(w.position);v.scale.subVectors(w.boxMax,w.boxMin);v.scale.subScalar(.005)}function d(w){var v=new WALK.StandardMaterial;v.hideFromLightProbes=!0;v.disableLightProbe=!1;v.highlight=WALK.EDITOR_SELECTION_COLOR;v.metallic=1;v.roughness=0;v.setUniforms();v=new THREE.Mesh(m,v);v.visibilityId=null;v.lightProbe=w;v.position.copy(w.position);var y=new THREE.Mesh(n,u);y.visible=
!1;v.add(y);w.isBoundingBoxEnabled()&&c(w,y);v.updateMatrixWorld(!0);v.visible=r;l.lightProbeMeshes.push(v);a.addAuxiliaryObject(v)}function f(w){for(var v=0;v<l.lightProbeMeshes.length;v+=1)if(l.lightProbeMeshes[v].lightProbe===w)return v;console.assert(!1);return null}function g(w){w=w.target;var v=l.lightProbeMeshes[f(w)];v.position.copy(w.position);var y=v.children[0];w.isBoundingBoxEnabled()?(c(w,y),y.visible=!0):y.visible=!1;v.updateMatrixWorld()}function e(w){w=w.lightProbe;d(w);b.requestFrame();
w.addEventListener("positionUpdated",g);w.addEventListener("boundsUpdated",g)}function k(w){w=f(w.lightProbe);var v=l.lightProbeMeshes[w];a.removeAuxiliaryObject(v);v.material.dispose();l.lightProbeMeshes.splice(w,1);b.requestFrame()}function h(w){for(var v=0;v<l.lightProbeMeshes.length;v+=1){var y=l.lightProbeMeshes[v];if(y.lightProbe===w)return y}return null}var l=this,r=!1,q=null;this.lightProbeMeshes=[];var m=new THREE.SphereBufferGeometry(.2,32,16);m.convertNormalsToSpherical();var u=WALK.createBoundingBoxMaterial(),
n=new THREE.BoxBufferGeometry(1,1,1);n.addTriangleOrderAttribute();n.convertNormalsToSpherical();this.getLightProbeMaterial=function(w){return(w=h(w))?w.material:null};this.showLightProbeBoundingBox=function(w){q&&(q.visible=!1,q=null);w.isBoundingBoxEnabled()&&(q=h(w).children[0],q.visible=!0)};this.showLightProbes=function(){if(!r){r=!0;for(var w=0;w<this.lightProbeMeshes.length;w+=1)this.lightProbeMeshes[w].visible=!0}b.requestFrame()};this.hideLightProbes=function(){if(r){r=!1;for(var w=0;w<this.lightProbeMeshes.length;w+=
1)this.lightProbeMeshes[w].visible=!1}b.requestFrame()};(function(){for(var w=0;w<a.lightProbes.length;w+=1){var v=a.lightProbes[w];d(v);v.addEventListener("positionUpdated",g);v.addEventListener("boundsUpdated",g)}a.addEventListener("lightProbeAdded",e);a.addEventListener("lightProbeRemoved",k)})()}})();(function(){WALK.CameraVolumeControls=function(a,b){function c(k){function h(){r.position.copy(k.position);r.rotation.copy(k.rotation);r.scale.copy(k.scale);r.updateMatrixWorld()}var l=WALK.createBoundingBoxMaterial(),r=new THREE.Mesh(k.getVolumeGeometry(),l);r.visible=!1;r.visibilityId=null;g.add(r);f.set(k,r);h(k);k.addEventListener("updated",h)}var d=function(){},f=new Map,g=new THREE.Object3D;g.visible=!1;a.addAuxiliaryObject(g);this.setHighlightedCameraVolume=function(k){d();var h=f.get(k);h.visible=
!0;d=function(){return h.visible=!1};return h.material};this.setControlsVisible=function(k){g.visible=k;b.requestFrame()};a.addEventListener("cameraVolumeAdded",function(k){c(k.cameraVolume);b.requestFrame()});a.addEventListener("cameraVolumeRemoved",function(k){k=k.cameraVolume;var h=f.get(k);g.remove(h);h.material.dispose();f.delete(k);b.requestFrame()});for(var e=0;e<a.cameraVolumes.length;e+=1)c(a.cameraVolumes[e])}})();/*
 Copyright (C) 2019-present Shapespark
*/
(function(){WALK.sunRotationToPosition=function(a,b,c){a=a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);c.set(0,-a.radius,0);c.applyEuler(b);c.add(a.position)};WALK.computeNodeBoundingSphere=function(a,b){b.radius=0;a.visitSubtree(function(c){c.mesh&&WALK.Math.spheresUnion(c.mesh.geometry.boundingSphere,b)})}})();(function(){WALK.PointerEventDispatcher=function(a,b){function c(w){if(void 0===w.button)return 0;switch(w.button){case 0:return 0;case 1:return 1;case 2:return 2}return-1}function d(w,v){if(0!==w.length){var y=void 0!==v.touches;if(!y&&(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement))u.clipX=0,u.clipY=0;else{if(y){b:{for(y=0;y<v.changedTouches.length;y++){var C=v.changedTouches[y];if(C.identifier===m){v=C;break b}}for(y=0;y<v.touches.length;y++)if(C=
v.touches[y],C.identifier===m){v=C;break b}v=null}console.assert(null!==v);y=v.clientX;v=v.clientY}else y=v.clientX,v=v.clientY;u.clipX=y/window.innerWidth*2-1;u.clipY=2*-(v/window.innerHeight)+1}v=u;for(y=0;y<w.length&&(C=w[y].callback,!C(v.clipX,v.clipY));y++);}}function f(w){0!==c(w)||q||(q=!0,void 0!==w.touches&&(console.assert(0<w.changedTouches.length),m=w.changedTouches[0].identifier),d(h,w))}function g(w){0===c(w)&&q&&(q=!1,d(l,w))}function e(w){d(r,w)}function k(w,v,y){var C=w.filter(function(I){return I.callback===
v});console.assert(0===C.length,"Do not add the same callback twice!");y={callback:v,priority:y};for(C=C=0;C<w.length;C+=1){var A=w[C];if(y.priority<=A.priority){if(y.priority===A.priority){console.error("Adding two listeners with the same priority is not allowed!");return}break}}w.splice(C,0,y)}var h=[],l=[],r=[],q=!1,m=-1,u={clipX:0,clipY:0};this.addPointerDownListener=function(w,v){k(h,w,v)};this.removePointerDownListener=function(w){h=h.filter(function(v){return v.callback!==w})};this.addPointerUpListener=
function(w,v){k(l,w,v)};this.removePointerUpListener=function(w){l=l.filter(function(v){return v.callback!==w})};this.addPointerMoveListener=function(w,v){k(r,w,v)};this.removePointerMoveListener=function(w){r=r.filter(function(v){return v.callback!==w})};var n=!1;this.isEnabled=function(){return n};this.enable=function(){n||(a.addEventListener("mousedown",f,!1),a.addEventListener("touchstart",f,!1),a.addEventListener("mouseup",g,!1),a.addEventListener("touchend",g,!1),a.addEventListener("mousemove",
e,!1),a.addEventListener("touchmove",e,!1),window.addEventListener("mouseup",g,!1),b&&window.top.addEventListener("mouseup",g,!1),n=!0)};this.disable=function(){n&&(a.removeEventListener("mousedown",f,!1),a.removeEventListener("touchstart",f,!1),a.removeEventListener("mouseup",g,!1),a.removeEventListener("touchend",g,!1),a.removeEventListener("mousemove",e,!1),a.removeEventListener("touchmove",e,!1),window.removeEventListener("mouseup",g,!1),b&&window.top.removeEventListener("mouseup",g,!1),n=!1)};
this.enable()}})();(function(){WALK.PointerEventHelper=function(a,b){function c(){return!1}function d(n,w){var v=e.callbacks.onPointerDown(n,w);k=!0;h=n;l=w;return v}function f(n,w){var v=e.callbacks.onPointerUp(n,w);if(k){var y=Date.now();v=null!==m&&.03>=Math.abs(r-h)&&.03>=Math.abs(q-l)&&500>=Math.abs(m-y)&&e.callbacks.onDoubleClick!==c?e.callbacks.onDoubleClick(n,w)||v:e.callbacks.onClick(n,w)||v;m=y;r=n;q=w}return v}function g(n,w){var v=e.callbacks.onPointerMove(n,w);!k||.03>=Math.abs(n-h)&&.03>=Math.abs(w-l)||
(k=!1,m=null);return v}var e=this,k=!1,h=null,l=null,r=null,q=null,m=null;this.callbacks={onClick:c,onDoubleClick:c,onPointerDown:c,onPointerUp:c,onPointerMove:c};var u=!1;this.isEnabled=function(){return u};this.enable=function(){u||(a.addPointerDownListener(d,b),a.addPointerUpListener(f,b),a.addPointerMoveListener(g,b),u=!0)};this.disable=function(){u&&(a.removePointerDownListener(d),a.removePointerUpListener(f),a.removePointerMoveListener(g),u=!1)};this.enable()}})();(function(){function a(A){var I=new THREE.Box3;A instanceof THREE.Object3D&&A.traverse(function(D){D instanceof THREE.Mesh&&(D.geometry.boundingBox||D.geometry.computeBoundingBox(),I.union(D.geometry.boundingBox))});return I}function b(A,I){var D=a(A);A=D.size();A=new THREE.BoxBufferGeometry(A.x,A.y,A.z);D=D.center();var E=new THREE.Matrix4;E.makeTranslation(D.x,D.y,D.z);A.applyMatrix(E);A.computeBoundingBox();I=new THREE.Mesh(A,I);I.visible=!1;I.visibilityId=null;return I}function c(A,I){var D=new WALK.StandardMaterial;
D.hideFromLightProbes=!0;D.baseColor.copy(A);D.opacity=I;D.specularOff=1;D.depthTest=!1;D.depthWrite=!1;return D}function d(A){for(var I=[],D=0;D<arguments.length;++D)I[D-0]=arguments[D];console.assert(0<I.length,"Part must have at least one element!");var E=new THREE.Object3D;I.forEach(function(O){return E.add(O)});I=b(E,c(g,.6));return new m(E,I,E.children[0].material)}function f(A,I,D){var E=A.material;E.opacity=I===A.collider?A.hoveredOpacity:D&&null!==I?A.notUsedOpacity:A.defaultOpacity;E.setUniforms()}
WALK.TRANSFORM_MODE={TRANSLATE:0,ROTATE:1,SCALE:2};var g=new THREE.Color(16777215),e=new THREE.Color(16711680),k=new THREE.Color(65280),h=new THREE.Color(255),l=new THREE.Vector3(0,0,1),r=new THREE.Vector3(1,0,0),q=new THREE.Vector3(0,1,0),m=function(A,I,D){THREE.Object3D.call(this);this.add(A);this.add(I);this.material=D;this.collider=I;this.defaultOpacity=D.opacity;this.hoveredOpacity=.99;this.notUsedOpacity=.3;this.usedAxes=0};m.prototype=Object.create(THREE.Object3D.prototype);m.prototype.constructor=
m;var u=function(){function A(U){U=c(U,.6);U.depthTest=!0;return new THREE.Mesh(I,U)}THREE.Object3D.call(this);var I=new THREE.CylinderBufferGeometry(.005,.005,1E3,4,1,!1),D=A(e);D.rotation.set(0,0,Math.PI/2);var E=A(k),O=A(h);O.rotation.set(Math.PI/2,0,0);this.add(D);this.add(E);this.add(O);var S=[!1,!1,!1];this.show=function(U){S[0]=1===(1&U);S[1]=2===(2&U);S[2]=4===(4&U);D.visible=S[0];E.visible=S[1];O.visible=S[2]};var W=new THREE.Vector3;this.update=function(U){W.copy(U);W.sub(this.position);
W.normalize();D.visible=S[0]&&.998>Math.abs(r.dot(W));E.visible=S[1]&&.998>Math.abs(q.dot(W));O.visible=S[2]&&.998>Math.abs(l.dot(W))}};u.prototype=Object.create(THREE.Object3D.prototype);u.prototype.constructor=u;var n=function(){function A(){var S=c(g,.99);return new THREE.Mesh(I,S)}THREE.Object3D.call(this);var I=new THREE.SphereBufferGeometry(.012,10,10),D=A(),E=A(),O=A();this.add(D);this.add(E);this.add(O);this.show=function(S){D.visible=1===(1&S);E.visible=2===(2&S);O.visible=4===(4&S)};this.update=
function(S){D.position.set(S.x,0,0);D.updateMatrixWorld();E.position.set(0,S.y,0);E.updateMatrixWorld();O.position.set(0,0,S.z);O.updateMatrixWorld()}};n.prototype=Object.create(THREE.Object3D.prototype);n.prototype.constructor=n;var w=function(){function A(U){U=c(U,.2);U.depthTest=!0;U.side=THREE.DoubleSide;return d(new THREE.Mesh(I,U))}THREE.Object3D.call(this);var I=new THREE.PlaneBufferGeometry(1E3,1E3,1,1),D=A(g);this.add(D);var E=new THREE.Object3D;this.add(E);var O=A(h);O.rotation.set(0,0,
0);var S=A(k);S.rotation.set(Math.PI/2,0,0);var W=A(e);W.rotation.set(0,Math.PI/2,0);E.add(O);E.add(S);E.add(W);this.setLocalRotation=function(U){U?E.rotation.copy(U):E.rotation.set(0,0,0)};this.update=function(U){D.rotation.setFromRotationMatrix(U.matrixWorld);D.updateMatrixWorld()};this.cameraPlane=D;this.findPlaneIntersectionPoint=function(){function U(qa){switch(qa){case 1:return W;case 2:return S;case 4:return O;case 3:return O;case 5:return S;case 6:return W;case 7:return D;default:throw"Impossible";
}}var va=new THREE.Vector3,ta=new THREE.Vector3;return function(qa,ha,F,J){var Z=U(qa);Z.getWorldPosition(va).sub(ha);Z.getWorldDirection(ta);if(1===qa||2===qa||4===qa){qa=ta.dot(ta);Z=ta.dot(F);var M=F.dot(F),ma=ta.dot(va),ea=F.dot(va);M=qa*M-Z*Z;qa=1E-5>Math.abs(M)?Infinity:(qa*ea-Z*ma)/M}else qa=ta.dot(F),qa=1E-5>Math.abs(qa)?Infinity:ta.dot(va)/qa;if(Infinity===qa)return!1;J.copy(F).multiplyScalar(qa).add(ha);return!0}}();this.show=function(U){D.visible=7===U?!0:!1;O.visible=3===U;S.visible=5===
U;W.visible=6===U}};w.prototype=Object.create(THREE.Object3D.prototype);w.prototype.constructor=w;var v=function(){function A(J){for(var Z=new Uint8Array(4096),M=Math.floor(255*J.r),ma=Math.floor(255*J.g),ea=Math.floor(255*J.b),ya=0,Q=0;32>Q;Q++)for(var fa=0;32>fa;fa++)Z[ya]=M,Z[ya+1]=ma,Z[ya+2]=ea,Z[ya+3]=0===Q||0===fa||31===Q||31===fa?220:150,ya+=4;Z=new WALK.DataTexture(Z,32,32,THREE.RGBAFormat);Z.hasAlpha=!0;Z.needsUpdate=!0;Z.loaded=!0;M=new WALK.StandardMaterial;M.hideFromLightProbes=!0;M.specularOff=
1;M.disableLightProbe=!0;M.depthTest=!1;M.depthWrite=!1;M.transparent=!0;M.baseColor=J;M.side=THREE.DoubleSide;M.baseColorTexture=Z;M.opacity=.6;M.configureTransparency();M.setUniforms();return d(new THREE.Mesh(E.squareGeometry,M))}function I(J){J=c(J,.6);return d(new THREE.Mesh(E.lineGeometry,J),new THREE.Mesh(E.arrowHeadGeometry,J))}var D=this;THREE.Object3D.call(this);var E=function(){var J=new THREE.Matrix4,Z=new THREE.SphereBufferGeometry(.1,16,16),M=new THREE.PlaneBufferGeometry(.23,.23,1,1);
J.makeTranslation(.45,.45,0);M.applyMatrix(J);M.addTriangleOrderAttribute();var ma=new THREE.CylinderBufferGeometry(.015,.015,1,4,1,!1);J.makeTranslation(0,.65,0);ma.applyMatrix(J);var ea=new THREE.CylinderBufferGeometry(0,.05,.2,10,1,!1);J.makeTranslation(0,1.25,0);ea.applyMatrix(J);return{pickerGeometry:Z,squareGeometry:M,lineGeometry:ma,arrowHeadGeometry:ea}}(),O=function(){var J=c(g,.6);return d(new THREE.Mesh(E.pickerGeometry,J))}(),S=I(e);S.rotation.set(0,0,-Math.PI/2);var W=I(k),U=I(h);U.rotation.set(Math.PI/
2,0,0);var va=A(h),ta=A(k);ta.rotation.set(Math.PI/2,0,0);var qa=A(e);qa.rotation.set(0,-Math.PI/2,0);O.usedAxes=7;S.usedAxes=1;W.usedAxes=2;U.usedAxes=4;va.usedAxes=3;ta.usedAxes=5;qa.usedAxes=6;var ha=[O,S,W,U,va,ta,qa];ha.forEach(function(J){return D.add(J)});var F=new Map(ha.map(function(J){return[J.collider,J]}));this.colliders=[].concat($jscomp.arrayFromIterable(F.keys()));this.highlight=function(J,Z){ha.forEach(function(M){return f(M,J,Z)})};this.usedAxes=function(J){return F.get(J).usedAxes}};
v.prototype=Object.create(THREE.Object3D.prototype);v.prototype.constructor=v;var y=function(){function A(ha){var F=new THREE.TorusBufferGeometry(ha,.012,6,64);ha=new THREE.TorusBufferGeometry(ha,.038,6,64);return{torusGeometry:F,colliderGeometry:ha}}function I(ha,F){ha=new WALK.RotateGizmoMaterial(ha,.6);var J=new THREE.Object3D;J.add(new THREE.Mesh(F.torusGeometry,ha));F=new THREE.Mesh(F.colliderGeometry,ha);F.visible=!1;F.visibilityId=null;return new m(J,F,ha)}var D=this;THREE.Object3D.call(this);
var E=A(.9),O=I(e,E);O.rotation.set(0,Math.PI/2,0);var S=I(k,E);S.rotation.set(Math.PI/2,0,0);E=I(h,E);var W=A(1.12),U=I(g,W),va=function(ha,F){ha=c(ha,0);var J=new THREE.SphereBufferGeometry(F,32,32);F=new THREE.Object3D;F.add(new THREE.Mesh(J,ha));J=new THREE.Mesh(J,ha);J.visible=!1;J.visibilityId=null;ha=new m(F,J,ha);ha.defaultOpacity=0;ha.hoveredOpacity=.2;ha.notUsedOpacity=0;return ha}(g,.848),ta=[O,S,E,U,va];ta.forEach(function(ha){return D.add(ha)});var qa=new Map(ta.map(function(ha){return[ha.collider,
ha]}));this.colliders=[].concat($jscomp.arrayFromIterable(qa.keys()));this.update=function(ha){var F=this;ta.filter(function(J){return J!==va}).forEach(function(J){J=J.material;J.gizmoPosition.copy(F.position);J.sphereRadius=.86*F.scale.x});U.rotation.setFromRotationMatrix(ha.matrixWorld);U.updateMatrixWorld()};O.usedAxes=1;S.usedAxes=2;E.usedAxes=4;U.usedAxes=7;va.usedAxes=0;this.highlight=function(ha,F){ta.forEach(function(J){return f(J,ha,F)})};this.usedAxes=function(ha){return qa.get(ha).usedAxes}};
y.prototype=Object.create(THREE.Object3D.prototype);y.prototype.constructor=y;var C=function(){function A(J){for(var Z=new Uint8Array(4096),M=Math.floor(255*J.r),ma=Math.floor(255*J.g),ea=Math.floor(255*J.b),ya=0,Q=0;32>Q;Q++)for(var fa=0;32>fa;fa++)Z[ya]=M,Z[ya+1]=ma,Z[ya+2]=ea,Z[ya+3]=0===Q||0===fa||31===Q||31===fa?220:150,ya+=4;Z=new WALK.DataTexture(Z,32,32,THREE.RGBAFormat);Z.hasAlpha=!0;Z.needsUpdate=!0;Z.loaded=!0;M=new WALK.StandardMaterial;M.hideFromLightProbes=!0;M.specularOff=1;M.disableLightProbe=
!0;M.depthTest=!1;M.depthWrite=!1;M.transparent=!0;M.baseColor=J;M.side=THREE.DoubleSide;M.baseColorTexture=Z;M.opacity=.6;M.configureTransparency();M.setUniforms();return d(new THREE.Mesh(E.squareGeometry,M))}function I(J){J=c(J,.6);return d(new THREE.Mesh(E.lineGeometry,J),new THREE.Mesh(E.cubeGeometry,J))}var D=this;THREE.Object3D.call(this);var E=function(){var J=new THREE.Matrix4,Z=new THREE.BoxBufferGeometry(.3,.3,.3),M=new THREE.PlaneBufferGeometry(.23,.23,1,1);J.makeTranslation(.45,.45,0);
M.applyMatrix(J);M.addTriangleOrderAttribute();var ma=new THREE.CylinderBufferGeometry(.015,.015,1,4,1,!1);J.makeTranslation(0,.65,0);ma.applyMatrix(J);var ea=new THREE.BoxBufferGeometry(.1,.1,.1);J.makeTranslation(0,1.1,0);ea.applyMatrix(J);return{pickerGeometry:Z,squareGeometry:M,lineGeometry:ma,cubeGeometry:ea}}(),O=function(){var J=c(g,.6);return d(new THREE.Mesh(E.pickerGeometry,J))}(),S=I(e);S.rotation.set(0,0,-Math.PI/2);var W=I(k),U=I(h);U.rotation.set(Math.PI/2,0,0);var va=A(h),ta=A(k);ta.rotation.set(Math.PI/
2,0,0);var qa=A(e);qa.rotation.set(0,-Math.PI/2,0);O.usedAxes=7;S.usedAxes=1;W.usedAxes=2;U.usedAxes=4;va.usedAxes=3;ta.usedAxes=5;qa.usedAxes=6;var ha=[O,S,W,U,va,ta,qa];ha.forEach(function(J){return D.add(J)});var F=new Map(ha.map(function(J){return[J.collider,J]}));this.colliders=[].concat($jscomp.arrayFromIterable(F.keys()));this.highlight=function(J,Z){ha.forEach(function(M){return f(M,J,Z)})};this.usedAxes=function(J){return F.get(J).usedAxes}};C.prototype=Object.create(THREE.Object3D.prototype);
C.prototype.constructor=C;WALK.TransformGizmo=function(A,I,D,E){function O(V){U.oldPosition.copy(V);U.newPosition.copy(V);va.position.copy(V);ta.position.copy(V);qa.position.copy(V);ha.position.copy(V);F.position.copy(V);J.position.copy(V)}function S(V){U.oldRotation.copy(V);U.newRotation.copy(V);ya===WALK.TRANSFORM_MODE.SCALE?(va.rotation.copy(V),ta.setLocalRotation(V),J.rotation.copy(U.oldRotation)):(va.rotation.set(0,0,0),ta.setLocalRotation(null))}function W(){Q?ya===WALK.TRANSFORM_MODE.TRANSLATE?
(A.addAuxiliaryObject(va),A.addAuxiliaryObject(ta),A.addAuxiliaryObject(qa),A.addAuxiliaryObject(ha),A.removeAuxiliaryObject(F),A.removeAuxiliaryObject(J)):ya===WALK.TRANSFORM_MODE.ROTATE?(A.addAuxiliaryObject(va),A.removeAuxiliaryObject(ha),A.addAuxiliaryObject(F),A.removeAuxiliaryObject(J)):(A.addAuxiliaryObject(va),A.addAuxiliaryObject(ta),A.removeAuxiliaryObject(ha),A.removeAuxiliaryObject(F),A.addAuxiliaryObject(J)):(A.removeAuxiliaryObject(va),A.removeAuxiliaryObject(ta),A.removeAuxiliaryObject(qa),
A.removeAuxiliaryObject(ha),A.removeAuxiliaryObject(F),A.removeAuxiliaryObject(J))}var U=this;this.target=null;var va=new u;va.show(7);var ta=new w;ta.show(0);var qa=new n;qa.show(0);var ha=new v,F=new y,J=new C,Z=!1;Object.defineProperty(this,"transforming",{get:function(){return Z}});var M=new THREE.Vector3(0,0,0),ma=0,ea=new THREE.Vector3;this.oldPosition=new THREE.Vector3(0,0,0);this.newPosition=new THREE.Vector3(0,0,0);this.oldRotation=new THREE.Euler(0,0,0);this.newRotation=new THREE.Euler(0,
0,0);this.oldScale=new THREE.Vector3(1,1,1);this.newScale=new THREE.Vector3(1,1,1);Object.defineProperty(this,"position",{get:function(){return va.position}});Object.defineProperty(this,"rotation",{get:function(){return U.oldRotation}});var ya=!1;Object.defineProperty(this,"scale",{get:function(){return U.oldScale}});var Q=!1;Object.defineProperty(this,"mode",{get:function(){return ya},set:function(V){ya!==V&&(ya=V,W(),E.requestFrame())}});Object.defineProperty(this,"visible",{get:function(){return Q},
set:function(V){Q!==V&&(Q=V,W())}});this.mode=WALK.TRANSFORM_MODE.TRANSLATE;var fa=Infinity,K=Infinity,R=new THREE.Vector3(0,0,0),ka=null,ba=!1,ja=7,na=function(){var V=new THREE.Vector3,xa=new THREE.Vector3,Ea=new THREE.Quaternion;return function(Ia,Qa,L){V.set(Qa,L,1).unproject(A.camera);V.sub(D).normalize();if(!ta.findPlaneIntersectionPoint(Ia,D,V,xa))return null;xa.sub(va.position);xa.applyQuaternion(Ea.setFromEuler(va.rotation).inverse());Ia&1||(xa.x=0);Ia&2||(xa.y=0);Ia&4||(xa.z=0);return xa}}(),
ra=function(){var V=new THREE.Vector3,xa=new THREE.Vector3,Ea=new THREE.Vector3;return function(Ia,Qa){var L=ta.cameraPlane;V.set(0,0,-1);V.transformDirection(L.matrixWorld);xa.set(-1,0,0);xa.transformDirection(L.matrixWorld);Ia=na(7,Ia,Qa).normalize();Ea.copy(xa).cross(Ia);return Math.sign(V.dot(Ea))*Math.acos(xa.dot(Ia))}}(),za=new THREE.Vector3;this.rotationSpeed=5;var Da=function(){var V=new THREE.Vector2(0,0),xa=new THREE.Quaternion,Ea=new THREE.Euler,Ia=new THREE.Quaternion,Qa=new THREE.Quaternion,
L=new THREE.Vector3,pa=new THREE.Vector3,ca=new THREE.Vector3;return function(Aa,Ca){xa.setFromEuler(U.oldRotation);xa.normalize();V.set(fa-Aa,K-Ca);V.multiplyScalar(U.rotationSpeed);if(0===ja)return Aa=ta.cameraPlane,L.copy(r),L.transformDirection(Aa.matrixWorld),pa.set(0,1,0),pa.transformDirection(Aa.matrixWorld),Qa.setFromAxisAngle(L,V.y),Ia.setFromAxisAngle(pa,-V.x),Ia.multiply(Qa),Ia.multiply(xa),Ia.normalize(),Ea.setFromQuaternion(Ia,"ZXY"),Ea;if(7===ja){var Oa=ta.cameraPlane;ca.set(0,0,-1);
ca.transformDirection(Oa.matrixWorld);Oa=ca;Aa=ra(Aa,Ca);Aa-=ma}else{4!==ja&&V.multiplyScalar((1===ja?-1:1)*Math.sign((1===ja?q:r).dot(za)));a:{switch(ja){case 1:Oa=r;break a;case 2:Oa=q;break a;case 4:Oa=l;break a}console.error("Unable to get direction for this value!");Oa=void 0}Aa=4===ja?-V.x:V.y}Ia.setFromAxisAngle(Oa,Aa);Ia.multiply(xa);Ia.normalize();Ea.setFromQuaternion(Ia,"ZXY");return Ea}}(),ia=function(){var V={hoveredCollider:null,hasAnythingChanged:!1};return function(xa,Ea,Ia){var Qa=
ya===WALK.TRANSFORM_MODE.TRANSLATE?ha:ya===WALK.TRANSFORM_MODE.ROTATE?F:J;xa=I.findMeshFromListAtPosition(Qa.colliders,xa,Ea,!0);Ea=!1;if(xa!==ka||ba!==Ia)ka=xa,Qa.highlight(xa,Ia),Ea=!0;V.hoveredCollider=xa;V.hasAnythingChanged=Ea;return V}}();this.onCanvasPointerMove=function(V,xa){if(this.transforming){if(this.mode===WALK.TRANSFORM_MODE.TRANSLATE){var Ea=na(ja,V,xa);Ea&&this.newPosition.copy(Ea.sub(M).add(va.position));R.copy(this.newPosition);R.sub(va.position);R.divide(va.scale);qa.update(R);
if(V!==fa||xa!==K)ha.visible=!1,qa.show(ja),va.show(ja)}else if(this.mode===WALK.TRANSFORM_MODE.ROTATE){if(va.show(ja),this.newRotation.copy(Da(V,xa)),V!==fa||xa!==K)F.visible=!1}else{va.show(ja);if(Ea=na(ja,V,xa))Ea.addScalar(1).divide(ea),this.newScale.copy(Ea);if(V!==fa||xa!==K)J.visible=!1}E.requestFrame();return!0}ia(V,xa,ba).hasAnythingChanged&&E.requestFrame();return!1};this.onCanvasPointerDown=function(V,xa){var Ea=ia(V,xa,!0);ba=!0;if(null!==Ea.hoveredCollider)return Z=!0,ja=(ya===WALK.TRANSFORM_MODE.TRANSLATE?
ha:ya===WALK.TRANSFORM_MODE.ROTATE?F:J).usedAxes(Ea.hoveredCollider),fa=V,K=xa,this.mode===WALK.TRANSFORM_MODE.TRANSLATE?(ta.show(ja),this.newPosition.copy(this.oldPosition),M.copy(na(ja,V,xa))):this.mode===WALK.TRANSFORM_MODE.ROTATE?7===ja&&(this.newRotation.copy(this.oldRotation),ma=ra(V,xa)):(ta.show(7===ja?0:ja),this.newScale.copy(this.oldScale),V=na(ja,V,xa),ea.copy(V).addScalar(1).divide(this.oldScale)),!0;ja=7;Z=!1;Ea.hasAnythingChanged&&E.requestFrame();return!1};this.onCanvasPointerUp=function(V,
xa){if(this.transforming){O(this.newPosition);S(this.newRotation);var Ea=this.newScale;U.oldScale.copy(Ea);U.newScale.copy(Ea);ta.show(0);qa.show(0);ja=7;va.show(ja);this.mode===WALK.TRANSFORM_MODE.TRANSLATE?ha.visible=!0:this.mode===WALK.TRANSFORM_MODE.ROTATE?F.visible=!0:J.visible=!0}Ea=this.transforming;Z=!1;this.update();ia(V,xa,!1).hasAnythingChanged&&E.requestFrame();ba=!1;return Ea};this.update=function(){if(!this.transforming&&(void 0!==this.target.position&&O(this.target.position),void 0!==
this.target.rotation&&S(this.target.rotation),void 0!==this.target.scale)){var V=this.target.scale;U.oldScale.copy(V);U.newScale.copy(V)}za.copy(D);za.sub(va.position);za.normalize();V=.18*va.position.distanceTo(D)*A.camera.fov/90;va.scale.set(V,V,V);ta.scale.set(V,V,V);qa.scale.set(V,V,V);ha.scale.set(V,V,V);F.scale.set(V,V,V);J.scale.set(V,V,V);F.update(A.camera);ta.update(A.camera);va.update(D);va.updateMatrixWorld();ta.updateMatrixWorld();qa.updateMatrixWorld();ha.updateMatrixWorld();F.updateMatrixWorld();
J.updateMatrixWorld()}}})();(function(){WALK.TransformControls=function(a,b,c,d,f){function g(){}function e(u){f.isEnabled()!==u&&(u?f.enable():f.disable())}var k=this,h=!1,l=new WALK.TransformGizmo(c,d,f.cameraWorldPosition(),b);l.mode=WALK.TRANSFORM_MODE.TRANSLATE;var r={itemModified:g},q=[];Object.defineProperty(this,"supportedModes",{get:function(){return q}});Object.defineProperty(this,"mode",{get:function(){return l.mode}});this.setItemModifiedCallback=function(u){console.assert(r.itemModified===g);r.itemModified=u};var m=
new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.TRANSFORM_CONTROLS);m.callbacks.onPointerDown=function(u,n){u=l.onCanvasPointerDown(u,n);e(!l.transforming);return u};m.callbacks.onPointerUp=function(u,n){u=l.onCanvasPointerUp(u,n);e(!l.transforming);return u};m.callbacks.onPointerMove=function(u,n){u=l.onCanvasPointerMove(u,n);l.transforming&&(l.mode===WALK.TRANSFORM_MODE.TRANSLATE?(n=l.newPosition,k.target.setPosition(n.x,n.y,n.z)):l.mode===WALK.TRANSFORM_MODE.ROTATE?(n=l.newRotation,k.target.setRotation(n.z,
n.x,n.y)):(n=l.newScale,k.target.setScale(n.x,n.y,n.z)),r.itemModified(k.target));return u};m.disable();Object.defineProperty(this,"target",{get:function(){return l.target}});this.setTransformMode=function(u){l.mode=u};this.update=function(){h&&l.update()};this.enable=function(u,n){h=!0;l.target=u;null!==u&&(l.update(),l.visible=!0);q=n;-1===n.indexOf(l.mode)&&(l.mode=n[0]);m.enable()};this.disable=function(){h=!1;q=[];l.visible=!1;m.disable()}}})();(function(){var a=function(b,c){this._nodesPrimary=b;this._nodesSecondary=c};a.prototype.constructor=a;Object.defineProperty(a.prototype,"highlightMix",{set:function(b){this._nodesPrimary.forEach(function(c){c.highlightMix=b});this._nodesSecondary.forEach(function(c){c.highlightMix=b})}});Object.defineProperty(a.prototype,"selected",{set:function(b){this._nodesPrimary.forEach(function(c){c.selected=b});this._nodesSecondary.forEach(function(c){c.selectedSecondary=b})}});WALK.EditorSelector=function(b,
c,d,f,g,e,k,h,l){function r(){}function q(){C.highlightMix=.8*Math.pow(A/y.selectionTimeSec,2)}function m(F){null!==C&&(C.highlightMix=0);null!==F&&(C=F,A=y.selectionTimeSec,q());h.requestFrame()}function u(F){var J=F.geometry;J&&void 0===J.getAttribute("order")&&F.visible&&(F.visible=!1,ha.push(F))}function n(){for(var F=$jscomp.makeIterator(ha),J=F.next();!J.done;J=F.next())J.value.visible=!0}function w(){W.set(!0,!1,!1);U.set(va);c.gpuMeshes.forEach(function(F){F.geometry.addTriangleOrderAttribute();
F.highlightMix=0;F.selected=!1;d.uploadNewBuffers(F)});ha.length=0;c.threeScene.traverse(u);c.threeScene.overrideMaterial=ta;c.skyMeshes.forEach(function(F){F.visible=!1})}function v(){W.restore();U.restore();n();c.threeScene.overrideMaterial=null;c.gpuMeshes.forEach(function(F){F.highlightMix=null;F.selected=null;F.selectedSecondary=!1});I=null;c.skyMeshes.forEach(function(F){F.visible=!0})}var y=this,C=null,A=0,I=null,D=0,E=new WALK.RayIntersection,O=new WALK.TransformControls(b,h,c,f,l),S={materialSelected:r,
lightInstanceSelected:r,lightProbeSelected:r,nodeSelected:r,extensionSelected:r,positionSelected:r},W=new WALK.AutoClearAlter(d),U=new WALK.ClearColorAlter(d),va=new THREE.Color(16777215),ta=new WALK.WireframeMaterial(new THREE.Color(0));ta.highlight=ta.meshSelectedLineColor;var qa;this.selectionTimeSec=1;this.selectMaterial=function(F,J){console.assert(qa===WALK.EditorSelector.SELECTION_MODE.MATERIAL);m(F);null!==F&&J&&S.materialSelected(F)};this.selectLight=function(F){console.assert(qa===WALK.EditorSelector.SELECTION_MODE.LIGHT);
g.showSelectionMesh(F);h.requestFrame()};this.selectLightInstance=function(F,J){var Z=null;console.assert(qa===WALK.EditorSelector.SELECTION_MODE.LIGHT);if(F){Z=g.getLightInstanceMaterial(F);var M=F.light.type;O.enable(F,"point"===M?[WALK.TRANSFORM_MODE.TRANSLATE]:"sun"===M?[WALK.TRANSFORM_MODE.ROTATE]:[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE])}else O.disable();m(Z);F&&J&&S.lightInstanceSelected(F)};this.selectLightProbe=function(F,J){var Z=null;console.assert(qa===WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE);
F?(e.showLightProbeBoundingBox(F),Z=e.getLightProbeMaterial(F),O.enable(F,[WALK.TRANSFORM_MODE.TRANSLATE])):O.disable();m(Z);F&&J&&S.lightProbeSelected(F)};this.selectEditorCameraVolume=function(F){console.assert(qa===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME);F?(m(k.setHighlightedCameraVolume(F)),O.enable(F,[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE,WALK.TRANSFORM_MODE.SCALE])):(m(null),O.disable())};this.selectExtension=function(F,J){var Z=null;console.assert(qa===WALK.EditorSelector.SELECTION_MODE.EXTENSION);
if(F&&0<F.triggers.length){var M=F.triggers[0].mesh;M&&(Z=M.material)}m(Z);F&&J&&S.extensionSelected(F)};this.selectNodes=function(F,J){console.assert(qa===WALK.EditorSelector.SELECTION_MODE.NODE);I&&(I.selected=!1);F.length||J.length?(I=new a(F,J),I.selected=!0):I=null;m(I)};this._selectNode=function(F){null!==F?this.selectNodes([F],[]):this.selectNodes([],[]);F&&S.nodeSelected(F)};this.update=function(F){O.update();null!==C&&(A-=F,0<A?q():(C.highlightMix=0,C=null),h.requestFrame())};var ha=[];this.setDistanceToObject=
function(F){D=F};this.setSelectionMode=function(F){if(F!==qa){qa===WALK.EditorSelector.SELECTION_MODE.NODE&&v();qa===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&k.setControlsVisible(!1);switch(F){case WALK.EditorSelector.SELECTION_MODE.OFF:case WALK.EditorSelector.SELECTION_MODE.MATERIAL:case WALK.EditorSelector.SELECTION_MODE.EXTENSION:case WALK.EditorSelector.SELECTION_MODE.POSITION:case WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME:g.hideLights();e.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT:g.showLights();
e.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:g.hideLights();e.showLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.NODE:g.hideLights(),e.hideLightProbes(),w()}F===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&k.setControlsVisible(!0);O.disable();if(F===WALK.EditorSelector.SELECTION_MODE.MATERIAL)for(var J=$jscomp.makeIterator(c.getAnimatedMaterials()),Z=J.next();!Z.done;Z=J.next())Z.value.play();else for(J=$jscomp.makeIterator(c.getAnimatedMaterials()),
Z=J.next();!Z.done;Z=J.next())Z.value.pause();qa=F}};this.setMaterialSelectedCallback=function(F){console.assert(S.materialSelected===r);S.materialSelected=F};this.setLightInstanceSelectedCallback=function(F){console.assert(S.lightInstanceSelected===r);S.lightInstanceSelected=F};this.setLightProbeSelectedCallback=function(F){console.assert(S.lightProbeSelected===r);S.lightProbeSelected=F};this.setNodeSelectedCallback=function(F){console.assert(S.nodeSelected===r);S.nodeSelected=F};this.setExtensionSelectedCallback=
function(F){console.assert(S.extensionSelected===r);S.extensionSelected=F};this.setPositionSelectedCallback=function(F){console.assert(S.positionSelected===r);S.positionSelected=F};(function(){var F=new WALK.PointerEventHelper(b,WALK.POINTER_PRIORITY.EDITOR_SELECTOR);F.callbacks.onClick=function(J,Z){if(qa===WALK.EditorSelector.SELECTION_MODE.OFF)return!1;var M=!1;qa===WALK.EditorSelector.SELECTION_MODE.MATERIAL?(J=f.findObstacleMeshAtPosition(J,Z),J=null!==J?J.material:null,y.selectMaterial(J,!0)):
qa===WALK.EditorSelector.SELECTION_MODE.LIGHT?(J=f.findMeshFromListAtPosition(g.lightInstanceMeshes,J,Z),J=null!==J?J.userData.lightInstance:null,null!==J&&y.selectLightInstance(J,!0)):qa===WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE?(J=f.findMeshFromListAtPosition(e.lightProbeMeshes,J,Z),J=null!==J?J.lightProbe:null,null!==J&&y.selectLightProbe(J,!0)):qa===WALK.EditorSelector.SELECTION_MODE.NODE?(J=f.findObstacleMeshAtPosition(J,Z),J=null!==J?J.node:null,y._selectNode(J)):qa===WALK.EditorSelector.SELECTION_MODE.EXTENSION?
(J=f.findIntersectionAtPosition(J,Z,!1,E)?E.object.anchor||null:null,y.selectExtension(J?J.extension:null,!0)):qa===WALK.EditorSelector.SELECTION_MODE.POSITION&&(J=f.findIntersectionAtPosition(J,Z,!1,E)&&!E.object.anchor?f.movePointTowardsTheCamera(E.point,D):null,J&&(S.positionSelected(J),M=!0));return M};F.callbacks.onDoubleClick=function(J,Z){return!1}})();Object.defineProperty(this,"transformControls",{get:function(){return O}});this.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};WALK.EditorSelector.SELECTION_MODE=
{OFF:0,MATERIAL:1,LIGHT:2,LIGHT_PROBE:3,NODE:4,EXTENSION:6,POSITION:7,CAMERA_VOLUME:8}})();(function(){function a(){WALK.BaseMaterial.call(this,WALK.getShader("static_render_vertex.glsl"),WALK.getShader("static_render_fragment.glsl"));this.uniforms={staticRender:{type:"t",value:null},sizeInv:{type:"v2",value:new THREE.Vector2}}}function b(c){c=WALK.createRenderer(c,{antialias:!1});c.autoClear=!1;c.autoUpdateObjects=!1;c.sortObjects=!1;return c}a.prototype=Object.create(WALK.BaseMaterial.prototype);a.prototype.constructor=a;WALK.StaticRenderViewer=function(c){var d=b(c),f=new a,g=new THREE.OrthographicCamera(-1,
1,1,-1,0,1),e=new THREE.Scene;c=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),f);d.uploadNewBuffers(c);e.add(c);this.update=function(k){var h=new Float32Array(k,0,k.byteLength/4);k=h[0];var l=h[1];h=h.subarray(2);console.assert(k*l===h.length/3);h=new WALK.DataTexture(h,k,l,GLC.RGB,GLC.FLOAT);h.minFilter=GLC.NEAREST;h.magFilter=GLC.NEAREST;h.generateMipmaps=!1;h.flipY=!1;h.needsUpdate=!0;f.uniforms.staticRender.value=h;f.uniforms.sizeInv.value.set(1/k,1/l);d.setCanvasSize(k,l);d.render(e,g);h.dispose()}}})();(function(){WALK.VRManager=function(a,b,c,d,f,g,e){function k(){return WALK.DETECTOR.ios&&void 0!==DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&void 0!==DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?new Promise(function(O,S){Promise.all([DeviceMotionEvent.requestPermission(),DeviceOrientationEvent.requestPermission()]).then(function(W){"granted"===W[0]&&"granted"===W[1]?O():S()},function(){S()})}):Promise.resolve()}function h(){m=
null;I.dispose();n=u=v=I=null;b.removeAllXrGamepads();e(!1);if(A){var O=A;A=null;O()}}function l(O){for(var S=$jscomp.makeIterator(O.removed),W=S.next();!W.done;W=S.next())W=W.value,W.gamepad&&b.removeXrGamepad(W.gamepad);O=$jscomp.makeIterator(O.added);for(W=O.next();!W.done;W=O.next())S=W.value,S.gamepad&&b.addXrGamepad(S.gamepad,S.handedness)}var r=navigator.xr,q=c?!c.nativeWebXR:!1,m,u,n,w=!1,v,y,C,A=null,I,D=new THREE.Matrix4,E=WALK.CAMERA_MIN_FAR;this.setCameraFar=function(O){E=O;m&&(v.depthFar=
E,m.updateRenderState(v))};this.render=function(O,S,W){C.set(!1,!0,!1);y.matrixWorld=S;S=y.projectionMatrix;for(var U=n.views,va=0;va<U.length;++va){var ta=U[va];D.fromArray(ta.transform.inverse.matrix);S.fromArray(n.transform.matrix);D.multiply(S);S.fromArray(ta.projectionMatrix);S.multiply(D);W(y);a.enableScissorTest(!0);ta=v.baseLayer.getViewport(ta);a.setScissor(ta.x,ta.y,ta.width,ta.height);I.x=ta.x;I.y=ta.y;I.width=ta.width;I.height=ta.height;a.render(O,y,I);a.enableScissorTest(!1)}C.restore()};
this.enableVr=function(O){r?w?(g(!0),k().then(function(){return O.makeXRCompatible().then(function(){return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"]})}).then(function(S){m=S;return m.requestReferenceSpace("local-floor")}).then(function(S){u=S;S=new XRWebGLLayer(m,O);I=a.createFrameBufferRenderTarget(S.framebuffer);v={baseLayer:S};y||(y=new THREE.PerspectiveCamera,C=new WALK.AutoClearAlter(a));v.depthNear=WALK.CAMERA_WALK_NEAR;v.depthFar=E;m.updateRenderState(v);
m.addEventListener("end",h);q||m.addEventListener("inputsourceschange",l);g(!1);e(!0)}).catch(function(){g(!1);WALK.USER_MSG.info("Failed to enable VR mode")})}).catch(function(){g(!1);WALK.USER_MSG.info("Permissions necessary for VR mode not granted")})):WALK.USER_MSG.info("VR device not connected"):WALK.USER_MSG.info('You need a <a href="https://mozvr.com/#start" target="_blank">VR ready browser</a>.')};this.disableVr=function(){m.end().then(function(){WALK.USER_MSG.hideInfo()},function(){WALK.USER_MSG.info("Failed to exit VR mode")})};
this.vrEnabled=function(){return!!u};this.requestAnimationFrame=function(){function O(S,W){n=W.getViewerPose(u);A&&(W=A,A=null,W(S))}return function(S){A=S;m.requestAnimationFrame(O)}}();this.update=function(){var O=new WALK.Euler,S=new THREE.Vector3;return function(){if(n){var W=n.transform;if(null!==W.orientation){O.setFromQuaternion(W.orientation,"YXZ");var U=O.y;O.y=-O.z;O.z=U;W=W.position;f(O,W&&S.set(W.x,-W.z,W.y,W.w))}}}}();(WALK.DETECTOR.https||WALK.DETECTOR.localhost)&&r?(c=function(){navigator.xr.isSessionSupported("immersive-vr").then(function(O){w=
O;d(O)})},c(),navigator.xr.addEventListener("devicechange",c,!1)):d(!1)}})();(function(){WALK.RaycasterConfig=function(a,b,c){this.ray=new THREE.Ray(a,b);this.far=c||Infinity;this.ignoreVisibility=this.onlyGroundCollisions=this.respectColliderSettings=!1};WALK.RayIntersection=function(){this.distance=Infinity;this.point=new THREE.Vector3;this.object=null};WALK.GpuRaycaster=function(a,b){function c(q,m){if(!m.ignoreVisibility&&!q.visible)return!1;var u=q.node||r;if(u.disableCollisions&&m.respectColliderSettings||!u.ground&&m.onlyGroundCollisions)return!1;u=m.ray;if(q.matrixWorld)return!0;
var n=q.geometry.boundingSphere;if(n.distanceToPoint(u.origin)>m.far||!1===u.isIntersectionSphere(n))return!1;q=q.geometry.boundingBox;return q.distanceToPoint(u.origin)>m.far||!u.isIntersectionBox(q)?!1:!0}var d=a.createRenderTarget(1,1,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),f=new Uint8Array(4),g=new WALK.AutoClearAlter(a),e=new WALK.ClearColorAlter(a),k=new THREE.Color(16777215),h=new WALK.ObjectDistanceMaterial(!1),l=new THREE.PerspectiveCamera(1,
1,b.near,b.far),r={disableCollisions:!1,ground:!1};this.closestIntersection=function(q,m,u){for(var n=[],w=0;w<q.length;w+=1){var v=q[w];console.assert(null===v.visibilityId);c(v,m)&&(v.visibilityId=n.length,n.push(v))}if(0===n.length)return!1;l.position.set(0,0,0);l.lookAt(m.ray.direction);l.position.copy(m.ray.origin);l.updateMatrixWorld();g.set(!0,!0,!1);e.set(k);q=a.sortObjects;a.sortObjects=!1;a.renderMeshes(n,h,l,d,!1,m.ignoreVisibility);a.sortObjects=q;e.restore();g.restore();a.readPixels(1,
1,f);a.setRenderTarget(null);q=256*f[0]+f[1];w=f[2]+f[3]/255;for(v=0;v<n.length;v+=1)n[v].visibilityId=null;if(65535===q||w>m.far)return!1;console.assert(q<n.length);u.object=n[q];u.distance=w;u.point.copy(m.ray.direction).multiplyScalar(w).add(m.ray.origin);return!0}}})();(function(){WALK.movePointTowards=function(){var a=new THREE.Vector3;return function(b,c,d){a.copy(b);a.sub(c).normalize();a.multiplyScalar(d);return b.sub(a)}}();WALK.Collider=function(a,b,c){var d=this,f=new THREE.Octree({scene:null,depthMax:Infinity,objectsThreshold:8,overlapPct:.15}),g=c.cameraWorldPosition(),e=b.camera,k=[];this.addStaticObstacle=function(q,m,u){f.add(q,m,u)};this.addDynamicObstacle=function(q){k.push(q)};this.removeDynamicObstacle=function(q){WALK.removeFromArray(q,k)};var h=
function(){var q=new WALK.GpuRaycaster(a,e);return function(m,u){for(var n=f.search(m.ray.origin,m.far,m.ray.direction),w=0;w<k.length;w+=1)n.push(k[w]);return q.closestIntersection(n,m,u)?!0:!1}}(),l=function(){var q=new WALK.RayIntersection;return function(m){return h(m,q)?q.distance:Infinity}}(),r=function(){var q=new WALK.RaycasterConfig;q.ray.direction.set(0,0,-1);q.respectColliderSettings=!0;q.onlyGroundCollisions=e.autoClimb;return function(m,u){q.ray.origin.copy(m);q.far=u;m=l(q);return e.autoClimb||
1<=m?m:Infinity}}();this.distanceToGround=function(q){return r(g,q)};this.objectBelowCamera=function(){var q=new WALK.RayIntersection,m=new WALK.RaycasterConfig(g);m.ray.direction.set(0,0,-1);m.respectColliderSettings=!0;return function(u){m.far=u;return h(m,q)?q.object:null}}();this.distanceToCeiling=function(){var q=new WALK.RaycasterConfig(g);q.ray.direction.set(0,0,1);q.respectColliderSettings=!0;return function(m){q.far=m;return l(q)}}();this.distanceToCeilingFrom=function(){var q=new WALK.RaycasterConfig;
q.ray.direction.set(0,0,1);q.respectColliderSettings=!0;return function(m,u){q.ray.origin.copy(m);q.far=u;return l(q)}}();this.cameraHeightFromPoint=function(q){q=r(q,WALK.MAX_GROUND_SEARCH_DEPTH);return Infinity===q?null:q};this.adjustPointToMatchCameraHeight=function(q){var m=c.cameraHeight;if(null===m)return!1;var u=r(q,WALK.MAX_GROUND_SEARCH_DEPTH);if(Infinity===u)return!1;m-=u;if(.01>Math.abs(m)||0<m&&Infinity!==this.distanceToCeilingFrom(q,m+WALK.MIN_DISTANCE_TO_CEILING))return!1;q.z+=m;return!0};
this.findIntersectionAtPosition=function(){var q=new WALK.RaycasterConfig(g),m=q.ray.direction;return function(u,n,w,v){m.set(u,n,1).unproject(c.camera());m.sub(g).normalize();q.respectColliderSettings=w;return h(q,v)}}();this.findObstacleMeshAtPosition=function(){var q=new WALK.RayIntersection;return function(m,u){return this.findIntersectionAtPosition(m,u,!1,q)?q.object:null}}();this.findMeshFromListAtPosition=function(){var q=new WALK.RaycasterConfig(g),m=new WALK.RayIntersection,u=new WALK.GpuRaycaster(a,
e),n=q.ray.direction;return function(w,v,y,C,A){q.ignoreVisibility=void 0===C?!1:C;C=void 0===A?m:A;n.set(v,y,1).unproject(e);n.sub(g).normalize();return u.closestIntersection(w,q,C)?C.object:null}}();this.clickedPointToMoveTarget=function(){function q(y){var C=u.x-v.x;var A=u.y-v.y;C=Math.sqrt(C*C+A*A);m.far=C+WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE;n.x=v.x-u.x;n.y=v.y-u.y;if(!(.01>Math.abs(n.x)&&.01>Math.abs(n.y)))if(n.z=0,n.normalize(),h(m,w)){if(A=w.distance-WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE,
0<A&&(y.x=u.x+n.x*A,y.y=u.y+n.y*A,y.z=u.z),A=Math.min(w.distance-.01,C),u.x+=n.x*A,u.y+=n.y*A,d.adjustPointToMatchCameraHeight(u))return q(y)}else y.x=v.x,y.y=v.y,y.z=u.z}var m=new WALK.RaycasterConfig;m.respectColliderSettings=!0;var u=m.ray.origin,n=m.ray.direction,w=new WALK.RayIntersection,v=new THREE.Vector3;return function(y){u.copy(g);v.copy(y);y.copy(g);q(y);d.adjustPointToMatchCameraHeight(y)}}();this.movePointTowardsTheCamera=function(q,m){return WALK.movePointTowards(q,g,m)};this.handleCollisions=
function(){function q(y){c.applyCameraYaw(u);u.normalize();var C=n.start.distanceTo(g),A=n.end.distanceTo(g);if(v-.02<C+A&&C+A<v+.02&&A>=y&&w.equals(u))return!1;C=l(m);Infinity===C&&(C=m.far);w.copy(u);n.start.copy(g);n.end.copy(u).multiplyScalar(C).add(g);v=n.distance();return C<y}var m=new WALK.RaycasterConfig(g),u=m.ray.direction,n=new THREE.Line3,w=new THREE.Vector3,v=0;m.respectColliderSettings=!0;m.far=5;console.assert(m.far>WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE);return function(y){y=c.maxFrameMoveLinearDistance(y)+
WALK.KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE;c.movesForward()&&(u.set(0,1,0),q(y)&&c.stopForward());c.movesBackward()&&(u.set(0,-1,0),q(y)&&c.stopBackward());c.movesLeft()&&(u.set(-1,0,0),q(y)&&c.stopLeft());c.movesRight()&&(u.set(1,0,0),q(y)&&c.stopRight());c.movesDown()&&(u.set(0,0,-1),q(y)&&c.stopDown());c.movesUp()&&(u.set(0,0,1),q(y)&&c.stopUp())}}()}})();(function(){WALK.OrbitControls=function(a,b,c,d){function f(){var Q=b.getYawAngle(),fa=b.getPitchAngle(),K=b.cameraWorldPosition();D.copy(K).sub(m.target);m.autoRotate&&ea===ma.NONE&&m.rotateLeft(2*Math.PI/60/60*m.autoRotateSpeed);var R=m.getMinYawAngle(),ka=m.getMaxYawAngle();Math.abs(ka-R)>=2*Math.PI-1E-6?Q+=W:R===ka?Q=R:(R>ka&&(ka+=2*Math.PI,Q<R&&(Q+=2*Math.PI)),Q=0>W?Math.min(Math.max(Q+W,R),ka):Math.max(Math.min(Q+W,ka),R));fa=THREE.Math.clamp(fa+U,m.getMinPitchAngle(),m.getMaxPitchAngle());
R=D.length()*va;R=THREE.Math.clamp(R,m.minDistance,m.maxDistance);m.target.add(ta);WALK.OrbitControls.computeCameraPosition(K,m.target,Q,fa,R);b.cameraPositionUpdated();b.setYawAngle(Q);b.setPitchAngle(fa);U=W=0;va=1;ta.set(0,0,0);d.requestFrame()}function g(){Z=M=F=J=ha=0;ya&&(ya(),ya=!1)}function e(Q){if(!1!==u){Q.preventDefault();var fa=c===document?c.body:c;if(ea===ma.ROTATE){if(!0===m.noRotate)return;w.set(Q.clientX,Q.clientY);v.subVectors(w,n);m.rotateLeft(v.x/fa.clientWidth*m.mouseRotateSpeed);
!1===m.noPitchRotate&&m.rotateUp(v.y/fa.clientHeight*m.mouseRotateSpeed);n.copy(w)}else if(ea===ma.DOLLY){if(!0===m.noZoom)return;O.set(Q.clientX,Q.clientY);S.subVectors(O,E);0<S.y?m.dollyIn():0>S.y&&m.dollyOut();E.copy(O)}else if(ea===ma.PAN){if(!0===m.noPan)return;C.set(Q.clientX,Q.clientY);A.subVectors(C,y);m.pan(A.x/fa.clientHeight,A.y/fa.clientWidth);y.copy(C)}ea!==ma.NONE&&f()}}function k(){!1!==u&&ya&&(ya(),ya=!1)}function h(Q){if(!1!==u&&!0!==m.noZoom&&ea===ma.NONE){Q.preventDefault();var fa=
0;void 0!==Q.wheelDelta?fa=Q.wheelDelta:void 0!==Q.detail&&(fa=-Q.detail);0<fa?m.dollyOut():0>fa&&m.dollyIn();f()}}function l(Q,fa,K){return!0===K?fa:Q===fa?0:Q}function r(Q,fa){var K=!1,R=Q.keyCode;if(!1!==u){if(!0===qa&&!1===m.noPan)if(38===R||87===R)M=l(M,1,fa),K=!0;else if(40===R||83===R)M=l(M,-1,fa),K=!0;else if(37===R||65===R)Z=l(Z,1,fa),K=!0;else{if(39===R||68===R)Z=l(Z,-1,fa),K=!0}else if(!1===qa&&!1===m.noRotate)if((38===R||87===R)&&!1===m.noPitchRotate)J=l(J,1,fa),K=!0;else if((40===R||
83===R)&&!1===m.noPitchRotate)J=l(J,-1,fa),K=!0;else if(37===R||65===R)F=l(F,1,fa),K=!0;else if(39===R||68===R)F=l(F,-1,fa),K=!0;switch(R){case m.dollyKeys.IN1:case m.dollyKeys.IN2:case m.dollyKeys.IN3:!1===m.noZoom&&(ha=l(ha,1,fa),K=!0);break;case m.dollyKeys.OUT1:case m.dollyKeys.OUT2:case m.dollyKeys.OUT3:!1===m.noZoom&&(ha=l(ha,-1,fa),K=!0)}K&&(Q.preventDefault(),d.requestFrame())}}function q(Q){return m.noPan?!1:qa&&1===Q.length?!0:qa||2!==Q.length?!1:Math.abs(Q[0].clientY-Q[1].clientY)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}
this.target=new THREE.Vector3;this.noZoom=!1;this.mouseZoomSpeed=.98;this.keyZoomSpeed=.7;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.noPitchRotate=this.noRotate=!1;this.mouseRotateSpeed=2*Math.PI;this.keyYawRotateSpeed=Math.PI/4;this.keyPitchRotateSpeed=this.keyYawRotateSpeed/2;this.autoRotate=!1;this.autoRotateSpeed=2;this.getMinPitchAngle=function(){return-Math.PI/2};this.getMaxPitchAngle=function(){return Math.PI/2};this.getMinYawAngle=function(){return-Math.PI};
this.getMaxYawAngle=function(){return Math.PI};this.noPan=!1;this.keyPanSpeed=.25;this.dollyKeys={IN1:61,IN2:187,IN3:69,OUT1:173,OUT2:189,OUT3:81};this.primaryMouseButton=THREE.MOUSE.LEFT;this.secondaryMouseButton=THREE.MOUSE.RIGHT;this.mouseButtons={ROTATE:this.primaryMouseButton,ZOOM:THREE.MOUSE.MIDDLE,PAN:this.secondaryMouseButton};var m=this,u=!1,n=new THREE.Vector2,w=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,C=new THREE.Vector2,A=new THREE.Vector2,I=new THREE.Vector3,D=new THREE.Vector3,
E=new THREE.Vector2,O=new THREE.Vector2,S=new THREE.Vector2,W=0,U=0,va=1,ta=new THREE.Vector3,qa=!1,ha=0,F=0,J=0,Z=0,M=0,ma={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},ea=ma.NONE,ya=!1;this.enable=function(){u=!0;f()};this.disable=function(){u=!1;g()};this.isEnabled=function(){return u};this.setPanPrimary=function(Q){qa=Q;!0===qa?(this.mouseButtons.PAN=this.primaryMouseButton,this.mouseButtons.ROTATE=this.secondaryMouseButton):(this.mouseButtons.ROTATE=this.primaryMouseButton,
this.mouseButtons.PAN=this.secondaryMouseButton)};this.getCameraDistance=function(){var Q=new THREE.Vector3;return function(){Q.copy(b.cameraWorldPosition()).sub(this.target);return Q.length()}}();this.rotateLeft=function(Q){void 0===Q&&(Q=2*Math.PI/60/60*m.autoRotateSpeed);W-=Q};this.rotateUp=function(Q){void 0===Q&&(Q=2*Math.PI/60/60*m.autoRotateSpeed);U-=Q};this.panLeft=function(Q){var fa=a.matrixWorld.elements;I.set(fa[0],fa[1],fa[2]);I.multiplyScalar(-Q);ta.add(I)};this.panUp=function(Q){var fa=
a.matrixWorld.elements;I.set(fa[4],fa[5],fa[6]);I.multiplyScalar(Q);ta.add(I)};this.pan=function(Q,fa){if(a instanceof THREE.PerspectiveCamera){var K=b.cameraWorldPosition().clone().sub(m.target).length();K*=Math.tan(a.fov/2*Math.PI/180);m.panLeft(2*Q*K);m.panUp(2*fa*K)}else a instanceof THREE.OrthographicCamera&&(m.panLeft(Q*(a.right-a.left)),m.panUp(fa*(a.top-a.bottom)))};this.dollyIn=function(Q){void 0===Q&&(Q=this.mouseZoomSpeed);a instanceof THREE.PerspectiveCamera?va/=Q:a instanceof THREE.OrthographicCamera&&
(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom*Q)),a.updateProjectionMatrix())};this.dollyOut=function(Q){void 0===Q&&(Q=this.mouseZoomSpeed);a instanceof THREE.PerspectiveCamera?va*=Q:a instanceof THREE.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom/Q)),a.updateProjectionMatrix())};this.update=function(Q){if(u&&Q){var fa=!1;0!==F&&(m.rotateLeft(F*m.keyYawRotateSpeed*Q),fa=!0);0!==J&&(m.rotateUp(J*m.keyPitchRotateSpeed*Q),fa=!0);if(0!==Z||0!==M)m.pan(Z*
m.keyPanSpeed*Q,M*m.keyPanSpeed*Q),fa=!0;0!==ha&&(Q=Math.pow(m.keyZoomSpeed,Q),-1===ha?m.dollyIn(Q):m.dollyOut(Q),fa=!0);fa&&f()}};c.addEventListener("mousedown",function(Q){if(!1!==u){c.focus();Q.preventDefault();if(Q.button===m.mouseButtons.ROTATE){if(!0===m.noRotate)return;ea=ma.ROTATE;n.set(Q.clientX,Q.clientY)}else if(Q.button===m.mouseButtons.ZOOM){if(!0===m.noZoom)return;ea=ma.DOLLY;E.set(Q.clientX,Q.clientY)}else if(Q.button===m.mouseButtons.PAN){if(!0===m.noPan)return;ea=ma.PAN;y.set(Q.clientX,
Q.clientY)}ea!==ma.NONE&&(document.addEventListener("mousemove",e,!1),document.addEventListener("mouseup",k,!1),ya=function(){document.removeEventListener("mousemove",e,!1);document.removeEventListener("mouseup",k,!1);ea=ma.NONE})}},!1);c.addEventListener("mousewheel",h,!1);c.addEventListener("DOMMouseScroll",h,!1);c.addEventListener("touchstart",function(Q){if(!1!==u){var fa=Q.touches.length;Q.preventDefault();q(Q.touches)?(ea=ma.TOUCH_PAN,y.set(Q.touches[0].clientX,Q.touches[0].clientY)):m.noRotate||
qa||1!==fa?m.noZoom||2!==fa?ea=ma.NONE:(ea=ma.TOUCH_DOLLY,fa=Q.touches[0].clientX-Q.touches[1].clientX,Q=Q.touches[0].clientY-Q.touches[1].clientY,E.set(0,Math.sqrt(fa*fa+Q*Q))):(ea=ma.TOUCH_ROTATE,n.set(Q.touches[0].clientX,Q.touches[0].clientY))}},!1);c.addEventListener("touchend",function(){!1!==u&&(ea=ma.NONE)},!1);c.addEventListener("touchmove",function(Q){if(!1!==u){var fa=Q.touches.length;Q.preventDefault();var K=c===document?c.body:c;q(Q.touches)&&ea===ma.TOUCH_PAN?(C.set(Q.touches[0].clientX,
Q.touches[0].clientY),A.subVectors(C,y),m.pan(A.x/K.clientHeight,A.y/K.clientWidth),y.copy(C),f()):m.noRotate||qa||1!==fa||ea!==ma.TOUCH_ROTATE?m.noZoom||2!==fa||ea!==ma.TOUCH_DOLLY?ea=ma.NONE:(fa=Q.touches[0].clientX-Q.touches[1].clientX,Q=Q.touches[0].clientY-Q.touches[1].clientY,O.set(0,Math.sqrt(fa*fa+Q*Q)),S.subVectors(O,E),0<S.y?m.dollyOut():0>S.y&&m.dollyIn(),E.copy(O),f()):(w.set(Q.touches[0].clientX,Q.touches[0].clientY),v.subVectors(w,n),m.rotateLeft(v.x/K.clientWidth*m.mouseRotateSpeed),
m.rotateUp(v.y/K.clientHeight*m.mouseRotateSpeed),n.copy(w),f())}},!1);c.addEventListener("blur",function(Q){g()},!1);window.addEventListener("keydown",function(Q){WALK.isModifierPressed(Q)||r(Q,!0)},!1);window.addEventListener("keyup",function(Q){r(Q,!1)},!1);a instanceof THREE.PerspectiveCamera||a instanceof THREE.OrthographicCamera||console.warn("WARNING: OrbitControls.js requires perspective or orthographic camers")};WALK.OrbitControls.prototype.constructor=WALK.OrbitControls;WALK.OrbitControls.computeCameraPosition=
function(){var a=new THREE.Vector3;return function(b,c,d,f,g){d-=Math.PI/2;f+=Math.PI/2;a.x=g*Math.sin(f)*Math.cos(d);a.y=g*Math.sin(f)*Math.sin(d);a.z=g*Math.cos(f);b.copy(c).add(a)}}()})();(function(){WALK.Controls=function(a,b,c,d){function f(){fa.rotation.z=WALK.normalizeRotation(ka.z+R.z)}function g(){f();Q.rotation.x=WALK.normalizeRotation(ka.x+R.x);ya.rotation.y=ka.y;fa.updateMatrixWorld(!0)}function e(ba){return Math.abs(ba[0].y-ba[1].y)<=WALK.MAX_TWO_POINTERS_IN_LINE_DIFF}function k(ba){U[0].copy(W[0]);U[1].copy(W[1]);ba.touches?(W[0].set(ba.touches[0].clientX,ba.touches[0].clientY),2===ba.touches.length?W[1].set(ba.touches[1].clientX,ba.touches[1].clientY):W[1].set(0,0)):(W[0].set(ba.clientX,
ba.clientY),W[1].set(0,0))}function h(ba){if(n)if(ba.preventDefault(),k(ba),J){if(J!==F){if(J===ta){var ja=Z[0].distanceTo(Z[1]);ba=W[0].distanceTo(W[1]);10<=Math.abs(ba-ja)?(J=qa,ja=!0):e(W)&&e(Z)&&10<=Math.abs(W[0].y-Z[0].y)?(J=ha,ja=!0):ja=!1;if(!ja)return}J===qa?(ja=U[1].distanceTo(U[0]),ja=W[1].distanceTo(W[0])-ja,0<Math.abs(ja)&&(M=Date.now(),E.activateDirectionFromSource(Math.sign(ja),C)),d.requestFrame()):J===ha&&e(W)&&(ja=W[0].y-U[0].y,0<Math.abs(ja)&&(ma=Date.now(),O.activateDirectionFromSource(Math.sign(ja),
C)),d.requestFrame())}}else if(!u.mousePressLook||ea||!J&&ba.touches){ja=ba.movementX||ba.mozMovementX||ba.webkitMovementX;void 0===ja&&(ja=W[0].x-U[0].x);var na=ba.movementY||ba.mozMovementY||ba.webkitMovementY;void 0===na&&(na=W[0].y-U[0].y);ba=u.flipMouseLook||!J&&ba.touches?1:-1;R.z+=ba*ja*WALK.CAMERA_LOOK_SPEED;u.mouseControlsPitch&&(R.x+=ba*na*WALK.CAMERA_LOOK_SPEED);u.restrictVerticalAngle&&(R.x>u.verticalAngleMax?R.x=u.verticalAngleMax:R.x<u.verticalAngleMin&&(R.x=u.verticalAngleMin));g();
d.requestFrame()}}function l(ba){n&&(b.focus(),ba.preventDefault(),k(ba),ea=!0,d.requestFrame())}function r(ba){n&&(ba.preventDefault(),ea=!1)}function q(ba){var ja=0,na;(na=!n)||(na=void 0!==document.hasFocus?document.hasFocus():document.activeElement===b,na=!na);na||(ba||(ba=window.event),ba.preventDefault(),ba.wheelDelta?ja=ba.wheelDelta/120:ba.detail&&(ja=-ba.detail/3),va+=ja*WALK.CAMERA_SCROLL_SPEED,va=0<=va?Math.min(va,.5):Math.max(va,-.5),d.requestFrame())}function m(){u.stopForward();u.stopBackward();
u.stopLeft();u.stopRight();u.stopUp();u.stopDown();S.stopInDirection(1);S.stopInDirection(-1)}var u=this,n=!0,w=Math.PI/12,v=Symbol("MOVE_SOURCE_NONE"),y=Symbol("MOVE_SOURCE_KEY"),C=Symbol("MOVE_SOURCE_GESTURE"),A=Symbol("MOVE_SOURCE_GAMEPAD"),I=function(ba){this.activeDirection=0;this.activeSource=v;this.speed=0;this.moves=function(){return this.activeDirection||this.speed};this.movesInDirection=function(ja){return this.activeDirection===ja||Math.sign(this.speed)===ja};this.activateDirectionFromSource=
function(ja,na){this.activeDirection=ja;this.activeSource=na};this.deactivateDirectionFromSource=function(ja,na){this.activeDirection===ja&&this.activeSource===na&&(this.activeDirection=0,this.activeSource=na)};this.deactivateSource=function(ja){this.activeSource===ja&&(this.activeDirection=0,this.activeSource=v)};this.stopInDirection=function(ja){this.activeDirection===ja&&(this.activeDirection=0,this.activeSource=v);Math.sign(this.speed)===ja&&(this.speed=0)};this.update=function(ja,na){if(!this.moves())return 0;
var ra=Math.sign(this.speed),za=this.activeDirection||-ra;za=na*za*(ra===za?ja/WALK.CAMERA_FULL_ACCELERATION_TIME:ja/WALK.CAMERA_FULL_DECELERATION_TIME);na*=this.speed+za/2;this.speed=THREE.Math.clamp(this.speed+za,-ja,ja);this.activeDirection||Math.sign(this.speed)===ra||(this.speed=0);return THREE.Math.clamp(na,-ba,ba)}},D=new I(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),E=new I(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),O=new I(WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),S=new I(w),W=[new THREE.Vector2(0,
0),new THREE.Vector2(0,0)],U=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],va=0,ta=Symbol("GESTURE_RECOGNITION"),qa=Symbol("GESTURE_PINCH"),ha=Symbol("GESTURE_TWO_POINTER_DRAG"),F=Symbol("GESTURE_IGNORE"),J=null,Z=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],M=0,ma=0,ea=!1,ya=new THREE.Object3D,Q=new THREE.Object3D,fa=new THREE.Object3D,K=!1,R=new THREE.Vector3(0,0,0),ka=new THREE.Euler(0,0,0);ya.add(a);Q.add(ya);fa.add(Q);this.flipMouseLook=this.mousePressLook=!1;this.restrictVerticalAngle=
this.mouseControlsPitch=!0;this.verticalAngleMin=-Math.PI/2;this.verticalAngleMax=Math.PI/3;this.arrowsTurn=!0;this.orbit=new WALK.OrbitControls(a,this,b,d);this.orbit.keyYawRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED;this.orbit.keyPitchRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED/2;this.cameraHeight=null;this.isFpsEnabled=function(){return n};this.isOrbitEnabled=function(){return this.orbit.isEnabled()};this.orbitModeEnable=function(){n=!1;this.orbit.enable()};this.camera=function(){return a};this.applyCameraYaw=
function(ba){ba.applyEuler(fa.rotation)};this.cameraWorldPosition=function(){return fa.position};this.cameraPositionUpdated=function(){var ba={type:"positionChanged",target:null},ja=null,na=null,ra=null;return function(){fa.updateMatrixWorld(!0);var za=fa.position;if(ja!==za.x||na!==za.y||ra!==za.z)ja=za.x,na=za.y,ra=za.z,a.dispatchEvent(ba)}}();this.resetRollAngle=function(){0!==ya.rotation.y&&(ka.y=0,g())};this.getPitchAngle=function(){return Q.rotation.x};this.setPitchAngle=function(ba){ba!==Q.rotation.x&&
(R.x=ba,ka.x=0,g())};this.resetPitchAngle=function(){this.setPitchAngle(0)};this.getYawAngle=function(){return fa.rotation.z};this.setYawAngle=function(ba){ba!==fa.rotation.z&&(R.z=ba,ka.z=0,g())};this.resetYawAngle=function(){this.setYawAngle(0)};this.isHandlingGesture=function(){return null!==J};this.hmdReset=function(){K=!0;this.resetPitchAngle()};this.onHmdUpdate=function(){var ba=new THREE.Vector3,ja=new THREE.Vector3,na=new THREE.Vector3,ra=new THREE.Vector3,za=new THREE.Vector3;return function(Da,
ia){n&&(ka.copy(Da),K?R.z-=ka.z:ia&&(ra.subVectors(ia,na),ba.set(Math.cos(R.z),Math.sin(R.z),0),ja.set(-Math.sin(R.z),Math.cos(R.z),0),za.copy(ba.multiplyScalar(ra.x)),za.add(ja.multiplyScalar(ra.y)),za.z=ra.z,fa.position.add(za)),ia&&na.copy(ia),K=!1,g())}}();this.maxFrameMoveLinearDistance=function(ba){return Math.min(ba*a.moveMaxSpeed,WALK.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)};this.movesForward=function(){return E.movesInDirection(1)||0<va};this.stopForward=function(){0<va&&(va=0);E.stopInDirection(1)};
this.movesBackward=function(){return E.movesInDirection(-1)||0>va};this.stopBackward=function(){0>va&&(va=0);E.stopInDirection(-1)};this.movesLeft=function(){return D.movesInDirection(-1)};this.stopLeft=function(){D.stopInDirection(-1)};this.movesRight=function(){return D.movesInDirection(1)};this.stopRight=function(){D.stopInDirection(1)};this.movesUp=function(){return O.movesInDirection(1)};this.stopUp=function(){O.stopInDirection(1)};this.movesDown=function(){return O.movesInDirection(-1)};this.stopDown=
function(){O.stopInDirection(-1)};this.enable=function(){this.orbit.disable();n=!0;ea=0};this.disable=function(){this.orbit.disable();n=!1;m()};this.update=function(ba){if(n){E.activeSource===C&&100<Date.now()-M&&E.deactivateSource(C);O.activeSource===C&&100<Date.now()-ma&&O.deactivateSource(C);var ja=D.update(a.moveMaxSpeed,ba),na=E.update(a.moveMaxSpeed,ba),ra=O.update(a.moveMaxSpeed,ba);var za=0;na?va=0:(va&&(na=u.maxFrameMoveLinearDistance(ba),za=THREE.Math.clamp(va,-na,na),va-=za),na=za);fa.translateX(ja);
fa.translateY(na);fa.translateZ(ra);ba=S.update(WALK.CAMERA_ARROWS_TURN_SPEED,ba);R.z+=ba;f();(D.moves()||E.moves()||O.moves()||S.moves()||va)&&d.requestFrame();this.cameraPositionUpdated()}else this.orbit.update(ba)};a.rotation.set(0,0,0);a.up.set(0,0,1);a.lookAt(new THREE.Vector3(0,1,0));b.setAttribute("tabindex",-1);b.addEventListener("contextmenu",function(ba){ba.preventDefault()},!1);b.addEventListener("mousedown",l,!1);b.addEventListener("touchstart",function(ba){n&&(ba.preventDefault(),k(ba),
2===ba.touches.length?(J=ta,Z[0].copy(W[0]),Z[1].copy(W[1])):2<ba.touches.length&&(J=F))},!1);b.addEventListener("mousemove",h,!1);b.addEventListener("touchmove",h,!1);b.addEventListener("mouseup",r,!1);b.addEventListener("touchend",function(ba){n&&(ba.preventDefault(),J=0===ba.touches.length?null:F)},!1);b.addEventListener("keydown",function(ba){var ja=!0;if(n&&!WALK.isModifierPressed(ba)){switch(ba.keyCode){case 38:case 32:case 87:E.activateDirectionFromSource(1,y);break;case 37:u.arrowsTurn?S.activateDirectionFromSource(1,
y):D.activateDirectionFromSource(-1,y);break;case 65:D.activateDirectionFromSource(-1,y);break;case 40:case 83:E.activateDirectionFromSource(-1,y);break;case 39:u.arrowsTurn?S.activateDirectionFromSource(-1,y):D.activateDirectionFromSource(1,y);break;case 68:D.activateDirectionFromSource(1,y);break;case 33:case 69:O.activateDirectionFromSource(1,y);break;case 34:case 81:O.activateDirectionFromSource(-1,y);break;default:ja=!1}ja&&(ba.preventDefault(),d.requestFrame())}},!1);b.addEventListener("keyup",
function(ba){var ja=!0;if(n){switch(ba.keyCode){case 38:case 32:case 87:E.deactivateDirectionFromSource(1,y);break;case 37:case 65:S.deactivateDirectionFromSource(1,y);D.deactivateDirectionFromSource(-1,y);break;case 40:case 83:E.deactivateDirectionFromSource(-1,y);break;case 39:case 68:S.deactivateDirectionFromSource(-1,y);D.deactivateDirectionFromSource(1,y);break;case 33:case 69:O.deactivateDirectionFromSource(1,y);break;case 34:case 81:O.deactivateDirectionFromSource(-1,y);break;default:ja=!1}ja&&
ba.preventDefault()}},!1);b.addEventListener("mouseout",function(ba){r(ba)},!1);b.addEventListener("mouseenter",function(ba){0<ba.buttons&&l(ba)},!1);b.addEventListener("DOMMouseScroll",q,!1);b.addEventListener("mousewheel",q,!1);b.addEventListener("blur",function(ba){m()},!1);c.addEventListener("actionActivated",function(ba){if(n)switch(ba.action){case WALK.GAMEPAD_ACTION.BACKWARD:E.activateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.FORWARD:E.activateDirectionFromSource(1,A);break;
case WALK.GAMEPAD_ACTION.LEFT:u.arrowsTurn?S.activateDirectionFromSource(1,A):D.activateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.RIGHT:u.arrowsTurn?S.activateDirectionFromSource(-1,A):D.activateDirectionFromSource(1,A);break;case WALK.GAMEPAD_ACTION.DOWN:O.activateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.UP:O.activateDirectionFromSource(1,A)}});c.addEventListener("actionDeactivated",function(ba){if(n)switch(ba.action){case WALK.GAMEPAD_ACTION.BACKWARD:E.deactivateDirectionFromSource(-1,
A);break;case WALK.GAMEPAD_ACTION.FORWARD:E.deactivateDirectionFromSource(1,A);break;case WALK.GAMEPAD_ACTION.LEFT:D.deactivateDirectionFromSource(-1,A);S.deactivateDirectionFromSource(1,A);break;case WALK.GAMEPAD_ACTION.RIGHT:D.deactivateDirectionFromSource(1,A);S.deactivateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.DOWN:O.deactivateDirectionFromSource(-1,A);break;case WALK.GAMEPAD_ACTION.UP:O.deactivateDirectionFromSource(1,A)}});this.isEnabled=function(){return n}}})();(function(){WALK.ClickNavigator=function(a,b,c){function d(){c.teleportingToPoint&&c.cancelSwitchToPoint()}function f(){!b.mousePressLook&&c.teleportingToPoint&&c.cancelSwitchToPoint()}this.onMeshClicked=function(g,e){b.isOrbitEnabled()||b.isHandlingGesture()||(a.clickedPointToMoveTarget(e),c.switchToPoint(e))};this.dispose=function(){document.removeEventListener("keydown",d,!1);document.removeEventListener("mousedown",d,!1);document.removeEventListener("mousemove",f,!1);document.removeEventListener("touchstart",
d,!1);document.removeEventListener("DOMMouseScroll",d,!1);document.removeEventListener("mousewheel",d,!1)};document.addEventListener("keydown",d,!1);document.addEventListener("mousedown",d,!1);document.addEventListener("mousemove",f,!1);document.addEventListener("touchstart",d,!1);document.addEventListener("DOMMouseScroll",d,!1);document.addEventListener("mousewheel",d,!1)}})();(function(){WALK.StepsClimber=function(a,b,c){var d,f,g=b.cameraWorldPosition(),e=new THREE.Vector3;this.updateCameraHeight=function(k){if(d){var h=g.z-e.z;null!==b.cameraHeight&&(b.cameraHeight+=h);g.x!==e.x||g.y!==e.y?f=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH):Infinity!==f&&(f+=h);if(Infinity!==f&&(null===b.cameraHeight&&(b.cameraHeight=f),h=b.cameraHeight,f<h-.005||f>h+.005)){var l=1.5*b.camera().moveMaxSpeed;h=b.cameraHeight;k=Math.min(l*k,Math.abs(f-h));f>h&&(k=-k);if(0>k||Infinity===
a.distanceToCeiling(k+WALK.MIN_DISTANCE_TO_CEILING))g.z+=k,f+=k,c.requestFrame()}e.copy(g)}};this.enable=function(){d=!0;f=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH);b.cameraHeight=Infinity!==f?f:null;e.copy(g)};this.disable=function(){d=!1};this.isEnabled=function(){return d};this.enable()}})();(function(){WALK.VRHeightController=function(a,b){var c=a.cameraWorldPosition(),d,f,g;this.onHmdPositionUpdate=function(e){d&&!g&&1<e.z&&(a.cameraHeight=e.z,b.adjustPointToMatchCameraHeight(c),a.cameraPositionUpdated(),f=c.z,g=!0)};this.onTeleportDone=function(){d&&(f=c.z)};this.updateCameraHeight=function(){d&&(a.cameraHeight+=c.z-f,f=c.z)};this.enable=function(){d=!0;a.cameraHeight=b.cameraHeightFromPoint(c);null===a.cameraHeight&&(a.cameraHeight=WALK.VR_FALLBACK_CAMERA_HEIGHT);f=c.z;g=!1};this.disable=
function(){d=!1;a.cameraHeight=null}}})();(function(){function a(d){var f=null;this.activateSky=function(g){if(f){if(f.name===g)return;d.removeAuxiliaryObject(f)}var e=d.findSkyMesh(g);(g=e.material.map)&&!g.loaded?(this.activateSky(WALK.DEFAULT_SKY_NAME),f=e,g.addLoadedListener(function(){f===e&&(d.addAuxiliaryObject(e),e.updateMatrixWorld(!0))})):(d.addAuxiliaryObject(e),e.updateMatrixWorld(!0),f=e)};this.activeSkyName=function(){return f.name}}function b(d,f,g){this.position=d||new THREE.Vector3;this.rotation=f||new THREE.Vector2;this.fov=
g||0}var c=1/180;b.prototype={length:function(){return Math.sqrt(this.position.lengthSq()+this.rotation.lengthSq()+this.fov*this.fov)},multiplyScalar:function(d){this.position.multiplyScalar(d);this.rotation.multiplyScalar(d);this.fov*=d;return this},divideScalar:function(d){this.position.divideScalar(d);this.rotation.divideScalar(d);this.fov/=d;return this},normalize:function(){return this.divideScalar(this.length())},normalizeRotation:function(){this.rotation.x=WALK.normalizeRotation(this.rotation.x);
this.rotation.y=WALK.normalizeRotation(this.rotation.y);return this},distanceTo:function(d){var f=this.position.x-d.position.x,g=this.position.y-d.position.y,e=this.position.z-d.position.z,k=WALK.normalizeRotation(this.rotation.x-d.rotation.x),h=WALK.normalizeRotation(this.rotation.y-d.rotation.y);d=this.fov-d.fov;return Math.sqrt(f*f+g*g+e*e+k*k+h*h+d*d)},subVectors:function(d,f){this.position.subVectors(d.position,f.position);this.rotation.subVectors(d.rotation,f.rotation);this.fov=d.fov-f.fov;
return this.normalizeRotation()},copy:function(d){this.position.copy(d.position);this.rotation.copy(d.rotation);this.fov=d.fov;return this}};WALK.Teleport=function(d,f,g,e){function k(){v=[];for(var M=0;M<d.views.length;M+=1)v[d.views[M].id]=[];for(M=0;M<d.gpuMeshes.length;M+=1){var ma=d.gpuMeshes[M],ea=ma.hideInViews;if(ea)for(var ya=0;ya<ea.length;ya+=1)v[ea[ya]]?v[ea[ya]].push(ma):console.warn("Invalid view id in hideInViews list: '"+ea[M]+"'")}}function h(M){for(var ma=0;ma<M.length;ma+=1){var ea=
M[ma];ea.visible=!1;y.push(ea)}}function l(){for(var M=0;M<y.length;M+=1)y[M].visible=!0;y.length=0}function r(M){l();h(M)}function q(){w.fov=C.fov;n.copy(C.position);f.setYawAngle(C.rotation.x);f.setPitchAngle(C.rotation.y);f.cameraPositionUpdated()}var m=this,u=new a(d),n=f.cameraWorldPosition(),w=d.camera,v,y=[],C=new b,A=new b,I=new THREE.Vector3,D=0,E=0,O=0,S,W,U,va=!1,ta={type:"teleportStarted",target:this,view:null},qa={type:"teleportDone",target:this,view:null},ha=null;this.lastDestinationView=
null;var F=this.teleportingToPoint=this.teleportingToView=!1,J=!1,Z=function(){var M=new b(f.cameraWorldPosition());return function(){M.rotation.set(f.getYawAngle(),f.getPitchAngle());M.normalizeRotation();M.fov=w.fov;return M}}();this.update=function(){function M(ea,ya){var Q=0;E*E/(2*O)>=ya?(Q=E/O,Q=2*(E*Q-ya)/(Q*Q)*-ea):E<D&&(Q=ea*O);ma.copy(A);E=THREE.Math.clamp(E+.5*Q,0,D);ma.multiplyScalar(E*ea);E=THREE.Math.clamp(E+.5*Q,0,D);ma.fov&&(w.fov+=ma.fov,w.updateProjectionMatrix());n.add(ma.position);
f.setYawAngle(f.getYawAngle()+ma.rotation.x);f.setPitchAngle(f.getPitchAngle()+ma.rotation.y)}var ma=new b;return function(ea){if(m.teleportingToView||m.teleportingToPoint){ea=Math.min(ea,.067);ea=Math.max(ea,c);var ya=Z().distanceTo(C);this.teleportingToPoint&&(C.position.z=n.z);var Q=!0;0!==ya&&(M(ea,ya),Z().distanceTo(C)>ya||0===E?q():Q=!1,f.cameraPositionUpdated());Q&&(this.teleportingToView&&("orbit"!==U.mode||va?(ea=f.camera(),ea.near=WALK.CAMERA_WALK_NEAR,ea.updateProjectionMatrix(),f.enable()):
(f.orbit.minDistance=S,f.orbit.maxDistance=W,f.orbit.setPanPrimary(U.panPrimary||!1),f.orbit.noPan=U.noPan||!1,f.orbit.noRotate=U.noRotate||!1,f.orbit.noPitchRotate=U.noPitchRotate||!1,f.orbit.getMinPitchAngle=function(){return-U.maxUpAngle},f.orbit.getMaxPitchAngle=function(){return-U.minUpAngle},f.orbit.getMinYawAngle=function(){return U.minSideAngle},f.orbit.getMaxYawAngle=function(){return U.maxSideAngle},f.orbit.target.copy(I),f.orbitModeEnable()),u.activateSky(U.sky),r(v[U.id]||[])),this.teleportingToView=
this.teleportingToPoint=!1,qa.view=U,this.dispatchEvent(qa));e.requestFrame()}}}();this.cancelSwitchToPoint=function(){console.assert(this.teleportingToPoint);this.teleportingToPoint=!1;qa.view=null;this.dispatchEvent(qa)};this.switchToPoint=function(M){if(M.x!==n.x||M.y!==n.y)if(U=null,this.teleportingToPoint=!0,this.teleportingToView=!1,ta.view=null,this.dispatchEvent(ta),F?C.position.set(M.x,M.y,M.z):C.position.set(M.x,M.y,n.z),M=Math.atan2(-(M.x-n.x),M.y-n.y),M=WALK.normalizeRotation(M),C.rotation.set(M,
0),C.fov=w.defaultFov,F)q(),this.update(c);else{A.subVectors(C,Z());M=A.length();D=2*WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;O=D/WALK.CAMERA_FULL_ACCELERATION_TIME;var ma=WALK.TELEPORT_TO_POINT_MAX_TIME;M>(ma-WALK.CAMERA_FULL_ACCELERATION_TIME)*D&&(D=WALK.Math.anyPositiveRootOfQuadraticEquation(1,-O*ma,O*M),null===D&&(ma/=2,O=M/(ma*ma),D=O*ma));A.normalize();E=0;e.requestFrame()}};this.switchToView=function(M,ma){void 0===ma&&(ma=WALK.TELEPORT_TO_VIEW_MAX_TIME);M.hideFromMenu||(ha=M);this.lastDestinationView=
U=M;this.teleportingToView=!0;this.teleportingToPoint=!1;ta.view=U;this.dispatchEvent(ta);f.disable();f.resetRollAngle();h(v[U.id]||[]);void 0!==U.rotation?C.rotation.set(U.rotation.yaw,U.rotation.pitch):C.rotation.set(0,0);C.fov=U.fov||w.defaultFov;"orbit"===U.mode?(void 0!==U.target?I.set(U.target.x,U.target.y,U.target.z):I.set(0,0,0),S=U.minDistance||0,W=U.maxDistance||100,M=THREE.Math.clamp(U.distance||10,S,W),WALK.OrbitControls.computeCameraPosition(C.position,I,C.rotation.x,C.rotation.y,M),
M=f.camera(),M.near=WALK.CAMERA_ORBIT_NEAR,M.updateProjectionMatrix()):void 0!==U.position?(C.position.set(U.position.x,U.position.y,U.position.z),J&&g.adjustPointToMatchCameraHeight(C.position)):C.position.set(0,0,0);if(0===ma||F)q(),this.update(c);else{U.sky!==u.activeSkyName()&&u.activateSky(WALK.DEFAULT_SKY_NAME);A.subVectors(C,Z());M=A.length();O=WALK.TELEPORT_TO_VIEW_ACCELERATION;var ea=Math.sqrt(M/O);ea>ma/2&&(ea=ma/2,O=M/(ea*ea));D=O*ea;A.normalize();E=0}e.requestFrame()};this._switchToAdjacentVisibleView=
function(M,ma){var ea=d.visibleViews();if(0!==ea.length)if(null===ha)this.switchToView(ea[0],ma);else{var ya=ea.indexOf(ha);-1===ya&&this.switchToView(ea[0],ma);this.switchToView(ea[(ya+ea.length+M)%ea.length],ma)}};this.switchToPreviousVisibleView=function(M){this._switchToAdjacentVisibleView(-1,M)};this.switchToNextVisibleView=function(M){this._switchToAdjacentVisibleView(1,M)};this.updateHiddenMeshes=function(M){k();M?r(v[M.id]||[]):l();e.requestFrame()};this.activateSky=function(M){u.activateSky(M.sky);
e.requestFrame()};this.executeWithViewVisibilitySettings=function(M,ma){var ea=y.slice();r(v[M.id]||[]);u.activateSky(M.sky);ma();u.activateSky(this.lastDestinationView.sky);r(ea)};this.onVrChange=function(M){J=F=va=M;this.lastDestinationView&&"orbit"===this.lastDestinationView.mode&&this.switchToView(this.lastDestinationView,0)};k();d.addEventListener("viewAdded",k);d.addEventListener("viewRemoved",k);d.addEventListener("skyMeshAdded",function(M){u.activateSky(M.skyMesh.name);e.requestFrame()});
d.addEventListener("skyMeshRemoved",function(M){u.activeSkyName()===M.skyMesh.name&&(u.activateSky(WALK.DEFAULT_SKY_NAME),e.requestFrame())})};THREE.EventDispatcher.prototype.apply(WALK.Teleport.prototype)})();(function(){WALK.AutoTour=function(a,b){function c(){d&&b.switchToNextVisibleView(4)}var d=!1,f={type:"tourStarted"},g={type:"tourStopped"};b.addEventListener("teleportDone",function(){d&&setTimeout(c,WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)});this.isRunning=function(){return d};this.start=function(){console.assert(!d);d=!0;this.dispatchEvent(f);c()};this.stop=function(){console.assert(d);d=!1;b.switchToView(b.lastDestinationView,0);this.dispatchEvent(g)}};THREE.EventDispatcher.prototype.apply(WALK.AutoTour.prototype)})();(function(){function a(e){return-.7>=e?0:.7<=e?1:-1}function b(e,k){if("xr-standard"===e.mapping)return"left"===(e.hand?e.hand:k)?d:f;k=$jscomp.makeIterator(c);for(var h=k.next();!h.done;h=k.next()){h=h.value;var l=e;var r=h;l=r.gamepadIdPattern.test(l.id)?void 0!==r.gamepadLayoutMappingId?l.mapping===r.gamepadLayoutMappingId:!0:!1;if(l)return h}console.error("No matching action mapping for gamepad found",e.id);return null}WALK.GAMEPAD_ACTION={TRIGGER:0,BACKWARD:1,FORWARD:2,LEFT:3,RIGHT:4,DOWN:5,
UP:6,PREVIOUS:7,NEXT:8};var c=[{gamepadIdPattern:/^Spatial Controller \(Spatial Interaction Source\).*$/,axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[3,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]],[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/Oculus Touch \(Left\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,
WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.DOWN],[4,WALK.GAMEPAD_ACTION.UP]])},{gamepadIdPattern:/Oculus Touch \(Right\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.NEXT],[4,WALK.GAMEPAD_ACTION.PREVIOUS]])},
{gamepadIdPattern:/OpenVR (Gamepad|Controller)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.DOWN,WALK.GAMEPAD_ACTION.UP]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,gamepadLayoutMappingId:"standard",axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]],[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,
[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.DOWN],[1,WALK.GAMEPAD_ACTION.NEXT],[2,WALK.GAMEPAD_ACTION.PREVIOUS],[3,WALK.GAMEPAD_ACTION.UP],[4,WALK.GAMEPAD_ACTION.TRIGGER],[5,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[1,WALK.GAMEPAD_ACTION.TRIGGER],
[2,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.TRIGGER]])}],d={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[4,WALK.GAMEPAD_ACTION.DOWN],[5,WALK.GAMEPAD_ACTION.UP]])},f={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],
[4,WALK.GAMEPAD_ACTION.NEXT],[5,WALK.GAMEPAD_ACTION.PREVIOUS]])},g=function(e,k){k=b(e,k);this.axisMapping=k.axisMapping;this.buttonMapping=k.buttonMapping;this.axisPosition=e.axes.map(a);this.buttonPressed=e.buttons.map(function(h){return h.pressed})};WALK.GamepadManager=function(){function e(n){var w=n.gamepad;n=new g(n.gamepad);h.set(w.index,n)}function k(n){h.delete(n.gamepad.index)}var h=new Map,l=new Map,r=new Set,q=new Set,m={type:"actionActivated",action:null},u={type:"actionDeactivated",
action:null};this.hasGamepads=function(){return 0<h.size||0<l.size};this.update=function(){function n(C,A){for(var I=0;I<A.axes.length;++I){var D=a(A.axes[I]),E=C.axisPosition[I];if(D!==E){var O=C.axisMapping.get(I);void 0!==O&&(-1!==E&&q.add(O[E]),-1!==D&&r.add(O[D]))}C.axisPosition[I]=D}for(I=0;I<A.buttons.length;++I)D=A.buttons[I].pressed,E=C.buttonPressed[I],D!==E&&(O=C.buttonMapping.get(I),void 0!==O&&(E?q.add(O):r.add(O))),C.buttonPressed[I]=D}if(this.hasGamepads()){r.clear();q.clear();var w=
navigator.getGamepads?navigator.getGamepads():[];w=$jscomp.makeIterator(w);for(var v=w.next();!v.done;v=w.next())if(v=v.value){var y=h.get(v.index);n(y,v)}w=$jscomp.makeIterator(l);for(v=w.next();!v.done;v=w.next())y=$jscomp.makeIterator(v.value),v=y.next().value,y=y.next().value,n(y,v);v=$jscomp.makeIterator(q);for(w=v.next();!w.done;w=v.next())u.action=w.value,this.dispatchEvent(u);v=$jscomp.makeIterator(r);for(w=v.next();!w.done;w=v.next())m.action=w.value,this.dispatchEvent(m)}};this.addXrGamepad=
function(n,w){w=new g(n,w);l.set(n,w)};this.removeXrGamepad=function(n){l.delete(n)};this.removeAllXrGamepads=function(){l.clear()};(function(){if(navigator.getGamepads){window.addEventListener("gamepadconnected",e);window.addEventListener("gamepaddisconnected",k);for(var n=$jscomp.makeIterator(navigator.getGamepads()),w=n.next();!w.done;w=n.next())if(w=w.value){var v=new g(w);h.set(w.index,v)}}})()};THREE.EventDispatcher.prototype.apply(WALK.GamepadManager.prototype)})();/*
 Copyright (C) 2020-present Shapespark
*/
(function(){WALK.GazeModeObserver=function(){var a=this,b=!1,c={type:"modeDisabled"},d={type:"modeEnabled"};this.enableMode=function(){b=!0;a.dispatchEvent(d)};this.disableMode=function(){b=!1;a.dispatchEvent(c)};this.modeIsEnabled=function(){return b}};THREE.EventDispatcher.prototype.apply(WALK.GazeModeObserver.prototype)})();(function(){function a(){var c=new THREE.BufferGeometry,d=new Float32Array(18);c.addAttribute("position",new THREE.BufferAttribute(d,3));d[0]=.05;d[1]=-.05;d[2]=-2;d[3]=.05;d[4]=.05;d[5]=-2;d[6]=-.05;d[7]=-.05;d[8]=-2;d[9]=.05;d[10]=.05;d[11]=-2;d[12]=-.05;d[13]=.05;d[14]=-2;d[15]=-.05;d[16]=-.05;d[17]=-2;c.computeBoundingSphere();return c}console.assert(WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S<=WALK.GAZE_POINTER_ACTIVATE_AFTER_S);var b=Math.PI/60;WALK.GazePointer=function(c,d,f,g){function e(){h=l=
null;r=0;q=!1;m&&m.setCircleSpan(0)}var k=g.modeIsEnabled(),h,l,r,q,m=null,u=null,n=null;this.setGazeHandlers=function(v,y){u=v;n=y};var w=function(){if(!k)e();else if(!m){var v=new WALK.GazePointerMaterial,y=new THREE.Mesh(a(),v);c.addAuxiliaryObject(y);y.frustumCulled=!1;y.matrixWorld=d.camera().matrixWorld;m={setVisible:function(C){y.visible=C;f()},setCircleSpan:function(C){v.circleSpan=C;f()}};e()}m&&m.setVisible(k)};g.addEventListener("modeDisabled",function(){k=!1;w()});g.addEventListener("modeEnabled",
function(){k=!0;w()});this.reset=function(){null!==h&&e()};this.update=function(v){if(k){var y=d.getPitchAngle(),C=d.getYawAngle();null===h?(h=y,l=C):Math.abs(h-y)>b||Math.abs(l-C)>b?e():(r+=v,r>=WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S&&(q?(m.setCircleSpan(Math.min((r-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S)/(WALK.GAZE_POINTER_ACTIVATE_AFTER_S-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S),1)),r>=WALK.GAZE_POINTER_ACTIVATE_AFTER_S&&(n&&n(),e())):u&&u()?q=!0:e()))}};w()}})();/*
 Copyright (C) 2018-present Shapespark
*/
(function(){WALK.HashChangeTeleport=function(a,b){function c(){var d=WALK.urlHashGetArgument("view");d&&(d=a.findViewByName(d))&&(b.switchToView(d),window.location.hash=WALK.urlHashRemoveArgument("view"))}window.addEventListener("hashchange",c,!1);this.dispose=function(){window.removeEventListener("hashchange",c,!1)}}})();(function(){WALK.AutoClearAlter=function(a){var b,c,d,f;this.set=function(g,e,k){console.assert(void 0===b&&void 0===c&&void 0===d&&void 0===f);b=a.autoClear;c=a.autoClearColor;d=a.autoClearDepth;f=a.autoClearStencil;a.autoClear=g||e||k;a.autoClearColor=g;a.autoClearDepth=e;a.autoClearStencil=k};this.restore=function(){console.assert(void 0!==b&&void 0!==c&&void 0!==d&&void 0!==f);a.autoClear=b;a.autoClearColor=c;a.autoClearDepth=d;a.autoClearStencil=f;f=d=c=b=void 0}}})();(function(){WALK.ClearColorAlter=function(a){var b=new THREE.Color,c=!1;this.set=function(d){console.assert(!c);c=!0;b.copy(a.getClearColor());a.setClearColor(d)};this.restore=function(){console.assert(c);c=!1;a.setClearColor(b)}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("standard_material_fragment.glsl"),c=new WALK.InlineShader("vec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\n                     inout float opacity) {\n  return addSpecular(baseColor, totalIntensity, opacity);\n}"),d=new THREE.Color,f=new THREE.Vector3(0,0,0),g=new THREE.Vector4(0,0,1,1);WALK.ParallaxModes={basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"};
WALK.StandardMaterial=function(){var e=this;WALK.BaseMaterial.call(this,a,b,this.fragmentShaderHooks());this.type="standard";this.merged=!1;this._opacity=1;Object.defineProperty(this,"opacity",{get:function(){return this._opacity},set:function(h){this._opacity=.99<h?1:h;this.configureTransparency();this.setUniforms();this._updated()}});this.baseColor=new THREE.Color(16777215);this._baseColorTexture=null;this._baseColorTextureCorrection=this.planarReflector=!1;this._baseColorTextureContrast=0;this.baseColorTextureHslOffset=
{h:0,s:0,l:0};this._baseColorCorrectionUniform=new THREE.Vector4;this.lightMapped=!1;this.lightVisibilityMap=null;this._lightVisibilityMapSize=new THREE.Vector2;this.lightAttrMap=null;this.lightsCount=0;this._emissive=!1;this._roughness=this._emissionStrength=1;this._metallic=0;this._lastUsedLightProbeId=this.cubeCameraIndex=null;this._haveTextureLod=WALK.DETECTOR.textureLod;this._mipLevel1=this._mipLevel0=null;this.disableLightProbeTmp=this.disableLightProbe=!1;this._envMapProject=!0;this._hdrOutput=
!1;this._bumpScale=.001;this.parallaxCorrection=!1;this.parallaxMode="basic";this.parallaxScale=-.03;this.parallaxMinLayers=10;this.parallaxMaxLayers=15;this.colorMap=null;this.cameraExposure=0;this.cameraGamma=1;this.headLight=!1;this._uvOffsetScale=null;this.highlight=WALK.EDIT_MODE?WALK.EDITOR_SELECTION_COLOR:null;this._specularOff=this._highlightMix=0;this.doNotImport={baseColor:!1,opacity:!1};var k={type:"updated",target:this};this._updated=function(){return e.dispatchEvent(k)};this._alphaInLowerHalf=
!1;this._chromaKeyEnabled=void 0;this.chromaKeyColor=(new THREE.Color).setRGB(0,.94,0);this._chromaKeyDelta=new THREE.Vector3(.1,.1,.1);this._chromaKeyDeltaCoeff=new THREE.Vector3};WALK.StandardMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.StandardMaterial.prototype.constructor=WALK.StandardMaterial;WALK.StandardMaterial.prototype.addTextureProperty=function(e){var k="_"+e;Object.defineProperty(this,e,{get:function(){return this[k]||null},set:function(h){var l=this;(this[k]=h)?
h.addLoadedListener(function(){l.setUniforms();l._updated();l=h=null}):(l.setUniforms(),l._updated())}})};WALK.StandardMaterial.prototype.addTextureProperty("roughnessTexture");WALK.StandardMaterial.prototype.addTextureProperty("metallicTexture");WALK.StandardMaterial.prototype.addTextureProperty("bumpTexture");WALK.StandardMaterial.prototype.fragmentShaderHooks=function(){return c};WALK.StandardMaterial.prototype._useChromaKey=function(){return!(!this.isAnimated||!this.chromaKeyEnabled)};WALK.StandardMaterial.prototype._useAlphaInLowerHalf=
function(){return!(!this.isAnimated||!this.alphaInLowerHalf)};WALK.StandardMaterial.prototype._useBaseColorTextureAsCutout=function(){var e=this._baseColorTexture;return 1===this.opacity&&(e&&e.isCutout||this._useAlphaInLowerHalf()||this._useChromaKey())};WALK.StandardMaterial.prototype.configureTransparency=function(){var e=this._baseColorTexture;e=e&&(e.hasAlpha||this._useAlphaInLowerHalf()||this._useChromaKey());this.transparent=1>this.opacity||e;e=this._useBaseColorTextureAsCutout();this.transparent?
(this.blending=THREE.NormalBlending,this.transparentRenderOrder=e?0:1):this.blending=THREE.NoBlending;this.depthWrite=!this.transparent||e};Object.defineProperty(WALK.StandardMaterial.prototype,"alphaInLowerHalf",{get:function(){return this._alphaInLowerHalf},set:function(e){this._alphaInLowerHalf=e;this.configureTransparency();this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"chromaKeyEnabled",{get:function(){return!!this._chromaKeyEnabled},set:function(e){this._chromaKeyEnabled=
!!e;this.configureTransparency();this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setChromaKeyColorRGB=function(e,k,h){this.chromaKeyColor.setRGB(e,k,h);this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.getChromaKeyDeltaComponent=function(e){return this._chromaKeyDelta.getComponent(e)};WALK.StandardMaterial.prototype.setChromaKeyDeltaComponent=function(e,k){this._chromaKeyDelta.setComponent(e,k);this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,
"isAnimated",{get:function(){var e=this.baseColorTexture;return e&&e.isAnimated}});Object.defineProperty(WALK.StandardMaterial.prototype,"isPlaying",{get:function(){var e=this.baseColorTexture;return e&&e.isAnimated&&e.isPlaying}});WALK.StandardMaterial.prototype.play=function(){console.assert(this.isAnimated);var e=this.baseColorTexture.isPlaying;this.baseColorTexture.play();this.baseColorTexture.isPlaying!==e&&this._updated()};WALK.StandardMaterial.prototype.pause=function(){console.assert(this.isAnimated);
var e=this.baseColorTexture.isPlaying;this.baseColorTexture.pause();this.baseColorTexture.isPlaying!==e&&this._updated()};WALK.StandardMaterial.prototype.sleepAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.sleepAnimation()};WALK.StandardMaterial.prototype.wakeAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.wakeAnimation()};Object.defineProperty(WALK.StandardMaterial.prototype,"doubleSided",{get:function(){return this.side===THREE.DoubleSide},
set:function(e){this.side=e?THREE.DoubleSide:THREE.FrontSide;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapMirror",{get:function(){return 0===this.roughness&&!this.roughnessTexture}});Object.defineProperty(WALK.StandardMaterial.prototype,"hdrOutput",{get:function(){return this._hdrOutput},set:function(e){e!==this._hdrOutput&&(this._hdrOutput=e,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"specularOff",{get:function(){return this._specularOff},
set:function(e){e!==this._specularOff&&(this._specularOff=e,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"highlightMix",{get:function(){return this._highlightMix},set:function(e){e!==this._highlightMix&&(this._highlightMix=e,this.uniforms.highlightMix.value=e)}});Object.defineProperty(WALK.StandardMaterial.prototype,"cameraExposure",{get:function(){return this._cameraExposure},set:function(e){this._cameraExposure=e;this.setUniform("exposure","f",Math.pow(2,e))}});Object.defineProperty(WALK.StandardMaterial.prototype,
"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(e){this.setUniform("cameraGamma","f",e)}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTexture",{get:function(){return this._baseColorTexture},set:function(e){var k=this;(this._baseColorTexture=e)?e.addLoadedListener(function(){k.configureTransparency();k.setUniforms();k._updated();k=e=null}):(k.setUniforms(),k._updated())}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureCorrection",
{get:function(){return this._baseColorTextureCorrection},set:function(e){this._baseColorTextureCorrection=e;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureContrast",{get:function(){return this._baseColorTextureContrast},set:function(e){this._baseColorTextureContrast=e;this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setBaseColorTextureHslOffset=function(e,k,h){this.baseColorTextureHslOffset.h=e;this.baseColorTextureHslOffset.s=
k;this.baseColorTextureHslOffset.l=h;this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,"emissive",{get:function(){return this._emissive},set:function(e){this._emissive=e;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"emissionStrength",{get:function(){return this._emissionStrength},set:function(e){this._emissionStrength=e;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,
"roughness",{get:function(){return this._roughness},set:function(e){this._roughness=e;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"metallic",{get:function(){return this._metallic},set:function(e){this._metallic=e;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapProject",{get:function(){return this._envMapProject},set:function(e){this._envMapProject=e;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,
"bumpScale",{get:function(){return this._bumpScale},set:function(e){this._bumpScale=e;this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setDoNotImport=function(e,k){this.doNotImport[e]=k;this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.isLightProbeDisabled=function(){return this.disableLightProbe||this.disableLightProbeTmp||this.specularOff||1===this.roughness&&!this._roughnessTexture||this.transparent&&this.doubleSided};WALK.StandardMaterial.prototype._setLightProbeUniforms=
function(){this.setUniform("envMap","t",null);if(!this.condDefine(this._haveTextureLod,"HAVE_TEXTURE_LOD")){var e=WALK.LIGHT_PROBE_MIPS_COUNT-1;this._mipLevel0=Math.floor(this.roughness*e);this._mipLevel1=Math.min(this._mipLevel0+1,e);this.setUniform("envMap2","t",null)}this.envMapMirror?this.setUniform("envMipsCount","f",1):this.setUniform("envMipsCount","f",0);this.condDefine(this.envMapProject,"USE_ENVMAP_PROJECT")&&(this.setUniform("envMapPosW","v3",f),this.setUniform("envBoxMin","v3",f),this.setUniform("envBoxMax",
"v3",f));this._lastUsedLightProbeId=null};WALK.StandardMaterial.prototype.setUvOffsetAndScale=function(e,k,h,l){this._uvOffsetScale||(this._uvOffsetScale=new THREE.Vector4);console.assert(!this.baseColorTexture||!this.baseColorTexture.parentTexture,"Can't set uv offset and scale if baseColor texture is in atlas");this._uvOffsetScale.set(e,k,h,l)};WALK.StandardMaterial.prototype.setUniforms=function(){this.setUniform("opacity","f",this.opacity);var e=!this.isLightProbeDisabled(),k=!1,h=this.roughnessTexture;
this.condDefine(h&&h.loaded&&e,"USE_ROUGHNESS_TEXTURE")?(this.setUniform("roughnessTexture","t",h),k=!0):this.setUniform("roughness","f",this.roughness);h=this.metallicTexture;this.condDefine(h&&h.loaded&&e,"USE_METALLIC_TEXTURE")?(this.setUniform("metallicTexture","t",h),k=!0):this.setUniform("metallic","f",this.metallic);this.setUniform("emissionStrength","f",this.emissive?this.emissionStrength:0);this._baseColorTexture&&this.baseColorTextureCorrection?(d.set(this.baseColor),d.offsetHSL(this.baseColorTextureHslOffset.h,
this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l),h=Math.max(1+this.baseColorTextureContrast,0),this._baseColorCorrectionUniform.set(h*(d.r-this.baseColor.r-.5)+.5,h*(d.g-this.baseColor.g-.5)+.5,h*(d.b-this.baseColor.b-.5)+.5,h)):this._baseColorCorrectionUniform.set(0,0,0,1);this.setUniform("baseColorCorrection","v4",this._baseColorCorrectionUniform);h=null;if(this._baseColorTexture)if(this._baseColorTexture.parentTexture){h=this._baseColorTexture.parentTexture;var l=this._baseColorTexture.uvOffsetScale}else h=
this._baseColorTexture,l=g;this.condDefine(h&&h.loaded,"USE_BASE_COLOR_TEXTURE")?(this.setUniform("baseColorTexture","t",h),k=!0,this.setUniform("baseColorAtlasUvMod","v4",l),this._useBaseColorTextureAsCutout()?this.setUniform("alphaDiscardThreshold","f",.25):this.setUniform("alphaDiscardThreshold","f",0)):this.setUniform("baseColor","c",this.baseColor);this.condDefine(this._useAlphaInLowerHalf(),"USE_ALPHA_IN_LOWER_HALF");this.condDefine(this._useChromaKey(),"USE_CHROMA_KEY")&&(this.setUniform("chromaKeyColor",
"c",this.chromaKeyColor),l=this._chromaKeyDelta,this._chromaKeyDeltaCoeff.x=1/(1.22*l.x),this._chromaKeyDeltaCoeff.y=1/(1.22*l.y),this._chromaKeyDeltaCoeff.z=1/(1.22*l.z),this.setUniform("chromaKeyDeltaCoeff","v3",this._chromaKeyDeltaCoeff));h=this.bumpTexture;this.condDefine(h&&h.loaded&&e,"USE_BUMP_TEXTURE")&&(this.enableStandardDerivativesExtension(),this.setUniform("bumpTexture","t",h),k=!0,this.setUniform("bumpScale","f",this.bumpScale),this.condDefine(this.parallaxCorrection,"USE_PARALLAX_CORRECTION")&&
(this.addDefine(WALK.ParallaxModes[this.parallaxMode]),this.setUniform("parallaxScale","f",this.parallaxScale),this.setUniform("parallaxMinLayers","f",this.parallaxMinLayers),this.setUniform("parallaxMaxLayers","f",this.parallaxMaxLayers)));k&&this.setUniform("uvMod","v4",this._uvOffsetScale||g);this.condDefine(this.lightMapped,"USE_LIGHTMAP")&&this.setUniform("lightMap","t",null);this.condDefine(this.lightAttrMap&&!this.specularOff,"USE_DYNAMIC_LIGHT")&&(console.assert(this.lightVisibilityMap),console.assert(this.lightsCount),
console.assert(this.lightVisibilityMap.width),console.assert(this.lightVisibilityMap.height),this.setUniform("lightVisibilityMap","t",this.lightVisibilityMap),this.setUniform("lightAttrMap","t",this.lightAttrMap),this.setUniform("lightsCount","f",this.lightsCount),this._lightVisibilityMapSize.set(this.lightVisibilityMap.width,this.lightVisibilityMap.height),this.setUniform("lightVisibilityMapSize","v2",this._lightVisibilityMapSize));this.condDefine(e,"USE_ENVMAP")&&(this._haveTextureLod&&this.enableTextureLodExtension(),
this._setLightProbeUniforms());this.condDefine(this.highlight,"USE_HIGHLIGTH")&&(this.setUniform("highlight","c",this.highlight),this.setUniform("highlightMix","f",this.highlightMix));this.condDefine(this.hdrOutput,"HDR_OUTPUT");this.condDefine(!this.hdrOutput&&this.colorMap,"USE_COLORMAP")&&this.setUniform("colorMap","t",this.colorMap);this.condDefine((this.headLight||!this.lightMapped)&&!this.specularOff,"USE_HEADLIGHT")};WALK.StandardMaterial.prototype.forceObjectUniformsRefresh=function(){this._lastUsedLightProbeId=
null};WALK.StandardMaterial.prototype.textureNeedsUv0=function(e){return!0};WALK.StandardMaterial.prototype.hash=function(){return this.baseColorTexture?"standard"+this.baseColorTexture.name:"standard#"+this.baseColor.r+":"+this.baseColor.g+":"+this.baseColor.b};WALK.StandardMaterial.prototype.canMerge=function(e){if(this.type!==e.type||this.opacity!==e.opacity)return!1;if(this._baseColorTexture||e._baseColorTexture){if(this._baseColorTexture!==e._baseColorTexture||this.baseColorTextureCorrection!==
e.baseColorTextureCorrection||this.baseColorTextureContrast!==e.baseColorTextureContrast||this.baseColorTextureHslOffset.h!==e.baseColorTextureHslOffset.h||this.baseColorTextureHslOffset.s!==e.baseColorTextureHslOffset.s||this.baseColorTextureHslOffset.l!==e.baseColorTextureHslOffset.l||this._useAlphaInLowerHalf()!==e._useAlphaInLowerHalf()||(this._useChromaKey()?!(e._useChromaKey()&&this.chromaKeyColor.equals(e.chromaKeyColor)&&this._chromaKeyDelta.equals(e._chromaKeyDelta)):e._useChromaKey()))return!1}else if(!this.baseColor.equals(e.baseColor))return!1;
if(this.emissive||e.emissive)if(this.emissive!==e.emissive||this.emissionStrength!==e.emissionStrength)return!1;if(this.roughnessTexture||e.roughnessTexture){if(this.roughnessTexture!==e.roughnessTexture)return!1}else if(this.roughness!==e.roughness)return!1;if(this.metallicTexture||e.metallicTexture){if(this.metallicTexture!==e.metallicTexture)return!1}else if(this.metallic!==e.metallic)return!1;return(this.bumpTexture||e.bumpTexture)&&(this.bumpTexture!==e.bumpTexture||this.bumpScale!==e.bumpScale)||
this.envMapProject!==e.envMapProject||this.doubleSided!==e.doubleSided||this.parallaxCorrection||e.parallaxCorrection?!1:!0};WALK.StandardMaterial.prototype.refreshPerObjectUniforms=function(e,k){var h=!1;if(!this.isLightProbeDisabled()){var l=e.lightProbe;if(this._lastUsedLightProbeId!==l.id){h=!0;this._lastUsedLightProbeId=l.id;var r=this.envMapMirror?l.getMirrorTexture():this._haveTextureLod?l.getFilteredTexture():l.getFilteredTextureNoLod(this._mipLevel0);k.envMap.value=r;this._haveTextureLod||
(k.envMap2.value=l.getFilteredTextureNoLod(this._mipLevel1));this.envMapMirror||(k.envMipsCount.value=WALK.LIGHT_PROBE_MIPS_COUNT);this.envMapProject&&(l.isBoundingBoxEnabled()?(k.envMapPosW.value=l.position,k.envBoxMin.value=l.boxMin,k.envBoxMax.value=l.boxMax):(k.envBoxMin.value=f,k.envBoxMax.value=f))}}e=e.lightMap;this.lightMapped&&k.lightMap.value!==e&&(h=!0,k.lightMap.value=e);return h};WALK.StandardMaterial.prototype.setBaseColorRGB=function(e,k,h){this.baseColor.setRGB(e,k,h);this.setUniforms();
this._updated()};WALK.StandardMaterial.prototype.setTexture=function(e,k){if(k){var h=this.baseColorTexture;h&&(k.wrapS=h.wrapS,k.wrapT=h.wrapT,k.anisotropy=h.anisotropy)}this[e]=k||null;"baseColorTexture"===e?(this._baseColorTextureCorrection=!1,this._baseColorTextureContrast=0,this.baseColorTextureHslOffset.h=0,this.baseColorTextureHslOffset.s=0,this.baseColorTextureHslOffset.l=0):"bumpTexture"===e&&(this._bumpScale=.001)};WALK.StandardMaterial.prototype.serialize=function(){var e=this,k=null;console.assert(!this.merged);
this.baseColorTextureCorrection&&(k={contrast:this.baseColorTextureContrast,hslOffset:[this.baseColorTextureHslOffset.h,this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l]});var h={name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),baseColorTextureCorrection:k,alphaInLowerHalf:this.alphaInLowerHalf,opacity:this.opacity,emissive:this.emissive,emissionStrength:this.emissionStrength,roughness:this.roughness,metallic:this.metallic,envMapProject:this.envMapProject,
bumpScale:this.bumpScale,doubleSided:this.doubleSided,doNotImport:this.doNotImport};void 0!==this._chromaKeyEnabled&&(h.chromaKeyEnabled=this.chromaKeyEnabled,h.chromaKeyColor=this.chromaKeyColor.roundChannels().toArray(),h.chromaKeyDelta=this._chromaKeyDelta.toArray());k=function(l){var r=e[l];r?r.fromEditor&&(h[l]=r.serialize()):h[l]=null};k("baseColorTexture");k("roughnessTexture");k("metallicTexture");k("bumpTexture");return h}})();(function(){WALK.StandardMaterialWater=function(){WALK.StandardMaterial.call(this);this.type="water";this._isPlaying=!0;this._isSleeping=!1;this.setUniform("time","f",0);this._roughness=0;this.baseColor=new THREE.Color(0);this._wavesScale=this._wavesSpeed=1;this._refractionFactor=0;this.opacity=.2;this.doNotImport={baseColor:!0,baseColorTexture:!0,opacity:!0}};WALK.StandardMaterialWater.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.StandardMaterialWater.prototype.constructor=WALK.StandardMaterialWater;
WALK.StandardMaterialWater.prototype.addTextureProperty("normalTexture");WALK.StandardMaterialWater.prototype.textureNeedsUv0=function(a){return!1};WALK.StandardMaterialWater.prototype.hash=function(a){return"water"};WALK.StandardMaterialWater.prototype.canMerge=function(a){return this.type===a.type&&this.opacity===a.opacity&&this.baseColor.equals(a.baseColor)&&this.normalTexture===a.normalTexture&&this.wavesSpeed===a.wavesSpeed&&this.wavesScale===a.wavesScale&&this.refractionFactor===a.refractionFactor};
WALK.StandardMaterialWater.prototype.setUniforms=function(){WALK.StandardMaterial.prototype.setUniforms.call(this);var a=this.normalTexture;this.condDefine(a&&a.loaded&&!this.isLightProbeDisabled(),"USE_NORMAL_TEXTURE")&&(this.setUniform("normalTexture","t",a),this.setUniform("wavesScale","f",this.wavesScale),1!==this.opacity?this.setUniform("refractionFactor","f",this.refractionFactor):this.setUniform("refractionFactor","f",0))};WALK.StandardMaterialWater.prototype.fragmentShaderHooks=function(){return WALK.getShader("water.glsl")};
Object.defineProperty(WALK.StandardMaterialWater.prototype,"refractionFactor",{get:function(){return this._refractionFactor},set:function(a){this._refractionFactor=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesSpeed",{get:function(){return this._wavesSpeed},set:function(a){this._wavesSpeed=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesScale",{get:function(){return this._wavesScale},
set:function(a){this._wavesScale=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"hideFromLightProbes",{get:function(){return 1!==this.opacity&&0!==this.refractionFactor}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isAnimated",{get:function(){return!0}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying&&0<this.wavesSpeed}});WALK.StandardMaterialWater.prototype.play=
function(){this._isPlaying=!0};WALK.StandardMaterialWater.prototype.pause=function(){this._isPlaying=!1};WALK.StandardMaterialWater.prototype.sleepAnimation=function(){this._isSleeping=!0};WALK.StandardMaterialWater.prototype.wakeAnimation=function(){this._isSleeping=!1};WALK.StandardMaterialWater.prototype.update=function(a){this.uniforms.time.value+=a*this.wavesSpeed*.1};WALK.StandardMaterialWater.prototype.serialize=function(){return{name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),
baseColorTexture:null,opacity:this.opacity,normalTexture:this.normalTexture?this.normalTexture.serialize():null,wavesSpeed:this.wavesSpeed,wavesScale:this.wavesScale,refractionFactor:this.refractionFactor,doNotImport:this.doNotImport}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("luma_fragment.glsl"),c=new THREE.Color(16777215);WALK.LumaMaterial=function(d){WALK.BaseMaterial.call(this,a,b);this.computeIncidentLuma=d;this.setUniform("lightMap","t",null);this.color=new THREE.Color(c);this.setUniform("color","c",this.color);this.addDefine("USE_LIGHTMAP")};WALK.LumaMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LumaMaterial.prototype.constructor=WALK.LumaMaterial;WALK.LumaMaterial.prototype.refreshPerObjectUniforms=
function(d,f){var g=d.lightMap,e=!1;f.lightMap.value!==g&&(f.lightMap.value=g,e=!0);d=this.computeIncidentLuma?c:d.material.baseColor;d.equals(this.color)||(this.color.copy(d),e=!0);return e}})();(function(){WALK.DebugMaterial=function(){WALK.StandardMaterial.call(this);this.noSharedBuffers=new THREE.Color(16777215);this.sharedBuffersMaster=new THREE.Color(255);this.sharedBuffersCopy=new THREE.Color(65280);this.headLight=!0;this.setUniforms();this.defaultAttributeValues=Object.assign({},this.defaultAttributeValues);this.defaultAttributeValues.sphericalNormal=[0,0]};WALK.DebugMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.DebugMaterial.prototype.refreshPerObjectUniforms=
function(a,b){b.baseColor.value=0===a.sharedBuffersDebug?this.noSharedBuffers:1===a.sharedBuffersDebug?this.sharedBuffersMaster:this.sharedBuffersCopy;return!0}})();(function(){var a=WALK.getShader("equirect_sky_vertex.glsl"),b=WALK.getShader("equirect_sky_fragment.glsl");WALK.EquirectSkyMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.depthWrite=!1;this.side=THREE.FrontSide;this.uniforms={map:{type:"t",value:null},colorMap:{type:"t",value:null},exposure:{type:"f",value:1},cameraGamma:{type:"f",value:1}}};WALK.EquirectSkyMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.EquirectSkyMaterial.prototype.constructor=WALK.EquirectSkyMaterial;
Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"map",{get:function(){return this.uniforms.map.value},set:function(c){this.uniforms.map.value=c;this.condDefine(this.map.isRgbm,"USE_RGBM_MAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(c){this.condDefine(c,"HDR_OUTPUT")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(c){this.uniforms.colorMap.value=
c;this.condDefine(c,"USE_COLORMAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraExposure",{get:function(){return Math.log2(this.uniforms.exposure.value)},set:function(c){this.uniforms.exposure.value=Math.pow(2,c)}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(c){this.uniforms.cameraGamma.value=c}})})();(function(){WALK.ProceduralSkyMaterial=function(){WALK.BaseMaterial.call(this,WALK.getShader("procedural_sky_vertex.glsl"),WALK.getShader("procedural_sky_fragment.glsl"));this.depthWrite=!1;this.side=THREE.BackSide;this.uniforms={topColor:{type:"c",value:new THREE.Color(15135487)},bottomColor:{type:"c",value:new THREE.Color(16777215)},sinBottomAngle:{type:"f",value:Math.sin(THREE.Math.degToRad(-30))},exponent:{type:"f",value:.9},colorMap:{type:"t",value:null}}};WALK.ProceduralSkyMaterial.prototype=
Object.create(WALK.BaseMaterial.prototype);WALK.ProceduralSkyMaterial.prototype.constructor=WALK.ProceduralSkyMaterial;Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(a){this.uniforms.colorMap.value=a;this.condDefine(a,"USE_COLORMAP")}})})();(function(){var a=WALK.getShader("object_distance_vertex.glsl"),b=WALK.getShader("object_distance_float_fragment.glsl"),c=WALK.getShader("object_distance_byte_fragment.glsl");WALK.ObjectDistanceMaterial=function(d){WALK.BaseMaterial.call(this,a,d?b:c);this.doNotOverrideSide=!0;this.uniforms={objectId:{type:"i",value:null}}};WALK.ObjectDistanceMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.ObjectDistanceMaterial.prototype.constructor=WALK.ObjectDistanceMaterial;WALK.ObjectDistanceMaterial.prototype.refreshPerObjectUniforms=
function(d,f){f.objectId.value=d.visibilityId;return!0}})();(function(){var a=WALK.getShader("wireframe_vertex.glsl"),b=WALK.getShader("wireframe_fragment.glsl");WALK.WireframeMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.lineColor=c;this.setUniform("lineColor","c",c);this.setUniform("lineMaxAlpha","f",.65);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0);this.customLightmapResolutionLineColor=new THREE.Color(170);this.autoLightmapResolutionLineColor=new THREE.Color(43690);this.meshSelectedLineColor=
new THREE.Color(47872);this.meshSelectedSecondaryLineColor=new THREE.Color(13404160);this.transparent=!0;this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.attributes=this.attributes.concat(["order"]);this.enableStandardDerivativesExtension()};WALK.WireframeMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.WireframeMaterial.prototype.constructor=WALK.WireframeMaterial;WALK.WireframeMaterial.prototype.propertyFromUniform("lineMaxAlpha");WALK.WireframeMaterial.prototype.propertyFromUniform("highlight");
WALK.WireframeMaterial.prototype.propertyFromUniform("highlightMix");WALK.WireframeMaterial.prototype.refreshPerObjectUniforms=function(c,d){var f=!1;null!==c.highlightMix&&void 0!==c.highlightMix&&c.highlightMix!==d.highlightMix.value&&(d.highlightMix.value=c.highlightMix,f=!0);return null!==c.selected&&void 0!==c.selected&&(c=!0===c.selected?this.meshSelectedLineColor:!0===c.selectedSecondary?this.meshSelectedSecondaryLineColor:null!==c.node.lightmapResolution?this.customLightmapResolutionLineColor:
0<=c.autoLightmapResolution?this.autoLightmapResolutionLineColor:this.lineColor,d.lineColor.value!==c)?(d.lineColor.value=c,!0):f}})();(function(){var a=new WALK.InlineShader("attribute vec3 envLookup;\nvarying vec3 vEnvLookup;\nvoid main() {\nvEnvLookup = envLookup;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"),b=new WALK.InlineShader("uniform samplerCube envMap;\nvarying vec3 vEnvLookup;\nvoid main() {\nint objectId = int(textureCube(envMap, vEnvLookup).x);\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\ngl_FragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 1.0);\n}");
WALK.ObjectDistanceReader=function(c,d){var f=[],g=[],e=3*d,k=2*d;this.readCubeMapToBuffer=function(n){u.uniforms.envMap.value=n;m.set(!0,!1,!1);c.render(l,h,r);c.readPixels(e,k,q);m.restore();return q};this.dispose=function(){for(var n=0;6>n;n+=1)f[n].geometry.dispose();u.dispose();r.dispose();q=null};var h=new THREE.OrthographicCamera(-1,1,1,-1,0,1);var l=new THREE.Scene;var r=c.createRenderTarget(e,k,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});
var q=new Uint8Array(4*e*k);var m=new WALK.AutoClearAlter(c);var u=new WALK.BaseMaterial(a,b);u.uniforms={envMap:{type:"t",value:null}};u.attributes={envLookup:{type:"v3",value:null}};(function(){for(var n=[[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1]],[[-1,1,-1],[-1,1,1],[-1,-1,-1],[-1,-1,1]],[[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1]],[[-1,-1,1],[1,-1,1],[-1,-1,-1],[1,-1,-1]],[[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1]],[[1,1,-1],[-1,1,-1],[1,-1,-1],[-1,-1,-1]]],w=0;6>w;w+=1){var v=new THREE.PlaneBufferGeometry(d,d),
y=new Float32Array(12);v.addAttribute("envLookup",new THREE.BufferAttribute(y,3));for(var C=0;4>C;C+=1){var A=C,I=n[w][C];y[3*A]=I[0];y[3*A+1]=I[1];y[3*A+2]=I[2]}f[w]=new THREE.Mesh(v,u);l.add(f[w])}g[0]=[0,0];g[1]=[d,0];g[2]=[2*d,0];g[3]=[0,d];g[4]=[d,d];g[5]=[2*d,d]})();(function(n,w){n/=2;var v=w/2;h.left=-n;h.right=n;h.top=v;h.bottom=-v;h.updateProjectionMatrix();w=-n+d/2;n=v-d/2;for(v=0;v<f.length;v+=1)f[v].position.set(w+g[v][0],n-g[v][1],0)})(e,k)}})();(function(){WALK.ObjectDistanceQuery=function(a,b,c){var d=new WALK.ObjectDistanceMaterial(!0),f=new WALK.CubeCamera(WALK.CAMERA_WALK_NEAR,c);c=WALK.LIGHT_DISTANCE_PROBE_SIZE;var g=a.createRenderTarget(c,c,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,type:GLC.HALF_FLOAT_OES,stencilBuffer:!1,generateMipmaps:!1}),e=new WALK.ObjectDistanceReader(a,WALK.OBJECT_VISIBILITY_PROBE_SIZE),k=new WALK.AutoClearAlter(a),h=new WALK.ClearColorAlter(a),l=new THREE.Color(16777215);this.updateCubeMapAndFindVisibleObjects=
function(r){var q=[],m=[],u=[];f.position.copy(r);f.updateMatrixWorld();for(r=0;r<b.length;r+=1){var n=b[r];console.assert(!n.visibilityId);n.visibilityId=r;m.push(n)}k.set(!0,!0,!1);h.set(l);for(r=0;6>r;r+=1)g.activeCubeFace=r,a.renderMeshes(m,d,f.sideCameras[r],g);h.restore();k.restore();m=e.readCubeMapToBuffer(g);r=m.length;for(n=0;n<r;n+=4){var w=Math.round(65536*m[n]+256*m[n+1]+m[n+2]);16777215!==w&&(q[w]=!0)}for(var v in q)q.hasOwnProperty(v)&&u.push(b[v]);for(q=0;q<b.length;q+=1)b[q].visibilityId=
null;return u};this.objectDistanceCubeMap=function(){return g};this.dispose=function(){d.dispose();g.dispose();g=null;e.dispose()}};WALK.ObjectDistanceQuery.prototype.constructor=WALK.ObjectDistanceQuery})();(function(){WALK.LightVisibilityMaterial=function(a,b,c,d){WALK.BaseMaterial.call(this,WALK.getShader("light_visibility_vertex.glsl"),WALK.getShader("light_visibility_fragment.glsl"));this.depthWrite=this.depthTest=!1;this.uniforms={objectId:{type:"f",value:a},lightId:{type:"f",value:0},lightAttrMap:{type:"t",value:b},lightsCount:{type:"f",value:c},objectDistanceMap:{type:"t",value:d},combineWithMap:{type:"t",value:null}}};WALK.LightVisibilityMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);
WALK.LightVisibilityMaterial.prototype.constructor=WALK.LightVisibilityMaterial;Object.defineProperty(WALK.LightVisibilityMaterial.prototype,"lightId",{get:function(){return this.uniforms.lightId.value},set:function(a){this.uniforms.lightId.value=a}});Object.defineProperty(WALK.LightVisibilityMaterial.prototype,"combineWithMap",{get:function(){return this.uniforms.combineWithMap.value},set:function(a){this.uniforms.combineWithMap.value=a}})})();(function(){var a=WALK.getShader("aabb_query_vertex.glsl"),b=WALK.getShader("aabb_query_fragment.glsl");WALK.AabbQueryMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.side=THREE.DoubleSide;this.uniforms={axis:{type:"i",value:0}}};WALK.AabbQueryMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.AabbQueryMaterial.prototype.constructor=WALK.AabbQueryMaterial;Object.defineProperty(WALK.AabbQueryMaterial.prototype,"axis",{get:function(){return this.uniforms.axis.value},set:function(c){console.assert(0===
c||1===c||2===c);this.uniforms.axis.value=c}})})();(function(){var a=WALK.getShader("gaze_pointer_vertex.glsl"),b=WALK.getShader("gaze_pointer_fragment.glsl");WALK.GazePointerMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.transparent=!0;this.transparentRenderOrder=2;this.setUniform("circleSpan","f",0)};WALK.GazePointerMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.GazePointerMaterial.prototype.constructor=WALK.GazePointerMaterial;Object.defineProperty(WALK.GazePointerMaterial.prototype,
"circleSpan",{set:function(c){console.assert(1>=c);this.uniforms.circleSpan.value=2*Math.PI*c-Math.PI}})})();(function(){var a=WALK.getShader("editor_light_vertex.glsl"),b=WALK.getShader("editor_light_fragment.glsl");WALK.LightMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.setUniform("color","c",c.color);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0)};WALK.LightMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LightMaterial.prototype.propertyFromUniform("highlightMix")})();(function(){WALK.MirrorMaterial=function(a,b){WALK.BaseMaterial.call(this,WALK.getShader("mirror_vertex.glsl"),WALK.getShader("mirror_fragment.glsl"));this.hideFromLightProbes=!0;this.uniforms={mirrorColor:{type:"c",value:a},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:b}}};WALK.MirrorMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.MirrorMaterial.prototype.constructor=WALK.MirrorMaterial;Object.defineProperty(WALK.MirrorMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},
set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.MirrorMaterial.prototype,"mirrorSampler",{get:function(){return this.uniforms.mirrorSampler.value},set:function(a){this.uniforms.mirrorSampler.value=a}})})();(function(){WALK.createBoundingBoxMaterial=function(){var a=new WALK.WireframeMaterial(WALK.EDITOR_SELECTION_COLOR);a.depthTest=!0;a.depthWrite=!1;a.side=THREE.DoubleSide;a.hideFromLightProbes=!0;return a}})();(function(){var a=WALK.getShader("anchor_vertex.glsl");WALK.AnchorMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=a;this._metallic=.1;this._roughness=.5;this._bumpScale=.01;this.hideFromLightProbes=!0};WALK.AnchorMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);var b=WALK.getShader("anchor_sprite_vertex.glsl");WALK.AnchorSpriteMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=b;this.hideFromLightProbes=!0};WALK.AnchorSpriteMaterial.prototype=
Object.create(WALK.StandardMaterial.prototype)})();(function(){var a=WALK.getShader("rotate_gizmo_material_vertex.glsl"),b=WALK.getShader("rotate_gizmo_material_fragment.glsl");WALK.RotateGizmoMaterial=function(c,d){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.transparent=!0;this.transparentRenderOrder=1E3;this.hideFromLightProbes=!0;this.uniforms={opacity:{type:"f",value:1},color:{type:"c",value:c},gizmoPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},sphereRadius:{type:"f",value:1}};
Object.defineProperty(this,"color",{get:function(){return this.uniforms.color.value}});Object.defineProperty(this,"opacity",{get:function(){return this.uniforms.opacity.value},set:function(f){this.uniforms.opacity.value=f}});Object.defineProperty(this,"gizmoPosition",{get:function(){return this.uniforms.gizmoPosition.value}});Object.defineProperty(this,"sphereRadius",{get:function(){return this.uniforms.sphereRadius.value},set:function(f){this.uniforms.sphereRadius.value=f}});this.opacity=d;this.setUniforms=
function(){}};WALK.RotateGizmoMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.RotateGizmoMaterial.prototype.constructor=WALK.RotatoGizmoMaterial})();(function(){function a(e){e instanceof THREE.Mesh&&(e.frustumCulled=!1)}function b(e){e instanceof THREE.Mesh&&(e.frustumCulled=!0)}function c(e){for(var k=0,h=0;h<e.length;h+=1)k+=e[h].instances.length;return k+1}function d(e,k,h){var l=[],r=new THREE.Vector2,q=new Uint8Array(4),m;this.findFreeChannel=function(u){m.material.uniforms.threshold.value=1024;for(var n=0;n<l.length;n+=1){var w=l[n];r.set(1/u.width,1/u.height);m.material.uniforms.sizeInv.value=r;m.render(e,w,u);u=w;m.material.uniforms.threshold.value=
1}u=e.context;u.readPixels(0,0,1,1,u.RGBA,u.UNSIGNED_BYTE,q);for(u=0;4>u;u+=1)if(0===q[u])return u;return null};this.dispose=function(){for(var u=0;u<l.length;u+=1)l[u].dispose(),l[u]=null;m.material.dispose()};(function(){for(var u={format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1},n=k,w=h;1!==n&&1!==w;){n=Math.max(n/2,1);w=Math.max(w/2,1);var v=e.createRenderTarget(n,w,u);l.push(v)}u={uniforms:{lightVisibilityMap:{type:"t",value:null},threshold:{type:"f",
value:null},sizeInv:{type:"v2",value:null}},vertexShader:THREE.CopyShader.vertexShader,fragmentShader:WALK.getShader("light_visibility_free_channel_fragment.glsl")};m=new THREE.ShaderPass(u,"lightVisibilityMap")})()}function f(e){var k=[],h={};this.lightMap=function(l){return k[l]};this.lightMapId=function(l){return h[l.name]};this.lightMapsCount=function(){return k.length};this.findObjectsWithLightMap=function(l,r){for(var q=[],m=0;m<l.length;m+=1){var u=l[m];h[u.userData.origMaterial.lightMap.name]===
r&&q.push(u)}return q};(function(){for(var l=0;l<e.length;l+=1){var r=e[l].lightMap;r&&void 0===h[r.name]&&(h[r.name]=k.length,k.push(r))}})()}function g(e){for(var k=c(e),h=new Float32Array(16*k),l=0;16>l;l+=1)h[l]=0;WALK.Light.iterateLightInstances(e,function(r,q,m){m*=16;h[m]=q.position.x;h[m+1]=q.position.y;h[m+2]=q.position.z;h[m+3]=r.size;h[m+4]=r.color.r;h[m+5]=r.color.g;h[m+6]=r.color.b;h[m+7]=r.strength;"spot"===r.type?(WALK.log("have spot light"),h[m+8]=1,q=q.directionW(),h[m+9]=q.x,h[m+
10]=q.y,h[m+11]=q.z,h[m+12]=THREE.Math.degToRad(r.angle/2)):(WALK.log("have point light"),h[m+8]=0)});e=new WALK.DataTexture(h,16*k/4,1,GLC.RGBA,GLC.FLOAT,GLC.CLAMP_TO_EDGE,GLC.CLAMP_TO_EDGE,GLC.NEAREST,GLC.NEAREST);e.needsUpdate=!0;return e}WALK.LightAssigner=function(e,k,h,l,r){var q,m,u,n,w,v,y,C,A;this.assignLightLookupMaps=function(){for(var I=0;I<l.length;I+=1){var D=l[I],E=D.lightMap;E&&(E=q.lightMapId(E),D.lightVisibilityMap=A[E],D.lightAttrMap=C,D.lightsCount=c(h),D.setUniforms())}};this.dispose=
function(){m.dispose();u.dispose();v.material.dispose();for(var I=0;I<q.lightMapsCount();I+=1)w[I].dispose()};(function(){var I=0,D=0;q=new f(l);n=[];w=[];A=[];for(var E=0;E<q.lightMapsCount();E+=1){var O=q.lightMap(E);console.assert(O.width&&O.height);var S=O.width/WALK.LIGHT_VISIBILITY_MAP_DOWNSAMPLE;O=O.height/WALK.LIGHT_VISIBILITY_MAP_DOWNSAMPLE;I=Math.max(I,S);D=Math.max(D,O);n[E]=e.createRenderTarget(S,O,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,type:GLC.HALF_FLOAT_OES,stencilBuffer:!0,
generateMipmaps:!1});w[E]=e.createRenderTarget(S,O,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,type:GLC.HALF_FLOAT_OES,stencilBuffer:!0,generateMipmaps:!1,shareDepthFrom:n[E]});A[E]=n[E]}m=new WALK.ObjectDistanceQuery(e,r,k);u=new d(e,I,D);C=g(h);v=new THREE.ShaderPass(THREE.CopyShader);y=new WALK.AutoClearAlter(e)})();(function(){for(var I=c(h),D=m.objectDistanceCubeMap(),E=0;E<r.length;E+=1)r[E].userData.origMaterial=r[E].material,r[E].material=new WALK.LightVisibilityMaterial(E+
1,C,I,D)})(r);WALK.Light.iterateLightInstances(h,function(I,D,E){var O=[];if(0===I.strength)WALK.log("skipping light instance with strength 0");else{I=e.context;D=m.updateCubeMapAndFindVisibleObjects(D.position);WALK.log("Objects visible from light"+E+" "+D.length);I.enable(I.STENCIL_TEST);for(var S=!0,W=0;W<q.lightMapsCount();W+=1){for(var U=q.findObjectsWithLightMap(D,W),va=new THREE.Scene,ta=0;ta<U.length;ta+=1)va.add(new THREE.Mesh(U[ta].geometry,U[ta].material));U=va;U.traverse(a);va=E;ta=w[W];
for(var qa=0;qa<r.length;qa+=1){var ha=r[qa].material;console.assert(ha instanceof WALK.LightVisibilityMaterial);ha.lightId=va;ha.combineWithMap=ta}y.set(!0,!0,!0);I.stencilOp(I.REPLACE,I.REPLACE,I.REPLACE);I.stencilFunc(I.ALWAYS,1,4294967295);e.render(U,v.camera,n[W]);y.restore();U.traverse(b);y.set(!1,!1,!1);U=u.findFreeChannel(n[W]);y.restore();if(null===U){S=!1;break}O[W]=U}if(S){y.set(!1,!1,!1);I.stencilFunc(I.EQUAL,1,4294967295);I.stencilOp(I.KEEP,I.KEEP,I.KEEP);for(E=0;E<q.lightMapsCount();E+=
1){switch(O[E]){case 0:I.colorMask(!0,!1,!1,!1);break;case 1:I.colorMask(!1,!0,!1,!1);break;case 2:I.colorMask(!1,!1,!0,!1);break;case 3:I.colorMask(!1,!1,!1,!0);break;default:console.assert(!1)}v.render(e,w[E],n[E]);I.colorMask(!0,!0,!0,!0)}y.restore()}else WALK.log("Available channel not found, skipping light");I.disable(I.STENCIL_TEST)}});(function(){for(var I=0;I<r.length;I+=1)r[I].material.dispose(),r[I].material=r[I].userData.origMaterial,delete r[I].userData.origMaterial})(r);(function(){var I=
new THREE.Vector2,D={uniforms:{lightVisibilityMap:{type:"t",value:null},sizeInv:{type:"v2",value:null}},vertexShader:THREE.CopyShader.vertexShader,fragmentShader:WALK.getShader("light_visibility_dilate_fragment.glsl")};D=new THREE.ShaderPass(D,"lightVisibilityMap");y.set(!1,!1,!1);for(var E=0;E<q.lightMapsCount();E+=1){var O=A[E];I.set(1/O.width,1/O.height);D.material.uniforms.sizeInv.value=I;D.material.programNeedsUpdate=!0;D.render(e,O,w[E])}y.restore();D.material.dispose()})()}})();(function(){WALK.Camera=function(){var a=this;THREE.PerspectiveCamera.call(this,WALK.CAMERA_DEFAULT_FOV,1,WALK.CAMERA_WALK_NEAR,WALK.CAMERA_MIN_FAR);this._defaultFov=this.fov;this._exposure=this._defaultExposure=0;this._gamma=this._defaultGamma=1;this._autoExposure=!1;this._autoExposureDarkness=.3;this._moveMaxSpeed=WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;this._autoClimb=!1;this._colorMap=null;this._exposureUpdatedEvent={type:"exposureUpdated",target:null};this._gammaUpdatedEvent={type:"gammaUpdated",
target:null};this._colorMapUpdated={type:"colorMapUpdated",target:null};var b={type:"updated",target:this};this._updated=function(){return a.dispatchEvent(b)}};WALK.Camera.prototype=Object.create(THREE.PerspectiveCamera.prototype);WALK.Camera.prototype.constructor=WALK.Camera;Object.defineProperty(WALK.Camera.prototype,"defaultFov",{get:function(){return this._defaultFov},set:function(a){this.fov=this._defaultFov=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"colorMap",{get:function(){return this._colorMap},
set:function(a){var b=this;this._colorMap&&this._colorMap.dispose();(this._colorMap=a)?a.addLoadedListener(function(){return b.dispatchEvent(b._colorMapUpdated)}):this.dispatchEvent(this._colorMapUpdated)}});WALK.Camera.prototype.colorMapReady=function(){return this._colorMap&&this._colorMap.loaded};Object.defineProperty(WALK.Camera.prototype,"defaultExposure",{get:function(){return this._defaultExposure},set:function(a){this._defaultExposure=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,
"exposure",{get:function(){return this._exposure},set:function(a){a!==this._exposure&&(this._exposure=a,this.dispatchEvent(this._exposureUpdatedEvent))}});WALK.Camera.prototype.setExposureController=function(a){this.exposureController=a};WALK.Camera.prototype.setExposure=function(a){this.exposureController?this.exposureController.setTargetExposure(a):this.exposure=a};Object.defineProperty(WALK.Camera.prototype,"defaultGamma",{get:function(){return this._defaultGamma},set:function(a){this._defaultGamma=
a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"gamma",{get:function(){return this._gamma},set:function(a){a!==this._gamma&&(this._gamma=a,this.dispatchEvent(this._gammaUpdatedEvent))}});WALK.Camera.prototype.setGamma=function(a){this.gamma=a};Object.defineProperty(WALK.Camera.prototype,"autoExposure",{get:function(){return this._autoExposure},set:function(a){a!==this._autoExposure&&(this._autoExposure=a,this._exposure=this._defaultExposure,this._updated())}});WALK.Camera.prototype.setFar=
function(a){this.far=a;this.updateProjectionMatrix();this._updated()};Object.defineProperty(WALK.Camera.prototype,"moveMaxSpeed",{get:function(){return this._moveMaxSpeed},set:function(a){this._moveMaxSpeed=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoClimb",{get:function(){return this._autoClimb},set:function(a){this._autoClimb=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoExposureDarkness",{get:function(){return this._autoExposureDarkness},set:function(a){this._autoExposureDarkness=
a;this._updated()}});WALK.Camera.prototype.serialize=function(){return{fov:this.defaultFov,exposure:this.defaultExposure,gamma:this.defaultGamma,lutTexture:this.colorMap?this.colorMap.serialize():null,autoClimb:this.autoClimb,moveMaxSpeed:this.moveMaxSpeed}};THREE.EventDispatcher.prototype.apply(WALK.Camera.prototype)})();(function(){WALK.LightInstance=function(b,c,d){this.light=b;this.position=c;this.rotation=d;this._directionW=new THREE.Vector3};WALK.LightInstance.prototype={constructor:WALK.LightInstance,directionW:function(){this._directionW.set(0,1,0);this._directionW.applyEuler(this.rotation);return this._directionW},get index(){var b=this.light.instances.indexOf(this);console.assert(-1!==b,"Light instance not found");return b},setPosition:function(b,c,d){this.position.set(b,c,d);this.light._updated()},setRotation:function(b,
c,d){this.rotation.yaw=WALK.normalizeRotation(b);this.rotation.pitch=WALK.normalizeRotation(c);this.rotation.roll=WALK.normalizeRotation(d);this.light._updated()},setRotationDeg:function(b,c,d){b=THREE.Math.degToRad(b);c=THREE.Math.degToRad(c);d=void 0===d?this.rotation.roll:THREE.Math.degToRad(d);this.setRotation(b,c,d)},serialize:function(){return{position:this.position.toArray(),rotation:this.rotation.toDegTriple()}}};var a="angle color height photometricProfile strength size type width".split(" ");
WALK.Light=function(b){this._name=b.name;this._type=b.type||"spot";if(void 0!==b.strength)var c=b.strength;else a:{switch(this._type){case "point":case "spot":case "area":c=25;break a;case "sun":c=8;break a;default:console.assert(!1)}c=void 0}this._strength=c;if(void 0!==b.color)c=(new THREE.Color).fromArray(b.color);else a:{switch(this._type){case "point":case "spot":case "area":c=new THREE.Color(1,.88,.799);break a;case "sun":c=new THREE.Color(1,.8,.638);break a;default:console.assert(!1)}c=void 0}this._color=
c;if(void 0!==b.size)c=b.size;else a:{switch(this._type){case "point":case "spot":case "area":c=.1;break a;case "sun":c=.02;break a;default:console.assert(!1)}c=void 0}this._size=c;this._width=void 0!==b.width?b.width:.2;this._height=void 0!==b.height?b.height:.2;this._angle=void 0!==b.angle?b.angle:140;this._photometricProfile=void 0!==b.photometricProfile?b.photometricProfile:null;!0===b.doNotImport?this.doNotImport=!0:(this.doNotImport={},b.doNotImport&&WALK.copyProperties(b.doNotImport,a,this.doNotImport));
this.instances=[]};WALK.Light.prototype={constructor:WALK.Light,forEachLightInstance:function(b){for(var c=0;c<this.instances.length;c+=1)b(this.instances[c])},get name(){return this._name},set name(b){this._name=b;this._updated()},get type(){return this._type},set type(b){this._type=b;this._updated()},get size(){return this._size},set size(b){this._size=b;this._updated()},get width(){return this._width},set width(b){this._width=b;this._updated()},get height(){return this._height},set height(b){this._height=
b;this._updated()},get angle(){return this._angle},set angle(b){this._angle=b;this._updated()},get color(){return this._color},setColorRGB:function(b,c,d){this._color.setRGB(b,c,d);this._updated()},get strength(){return this._strength},set strength(b){this._strength=b;this._updated()},get photometricProfile(){return this._photometricProfile},set photometricProfile(b){this._photometricProfile=b;this._updated()},setDoNotImport:function(b,c){this.doNotImport[b]=c;this._updated()},addInstance:function(b,
c){c=void 0===c?[0,-90,0]:c;b=(new THREE.Vector3).fromArray(b);c=(new WALK.Euler).setFromDegTriple(c);c=new WALK.LightInstance(this,b,c);this.instances.push(c);this.dispatchEvent({type:"instanceAdded",instance:c,target:this})},removeInstance:function(b){WALK.removeFromArray(b,this.instances);this.dispatchEvent({type:"instanceRemoved",instance:b,target:this})},serialize:function(){return{name:this.name,type:this.type,angle:this.angle,strength:this.strength,photometricProfile:this.photometricProfile,
size:this.size,width:this.width,height:this.height,color:this.color.roundChannels().toArray(),doNotImport:this.doNotImport,instances:this.instances.map(function(b){return b.serialize()})}},_updated:function(){this.dispatchEvent({type:"updated",target:this})}};THREE.EventDispatcher.prototype.apply(WALK.Light.prototype);WALK.Light.iterateLightInstances=function(b,c){for(var d=1,f=0;f<b.length;f+=1)for(var g=b[f],e=0;e<g.instances.length;e+=1,d+=1)c(g,g.instances[e],d)}})();(function(){WALK.LightProbe=function(a){this.id=a.id;this.position=new THREE.Vector3;a.position&&this.position.fromArray(a.position);this._filteredCubeTexture=null;this._filteredCubeTextureNoLod={};this._mirrorCubeTexture=null;this._boxEnabled=a.box?!("enabled"in a.box)||a.box.enabled:!1;this.boxMin=new THREE.Vector3;this.boxMax=new THREE.Vector3;a.box&&(this.boxMin.fromArray(a.box.min),this._setClampedBoxMax(a.box.max[0],a.box.max[1],a.box.max[2]))};WALK.LightProbe.prototype={constructor:WALK.LightProbe,
setFilteredTexture:function(a){this._filteredCubeTexture&&this._filteredCubeTexture.dispose();this._filteredCubeTexture=a},setFilteredTextureNoLod:function(a,b){this._filteredCubeTextureNoLod[b]&&this._filteredCubeTextureNoLod[b].dispose();this._filteredCubeTextureNoLod[b]=a},isBoundingBoxInitialized:function(){return!this.boxMin.equals(this.boxMax)},resetBoundingBox:function(){this.boxMin.set(0,0,0);this.boxMax.set(0,0,0)},isBoundingBoxEnabled:function(){return this._boxEnabled},disableBoundingBox:function(){this._boxEnabled=
!1;this.dispatchEvent({type:"boundsUpdated",target:this})},enableBoundingBox:function(){this._boxEnabled=!0;this.isBoundingBoxInitialized()||this.dispatchEvent({type:"boundsInit",target:this});this.dispatchEvent({type:"boundsUpdated",target:this})},getFilteredTexture:function(){return this._filteredCubeTexture},getFilteredTextureNoLod:function(a){return this._filteredCubeTextureNoLod[a]},setMirrorTexture:function(a){this._mirrorCubeTexture&&this._mirrorCubeTexture.dispose();this._mirrorCubeTexture=
a},setPosition:function(a,b,c){this.position.set(a,b,c);this.dispatchEvent({type:"positionUpdated",target:this})},texturesReady:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},getMirrorTexture:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},_setClampedBoxMin:function(a,b,c){a>this.boxMax.x-.1&&(a=this.boxMax.x-.1);b>this.boxMax.y-.1&&(b=this.boxMax.y-.1);c>this.boxMax.z-.1&&(c=this.boxMax.z-
.1);this.boxMin.set(a,b,c)},isBoxMinValid:function(a,b,c){return a>this.boxMax.x-.1||b>this.boxMax.y-.1||c>this.boxMax.z-.1?!1:!0},isBoxMaxValid:function(a,b,c){return a<this.boxMin.x+.1||b<this.boxMin.y+.1||c<this.boxMin.z+.1?!1:!0},setBoxMin:function(a,b,c){this._setClampedBoxMin(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},_setClampedBoxMax:function(a,b,c){a<this.boxMin.x+.1&&(a=this.boxMin.x+.1);b<this.boxMin.y+.1&&(b=this.boxMin.y+.1);c<this.boxMin.z+.1&&(c=this.boxMin.z+.1);
this.boxMax.set(a,b,c)},setBoxMax:function(a,b,c){this._setClampedBoxMax(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},serialize:function(){var a={id:this.id,position:this.position.toArray()};this.isBoundingBoxInitialized()&&(a.box={enabled:this._boxEnabled,min:this.boxMin.toArray(),max:this.boxMax.toArray()});return a},dispose:function(){this._filteredCubeTexture&&(this._filteredCubeTexture.dispose(),this._filteredCubeTexture=null);for(var a in this._filteredCubeTextureNoLod)this._filteredCubeTextureNoLod.hasOwnProperty(a)&&
this._filteredCubeTextureNoLod[a].dispose();this._filteredCubeTextureNoLod={};this._mirrorCubeTexture&&(this._mirrorCubeTexture.dispose(),this._mirrorCubeTexture=null)}};THREE.EventDispatcher.prototype.apply(WALK.LightProbe.prototype)})();(function(){function a(f){return null!==f&&void 0!==f}function b(f){f.configure()}function c(f){f.visitSubtree(b)}function d(f){var g=new THREE.Vector3(Infinity,Infinity,Infinity),e=new THREE.Matrix4,k=new THREE.Matrix4,h=new THREE.Matrix4,l,r=new THREE.Vector3,q=new WALK.Euler;return function(m){if(g.equals(m))return e;g.copy(m);if(!l){l=new THREE.Vector3;var u=new THREE.Box3;f.visitSubtree(function(n){(n=n.mesh)&&u.union(n.geometry.boundingBox)});u.center(l);h.elements[12]=-l.x;h.elements[13]=-l.y;
h.elements[14]=-l.z}r.copy(m).sub(l).normalize();q.setFromDirection(r);"yaw"===f.faceCamera&&(q.pitch=0);k.makeRotationFromEuler(q);e.identity().setPosition(l).multiply(k).multiply(h);return e}}WALK.NodeConfig=function(f){var g=this;this.name=f.name;this._editable=f.editable||!1;this._setsDisableCollisions=a(f.disableCollisions);this._disableCollisions=f.disableCollisions||!1;this._setsHideInViews=a(f.hideInViews);this.hideInViews=null;f.hideInViews&&(this.hideInViews=f.hideInViews,this.hideInViews.sort());
this._lightmapResolution=(this._setsLightmapResolution=a(f.lightmapResolution))?f.lightmapResolution:null;this._ground=a(f.ground)?f.ground:!1;this._faceCamera=f.faceCamera||null;this._isolateShadows=a(f.isolateShadows)?f.isolateShadows:!1;this.nodes=[];var e={type:"updated",target:this};this._updated=function(){return g.dispatchEvent(e)}};WALK.NodeConfig.prototype.constructor=WALK.NodeConfig;THREE.EventDispatcher.prototype.apply(WALK.NodeConfig.prototype);WALK.NodeConfig.prototype._configUpdated=
function(){this.nodes.forEach(c);this._updated()};WALK.NodeConfig.prototype.addNode=function(f){this.nodes.push(f)};WALK.NodeConfig.prototype.isOnHideInViews=function(f){return-1!==this.hideInViews.indexOf(f)};WALK.NodeConfig.prototype.addToHideInViews=function(f){console.assert(this.setsHideInViews);console.assert(!this.isOnHideInViews(f));this.hideInViews.push(f);this._updated()};WALK.NodeConfig.prototype.removeFromHideInViews=function(f){if(this.hideInViews)for(var g=0;g<this.hideInViews.length;)this.hideInViews[g]===
f?this.hideInViews.splice(g,1):g+=1;this._updated()};WALK.NodeConfig.prototype.serialize=function(){return{name:this.name,disableCollisions:this.setsDisableCollisions?this.disableCollisions:null,hideInViews:this.setsHideInViews?this.hideInViews:null,lightmapResolution:this.setsLightmapResolution?this.lightmapResolution:null,ground:this.ground?!0:null,faceCamera:this.faceCamera,isolateShadows:this.isolateShadows?!0:null}};Object.defineProperty(WALK.NodeConfig.prototype,"setsDisableCollisions",{get:function(){return this._setsDisableCollisions},
set:function(f){this._setsDisableCollisions=f;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"disableCollisions",{get:function(){return this._disableCollisions},set:function(f){console.assert(this._setsDisableCollisions);this._disableCollisions=f;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"editable",{get:function(){return this._editable||null!==this.faceCamera},set:function(f){this._editable=f;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,
"ground",{get:function(){return this._ground},set:function(f){this._ground=f;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"faceCamera",{get:function(){return this._faceCamera},set:function(f){this._faceCamera=f;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsLightmapResolution",{get:function(){return this._setsLightmapResolution},set:function(f){this._setsLightmapResolution=f;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,
"lightmapResolution",{get:function(){return this._lightmapResolution},set:function(f){console.assert(this._setsLightmapResolution);this._lightmapResolution=f;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"isolateShadows",{get:function(){return this._isolateShadows},set:function(f){this._isolateShadows=f;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsHideInViews",{get:function(){return this._setsHideInViews},set:function(f){this._setsHideInViews=
f;null===this.hideInViews&&(this.hideInViews=[]);this._configUpdated()}});WALK.Node=function(f,g,e){this.id=e.id;this.initialLightProbeId=void 0===e.lightProbeId?null:e.lightProbeId;this.parent=f;this.config=g;this.children=[];this.shadowsIsolatedWithin=this.lightmapResolution=this.hideInViews=this.getFaceCameraMatrix=this.faceCamera=this.ground=this.disableCollisions=this._facesCnt=this.mesh=null;this.editable=!1;g.addNode(this);this.configure()};WALK.Node.prototype.constructor=WALK.Node;WALK.Node.prototype.configure=
function(){this.ground=(this.disableCollisions=this.config.setsDisableCollisions?this.config.disableCollisions:this.parent?this.parent.disableCollisions:!1)?!1:this.config.ground;this.config.faceCamera?(this.faceCamera=this.config.faceCamera,this.getFaceCameraMatrix=d(this)):(this.parent?(this.faceCamera=this.parent.faceCamera,this.getFaceCameraMatrix=this.parent.getFaceCameraMatrix):this.getFaceCameraMatrix=this.faceCamera=null,this.mesh&&(this.mesh.matrixWorld=null));this.hideInViews=this.config.setsHideInViews?
this.config.hideInViews:this.parent?this.parent.hideInViews:null;this.lightmapResolution=this.config.setsLightmapResolution?this.config.lightmapResolution:this.parent?this.parent.lightmapResolution:null;this.shadowsIsolatedWithin=this.config.isolateShadows?this.config.name:this.parent&&this.parent.shadowsIsolatedWithin?this.parent.shadowsIsolatedWithin:null;this.editable=this.config.editable;this.parent&&(this.editable=this.editable||this.parent.editable)};WALK.Node.prototype.visitSubtree=function(f){f(this);
var g=this.children;if(g)for(var e=0;e<g.length;e+=1)g[e].visitSubtree(f)};WALK.Node.prototype.facesInSubtree=function(){var f=this;null===f._facesCnt&&(f._facesCnt=0,f.visitSubtree(function(g){g.mesh&&(f._facesCnt+=g.mesh.geometry.vertexCnt/3)}));return f._facesCnt};WALK.Node.prototype.hide=function(){this.visitSubtree(function(f){f.mesh&&(f.mesh.visible=!1)})};WALK.Node.prototype.show=function(){this.visitSubtree(function(f){f.mesh&&(f.mesh.visible=!0)})};WALK.Node.prototype.serialize=function(){var f=
{id:this.id,children:this.children.map(function(e){return e.serialize()})},g=this.mesh;g&&(f.lightProbeId=g.lightProbe?g.lightProbe.id:null,f.mesh=!0);return f};Object.defineProperty(WALK.Node.prototype,"type",{get:function(){return this.config.name}});Object.defineProperty(WALK.Node.prototype,"highlightMix",{set:function(f){this.visitSubtree(function(g){g.mesh&&(g.mesh.highlightMix=f)})}});Object.defineProperty(WALK.Node.prototype,"selected",{set:function(f){this.visitSubtree(function(g){g.mesh&&
(g.mesh.selected=f)})}});Object.defineProperty(WALK.Node.prototype,"selectedSecondary",{set:function(f){this.visitSubtree(function(g){g.mesh&&(g.mesh.selectedSecondary=f)})}})})();(function(){WALK.Mesh=function(a,b,c){this._visible=!0;THREE.Mesh.call(this,b,c);this.node=a;this.useFaces16=!1;this.quantUv0Max=this.quantUv0Range=this.quantVertexMax=this.quantVertexRange=this.transformByteOffset=this.uv1CoordVOffset=this.uv1CoordUOffset=this.uv1CoordVScale=this.uv1CoordUScale=this.lightMapIdx=this.uv1ByteOffset=this.uv0ByteOffset=this.normalByteOffset=this.vertexCnt=this.vertexByteOffset=this.faceCnt=this.faceByteOffset=0;this.lightMap=null;this.autoLightmapResolution=-1;this.lightProbe=
null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.selected=this.highlightMix=null;this.selectedSecondary=!1;this.visibilityId=null;this.cameraDistance=0;this.matrix=this.matrixWorld=null;this.sharedBuffersDebug=0;this._mergedMesh=null};WALK.Mesh.prototype=Object.create(THREE.Mesh.prototype);WALK.Mesh.prototype.constructor=WALK.Mesh;WALK.Mesh.prototype.clone=void 0;WALK.Mesh.prototype.updateMatrixWorld=function(){};WALK.Mesh.prototype.uv0InBuffers=function(){return-1!==this.uv0ByteOffset};
WALK.Mesh.prototype.uv1InBuffers=function(){return-1!==this.uv1ByteOffset};WALK.Mesh.prototype.quantVertexFactor=function(){return this.quantVertexRange/this.quantVertexMax};WALK.Mesh.prototype.quantUv0Disabled=function(){return 0===this.quantUv0Max};WALK.Mesh.prototype.quantUv0Factor=function(){return this.quantUv0Range/this.quantUv0Max};WALK.Mesh.prototype.update=function(a,b){this.node.faceCamera&&(this.matrixWorld=this.node.getFaceCameraMatrix(b))};Object.defineProperty(WALK.Mesh.prototype,"hideInViews",
{get:function(){return this.node.hideInViews},set:function(a){console.assert(!1)}});Object.defineProperty(WALK.Mesh.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this._mergedMesh&&!WALK.EDIT_MODE&&(this._mergedMesh.visible=a))}});Object.defineProperty(WALK.Mesh.prototype,"isAnimated",{get:function(){return null!==this.node.faceCamera}});WALK.MergedMesh=function(a,b){this._visible=!0;THREE.Mesh.call(this,a,b);this.anyLogicalMeshHasUvs=
!1;this.lightProbe=this.lightMap=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.hideInViews=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.center=null;this.cameraDistance=0;this.matrix=this.matrixWorld=null;this.logicalMeshes=[]};WALK.MergedMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.MergedMesh.prototype.constructor=WALK.MergedMesh;WALK.MergedMesh.prototype.clone=void 0;WALK.MergedMesh.prototype.updateMatrixWorld=function(){};WALK.MergedMesh.prototype.addLogicalMesh=
function(a){this.logicalMeshes.push(a);a._mergedMesh=this};Object.defineProperty(WALK.MergedMesh.prototype,"visible",{get:function(){return this._visible},set:function(a){if(a!==this._visible){this._visible=a;for(var b=0;b<this.logicalMeshes.length;b+=1)this.logicalMeshes[b]._visible=a}}});Object.defineProperty(WALK.MergedMesh.prototype,"isAnimated",{get:function(){return!1}})})();(function(){WALK.SkyMesh=function(a,b,c,d){var f=this;THREE.Mesh.call(this,b,c);d&&this.position.fromArray(d);this.autoPosition=!d;this.name=a;var g={type:"updated",target:this};this._updated=function(){return f.dispatchEvent(g)}};WALK.SkyMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.SkyMesh.prototype.constructor=WALK.SkyMesh;WALK.SkyMesh.prototype.clone=void 0;WALK.SkyMesh.prototype.serialize=function(){var a={name:this.name};this.autoPosition||(a.center=this.position.toArray());this.isEquirect?
(a.type="equirect",a.yawRotation=this.yawRotationDeg,a.texture=this.material.map?this.material.map.serialize():null):a.type="procedural";return a};Object.defineProperty(WALK.SkyMesh.prototype,"yawRotationDeg",{get:function(){return THREE.Math.radToDeg(this.rotation.y)},set:function(a){a=THREE.Math.degToRad(a);this.rotation.y=a;this.updateMatrixWorld();this._updated()}});Object.defineProperty(WALK.SkyMesh.prototype,"isEquirect",{get:function(){return this.material instanceof WALK.EquirectSkyMaterial}});
Object.defineProperty(WALK.SkyMesh.prototype,"radius",{get:function(){return this.scale.x},set:function(a){this.scale.set(a,a,a);this.updateMatrixWorld(!0);this._updated()}})})();(function(){var a=1E3,b={internal:!1,position:[0,0,0],rotation:[0,0],hideFromMenu:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME};WALK.View=function(c){var d=this;void 0===c&&(c=b);this.id=void 0!==c.id?c.id:a++;this.name=c.name||"view"+this.id;this.internal=c.internal||!1;c.position&&(this.position=new THREE.Vector3(c.position[0],c.position[1],c.position[2]));this.rotation=new WALK.Euler(WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[0])),WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[1])),
0);this.hideFromMenu=c.hideFromMenu||!1;this.sky=c.sky||WALK.EDITOR_CONTROLLED_SKY_NAME;this.mode=c.mode||"fps";this.distance=c.distance;this.minDistance=c.minDistance;this.maxDistance=c.maxDistance;this.panPrimary=c.panPrimary;this.noPan=c.noPan;this.noRotate=c.noRotate;this.noPitchRotate=c.noPitchRotate;this.minUpAngle=void 0===c.minUpAngle?-Math.PI/2:c.minUpAngle;this.maxUpAngle=void 0===c.maxUpAngle?Math.PI/2:c.maxUpAngle;this.minSideAngle=void 0===c.minSideAngle?-Math.PI:c.minSideAngle;this.maxSideAngle=
void 0===c.maxSideAngle?Math.PI:c.maxSideAngle;c.target&&(this.target=new THREE.Vector3(c.target[0],c.target[1],c.target[2]));this.fov=c.fov;var f={type:"updated",target:this};this._updated=function(){return d.dispatchEvent(f)}};WALK.View.prototype={constructor:WALK.View,isTop:function(){return"orbit"===this.mode&&this.panPrimary&&this.noPitchRotate},isOrbit:function(){return"orbit"===this.mode&&!this.isTop()},usesDefaultSky:function(){return this.sky===WALK.DEFAULT_SKY_NAME},switchSky:function(){this.usesDefaultSky()?
this.sky=WALK.EDITOR_CONTROLLED_SKY_NAME:this.sky=WALK.DEFAULT_SKY_NAME;this._updated()},setName:function(c){this.name=c;this._updated()},setYaw:function(c){this.rotation.yaw=c;this._updated()},setMinUpAngle:function(c){c!==this.minUpAngle&&(this.minUpAngle=c,this._updated())},setMaxUpAngle:function(c){c!==this.maxUpAngle&&(this.maxUpAngle=c,this._updated())},setMinSideAngle:function(c){c!==this.minSideAngle&&(this.minSideAngle=c,this._updated())},setMaxSideAngle:function(c){c!==this.maxSideAngle&&
(this.maxSideAngle=c,this._updated())},setHideFromMenu:function(c){c!==this.hideFromMenu&&(this.hideFromMenu=c,this._updated())},serialize:function(){var c=this,d={id:this.id,name:this.name,mode:this.mode,rotation:this.rotation.toDegTriple().slice(0,2),hideFromMenu:this.hideFromMenu||!1,sky:this.sky};this.position&&(d.position=this.position.toArray());this.target&&(d.target=this.target.toArray());-Infinity!==this.minSideAngle&&(d.minSideAngle=this.minSideAngle);Infinity!==this.maxSideAngle&&(d.maxSideAngle=
this.maxSideAngle);"distance minDistance maxDistance panPrimary noPan noRotate noPitchRotate minUpAngle maxUpAngle fov".split(" ").forEach(function(f){void 0!==c[f]&&(d[f]=c[f])});return d}};THREE.EventDispatcher.prototype.apply(WALK.View.prototype)})();(function(){WALK.Mirror=function(a,b,c){THREE.Object3D.call(this);this.name="mirror_"+this.id;this.scene=a;this.mirrorCamera=b.clone();this.renderTargetParams={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!0};this.texture=null;c=c||{};this.matrixNeedsUpdate=!0;this.clipBias=void 0!==c.clipBias?c.clipBias:0;a=void 0!==c.color?new THREE.Color(c.color):new THREE.Color(8355711);this.textureMatrix=new THREE.Matrix4;this.mirrorWorldPosition=new THREE.Vector3;
this.mirrorRotationMatrix=new THREE.Matrix4;this.mirrorNormal=new THREE.Vector3;this.cameraWorldPosition=new THREE.Vector3;this.cameraRotationMatrix=new THREE.Matrix4;this.mirrorToCamera=new THREE.Vector3;this.cameraFrustum=null;this.material=new WALK.MirrorMaterial(a,this.textureMatrix)};WALK.Mirror.prototype=Object.create(THREE.Object3D.prototype);WALK.Mirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix();this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera;a.renderTemp();
a.material.uniforms.mirrorSampler.value=a.tempTexture;this.render();this.matrixNeedsUpdate=!0;a.material.uniforms.mirrorSampler.value=a.texture;a.camera=b;a.updateTextureMatrix()};WALK.Mirror.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.mirrorRotationMatrix.extractRotation(this.matrixWorld);this.mirrorNormal.set(0,0,1);this.mirrorNormal.applyMatrix4(this.mirrorRotationMatrix)};
WALK.Mirror.prototype.updateCameraPosition=function(a,b){this.cameraWorldPosition.setFromMatrixPosition(a.matrixWorld);this.cameraRotationMatrix.extractRotation(a.matrixWorld);this.matrixNeedsUpdate=!0;this.cameraFrustum=b};WALK.Mirror.prototype.inFrustum=function(){this.mirrorToCamera.subVectors(this.cameraWorldPosition,this.mirrorWorldPosition);return this.mirrorToCamera.angleTo(this.mirrorNormal)<Math.PI/2&&this.cameraFrustum.intersectsBox(this.parent.geometry.boundingBox)};WALK.Mirror.prototype.updateTextureMatrix=
function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector4,f=new THREE.Plane,g=new THREE.Vector4;return function(){a.copy(this.mirrorWorldPosition).sub(this.cameraWorldPosition).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);c.set(0,0,-1);c.applyMatrix4(this.cameraRotationMatrix);c.add(this.cameraWorldPosition);b.copy(this.mirrorWorldPosition).sub(c).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);this.up.set(0,-1,0);this.up.applyMatrix4(this.cameraRotationMatrix);
this.up.reflect(this.mirrorNormal).negate();this.mirrorCamera.position.copy(a);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(b);this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);f.setFromNormalAndCoplanarPoint(this.mirrorNormal,
this.mirrorWorldPosition);f.applyMatrix4(this.mirrorCamera.matrixWorldInverse);d.set(f.normal.x,f.normal.y,f.normal.z,f.constant);var e=this.mirrorCamera.projectionMatrix;g.x=(Math.sign(d.x)+e.elements[8])/e.elements[0];g.y=(Math.sign(d.y)+e.elements[9])/e.elements[5];g.z=-1;g.w=(1+e.elements[10])/e.elements[14];d.multiplyScalar(2/d.dot(g));e.elements[2]=d.x;e.elements[6]=d.y;e.elements[10]=d.z+1-this.clipBias;e.elements[14]=d.w}}();WALK.Mirror.prototype.configure=function(a,b,c,d){this.mirrorCamera.aspect=
c;this.mirrorCamera.fov=d;this.mirrorCamera.updateProjectionMatrix();null!==this.texture&&this.texture.dispose();this.material.mirrorSampler=this.texture};WALK.Mirror.prototype.render=function(a){this.material.visible&&(this.matrixNeedsUpdate&&(this.updateTextureMatrix(),this.matrixNeedsUpdate=!1),this.material.visible=!1,a.render(this.scene,this.mirrorCamera,this.texture,!0),this.material.visible=!0)};WALK.Mirror.prototype.renderTemp=function(a){this.matrixNeedsUpdate&&this.updateTextureMatrix();
a.render(this.scene,this.mirrorCamera,this.tempTexture,!0)}})();(function(){function a(g,e,k){k=k||"id";for(var h=0;h<g.length;h+=1)if(g[h].hasOwnProperty(k)&&g[h][k]===e)return!1;return!0}function b(g,e,k){k=k||"id";for(var h=0;h<g.length;h+=1)if(g[h][k]===e)return g[h];return null}function c(g,e){g=g.name.toUpperCase();e=e.name.toUpperCase();return g<e?-1:g>e?1:0}function d(g,e,k){for(var h=g[e],l=k>e?1:-1;e!==k;e+=l)g[e]=g[e+l];g[k]=h}var f=0;WALK.Scene=function(g){function e(){q.dispatchEvent(m)}function k(){q.dispatchEvent(u);e()}function h(n){n=n.target;
var w=q._mainAnimatedMaterials.has(n);n.isAnimated&&!w?q._mainAnimatedMaterials.add(n):!n.isAnimated&&w&&q._mainAnimatedMaterials.delete(n);e()}function l(){q._animatedMeshes.length=0;for(var n=$jscomp.makeIterator(q.gpuMeshes),w=n.next();!w.done;w=n.next())w=w.value,w.isAnimated&&q._animatedMeshes.push(w);e()}function r(n){q._nodeLookup[n.id]=n}var q=this,m={type:"updated",target:this},u={type:"anyViewUpdated",target:this};this.id=f++;this._headLight=!1;this.threeScene=new THREE.Scene;this.autoAddLightProbes=
!0;this.autoTour={disabled:!1,startOnLoad:!1};this.canStartAutoTour=function(){return!this.autoTour.disabled&&1<this.visibleViews().length};this.startAutoTourOnLoad=function(){return this.canStartAutoTour()&&this.autoTour.startOnLoad};this.disableProgressiveLoader=!1;this.camera=g;this._colorMap=null;this.materials=[];this._mainAnimatedMaterials=new Set;this._animatedMeshes=[];this._disabledMaterials=[];this._sortedMaterials=null;this.nodeConfigs=[];this._nodeConfigsLookup={};this.nodes=[];this._nodeLookup=
{};this.gpuMeshes=[];this.mirrors=[];this._animatableAuxiliaryObjects=new Set;this.boundingBox=new THREE.Box3;this._sumLogicalMeshCenter=new THREE.Vector3;this._logicalNonemptyMeshCount=0;this._center=new THREE.Vector3;this.skyMeshes=[];this.hideViewsMenu=!1;this.views=[];this.lights=[];this.lightProbes=[];this.cameraVolumes=[];this.serialize=function(){return{disableProgressiveLoader:this.disableProgressiveLoader,autoTour:this.autoTour,camera:this.camera.serialize(),materials:this.materials.map(function(n){return n.serialize()}),
nodeConfigs:this.nodeConfigs.map(function(n){return n.serialize()}),nodes:this.nodes.map(function(n){return n.serialize()}),lights:this.lights.map(function(n){return n.serialize()}),lightProbes:this.lightProbes.map(function(n){return n.serialize()}),cameraVolumes:this.cameraVolumes.map(function(n){return n.serialize()}),autoAddLightProbes:!1,views:this.views.filter(function(n){return!n.internal}).map(function(n){return n.serialize()}),skies:this.skyMeshes.filter(function(n){return n.name!==WALK.DEFAULT_SKY_NAME}).map(function(n){return n.serialize()})}};
this.addMaterial=function(n){this.materials.push(n);n.addEventListener("updated",h);n.isAnimated&&this._mainAnimatedMaterials.add(n);this.camera.colorMapReady()&&void 0!==n.colorMap&&(n.colorMap=this.camera.colorMap);void 0!==n.cameraExposure&&(n.cameraExposure=this.camera.exposure);void 0!==n.cameraGamma&&(n.cameraGamma=this.camera.gamma);void 0!==n.headLight&&(n.headLight=this.headLight)};this.replaceMaterial=function(n,w){var v=this.materials.indexOf(n);void 0===this._disabledMaterials[v]&&(this._disabledMaterials[v]=
new Map);this._disabledMaterials[v].set(n.type,n);var y=this._disabledMaterials[v].get(w);y||(y=WALK.createMaterialOfType(w),y.addEventListener("updated",h),y.name=n.name,0===this.lightProbes.length&&(y.disableLightProbeTmp=!0));this.materials[v]=y;e();for(w=0;w<this.gpuMeshes.length;w+=1)this.gpuMeshes[w].material===n&&(this.gpuMeshes[w].material=y);n.isAnimated&&this._mainAnimatedMaterials.delete(n);y.isAnimated&&this._mainAnimatedMaterials.add(y);this._sortedMaterials=null;y.setUniforms();return y};
this.addNodeConfig=function(n){this.nodeConfigs.push(n);this._nodeConfigsLookup[n.name]=n;n.addEventListener("updated",l)};this.findNodeConfig=function(n){return this._nodeConfigsLookup.hasOwnProperty(n)?this._nodeConfigsLookup[n]:null};this.addNode=function(n){this.nodes.push(n);n.visitSubtree(r)};this.findNode=function(n){return this._nodeLookup[n]};this.visitAllNodes=function(n){for(var w=0;w<this.nodes.length;w+=1)this.nodes[w].visitSubtree(n)};this.visitMeshesWithMaterial=function(n,w){this.visitAllNodes(function(v){(v=
v.mesh)&&v.material===n&&w(v)})};this.sortedMaterials=function(){null===this._sortedMaterials&&(this._sortedMaterials=this.materials.slice(0).sort(c));return this._sortedMaterials};this._updateSceneCenterWithGpuMesh=function(){var n=new THREE.Vector3;return function(w){if(w.logicalMeshes)for(var v=0;v<w.logicalMeshes.length;v+=1){var y=w.logicalMeshes[v].geometry.boundingBox;y.empty()||(y.center(n),this._sumLogicalMeshCenter.add(n),++this._logicalNonemptyMeshCount)}else w=w.geometry.boundingBox,w.empty()||
(w.center(n),this._sumLogicalMeshCenter.add(n),++this._logicalNonemptyMeshCount);this._logicalNonemptyMeshCount&&this._center.copy(this._sumLogicalMeshCenter).divideScalar(this._logicalNonemptyMeshCount)}}();this.addGpuMesh=function(n){n.isAnimated&&this._animatedMeshes.push(n);if(n.material.planarReflector){var w=new WALK.Mirror(this.threeScene,this.camera,{clipBias:0,color:8355711,debugMode:!1});w.material.name=n.material.name;var v=n.geometry;console.assert(v.boundingBox);var y=v.boundingBox,C=
Math.sqrt(Math.pow(y.max.x-y.min.x,2)+Math.pow(y.max.z-y.min.z,2)),A=y.max.y-y.min.y;C&&A?(C=new THREE.Mesh(new THREE.PlaneBufferGeometry(C,A),w.material),C.rotation.y=Math.atan2(v.normals[0],v.normals[2]),y.center(C.position),C.geometry.boundingBox=y,C.add(w),w=C):(WALK.log("mirror with 0 dimension"),w=null);this.mirrors.push(w.children[0]);this.addAuxiliaryObject(w)}else this.addAuxiliaryObject(n);this.gpuMeshes.push(n);this.boundingBox.union(n.geometry.boundingBox);this._updateSceneCenterWithGpuMesh(n)};
this.addAuxiliaryObject=function(n,w){w=void 0===w?!1:w;this.threeScene.add(n);w&&this._animatableAuxiliaryObjects.add(n)};this.removeAuxiliaryObject=function(n){this.threeScene.remove(n);this._animatableAuxiliaryObjects.delete(n)};this.addSkyMesh=function(n){var w=n.material;this.skyMeshes.push(n);this.camera.colorMapReady()&&(w.colorMap=this.camera.colorMap);void 0!==w.cameraExposure&&(w.cameraExposure=this.camera.exposure);void 0!==w.cameraGamma&&(w.cameraGamma=this.camera.gamma);n.addEventListener("updated",
e);this.dispatchEvent({type:"skyMeshAdded",skyMesh:n,target:this})};this.removeSkyMesh=function(n){WALK.removeFromArray(n,this.skyMeshes);this.dispatchEvent({type:"skyMeshRemoved",skyMesh:n,target:this});n.geometry.dispose();n.material.map&&n.material.map.dispose();n.material.dispose()};this.findSkyMesh=function(n){return b(this.skyMeshes,n,"name")};this.addLight=function(n){console.assert(a(this.lights,n.name,"name"));this.lights.push(n);n.addEventListener("updated",e);n.addEventListener("instanceAdded",
e);n.addEventListener("instanceRemoved",e);e();this.dispatchEvent({type:"lightAdded",light:n,target:this})};this.removeLight=function(n){WALK.removeFromArray(n,this.lights);e();this.dispatchEvent({type:"lightRemoved",light:n,target:this})};this.addLightProbe=function(n){console.assert(a(this.lightProbes,n.id));this.lightProbes.push(n);n.addEventListener("positionUpdated",e);n.addEventListener("boundsUpdated",e);e();this.dispatchEvent({type:"lightProbeAdded",lightProbe:n,target:this})};this.removeLightProbe=
function(n){WALK.removeFromArray(n,this.lightProbes);for(var w=0;w<this.gpuMeshes.length;w+=1)this.gpuMeshes[w].lightProbe===n&&(this.gpuMeshes[w].lightProbe=null);e();this.dispatchEvent({type:"lightProbeRemoved",lightProbe:n,target:this});n.dispose()};this.findLightProbe=function(n){return b(this.lightProbes,n)};this.closestLightProbe=function(n){for(var w=null,v=Infinity,y=$jscomp.makeIterator(this.lightProbes),C=y.next();!C.done;C=y.next()){C=C.value;var A=n.distanceTo(C.position);A<v&&(v=A,w=
C)}return w};this.addCameraVolume=function(n){console.assert(a(this.cameraVolumes,n.id));this.cameraVolumes.push(n);n.addEventListener("updated",e);e();this.dispatchEvent({type:"cameraVolumeAdded",cameraVolume:n,target:this})};this.removeCameraVolume=function(n){WALK.removeFromArray(n,this.cameraVolumes);e();this.dispatchEvent({type:"cameraVolumeRemoved",cameraVolume:n,target:this});n.dispose()};this.findCameraVolume=function(n){return b(this.cameraVolumes,n)};this.shiftCameraVolume=function(n,w){d(this.cameraVolumes,
this.cameraVolumes.indexOf(n),w);this.dispatchEvent({type:"cameraVolumeShifted",cameraVolume:n,target:this})};this.findView=function(n){return b(this.views,n)};this.findViewByName=function(n){return b(this.views,n,"name")};this.visibleViews=function(){return WALK.filter(this.views,function(n){return!n.hideFromMenu})};this.addView=function(n){console.assert(a(this.views,n.id));this.views.push(n);n.addEventListener("updated",k);e();this.dispatchEvent({type:"viewAdded",view:n,target:this})};this.removeView=
function(n){WALK.removeFromArray(n,this.views);this.nodeConfigs.forEach(function(w){w.removeFromHideInViews(n.id)});e();this.dispatchEvent({type:"viewRemoved",view:n,target:this})};this.shiftView=function(n,w){d(this.views,this.views.indexOf(n),w);this.dispatchEvent({type:"viewShifted",view:n,target:this})};this.hasLightMap=function(){return void 0!==WALK.find(this.materials,function(n){return n.lightMapped})};this.adjustSkiesAndCameraFarToSpanWholeScene=function(){for(var n=0,w=0;w<this.skyMeshes.length;w+=
1){var v=this.skyMeshes[w];v.autoPosition&&v.position.copy(this.center);if(this.boundingBox.empty())var y=0;else{var C=this.boundingBox,A=v.position;y=Math.max(Math.abs(C.min.x-A.x),Math.abs(C.max.x-A.x));var I=Math.max(Math.abs(C.min.y-A.y),Math.abs(C.max.y-A.y));C=Math.max(Math.abs(C.min.z-A.z),Math.abs(C.max.z-A.z));y=Math.sqrt(y*y+I*I+C*C)}y+=WALK.SKY_DISTANCE_TO_SCENE;v.radius=y;n=Math.max(n,y)}this.camera.setFar(Math.max(this.camera.far,2*n));WALK.log("Camera far set to "+this.camera.far)};
g.addEventListener("colorMapUpdated",function(){var n=g.colorMap;q.materials.forEach(function(w){void 0!==w.colorMap&&(w.colorMap=n);w.setUniforms()});q.skyMeshes.forEach(function(w){w.material.colorMap=n});e()});g.addEventListener("updated",e);this.disableLightProbesForMaterials=function(){for(var n=0;n<this.materials.length;n+=1)this.materials[n].disableLightProbeTmp=!0,this.materials[n].setUniforms()};this.enableLightProbesForMaterials=function(){for(var n=0;n<this.materials.length;n+=1)this.materials[n].disableLightProbeTmp=
!1,this.materials[n].setUniforms()};this.getAnimatedMaterials=function(){var n=!1,w=new Map;return function(){function v(D){D instanceof THREE.Mesh&&D.material.isAnimated&&w.set(D.material,y)}for(var y=!n,C=$jscomp.makeIterator(q._mainAnimatedMaterials),A=C.next();!A.done;A=C.next())w.set(A.value,y);C=$jscomp.makeIterator(q._animatableAuxiliaryObjects);for(A=C.next();!A.done;A=C.next())A.value.traverse(v);C=$jscomp.makeIterator(w);for(A=C.next();!A.done;A=C.next()){A=$jscomp.makeIterator(A.value);
var I=A.next().value;A.next().value===n&&w.delete(I)}n=y;return w.keys()}}();this.getAnimatedMeshes=function(){return this._animatedMeshes};g.addEventListener("exposureUpdated",function(n){var w=g.exposure;q.materials.forEach(function(v){void 0!==v.cameraExposure&&(v.cameraExposure=w)});q.skyMeshes.forEach(function(v){v=v.material;void 0!==v.cameraExposure&&(v.cameraExposure=w)})});g.addEventListener("gammaUpdated",function(n){var w=g.gamma;q.materials.forEach(function(v){void 0!==v.cameraGamma&&
(v.cameraGamma=w)});q.skyMeshes.forEach(function(v){v=v.material;void 0!==v.cameraGamma&&(v.cameraGamma=w)})})};WALK.Scene.prototype={constructor:WALK.Scene,get center(){return this._center},get headLight(){return this._headLight},set headLight(g){g!==this._headLight&&(this._headLight=g,this.materials.forEach(function(e){e.headLight=g;e.setUniforms()}))}};THREE.EventDispatcher.prototype.apply(WALK.Scene.prototype);WALK.createMaterialOfType=function(g){return"water"===g?new WALK.StandardMaterialWater:
new WALK.StandardMaterial}})();(function(){WALK.BufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this._length=a.length;this.releaseOnLoadedToGpu=!0;this.divisor=c||0;this.glType=this.buffer=null};WALK.BufferAttribute.prototype={constructor:WALK.BufferAttribute,get length(){return this._length}}})();(function(){function a(b,c,d,f,g){d=new WALK.BufferAttribute(d,f,g||0);b.addAttribute(c,d)}THREE.BufferGeometry.prototype.addTriangleOrderAttribute=function(){if(void 0===this.getAttribute("order")){for(var b=this.getAttribute("position").length/3,c=new Float32Array(b),d=0;d<b;d+=1)c[d]=d%3;this.addAttribute("order",new WALK.BufferAttribute(c,1))}};THREE.BufferGeometry.prototype.convertNormalsToSpherical=function(){console.assert(void 0===this.getAttribute("sphericalNormal"));var b=this.getAttribute("normal");
console.assert(!b.buffer);b=b.array;for(var c=b.length/3,d=WALK.DETECTOR.ios?new Int16Array(2*c):new Int8Array(2*c),f=0;f<c;f+=1){var g=3*f,e=2*f,k=Math.atan2(b[g+1],b[g])/Math.PI;d[e]=WALK.Math.toSnorm8(2*(Math.acos(b[g+2])/Math.PI-.5));d[e+1]=WALK.Math.toSnorm8(k)}delete this.attributes.normal;this.addAttribute("sphericalNormal",new WALK.BufferAttribute(d,2))};THREE.BufferGeometry.prototype.changePosition=function(b){var c=this.getAttribute("position"),d=c.length/3;c=c.array;for(var f=0;f<3*d;f+=
3)c[f]+=b.x,c[f+1]+=b.y,c[f+2]+=b.z};THREE.BufferGeometry.prototype.clone=function(){console.error("WALK.BufferGeometry cloning not supported")};WALK.Geometry=function(){THREE.BufferGeometry.call(this);this.isInstanced=!1;this.instanceCount=0;this.index=null;this.indexUint=!0;this.uvs1=this.uvs0=this.normals=this.vertices=null;this.vertexOffset=this.vertexCnt=this.indexOffset=this.indexCnt=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this.gpuSize=0};WALK.Geometry.prototype=
Object.create(THREE.BufferGeometry.prototype);WALK.Geometry.prototype.constructor=WALK.Geometry;WALK.Geometry.prototype.allocateCoreBuffers=function(b){console.assert(!this.vertices);b&&(65536>=this.vertexCnt?(this.indexUint=!1,this.index=new Uint16Array(this.indexCnt),this.gpuSize+=2*this.indexCnt):(this.indexUint=!0,this.index=new Uint32Array(this.indexCnt),this.gpuSize+=4*this.indexCnt));this.vertices=new Float32Array(3*this.vertexCnt);this.gpuSize+=12*this.vertexCnt;this.normals=WALK.DETECTOR.ios?
new Int16Array(2*this.vertexCnt):new Int8Array(2*this.vertexCnt);this.gpuSize+=2*this.vertexCnt};WALK.Geometry.prototype.addCoreAttributes=function(){this.index&&(a(this,"index",this.index,1),this.index=null);a(this,"position",this.vertices,3);this.vertices=null;a(this,"sphericalNormal",this.normals,2);this.normals=null};WALK.Geometry.prototype.allocateUv0=function(){console.assert(!this.uvs0);this.uvs0=new Float32Array(2*this.vertexCnt);this.gpuSize+=8*this.vertexCnt};WALK.Geometry.prototype.addUv0Attribute=
function(){a(this,"uv",this.uvs0,2);this.uvs0=null};WALK.Geometry.prototype.allocateUv1=function(){console.assert(!this.uvs1);this.uvs1=new Uint16Array(2*this.vertexCnt);this.gpuSize+=4*this.vertexCnt};WALK.Geometry.prototype.addUv1Attribute=function(){a(this,"uv2",this.uvs1,2);this.uvs1=null};WALK.Geometry.prototype.computeBoundingBox=void 0;WALK.Geometry.prototype.computeBoundingSphere=void 0;WALK.InstancedGeometry=function(b,c){THREE.BufferGeometry.call(this);this.parent=b;this.ownsGpuBuffers=
c;this.isInstanced=!0;this.instanceCount=0;this.transforms2=this.transforms1=this.transforms0=this.uvs1Mod=null;this.vertexOffset=this.indexOffset=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this._gpuSize=0};WALK.InstancedGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.InstancedGeometry.prototype.constructor=WALK.InstancedGeometry;WALK.InstancedGeometry.prototype.allocateCoreBuffers=function(b){console.assert(!this.transforms0);this.parent.vertices||
this.parent.allocateCoreBuffers(b);b=4*this.instanceCount;this.transforms0=new Float32Array(b);this.transforms1=new Float32Array(b);this.transforms2=new Float32Array(b);this._gpuSize+=12*b};WALK.InstancedGeometry.prototype.addCoreAttributes=function(){this.parent.attributes.position||this.parent.addCoreAttributes();for(var b=$jscomp.makeIterator(Object.keys(this.parent.attributes)),c=b.next();!c.done;c=b.next())c=c.value,this.addAttribute(c,this.parent.attributes[c]);a(this,"t0",this.transforms0,
4,1);a(this,"t1",this.transforms1,4,1);a(this,"t2",this.transforms2,4,1);this.transforms2=this.transforms1=this.transforms0=null};WALK.InstancedGeometry.prototype.allocateUv0=function(){this.parent.uvs0||this.parent.allocateUv0()};WALK.InstancedGeometry.prototype.addUv0Attribute=function(){this.parent.attributes.uv||this.parent.addUv0Attribute();this.addAttribute("uv",this.parent.attributes.uv)};WALK.InstancedGeometry.prototype.allocateUv1=function(){console.assert(!this.uvs1Mod);this.parent.uvs1||
this.parent.allocateUv1();this.uvs1Mod=new Float32Array(4*this.instanceCount);this._gpuSize+=16*this.instanceCount};WALK.InstancedGeometry.prototype.addUv1Attribute=function(){this.parent.attributes.uv2||this.parent.addUv1Attribute();this.addAttribute("uv2",this.parent.attributes.uv2);a(this,"uv2Mod",this.uvs1Mod,4,1);this.uvs1Mod=null};WALK.InstancedGeometry.prototype.computeBoundingBox=void 0;WALK.InstancedGeometry.prototype.computeBoundingSphere=void 0;Object.defineProperty(WALK.InstancedGeometry.prototype,
"index",{get:function(){return this.parent.index}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertices",{get:function(){return this.parent.vertices}});Object.defineProperty(WALK.InstancedGeometry.prototype,"normals",{get:function(){return this.parent.normals}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs0",{get:function(){return this.parent.uvs0}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs1",{get:function(){return this.parent.uvs1}});Object.defineProperty(WALK.InstancedGeometry.prototype,
"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertexCnt",{get:function(){return this.parent.vertexCnt},set:function(b){this.parent.vertexCnt=b}});Object.defineProperty(WALK.InstancedGeometry.prototype,"indexCnt",{get:function(){return this.parent.indexCnt},set:function(b){this.parent.indexCnt=b}});Object.defineProperty(WALK.InstancedGeometry.prototype,"gpuSize",{get:function(){return this.ownsGpuBuffers?this._gpuSize+this.parent.gpuSize:
this._gpuSize}});WALK.SubGeometry=function(b,c,d,f,g,e,k){THREE.BufferGeometry.call(this);this.indexCnt=b;this.vertexCnt=c;this.parent=d;this.vertexOffset=g;this.indexOffset=f;this.boundingBox=e;this.boundingSphere=k;this.isInstanced=d.isInstanced;this.instanceId=0;this.instanceCount=1};WALK.SubGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.SubGeometry.prototype.constructor=WALK.SubGeometry;Object.defineProperty(WALK.SubGeometry.prototype,"attributes",{get:function(){return this.parent.attributes}});
Object.defineProperty(WALK.SubGeometry.prototype,"attributesKeys",{get:function(){return this.parent.attributesKeys}});Object.defineProperty(WALK.SubGeometry.prototype,"indexUint",{get:function(){return this.parent.indexUint}});WALK.SubGeometry.prototype.computeBoundingBox=void 0;WALK.SubGeometry.prototype.computeBoundingSphere=void 0;WALK.SubGeometry.prototype.addTriangleOrderAttribute=function(){this.parent.addTriangleOrderAttribute()}})();(function(){function a(g){g.dispatchEvent({type:"updated",target:g})}var b=null,c=null,d=new THREE.Vector3,f=new THREE.Quaternion;WALK.CameraVolume=function(g){this.id=g.id;this.name=g.name;this._type=g.type;console.assert(0<=WALK.CameraVolume.CameraVolumeTypes.indexOf(this._type));this.position=(new THREE.Vector3).fromArray(g.position);this.rotation=(new WALK.Euler).setFromDegTriple(g.rotation);this.scale=(new THREE.Vector3).fromArray(g.scale);this.exposure=g.exposure;this.gamma=g.gamma;this._inverse=
new THREE.Matrix4;this._inverseDirty=!0};WALK.CameraVolume.CameraVolumeTypes=["cube","sphere"];WALK.CameraVolume.prototype={constructor:WALK.CameraVolume,getVolumeGeometry:function(){b||(b=new THREE.BoxBufferGeometry(2,2,2),b.addTriangleOrderAttribute(),b.convertNormalsToSpherical(),c=new THREE.IcosahedronBufferGeometry(1,2),c.addTriangleOrderAttribute(),c.convertNormalsToSpherical());return"sphere"===this._type?c:b},setName:function(g){this.name=g;a(this)},setPosition:function(g,e,k){this.position.set(g,
e,k);this._inverseDirty=!0;a(this)},setRotation:function(g,e,k){this.rotation.yaw=WALK.normalizeRotation(g);this.rotation.pitch=WALK.normalizeRotation(e);this.rotation.roll=WALK.normalizeRotation(k);this._inverseDirty=!0;a(this)},setRotationDeg:function(g,e,k){g=THREE.Math.degToRad(g);e=THREE.Math.degToRad(e);k=THREE.Math.degToRad(k);this.setRotation(g,e,k)},setScale:function(g,e,k){this.scale.set(g,e,k);this._inverseDirty=!0;a(this)},setExposure:function(g){this.exposure=g;a(this)},setGamma:function(g){this.gamma=
g;a(this)},worldCoordinatesInside:function(g){this._inverseDirty&&(this._inverseDirty=!1,this._inverse.compose(this.position,f.setFromEuler(this.rotation),this.scale),this._inverse.getInverse(this._inverse));d.copy(g).applyMatrix4(this._inverse);return"sphere"===this._type?1>=d.lengthSq():1>=Math.abs(d.x)&&1>=Math.abs(d.y)&&1>=Math.abs(d.z)},serialize:function(){return{id:this.id,name:this.name,type:this._type,position:this.position.toArray(),rotation:this.rotation.toDegTriple(),scale:this.scale.toArray(),
exposure:this.exposure,gamma:this.gamma}},dispose:function(){}};THREE.EventDispatcher.prototype.apply(WALK.CameraVolume.prototype)})();(function(){var a=512-2*Math.floor(512*(.5-.5*Math.sin(70/180*Math.PI/2))),b=null,c,d,f=null,g,e=new THREE.Color,k=new Map;WALK.Anchor=function(h,l){b&&f===h.id||(b=new THREE.SphereBufferGeometry(1,32,16),b.convertNormalsToSpherical(),c=new THREE.PlaneBufferGeometry(1,1),c.convertNormalsToSpherical(),d=new THREE.CylinderBufferGeometry(.5,.5,1,16,1),g||(g=new THREE.Matrix4,g.makeRotationX(Math.PI/2)),d.applyMatrix(g),d.convertNormalsToSpherical(),f=h.id);var r=new THREE.Vector3;r.fromArray(l.position);
var q=$jscomp,m=q.makeIterator;var u=l.icon&&WALK.ICONS[l.icon],n=u?u.value:l.text,w=u?u.fontFamily:"Noto Sans";var v=l.color||"#4c9ed9";var y=l.opacity;void 0===y||1<=y||(e.setStyle(v),v="rgba("+(255*e.r|0)+","+(255*e.g|0)+","+(255*e.b|0)+","+y+")");var C=v;y=l.textColor||"#ffffff";v=void 0!==l.opacity&&1>l.opacity;var A="sphere"===l.type,I=A||void 0===l.textMargin?20:l.textMargin;u=[u||"",n,w,C,A,I,l.borderRadius||0,v].join("_");var D=k.get(u);if(D)D.usedTimes++,v=[u,D.texture];else{D=document.getElementById("anchor-canvas");
D||(D=document.createElement("canvas"),D.id="anchor-canvas");if(A)I=D,A=n,I.width=512,I.height=512,I=I.getContext("2d"),I.font="700 128px "+w,A=I.measureText(A).width,A=Math.floor(a/A*128),A=Math.min(A,a),I.font="700 "+A+"px "+w,w=I;else{A=$jscomp;var E=A.makeIterator,O=D,S=WALK.SPRITE_ANCHOR_FONT_SIZE,W=O.getContext("2d");W.font="700 "+S+"px "+w;for(var U=n,va=n.length-1,ta;;){ta=W.measureText(U).width;ta+=2*I;if(1024>=ta)break;U=n.substring(0,va)+"...";--va}O.width=ta;O.height=1.5*S;W=O.getContext("2d");
W.font="700 "+S+"px "+w;n=E.call(A,[W,U]);w=n.next().value;n=n.next().value}w.fillStyle=C;l.borderRadius?(C=w,I=D.width,A=D.height,E=.5*l.borderRadius*Math.min(I,A),C.beginPath(),C.moveTo(0+E,0),C.lineTo(0+I-E,0),C.quadraticCurveTo(0+I,0,0+I,0+E),C.lineTo(0+I,0+A-E),C.quadraticCurveTo(0+I,0+A,0+I-E,0+A),C.lineTo(0+E,0+A),C.quadraticCurveTo(0,0+A,0,0+A-E),C.lineTo(0,0+E),C.quadraticCurveTo(0,0,0+E,0),C.closePath(),C.fill()):w.fillRect(0,0,D.width,D.height);w.fillStyle=y;w.textAlign="center";w.textBaseline=
"middle";w.shadowColor="black";w.shadowBlur=16;w.fillText(n,D.width/2,D.height/2);y=new WALK.Texture(D);y.width=D.width;y.height=D.height;y.hasAlpha=v;y.minFilter=GLC.LINEAR;y.loaded=!0;y.needsUpdate=!0;k.set(u,{usedTimes:1,texture:y});v=[u,y]}q=m.call(q,v);m=q.next().value;q=q.next().value;this._textureSignature=m;if("sphere"===l.type)m=b,v=new WALK.AnchorMaterial,y=h.closestLightProbe(r),v.bumpTexture=q,v.disableLightProbe=null===y||!y.texturesReady(),v.headLight=!0,h=[l.radius,l.radius,l.radius];
else{m=c;v=new WALK.AnchorSpriteMaterial;y=null;v.disableLightProbe=!0;v.headLight=!1;v.specularOff=1;h=[q.width/q.height*l.height,l.height,1];var qa=new THREE.Mesh(d,null)}v.baseColorTexture=q;v.configureTransparency();v.setUniforms();THREE.Mesh.call(this,m,v);this.position.copy(r);this.scale.fromArray(h);this.updateMatrixWorld(!0);this.lightProbe=y;qa?(qa.position.copy(r),r=Math.max(h[0],h[1]),qa.scale.fromArray([r,r,l.height]),qa.updateMatrixWorld(!0),this.colliderMesh=qa):this.colliderMesh=this;
this.colliderMesh.visibilityId=null;this.colliderMesh.anchor=this;this.extension=null};WALK.Anchor.prototype=Object.create(THREE.Mesh.prototype);WALK.Anchor.prototype.dispose=function(){var h=this.material;h.dispose();var l=this._textureSignature,r=k.get(l),q=r.texture;console.assert(h.baseColorTexture===q);r.usedTimes--;0===r.usedTimes&&(q.dispose(),k.delete(l))};WALK.Anchor.prototype.enableLightProbe=function(){if(this.lightProbe){console.assert(this.lightProbe.texturesReady());var h=this.material;
h.disableLightProbe=!1;h.setUniforms()}}})();(function(){function a(d){return(d.boundingBox.max.z-d.boundingBox.min.z)/2}var b=null,c={sphere:null,head:null,torso:null,display:null};WALK.setAvatarGeometries=function(d){for(var f=$jscomp.makeIterator(["head","torso","display"]),g=f.next();!g.done;g=f.next())g=g.value,d.has(g)||console.assert(!1,'Avatar "'+g+'" geometry is missing'),c[g]=d.get(g)};WALK.Avatar=function(d,f,g){THREE.Object3D.call(this);this.uuid=f;this.displayName=g.displayName;this._scene=d;this._lastLightProbeCheckPosition=new THREE.Vector3(0,
0,0);c.plane&&b===d.id||(c.sphere=new THREE.SphereBufferGeometry(.08,32,16),c.sphere.convertNormalsToSpherical(),b=d.id);f=new WALK.StandardMaterial;f.baseColor.setStyle(g.color).convertGammaToLinear();this._haveLightProbe=0<d.lightProbes.length;f.roughness=.7;f.metallic=1;this._haveLightProbe||(f.disableLightProbe=!0,f.headLight=!0);f.setUniforms();this._body=new THREE.Object3D;this._head=new THREE.Mesh(c.head,f);this._torso=new THREE.Mesh(c.torso,f);this._torso.position.z=-(c.torso.boundingBox.max.z+
a(c.head)+.05);var e=new WALK.StandardMaterial;e.headLight=!1;e.baseColor.setRGB(0,0,0);e.roughness=.001;e.metallic=0;this._haveLightProbe||(e.disableLightProbe=!0);e.setUniforms();this._display=new THREE.Mesh(c.display,e);this._head.rotation.order="ZXY";this._displayNameAnchor=new WALK.Anchor(d,{type:"sprite",position:[0,0,.1+a(c.head)],height:.1,text:g.displayName,textColor:g.color,opacity:0});this._pointer=new THREE.Mesh(c.sphere,f);this._pointer.scale.set(.4,.4,.4);this._pointer.visible=!1;this._body.add(this._torso);
this._head.add(this._display);this._body.add(this._head);this.add(this._body);this.add(this._displayNameAnchor);this.add(this._pointer);g.position&&this.position.fromArray(g.position);this.updateMatrixWorld(!0);this._setClosestLightProbe();this._videoTexture1=this._videoTexture0=null};WALK.Avatar.prototype=Object.create(THREE.Object3D.prototype);WALK.Avatar.prototype.constructor=WALK.Avatar;WALK.Avatar.prototype.hideBody=function(){this._head.visible=!1;this._torso.visible=!1;this._displayNameAnchor.visible=
!1};WALK.Avatar.prototype._updated=function(){this.dispatchEvent({type:"avatarUpdated",target:this})};WALK.Avatar.prototype.rotate=function(d,f){this._body.rotation.z=d;this._head.rotation.x=f};WALK.Avatar.prototype.setVideoTexture0=function(d){this._videoTexture0&&(this._videoTexture0.dispose(),this._videoTexture0=null,this._updated());this._display.material.disableLightProbe=null!==d;this._display.material.baseColorTexture=d;this._updated()};WALK.Avatar.prototype.getVideoTexture0=function(){return this._videoTexture0};
WALK.Avatar.prototype.setVideoTexture1=function(d){var f=this;this._videoTexture1&&(this._videoTexture1.dispose(),this._videoTexture1=null,this._updated());d&&d.addLoadedListener(function(){f._videoTexture1=d;f._updated()})};WALK.Avatar.prototype.getVideoTexture1=function(){return this._videoTexture1};WALK.Avatar.prototype.getMainMaterial=function(){return this._head.material};WALK.Avatar.prototype._setClosestLightProbe=function(){var d=this._scene.closestLightProbe(this.position);d!==this._head.lightProbe&&
(this._head.lightProbe=d,this._torso.lightProbe=d,this._display.lightProbe=d,this._pointer.lightProbe=d)};WALK.Avatar.prototype.setPositionFromArray=function(d){this.position.fromArray(d);.5<this._lastLightProbeCheckPosition.distanceTo(this.position)&&(this._lastLightProbeCheckPosition.copy(this.position),this._setClosestLightProbe(this.position))};WALK.Avatar.prototype.placePointer=function(d,f,g){this._pointer.position.set(d-this.position.x,f-this.position.y,g-this.position.z);this._pointer.visible=
!0};WALK.Avatar.prototype.hidePointer=function(){this._pointer.visible=!1};WALK.Avatar.prototype.dispose=function(){this._head.material.dispose();this._display.material.dispose();this._videoTexture0&&this._videoTexture0.dispose();this._videoTexture1&&this._videoTexture1.dispose();this._displayNameAnchor.dispose();this.dispatchEvent({type:"dispose"})}})();(function(){function a(h,l,r,q,m){r=new THREE.SphereBufferGeometry(r,32,16);r.changePosition(q);r.computeBoundingSphere();r.convertNormalsToSpherical();q=new WALK.Mesh(null,r,l);l.lightMapped&&(q.lightMap=m);h.camera.getWorldPosition(g);q.lightProbe=h.closestLightProbe(g);q.frustumCulled=!1;q.userData.hideFromLightProbes=!0;return q}function b(h){c.setRGB(h,h,h);h=WALK.ColorUtils.hdrEncode(c,d);var l=new Uint8Array(4);l[0]=Math.round(255*d.r);l[1]=Math.round(255*d.g);l[2]=Math.round(255*d.b);l[3]=
Math.round(255*h);h=new WALK.DataTexture(l,1,1);h.magFilter=GLC.NEAREST;h.minFilter=GLC.NEAREST;h.anisotropy=WALK.NO_ANISOTROPY;h.hasAlpha=!0;h.isRgbm=!0;h.loaded=!0;h.needsUpdate=!0;return h}var c,d,f,g,e=new THREE.Matrix4,k=new THREE.Vector2;WALK.MaterialPicker=function(h,l,r,q,m,u,n){function w(va){y.forEach(function(ta){return ta(va)})}var v=this;this.lightMap=null;this.meshes=[];var y=[];c||(c=new THREE.Color,d=new THREE.Color,g=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3);var C=
q.camera.aspect,A=.1*Math.tan(THREE.Math.degToRad(q.camera.fov/2)),I=-A;C=Math.abs(C*A-C*I);A=Math.abs(A-I);var D=.01*C,E=(C-h.length*D-D)/(2*h.length);E=Math.min(E,.05*C);var O=h.length/2*-(2*E+D)+E+D;I=(window.innerHeight-$("menu-bar").getBoundingClientRect().top)/window.innerHeight;var S=-A/2+A*I+E+D;h.some(function(va){return va.lightMapped})&&(u=u.measureIncidentLuma(),0>u&&(u=1),this.lightMap=b(u));h.forEach(function(va,ta){if(va){f.set(O,S,-.1);var qa=a(q,va,E,f,v.lightMap);O+=2*E+D;var ha=
new THREE.Matrix4;ha.multiply(e.makeTranslation(l.x,l.y,l.z));va=m.cameraWorldPosition();k.x=va.x-l.x;k.y=va.y-l.y;ha.multiply(e.makeRotationZ(Math.abs(k.y)>Math.abs(k.x)?0<k.x?0:-Math.PI:0<k.y?Math.PI/2:-Math.PI/2));ha.multiply(e.makeRotationX(-Math.PI/2));ha.multiply(e.makeScale(r,r,r));ha.multiply(e.makeTranslation(2.1*(ta+1),0,0));ha.multiply(e.makeScale(1/E,1/E,1/E));ha.multiply(e.makeTranslation(-f.x,-f.y,-f.z));v.meshes.push(qa);y.push(function(F){F?(qa.matrix=ha,qa.matrixWorld=ha):(qa.matrix=
q.camera.matrix,qa.matrixWorld=q.camera.matrixWorld)})}});var W=function(){return w(!0)},U=function(){return w(!1)};n.addEventListener("modeEnabled",W);n.addEventListener("modeDisabled",U);this.dispose=function(){y.length=0;n.removeEventListener("modeEnabled",W);n.removeEventListener("modeDisabled",U);this.meshes.forEach(function(va){return va.geometry.dispose()});this.meshes=null;this.lightMap&&(this.lightMap.dispose(),this.lightMap=null)};w(n.modeIsEnabled())}})();(function(){function a(){var b=new Set,c=[];this.add=function(d){d instanceof RegExp?c.push(d):b.add(d)};this.matchesAny=function(d){return b.has(d)?!0:c.some(function(f){return f.test(d)})}}WALK.MergeConfig=function(){this._editableNodeTypes=new a;this._editableMaterialNames=new a;this._allMaterialsEditable=!1;this.setNodeTypeEditable=function(b){this._editableNodeTypes.add(b)};this.setMaterialEditable=function(b){this._editableMaterialNames.add(b)};this.setAllMaterialsEditable=function(){this._allMaterialsEditable=
!0};this.isMaterialEditable=function(b){return this._allMaterialsEditable||this._editableMaterialNames.matchesAny(b)};this.isNodeTypeEditable=function(b){return this._editableNodeTypes.matchesAny(b)}}})();(function(){function a(){function c(r,q,m){return(0<=r?r-1:r+q/m)*m}var d=this,f=new THREE.Vector3,g=new THREE.Vector3,e=new THREE.Vector3,k=new THREE.Vector3,h=new THREE.Vector3;this.objects=[];var l=null;this.vertices=[];this.normals=[];this.uvs=[];this.startObject=function(r){l={name:r||"",vertices:[],normals:[],uvs:[],hasUvs:!1};this.objects.push(l)};this.addFace=function(r,q,m,u,n,w,v,y,C){var A=this.vertices.length;r=c(r,A,3);q=c(q,A,3);m=c(m,A,3);A=d.vertices;var I=l.vertices;I.push(A[r+0],
A[r+1],A[r+2]);I.push(A[q+0],A[q+1],A[q+2]);I.push(A[m+0],A[m+1],A[m+2]);void 0!==v?(r=this.normals.length,v=c(v,r,3),y=c(y,r,3),C=c(C,r,3),r=d.normals,q=l.normals,q.push(r[v+0],r[v+1],r[v+2]),q.push(r[y+0],r[y+1],r[y+2]),q.push(r[C+0],r[C+1],r[C+2])):(C=d.vertices,y=l.normals,f.fromArray(C,r),g.fromArray(C,q),e.fromArray(C,m),h.subVectors(e,g),k.subVectors(f,g),h.cross(k),h.normalize(),y.push(h.x,h.y,h.z),y.push(h.x,h.y,h.z),y.push(h.x,h.y,h.z));void 0!==u?(C=this.uvs.length,u=c(u,C,2),n=c(n,C,2),
w=c(w,C,2),C=d.uvs,y=l.uvs,y.push(C[u+0],C[u+1]),y.push(C[n+0],C[n+1]),y.push(C[w+0],C[w+1]),l.hasUvs=!0):(w=l.uvs,w.push(0,0),w.push(0,0),w.push(0,0))}}function b(c){if(void 0!==c&&""!==c)return parseInt(c,10)}WALK.loadGeometriesFromObj=function(c,d,f){WALK.ajaxGet(c,!1,function(g){var e=g,k=/^[og]\s*(.+)?/,h=/^mtllib /,l=/^usemtl /,r=/^usemap /;g=new a;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n"));-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));e=e.split("\n");var q;e=$jscomp.makeIterator(e);
for(q=e.next();!q.done;q=e.next()){var m=q.value;if(0!==m.length&&"\x00"!==m){var u=m.charAt(0);if("#"!==u)if("v"===u)switch(q=m.split(/\s+/),q[0]){case "v":g.vertices.push(parseFloat(q[1]),parseFloat(q[2]),parseFloat(q[3]));7<=q.length&&console.assert(!1,"obj with vertex colors is not supported");break;case "vn":g.normals.push(parseFloat(q[1]),parseFloat(q[2]),parseFloat(q[3]));break;case "vt":g.uvs.push(parseFloat(q[1]),parseFloat(q[2]))}else if("f"===u){m=m.substr(1).trim().split(/\s+/);q=[];m=
$jscomp.makeIterator(m);for(u=m.next();!u.done;u=m.next())u=u.value,0<u.length&&(u=u.split("/"),q.push(u));m=q[0];u=1;for(var n=q.length-1;u<n;u++){var w=q[u],v=q[u+1];g.addFace(b(m[0]),b(w[0]),b(v[0]),b(m[1]),b(w[1]),b(v[1]),b(m[2]),b(w[2]),b(v[2]))}}else"l"===u?console.assert(!1,"line geometry is not supported"):"p"===u?console.assert(!1,"obj point geometry not supported"):null!==(q=k.exec(m))?(q=(" "+q[0].substr(1).trim()).substr(1),g.startObject(q)):l.test(m)||h.test(m)||r.test(m)||"s"!==u&&console.warn('OBJLoader: Unexpected line: "'+
m+'"')}}k=new Map;g=$jscomp.makeIterator(g.objects);for(h=g.next();!h.done;h=g.next())h=h.value,0!==h.vertices.length&&(l=new THREE.BufferGeometry,l.addAttribute("position",new WALK.BufferAttribute(new Float32Array(h.vertices),3)),0<h.normals.length&&l.addAttribute("normal",new WALK.BufferAttribute(new Float32Array(h.normals),3)),!0===h.hasUvs&&l.addAttribute("uv",new WALK.BufferAttribute(new Float32Array(h.uvs),2)),l.convertNormalsToSpherical(),l.computeBoundingBox(),l.computeBoundingSphere(),k.set(h.name,
l));return d(k)},f)}})();(function(){WALK.KTXLoader=function(){this._parser=WALK.KTXLoader.parse};WALK.KTXLoader.prototype=Object.create(WALK.CompressedTextureLoader.prototype);WALK.KTXLoader.parse=function(a){var b=[],c=new Int32Array(a,0,16);67305985===c[3]&&console.assert("Big endian machines not supported");console.assert(0===c[4]);console.assert(1===c[5]);console.assert(0===c[6]);if(35842===c[7]){console.assert(6408===c[8]);var d=GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG}else 36196===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_ETC1_WEBGL):
33776===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_S3TC_DXT1_EXT):33779===c[7]?(console.assert(6408===c[8]),d=GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT):console.error("Unknown KTX glInternalFormat: "+c[7]);var f=c[9],g=c[10];console.assert(0===(f&f-1));console.assert(0===(g&g-1));console.assert(0===c[11]);console.assert(0===c[12]);console.assert(1===c[13]);var e=c[14];c=c[15];console.assert(0===c%4);c=64+c;for(var k=new DataView(a,0),h=f,l=g,r=0;r<e;++r){var q=k.getUint32(c,!0);c+=4;var m=new Uint8Array(a,
c,q);b.push({data:m,width:h,height:l});c+=q+(3-(q+3)%4);h=Math.max(h/2,1);l=Math.max(l/2,1)}console.assert(c===a.byteLength);return{format:d,width:f,height:g,mipmapCount:e,mipmaps:b}}})();(function(){function a(f,g,e,k,h){f({wasmBinary:g}).then(function(l){function r(q,m,u){var n=0===Math.log2(m)%1&&0===Math.log2(u)%1;return k.dxtTextures?q?e.BC3:e.BC1:k.pvrtcTextures&&m===u&&n?q?e.PVRTC1_4_RGBA:e.PVRTC1_4_RGB:k.etc1Textures&&!q?e.ETC1:k.astcTextures?e.ASTC_4x4:e.RGBA32}l.initializeBasis();h(function(q){var m=new l.BasisFile(new self.Uint8Array(q));q=function(E){m.close();m.delete();throw E;};var u=m.getHasAlpha(),n=m.getNumImages(),w=m.getNumLevels(0),v=m.getImageWidth(0,0),y=m.getImageHeight(0,
0);0!==v&&0!==y&&0!==n&&0!==w||q("Invalid .basis file");1<n&&q("Missing multiple images handling");n=r(u,v,y);v=n.formatIdx;m.startTranscoding()||q("startTranscoding failed");y=[];for(var C=0;C<w;++C){var A=m.getImageWidth(0,C),I=m.getImageHeight(0,C),D=m.getImageTranscodedSizeInBytes(0,C,v);D=new self.Uint8Array(new self.ArrayBuffer(D));m.transcodeImage(D,0,C,v,0,u)||q(".transcodeImage failed");y.push({data:D,width:A,height:I})}m.close();m.delete();return{gpuFormat:n.gpuFormat,mipmaps:y}})})}function b(f){var g=
new window.SharedArrayBuffer(f.byteLength);(new Uint8Array(g)).set(new Uint8Array(f),0);return g}function c(f,g,e,k){function h(){if(0<u.length)if(0<m.length)m.shift().handleTexItem(u.shift()),h();else if(q<k&&!r){q++;r=!0;var w=new window.Worker(l),v=function(C){throw"Worker error @L"+C.lineno+": "+C.message;};w.addEventListener("error",v);var y=function(){function C(){0<u.length?(m.push(I),h()):(q--,w.terminate())}w.removeEventListener("error",v);w.removeEventListener("message",y);r=!1;var A,I=
{handleTexItem:function(D){A=D;w.postMessage(D.texBuffer,[D.texBuffer])}};w.addEventListener("error",function(D){A.onError("Worker error @L"+D.lineno+": "+D.message)});w.addEventListener("message",function(D){A.callback(D.data);C()});C()};w.addEventListener("message",y);w.postMessage(n)}}f="\nself.importScripts("+JSON.stringify(f)+");\nconst initBasis = "+a.toString()+";\nconst basisFormats = "+JSON.stringify(d)+";\nconst detector = "+JSON.stringify({astcTextures:g.astcTextures,dxtTextures:g.dxtTextures,
etc1Textures:g.etc1Textures,pvrtcTextures:g.pvrtcTextures})+";\n\nfunction initHandler(evt) {\n  self.removeEventListener('message', initHandler);\n\n  const wasmBinary = evt.data;\n  initBasis(BASIS, wasmBinary, basisFormats, detector, decodeTexBuffer => {\n    self.addEventListener('message', function(evt) {\n        const texBuffer = evt.data;\n        const texDatas = decodeTexBuffer(texBuffer);\n        // second argument to transfer ownership to the main thread\n        self.postMessage(texDatas, texDatas.mipmaps.map(t => t.data.buffer));\n    });\n    self.postMessage({}); // communicate end of init\n  });\n}\n\nself.addEventListener('message', initHandler);\n";
var l=window.URL.createObjectURL(new window.Blob([f])),r=!1,q=0,m=[],u=[],n=window.SharedArrayBuffer?b(e):e;return function(w,v,y){u.push({texBuffer:w,onError:v,callback:y});h()}}var d=function(){function f(g,e){return{formatIdx:g,gpuFormat:e}}return{ETC1:f(0,GLC.COMPRESSED_RGB_ETC1_WEBGL),BC1:f(2,GLC.COMPRESSED_RGB_S3TC_DXT1_EXT),BC3:f(3,GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT),PVRTC1_4_RGB:f(8,GLC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG),PVRTC1_4_RGBA:f(9,GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),ASTC_4x4:f(10,GLC.COMPRESSED_RGBA_ASTC_4x4_KHR),
RGBA32:f(13,GLC.RGBA)}}();WALK.createBasisLoader=function(f){if(!window.WebAssembly||!(f.pvrtcTextures||f.etc1Textures||f.dxtTextures||f.astcTextures))return null;var g=function(){var e=!1,k=null,h=[];return function(l){var r=function(){return l(k)};k?r():h.push(r);e||(e=!0,WALK.ajaxGet(WALK.getViewerAssetUrl("lib/basis/basis_transcoder.wasm"),!0,function(q){var m=WALK.getViewerAssetUrl("lib/basis/basis_transcoder.js"),u=f.BASIS_DECODE_WORKERS;if(0>=u){var n=window.document.createElement("script");
n.addEventListener("load",function v(){n.removeEventListener("load",v);a(window.BASIS,q,d,f,function(y){k=function(C,A,I){try{I(y(C))}catch(D){A(D)}};h.forEach(function(C){return C()});h.length=0})});n.src=m;window.document.head.appendChild(n)}else k=c(m,f,q,u),h.forEach(function(w){return w()}),h.length=0},function(q){throw q;}))}}();return{load:function(e,k,h,l){var r=new WALK.CompressedTexture;g(function(q){WALK.queueAjaxGet(e,k,!0,function(m){q(m,l,function(u){r.format=u.gpuFormat;u=u.mipmaps;
r.mipmaps=u;r.width=u[0].width;r.height=u[0].height;r.generateMipmaps=!1;r.minFilter=1===u.length?GLC.LINEAR:GLC.LINEAR_MIPMAP_LINEAR;r.flipY=!1;r.needsUpdate=!0;h(r)})},l)});return r}}}})();(function(){function a(){var f={};this.cacheKey=function(g,e,k,h,l){return g+"@"+e+"@"+k+"@"+h+"@"+l};this.get=function(g){return f[g]};this.insert=function(g,e){f[g]=e}}function b(f,g,e,k,h){function l(q){r.image=q;r.width=q.width;r.height=q.height;k(r)}var r=new WALK.Texture;r.format=e;WALK.queueImageGet(f,g,d?function(q){createImageBitmap(q,{premultiplyAlpha:"none",imageOrientation:r.flipY?"flipY":"none"}).then(l).catch(h)}:l,h);return r}function c(f,g,e,k,h,l){var r=new WALK.VideoTexture;r.format=
e;WALK.queueVideoGet(f,g,function(q){r.video=q;r.width=q.videoWidth;r.height=q.videoHeight;THREE.Math.isPowerOfTwo(r.width)&&THREE.Math.isPowerOfTwo(r.height)||(r.wrapS=GLC.CLAMP_TO_EDGE,r.wrapT=GLC.CLAMP_TO_EDGE);h(r);k&&r.pause()},l);return r}var d=!1;WALK.TextureLoader=function(f,g,e,k,h,l,r){function q(I){var D=I.id,E=I.webFormats;console.assert(E&&0<E.length,"No web format for texture: "+I.id+"."+I.rawExt);if(I.video)return f+"video/"+E[0]+"/"+D+"."+I.stdExt;var O=f+"img/",S=g.ios&&I.rgbm;if(A&&
!S){if(!g.mobile&&-1<E.indexOf("large/basis"))return O+"large/basis/"+D+".basis";if(-1<E.indexOf("small/basis"))return O+"small/basis/"+D+".basis"}if(g.pvrtcTextures&&!S&&-1<E.indexOf("small/pvr"))return O+"small/pvr/"+D+".ktx";if(g.etc1Textures&&-1<E.indexOf("small/etc1"))return O+"small/etc1/"+D+".ktx";if(g.dxtTextures&&-1<E.indexOf("large/dxt"))return O+"large/dxt/"+D+".ktx";S=-1<E.indexOf("small/std");return!(-1<E.indexOf("large/std"))||g.mobile&&S?O+"small/std/"+D+"."+I.stdExt:O+"large/std/"+
D+"."+I.stdExt}function m(I){--v.texturesToLoad;I.needsUpdate=!0;e(I);I.notifyLoaded()}function u(){--v.texturesToLoad;k()}function n(){--v.texturesToLoad;h()}function w(I,D,E,O,S){var W=new WALK.DataTexture;WALK.queueAjaxGet(I,D,!0,function(U){U=new Uint8Array(U,0,U.byteLength);var va=U[1];W.image.width=Math.pow(2,U[0]);W.image.height=Math.pow(2,va);W.format=E;W.type=GLC.UNSIGNED_BYTE;W.image.data=U.subarray(2);O&&O(W);W=null},S);return W}var v=this,y=new a,C=new WALK.KTXLoader,A=!WALK.urlHashContains("nobasis")&&
WALK.createBasisLoader(g);l&&(y.insert=function(){});this.texturesToLoad=0;this.clearCache=function(){y=null};this.load=function(I,D,E,O,S){var W=D.alpha?GLC.RGBA:GLC.RGB,U=q(D),va=/\.basis$/.test(U),ta=/\.ktx$/.test(U),qa=/\.buf$/.test(U),ha=D.video,F=!(ta||qa||ha),J=y.cacheKey(U,E,O,S,W),Z=y.get(J);if(Z)return Z;v.texturesToLoad+=1;qa?Z=w(I,U,W,m,u):va?Z=A.load(I,U,m,u):ta?Z=C.load(I,U,m,u):F?Z=b(I,U,W,m,u):(console.assert(ha),Z=c(WALK.LOAD_PRIORITY.VIDEO,U,W,r,m,n));Z.hasAlpha=!!D.alpha;Z.isRgbm=
!!D.rgbm;E&&(Z.wrapS=GLC.REPEAT,Z.wrapT=GLC.REPEAT);O&&!ha?(Z.minFilter=GLC.LINEAR_MIPMAP_LINEAR,Z.generateMipmaps=!ta):(Z.minFilter=GLC.LINEAR,Z.generateMipmaps=!1);S&&(Z.anisotropy=S);y.insert(J,Z);Z.id=D.id;Z.name=D.name;Z.webFormats=D.webFormats;D.rawExt&&(Z.rawExt=D.rawExt);Z.stdExt=D.stdExt;return Z}}})();(function(){function a(f,g,e){for(var k=0;k<g.length;k+=1){var h=g[k],l=f[h];void 0!==l&&(e["_"+h]=l)}}var b="doubleSided name opacity parallaxCorrection parallaxMode parallaxScale parallaxMinLayers parallaxMaxLayers planarReflector".split(" "),c="bumpScale emissive emissionStrength envMapProject metallic roughness alphaInLowerHalf chromaKeyEnabled".split(" "),d="baseColor bumpScale bumpTexture doubleSided emissive metallic opacity roughness".split(" ");WALK.MaterialLoader=function(f,g,e){var k=WALK.DETECTOR;
this.load=function(h,l){for(var r=new Map,q=0,m=0;m<h.length;m+=1){var u;var n=h[m];var w=WALK.createMaterialOfType(n.type);if("water"===w.type)w.name=n.name,n.normalTexture&&(w.normalTexture=f.load(WALK.LOAD_PRIORITY.SPECULARITY,n.normalTexture,!0,!1,WALK.DEFAULT_ANISOTROPY)),n.baseColor&&w.baseColor.fromArray(n.baseColor),void 0!==n.opacity&&(w.opacity=n.opacity),a(n,["wavesSpeed","wavesScale","refractionFactor"],w),w.setUniforms();else{WALK.copyProperties(n,b,w);a(n,c,w);n.baseColor&&(w.baseColor.fromArray(n.baseColor),
w.baseColor.roundChannels());if(u=n.baseColorTextureCorrection)w._baseColorTextureCorrection=!0,void 0!==u.contrast&&(w._baseColorTextureContrast=u.contrast),w.baseColorTextureHslOffset.h=u.hslOffset[0],w.baseColorTextureHslOffset.s=u.hslOffset[1],w.baseColorTextureHslOffset.l=u.hslOffset[2];if(u=n.baseColorTexture)u=u.atlasId?g[u.atlasId].getAtlasEntry(u.name,u.atlasOffset[0],u.atlasOffset[1],u.atlasScale[0],u.atlasScale[1]):f.load(WALK.LOAD_PRIORITY.DIFFUSE,u,!0,!0,WALK.DEFAULT_ANISOTROPY),u.isCutout=
null,w.baseColorTexture=u;n.roughnessTexture&&(w.roughnessTexture=f.load(WALK.LOAD_PRIORITY.SPECULARITY,n.roughnessTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));n.metallicTexture&&(w.metallicTexture=f.load(WALK.LOAD_PRIORITY.SPECULARITY,n.metallicTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));n.bumpTexture&&k.standardDerivatives&&(w.bumpTexture=f.load(WALK.LOAD_PRIORITY.SPECULARITY,n.bumpTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));n.doNotImport&&WALK.copyProperties(n.doNotImport,d,w.doNotImport);n.chromaKeyColor&&
(w.chromaKeyColor.fromArray(n.chromaKeyColor),w.chromaKeyColor.roundChannels());n.chromaKeyDelta&&w._chromaKeyDelta.fromArray(n.chromaKeyDelta)}n=w;if(!e.isMaterialEditable(n.name)){w=n.hash();u=r.get(w)||[];for(var v=$jscomp.makeIterator(u),y=v.next();!y.done;y=v.next())if(y=y.value,y.canMerge(n)){q+=1;y.merged=!0;n=y;break}n.merged||(u.push(n),r.set(w,u))}l.addMaterial(n);n.merged||n.setUniforms()}WALK.log("Have "+h.length+" materials and "+(h.length-q)+" merged materials.")}}})();(function(){WALK.SkyLoader=function(a){function b(d,f,g){var e=new THREE.SphereBufferGeometry(1,64,64);return new WALK.SkyMesh(d,e,f,g)}function c(d){var f=new WALK.ProceduralSkyMaterial;return b(d.name,f,d.center)}this.loadSkyTexture=function(d,f){d.material.map&&d.material.map.dispose();d.material.map=a.load(WALK.LOAD_PRIORITY.SKY,f,!1,!1,WALK.NO_ANISOTROPY);d.yawRotationDeg=0};this.loadSingleSky=function(d,f){if("procedural"===d.type||void 0===d.type)d=c(d);else if("equirect"===d.type){var g=new WALK.EquirectSkyMaterial;
g.map=a.load(WALK.LOAD_PRIORITY.SKY,d.texture,!1,!1,WALK.NO_ANISOTROPY);g=b(d.name,g,d.center);g.geometry.applyMatrix((new THREE.Matrix4).makeScale(1,1,-1));g.rotation.x=Math.PI/2;g.yawRotationDeg=d.yawRotation||0;d=g}else console.warn("Unknown sky type: ",d.type),d=c(d);f.addSkyMesh(d)};this.load=function(d,f){this.loadSingleSky({name:WALK.DEFAULT_SKY_NAME,type:"procedural"},f);for(var g=0;g<d.length;g+=1)this.loadSingleSky(d[g],f)}}})();(function(){WALK.LightmapLoader=function(a,b){function c(){--f;if(0===f)d.onComplete()}var d=this,f=b;this.lightmaps=[];this.onComplete=null;this.load=function(){for(var g={id:null,name:null,stdExt:"png",webFormats:["large/std"],alpha:!0,rgbm:!0},e=0;e<b;e+=1){g.id=g.name="lightmap-rgbm"+e;var k=a.load(WALK.LOAD_PRIORITY.LIGHTMAP,g,!1,!1,WALK.NO_ANISOTROPY);k.addLoadedListener(c);this.lightmaps.push(k)}}}})();(function(){WALK.TextureAtlasLoader=function(a){this.atlases={};this.load=function(b){for(var c=0;c<b.length;++c){var d=a.load(WALK.LOAD_PRIORITY.DIFFUSE,b[c],!1,!0,WALK.DEFAULT_ANISOTROPY);d.flipY=!1;d.enableAtlas();this.atlases[b[c].id]=d}}}})();(function(){WALK.BufferLoader=function(a,b){var c={};this.onHaveBuffer=this.onFailure=this.onProgress=null;this._buffersDone={};this.buffers={meshes:null,transforms:null,bounds:null,faces16:null,faces:null,vertices:null,normals:null,uvs0:null,uvs1:null};this.haveAllBuffers=function(){for(var d in this.buffers)if(this.buffers.hasOwnProperty(d)&&null===this.buffers[d])return!1;return!0};this.haveCoreBuffers=function(){var d=this.buffers;return d.faces16&&d.faces&&d.vertices&&d.normals&&d.transforms};
this.releaseCoreBuffers=function(){var d=this.buffers;d.faces16=d.faces=d.vertices=d.normals=null};this.load=function(){function d(h){return function(l){g.buffers[h]=l;g.onHaveBuffer()}}function f(h){return function(l){c[h]=l.loaded;g.onProgress()}}var g=this,e=WALK.LOAD_PRIORITY.CORE_RESOURCE,k={meshes:e,transforms:e,bounds:e,faces16:e,faces:e,vertices:e,normals:e,uvs0:b?e:WALK.LOAD_PRIORITY.UV0,uvs1:b?e:WALK.LOAD_PRIORITY.LIGHTMAP};(function(){for(var h in g.buffers)if(g.buffers.hasOwnProperty(h)){var l=
k[h];console.assert(void 0!==l);WALK.queueAjaxGet(l,a+h+".buf",!0,d(h),g.onFailure,f(h))}})()};this.totalDone=function(){var d=0,f;for(f in c)c.hasOwnProperty(f)&&(d+=c[f]);return d}}})();(function(){function a(c,d,f){var g=new Int32Array(c);c=new Float32Array(c);var e=new Float32Array(d),k={},h=g[0],l=g[1],r=2;for(d=0;r<g.length;){var q={nodeId:g[r],materialIdx:g[r+1],useFaces16:1===g[r+2],faceByteOffset:g[r+3],faceCnt:g[r+4],vertexByteOffset:g[r+5],vertexCnt:g[r+6],normalByteOffset:g[r+7],uv0ByteOffset:g[r+8],uv1ByteOffset:g[r+9],lightMapIdx:g[r+10],uv1CoordUScale:c[r+11],uv1CoordVScale:c[r+12],uv1CoordUOffset:g[r+13],uv1CoordVOffset:g[r+14],transformByteOffset:g[r+15],boundsByteOffset:g[r+
16],quantVertexRange:c[r+17],quantVertexMax:g[r+18],quantUv0Range:c[r+19],quantUv0Max:g[r+20],autoLightmapResolution:2<=h?g[r+21]:-1,useInstances:!1,hasCopies:!1,isMasterCopy:!1};q.boundingBox=new THREE.Box3;q.boundingSphere=new THREE.Sphere;a:{for(var m=q.boundingBox,u=q.boundingSphere,n=q.boundsByteOffset/4,w=0;6>w;++w)if(!isFinite(e[n+w]))break a;m.max.x=e[n];m.max.y=e[n+1];m.max.z=e[n+2];m.min.x=e[n+3];m.min.y=e[n+4];m.min.z=e[n+5];m.center(u.center);u.radius=e[n+6]}d=Math.max(d,q.lightMapIdx+
1);WALK.DETECTOR.instances&&(m=q.vertexByteOffset,k.hasOwnProperty(m)?(m=k[m],u=m[0],u.isMasterCopy=!0,u.hasCopies=!0,q.hasCopies=!0,m.push(q)):k[m]=[q]);f.push(q);r+=l}f=$jscomp.makeIterator(Object.values(k));for(g=f.next();!g.done;g=f.next())if(g=g.value,c=g.length,1<c&&500<c*g[0].faceCnt)for(g=$jscomp.makeIterator(g),c=g.next();!c.done;c=g.next())c.value.useInstances=!0;return d}var b=function(c,d,f,g,e){this.meshPropsSet=new Set;this.meshPropsSet.add(c);this.material=d;this.lightMap=f;this.lightProbe=
g;this.hideInViews=e;this.anyLogicalMeshHasUvs=-1!==c.uv0ByteOffset;this.sharedGeometryId=c.useInstances?c.vertexByteOffset:null};b.prototype.canUseLightMap=function(c){return null===this.lightMap||null===c||this.lightMap===c};WALK.MeshMaker=function(c,d,f,g){function e(q){var m=[],u=new Map;h.forEach(function(n){var w=c.findNode(n.nodeId),v=c.materials[n.materialIdx],y=null;null!==w.initialLightProbeId&&(y=c.findLightProbe(w.initialLightProbeId));var C=null;-1!==n.lightMapIdx&&(C=q[n.lightMapIdx]);
var A=w.hideInViews||[];if(w.editable||1!==v.opacity)m.push(new b(n,v,C,y,A));else{var I=n.useInstances?n.vertexByteOffset:null;w=u.get(v)||[];for(var D=$jscomp.makeIterator(w),E=D.next();!E.done;E=D.next()){E=E.value;var O;if(O=E.lightProbe===y&&E.canUseLightMap(C)&&E.sharedGeometryId===I)a:if(O=E.hideInViews,O.length!==A.length)O=!1;else{for(var S=0;S<O.length;S+=1)if(O[S]!==A[S]){O=!1;break a}O=!0}if(O){null!==C&&(E.lightMap=C);E.anyLogicalMeshHasUvs=E.anyLogicalMeshHasUvs||-1!==n.uv0ByteOffset;
E.meshPropsSet.add(n);return}}n=new b(n,v,C,y,A);w.push(n);u.set(v,w);m.push(n)}});return m}var k=this,h=[],l=d.byteLength,r=0;this.mergedMeshes=[];this.lightmapCount=this.geometryDownloadSize=this.coreGeometryDownloadSize=0;this.createMeshes=function(q){var m=q?q[0]:null,u=e(q);q={};u=$jscomp.makeIterator(u);for(var n=u.next();!n.done;n=u.next()){var w=n.value;n=w.sharedGeometryId;if(null!==n){var v=q[n],y=!1;v||(v=new WALK.Geometry,y=!0,q[n]=v);n=new WALK.InstancedGeometry(v,y)}else n=new WALK.Geometry;
v=new WALK.MergedMesh(n,w.material);v.lightProbe=w.lightProbe;v.lightMap=w.lightMap||m;v.hideInViews=w.hideInViews;v.anyLogicalMeshHasUvs=w.anyLogicalMeshHasUvs;this.mergedMeshes.push(v);w=$jscomp.makeIterator(w.meshPropsSet);for(y=w.next();!y.done;y=w.next()){y=y.value;var C,A=n;if(g){var I=3*y.faceCnt;var D=y.vertexCnt}else I=0,D=3*y.faceCnt;if(A.isInstanced)var E=C=0;else C=A.indexCnt,E=A.vertexCnt;E=new WALK.SubGeometry(I,D,A,C,E,y.boundingBox,y.boundingSphere);A.boundingBox.union(y.boundingBox);
WALK.Math.spheresUnion(y.boundingSphere,A.boundingSphere);A.isInstanced?(E.instanceId=A.instanceCount,A.instanceCount+=1,A.indexCnt=I,A.vertexCnt=D):(A.indexCnt+=I,A.vertexCnt+=D);I=E;D=c.findNode(y.nodeId);I=new WALK.Mesh(D,I,v.material);I.lightMap=v.lightMap;I.lightProbe=v.lightProbe;I.autoLightmapResolution=y.autoLightmapResolution;I.useFaces16=y.useFaces16;I.faceByteOffset=y.faceByteOffset;I.faceCnt=y.faceCnt;I.vertexByteOffset=y.vertexByteOffset;I.vertexCnt=y.vertexCnt;I.normalByteOffset=y.normalByteOffset;
I.uv0ByteOffset=y.uv0ByteOffset;I.uv1ByteOffset=y.uv1ByteOffset;I.lightMapIdx=y.lightMapIdx;I.uv1CoordUScale=y.uv1CoordUScale;I.uv1CoordVScale=y.uv1CoordVScale;I.uv1CoordUOffset=y.uv1CoordUOffset;I.uv1CoordVOffset=y.uv1CoordVOffset;I.transformByteOffset=y.transformByteOffset;I.quantVertexRange=y.quantVertexRange;I.quantVertexMax=y.quantVertexMax;I.quantUv0Range=y.quantUv0Range;I.quantUv0Max=y.quantUv0Max;y.hasCopies&&(I.sharedBuffersDebug=y.isMasterCopy?1:2);r+=1;v.addLogicalMesh(I);D.mesh=I}}WALK.log("Have "+
r+" meshes and "+this.mergedMeshes.length+" merged meshes.")};this.lightmapCount=a(d,f,h);d=f=null;(function(){for(var q=0,m=0,u=0,n=0,w=0,v=0,y=0,C=$jscomp.makeIterator(h),A=C.next();!A.done;A=C.next()){A=A.value;var I=A.vertexCnt;q=Math.max(q,A.faceByteOffset+3*A.faceCnt*(A.useFaces16?2:4));m=Math.max(m,A.vertexByteOffset+3*I*WALK.Math.minBytesToHold(A.quantVertexMax)+3&-4);u=Math.max(u,A.normalByteOffset+2*I);n=Math.max(n,A.transformByteOffset+64);w=Math.max(w,A.boundsByteOffset+28);-1!==A.uv0ByteOffset&&
(v=Math.max(v,A.uv0ByteOffset+2*I*WALK.Math.minBytesToHold(A.quantVertexMax)+3&-4));-1!==A.uv1ByteOffset&&(y=Math.max(y,A.uv1ByteOffset+4*I))}k.coreGeometryDownloadSize=l+q+m+u+n+w;k.geometryDownloadSize+=k.coreGeometryDownloadSize+v+y})()}})();(function(){function a(m,u,n,w,v,y,C){var A=0;for(n*=3;A<n;A+=3){var I=m[A+u]*v,D=m[A+u+1]*v,E=m[A+u+2]*v;y[C+A]=w[0]*I+w[1]*D+w[2]*E+w[3];y[C+A+1]=w[4]*I+w[5]*D+w[6]*E+w[7];y[C+A+2]=w[8]*I+w[9]*D+w[10]*E+w[11]}}function b(m,u,n,w,v,y){var C=0;for(n*=2;C<n;C+=2){var A=(m[C+u]/254+.5)*Math.PI,I=Math.PI/127*m[C+u+1],D=Math.sin(A),E=D*Math.cos(I);I=D*Math.sin(I);A=Math.cos(A);D=w[0]*E+w[1]*I+w[2]*A;var O=w[4]*E+w[5]*I+w[6]*A;A=2*(Math.acos(w[8]*E+w[9]*I+w[10]*A)/Math.PI-.5);I=Math.atan2(O,D)/Math.PI;
v[y+C]=WALK.Math.toSnorm8(A);v[y+C+1]=WALK.Math.toSnorm8(I)}}function c(m){return 0!==m.instanceId||!1===m.parent.ownsGpuBuffers}function d(m,u,n,w,v,y,C,A,I){var D=0;for(n*=2;D<n;D+=2){var E=m[D+u],O=m[D+u+1];0!==E||0!==O?(A[I+D]=Math.round(E*w)+y,A[I+D+1]=Math.round(O*v)+C):(A[I+D]=0,A[I+D+1]=0)}}function f(m,u,n,w,v){function y(){for(;A<m.length;){var D=m[A];if(0!==I||u(D)){for(;I<D.logicalMeshes.length;){var E=D.logicalMeshes[I];n(E);I+=1;if(C.shouldInterrupt(E.vertexCnt)){setTimeout(y,0);return}}w(D);
A+=1;I=0}else A+=1}v()}var C=new q(5E4),A=0,I=0;y()}function g(m,u){u.geometry.allocateCoreBuffers(m);return!0}function e(m,u){m?m=u.anyLogicalMeshHasUvs:(m=u.material,m=u.anyLogicalMeshHasUvs&&(m.baseColorTexture||m.bumpTexture||m.roughnessTexture||m.metallicTexture));return m?(u.geometry.allocateUv0(),!0):!1}function k(m){return m.lightMap?(m.geometry.allocateUv1(),!0):!1}function h(m,u,n,w,v){var y=4*v.instanceId;v=v.parent.uvs1Mod;v[y]=n/65535;v[y+1]=w/65535;v[y+2]=m/65535;v[y+3]=u/65535}function l(m,
u){var n=u.parent;u=4*u.instanceId;var w=n.transforms0;w[u]=m[0];w[u+1]=m[1];w[u+2]=m[2];w[u+3]=m[3];w=n.transforms1;w[u]=m[4];w[u+1]=m[5];w[u+2]=m[6];w[u+3]=m[7];n=n.transforms2;n[u]=m[8];n[u+1]=m[9];n[u+2]=m[10];n[u+3]=m[11]}var r=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0]),q=function(m){this.minVerticesUntilTimeCall=m;this.verticesCount=0;this.timer=new WALK.Timer};q.prototype.shouldInterrupt=function(m){this.verticesCount+=m;return this.verticesCount>this.minVerticesUntilTimeCall&&10<this.timer.elapsedMSec()?
(this.verticesCount=0,this.timer.reset(),!0):!1};WALK.asyncFillIndexedUv0=function(m,u,n,w,v){var y=new Uint16Array(m),C=new Float32Array(m);f(u,e.bind(null,n),function(A){if(A.uv0InBuffers()){var I=A.geometry;if(!c(I)){var D=I.vertexOffset,E=I.parent;if(A.quantUv0Disabled()){I=A.uv0ByteOffset/4;var O=E.uvs0;E=0;for(A=2*A.vertexCnt;E<A;E+=1)O[2*D+E]=C[E+I]}else{I=A.uv0ByteOffset/2;O=A.quantUv0Factor();E=E.uvs0;var S=0;for(A=2*A.vertexCnt;S<A;S+=1)E[2*D+S]=y[S+I]*O}}}},w,v)};WALK.asyncFillIndexedUv1=
function(m,u,n,w){var v=new Uint16Array(m);f(u,k,function(y){if(y.uv1InBuffers()){var C=y.uv1CoordUScale,A=y.uv1CoordVScale,I=y.uv1CoordUOffset,D=y.uv1CoordVOffset,E=y.geometry;if(E.isInstanced){h(C,A,I,D,E);if(c(E))return;C=A=1;I=D=0}d(v,y.uv1ByteOffset/2,y.vertexCnt,C,A,I,D,E.parent.uvs1,2*E.vertexOffset)}},n,w)};WALK.asyncFillIndexedCoreGeometry=function(m,u,n,w){var v=m.faces16?new Uint16Array(m.faces16):null,y=m.faces?new Uint32Array(m.faces):null,C=new Int8Array(m.vertices),A=new Int16Array(m.vertices),
I=new Int32Array(m.vertices),D=new Int8Array(m.normals);f(u,g.bind(null,!0),function(E){var O=E.geometry,S=O.parent,W=new Float32Array(m.transforms,E.transformByteOffset,16);if(O.isInstanced){l(W,O);if(c(O))return;W=r}switch(WALK.Math.minBytesToHold(E.quantVertexMax)){case 1:var U=C;var va=E.vertexByteOffset;break;case 2:U=A;va=E.vertexByteOffset/2;break;case 4:U=I,va=E.vertexByteOffset/4}var ta=O.vertexOffset;a(U,va,E.vertexCnt,W,E.quantVertexFactor(),S.vertices,3*ta);b(D,E.normalByteOffset,E.vertexCnt,
W,S.normals,2*ta);S=S.index;O=O.indexOffset;E.useFaces16?(va=E.faceByteOffset/2,W=v):(va=E.faceByteOffset/4,W=y);U=va;for(E=va+3*E.faceCnt;U<E;U+=1,O+=1)S[O]=W[U]+ta},n,w)};WALK.asyncFillNotIndexedGeometry=function(m,u,n,w,v){var y=m.faces16?new Uint16Array(m.faces16):null,C=m.faces?new Uint32Array(m.faces):null,A=new Int8Array(m.vertices),I=new Int16Array(m.vertices),D=new Int32Array(m.vertices),E=new Int8Array(m.normals),O=new Uint16Array(m.uvs0),S=new Float32Array(m.uvs0),W=m.uvs1?new Uint16Array(m.uvs1):
null;f(u,function(U){g(!1,U);e(n,U);k(U);return!0},function(U){var va=U.geometry,ta=U.geometry.parent,qa=new Float32Array(m.transforms,U.transformByteOffset,16);if(U.uv0InBuffers()&&ta.uvs0)var ha=ta.uvs0;if(U.uv1InBuffers()&&ta.uvs1){var F=ta.uvs1;var J=U.uv1CoordUScale;var Z=U.uv1CoordVScale;var M=U.uv1CoordUOffset;var ma=U.uv1CoordVOffset}if(va.isInstanced){l(qa,va);F&&h(J,Z,M,ma,va);if(c(va))return;qa=r;J=Z=1;M=ma=0}if(U.useFaces16){va=y;var ea=U.faceByteOffset/2}else va=C,ea=U.faceByteOffset/
4;switch(WALK.Math.minBytesToHold(U.quantVertexMax)){case 1:var ya=A;var Q=U.vertexByteOffset;break;case 2:ya=I;Q=U.vertexByteOffset/2;break;case 4:ya=D,Q=U.vertexByteOffset/4}var fa=U.quantUv0Disabled();if(fa)var K=U.uv0ByteOffset/4;else{var R=U.quantUv0Factor();K=U.uv0ByteOffset/2}var ka=3*U.geometry.vertexOffset,ba=2*U.geometry.vertexOffset,ja=U.quantVertexFactor(),na=ta.vertices;ta=ta.normals;var ra=U.normalByteOffset,za=U.uv1ByteOffset/2,Da=ea;for(U=ea+3*U.faceCnt;Da<U;Da+=1,ka+=3,ba+=2){ea=
va[Da];a(ya,Q+3*ea,1,qa,ja,na,ka);b(E,ra+2*ea,1,qa,ta,ba);if(ha){var ia=K+2*ea;if(fa)for(var V=ha,xa=ba,Ea=0;2>Ea;Ea+=1)V[xa+Ea]=S[Ea+ia];else{V=R;xa=ha;Ea=ba;for(var Ia=0;2>Ia;Ia+=1)xa[Ea+Ia]=O[Ia+ia]*V}}F&&d(W,za+2*ea,1,J,Z,M,ma,F,ba)}},w,v)}})();(function(){function a(k,h){k.forEach(function(l){h.addView(new WALK.View(l))})}function b(k,h,l){k.forEach(function(r){l.isNodeTypeEditable(r.name)&&(r.editable=!0);h.addNodeConfig(new WALK.NodeConfig(r))})}function c(k,h){k.forEach(function(l){var r=new WALK.Light(l);l=l.instances;for(var q=0;q<l.length;q+=1){var m=l[q];r.addInstance(m.position,m.rotation)}h.addLight(r)})}function d(k,h){k.forEach(function(l){h.addLightProbe(new WALK.LightProbe(l))})}function f(k,h,l){l=l.camera;k&&(l.defaultFov=
k.fov,k.exposure&&(l.defaultExposure=k.exposure),k.gamma&&(l.defaultGamma=k.gamma),k.lutTexture&&(h=h.load(WALK.LOAD_PRIORITY.COLORMAP,k.lutTexture,!1,!1,WALK.NO_ANISOTROPY),h.flipY=!1,l.colorMap=h),l.autoClimb=!!k.autoClimb,l.autoExposure=!!k.autoExposure,void 0!==k.autoExposureDarkness&&(l.autoExposureDarkness=k.autoExposureDarkness),k.moveMaxSpeed&&(l.moveMaxSpeed=k.moveMaxSpeed),l.updateProjectionMatrix())}function g(k,h){function l(r,q){var m=h.findNodeConfig(q.config),u=new WALK.Node(r,m,q);
void 0!==q.children&&(u.children=q.children.map(function(n){return l(u,n)}));return u}k.forEach(function(r){h.addNode(l(null,r))})}function e(){WALK.USER_MSG.error("Scene failed to load. Reload the page to retry.")}WALK.SceneLoader=function(k,h,l,r){var q=!l&&WALK.DETECTOR.indexUint,m=!l&&!WALK.DEBUG_SHARED_BUFFERS,u=new WALK.Timer;this.onComplete=this.onReadyToDisplay=this.onTextureLoaded=this.onMeshBuffersLoaded=this.onProgress=null;this.panoramas=[];this.load=function(){function n(){if(void 0!==
K.total)qa.onProgress(K)}function w(){M||(M=!0,qa.onReadyToDisplay(k))}function v(ka){0===ka.name.indexOf("lightmap-rgbm")?K.texturesDone+=12582912:K.texturesDone+=524288;n();qa.onTextureLoaded(ka);R()}function y(){console.warn("Failed to load video texture");R()}function C(){if(0===ha.texturesToLoad&&ea){ha.clearCache();for(var ka=0,ba=$jscomp.makeIterator(J.mergedMeshes),ja=ba.next();!ja.done;ja=ba.next())ka+=ja.value.geometry.gpuSize;WALK.log("Total GPU geometry buffers size "+ka+" bytes");ha=
F=J=null;WALK.defer(function(){w();qa.onComplete(k)})}}function A(){ya&&ma&&Z&&(R=C,fa&&k.materials.forEach(function(ka){ka.lightMapped||(ka.lightMapped=!0,ka.setUniforms())}),R())}function I(ka){ka.geometry.addUv1Attribute();qa.onMeshBuffersLoaded(ka)}function D(){F.buffers.uvs1&&(R=A,WALK.asyncFillIndexedUv1(F.buffers.uvs1,J.mergedMeshes,I,function(){F.buffers.uvs1=null;ya=!0;R()}))}function E(ka){ka.geometry.addUv0Attribute();qa.onMeshBuffersLoaded(ka)}function O(){F.buffers.uvs0&&(R=D,WALK.asyncFillIndexedUv0(F.buffers.uvs0,
J.mergedMeshes,l,E,function(){F.buffers.uvs0=null;ea=!0;R()}))}function S(){Z=!0;0===k.views.length&&k.addView(new WALK.View({id:0,name:"Start place",hideFromMenu:!0,position:k.center.toArray(),rotation:[0,0],internal:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME}));if(!l&&!k.disableProgressiveLoader){var ka=1E3*WALK.PROGRESSIVE_LOADER_AFTER_SEC-u.elapsedMSec();0>=ka?w():setTimeout(w,ka)}R()}function W(ka){k.addGpuMesh(ka)}function U(ka){ka.geometry.addCoreAttributes();var ba=ka.logicalMeshes;console.assert(!ba[0].node.editable||
1===ba.length);ba[0].node.editable||!m?ba.forEach(W):W(ka);qa.onMeshBuffersLoaded(ka)}function va(ka){ka.geometry.uvs0&&ka.geometry.addUv0Attribute();ka.geometry.uvs1&&ka.geometry.addUv1Attribute();U(ka)}function ta(){if(q){if(!F.haveCoreBuffers())return;WALK.log("Using indexed geometry");R=O;WALK.asyncFillIndexedCoreGeometry(F.buffers,J.mergedMeshes,U,S)}else{if(!F.haveAllBuffers())return;R=A;WALK.asyncFillNotIndexedGeometry(F.buffers,J.mergedMeshes,l,va,function(){ya=ea=!0;S()})}F&&F.releaseCoreBuffers()}
var qa=this,ha=null,F=null,J=null,Z=!1,M=!1,ma=!1,ea=!1,ya=!1,Q=null,fa=!1,K={total:void 0,texturesDone:0,totalDone:function(){return this.texturesDone+F.totalDone()}};u.reset();var R=function(){if(Q&&F.buffers.meshes&&F.buffers.bounds){R=ta;void 0!==Q.autoAddLightProbes&&(k.autoAddLightProbes=Q.autoAddLightProbes);k.disableProgressiveLoader=Q.disableProgressiveLoader||!1;void 0!==Q.autoTour&&(k.autoTour.disabled=Q.autoTour.disabled||!1,k.autoTour.startOnLoad=Q.autoTour.startOnLoad||!1);c(Q.lights,
k);d(Q.lightProbes||[],k);Q.cameraVolumes&&Q.cameraVolumes.forEach(function(ja){return k.addCameraVolume(new WALK.CameraVolume(ja))});ha=new WALK.TextureLoader(h,WALK.DETECTOR,v,e,y,!1,!0);f(Q.camera,ha,k);var ka=new WALK.TextureAtlasLoader(ha);ka.load(Q.atlases||[]);(new WALK.MaterialLoader(ha,ka.atlases,r)).load(Q.materials||[],k);(new WALK.SkyLoader(ha)).load(Q.skies||[],k);null===k.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)&&console.error("A sky with name "+WALK.EDITOR_CONTROLLED_SKY_NAME+" is missing.");
a(Q.views||[],k);Q.hideViewsMenu&&(k.hideViewsMenu=!0);b(Q.nodeConfigs,k,r);g(Q.nodes,k);J=new WALK.MeshMaker(k,F.buffers.meshes,F.buffers.bounds,q);ka=null;if(0!==J.lightmapCount){fa=!0;var ba=new WALK.LightmapLoader(ha,J.lightmapCount);ba.onComplete=function(){ma=!0;R()};ba.load();ka=ba.lightmaps;ba=null}else ma=!0;J.createMeshes(ka);K.total=J.geometryDownloadSize+524288*(ha.texturesToLoad-J.lightmapCount)+12582912*J.lightmapCount;Q.panoramas&&(qa.panoramas=Q.panoramas);Q=null;R()}};WALK.queueAjaxGet(WALK.LOAD_PRIORITY.CORE_RESOURCE,
h+"scene.json",!1,function(ka){Q=ka;R()},e);F=new WALK.BufferLoader(h,!q);F.onProgress=n;F.onFailure=e;F.onHaveBuffer=function(){R()};F.load()};this.elapsedLoadTimeSec=function(){return u.elapsedSec()}}})();(function(){function a(c,d,f,g){for(var e=[],k=0;6>k;k+=1){var h=g?new THREE.OrthographicCamera(-1,1,1,-1,c,d):new THREE.PerspectiveCamera(90,1,c,d);f.add(h);e.push(h)}e[0].up.set(0,-1,0);b.set(1,0,0);e[0].lookAt(b);e[1].up.set(0,-1,0);b.set(-1,0,0);e[1].lookAt(b);e[2].up.set(0,0,1);b.set(0,1,0);e[2].lookAt(b);e[3].up.set(0,0,-1);b.set(0,-1,0);e[3].lookAt(b);e[4].up.set(0,-1,0);b.set(0,0,1);e[4].lookAt(b);e[5].up.set(0,-1,0);b.set(0,0,-1);e[5].lookAt(b);return e}var b=new THREE.Vector3;WALK.CubeCamera=
function(c,d){THREE.Object3D.call(this);this.sideCameras=a(c,d,this,!1)};WALK.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.CubeCamera.prototype.constructor=WALK.CubeCamera;WALK.OrthoCubeCamera=function(c,d){THREE.Object3D.call(this);this.sideCameras=a(c,d,this,!0)};WALK.OrthoCubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.OrthoCubeCamera.prototype.constructor=WALK.OrthoCubeCamera})();(function(){WALK.CubeMapFilterShader={uniforms:{gloss:{type:"f",value:.9},face:{type:"f",value:0},mipSize:{type:"f",value:128},envMap:{type:"t",value:null}},vertexShader:WALK.getShader("cubemap_filter_vertex.glsl"),fragmentShader:WALK.getShader("cubemap_filter_fragment.glsl")}})();(function(){function a(r,q){q=q.target;r.deleteTexture(q.__webglTexture);q.__webglTexture=null;q.image=null}function b(r,q,m){for(var u=!0;u;){r.readPixels(q,q,m);for(var n=0;n<q*q*4;n+=4)if(0!==m[n]||0!==m[n+1]||0!==m[n+2]){u=!1;break}if(u){console.warn("Cube face has all pixels black.");break}}}function c(r,q){var m=new Set;r.traverse(function(u){if(u instanceof THREE.Mesh&&u.visible){var n=u.material;u.userData.hideFromLightProbes||n.hideFromLightProbes?(q.add(u),u.visible=!1):m.has(n)||(m.add(n),
n.configureTransparency&&(n.transparent=!1,n.blending=THREE.NoBlending,n.depthWrite=!0),void 0!==n.hdrOutput&&(n.hdrOutput=!0),void 0!==n.specularOff&&(n.specularOff+=1))}});m=null}function d(r,q){var m=new Set;r.traverse(function(u){if(u instanceof THREE.Mesh){var n=u.material;n.forceObjectUniformsRefresh&&n.forceObjectUniformsRefresh();u.visible?m.has(n)||(m.add(n),void 0!==n.hdrOutput&&(n.hdrOutput=!1),n.configureTransparency&&n.configureTransparency(),void 0!==n.specularOff&&--n.specularOff):
q.has(u)&&(u.visible=!0)}});m=null}function f(r,q){var m={format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1};this.renderer=r;this.scene=q;this.threeScene=q.threeScene;this.aabbQueryMaterial=new WALK.AabbQueryMaterial;this.filterPass=new THREE.ShaderPass(WALK.CubeMapFilterShader,"envMap");q=WALK.LIGHT_PROBE_MAX_MIP_SIZE;this.pixelBuf=new Uint8Array(q*q*4);this.targetCubeRaw=r.createRenderTargetCube(q,q,m);m.depthBuffer=!1;this.targetFiltered=r.createRenderTarget(q,
q,m);this.autoClearAlter=new WALK.AutoClearAlter(r);this.dispose=function(){this.targetCubeRaw.dispose();this.targetFiltered.dispose();this.aabbQueryMaterial.dispose();this.filterPass.material.dispose();this.pixelBuf=null}}function g(r,q){var m=q.geometry.boundingSphere.center;if(null===q.lightProbe||m.distanceTo(r.position)<m.distanceTo(q.lightProbe.position))q.lightProbe=r}function e(r,q){for(var m=0;m<q.length;m+=1)g(r,q[m])}function k(r,q){WALK.log("No visible light probe found for "+q.length+
" objects. Assigning the closest ones.");for(var m=0;m<q.length;m+=1)for(var u=0;u<r.length;u+=1)g(r[u],q[m])}var h=function(){var r=null;return function(q,m){var u=null,n=0;m*=m;console.assert(m<Math.pow(2,16));null===r&&(r=new Uint16Array(65536));for(var w=0;w<4*m;w+=4)r[256*q[w]+q[w+1]]+=1;r[0]>.7*m&&(n=r[0]);r[0]=0;for(q=1;q<r.length;q+=1)r[q]>n&&(n=r[q],u=Math.floor(q/256)+q%256/255),r[q]=0;return u}}(),l=function(){var r=null;return function(q,m,u){var n=q.renderer,w=q.aabbQueryMaterial,v=q.pixelBuf,
y=q.targetCubeRaw;null===r&&(r=new WALK.OrthoCubeCamera(.01,255));r.position.copy(m.position);r.updateMatrixWorld();var C;for(C=0;6>C;C+=1){y.activeCubeFace=C;w.axis=Math.floor(C/2);n.renderMeshes(q.scene.gpuMeshes,w,r.sideCameras[C],y);b(n,y.width,v);var A=h(v,y.width);if(null===A){WALK.log("failed to find light probe bound");break}switch(C){case 0:u.boxMax.x=m.position.x+A;break;case 1:u.boxMin.x=m.position.x-A;break;case 2:u.boxMax.y=m.position.y+A;break;case 3:u.boxMin.y=m.position.y-A;break;
case 4:u.boxMax.z=m.position.z+A;break;case 5:u.boxMin.z=m.position.z-A}}6!==C&&(WALK.log("Light probe bounds: X["+u.boxMin.x.toFixed(2)+":"+u.boxMax.x.toFixed(2)+"] Y["+u.boxMin.y.toFixed(2)+":"+u.boxMax.y.toFixed(2)+"] Z["+u.boxMin.z.toFixed(2)+":"+u.boxMax.z.toFixed(2)+"]"),u.resetBoundingBox())}}();f.prototype.constructor=f;WALK.LightProbeMaker=function(r,q,m,u,n){function w(D,E){I.position.copy(D.position);I.updateMatrixWorld();var O;if((O=u)&&!(O=n))a:{O=r.gpuMeshes;for(var S=0;S<O.length;S+=
1){var W=O[S];if(W.lightProbe===D&&W.material.envMapMirror){O=!0;break a}}O=!1}(S=O)&&WALK.log("Mirror texture needed for the light probe.");A.reset();O=C.renderer;C.autoClearAlter.set(!0,!0,!1);if(S){S=C.renderer;var U=WALK.LIGHT_PROBE_MIRROR_SIZE;U=S.createRenderTargetCube(U,U,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(W=0;6>W;W+=1)U.activeCubeFace=W,S.render(C.threeScene,I.sideCameras[W],U);S=S.context;W=new WALK.Texture;W.minFilter=GLC.LINEAR;
W.generateMipmaps=!1;W.needsUpdate=!1;W.isCube=!0;W.addEventListener("dispose",a.bind(void 0,S));W.__webglTexture=U.__webglTexture;U.__webglTexture=null;U.dispose();U=W;D.setMirrorTexture(U)}E&&l(C,I,D);E=C.renderer;S=C.targetCubeRaw;for(W=0;6>W;W+=1)S.activeCubeFace=W,E.render(C.threeScene,I.sideCameras[W],S);C.autoClearAlter.restore();O.enableScissorTest(!0);C.autoClearAlter.set(!1,!1,!1);m&&(U=O.createCubeTexture(C.targetFiltered.width,!0),D.setFilteredTexture(U));for(E=0;E<WALK.LIGHT_PROBE_MIPS_COUNT;E+=
1){S=E;S=Math.pow(2,WALK.log2(C.targetFiltered.width)-S);O.setScissor(0,0,S,S);C.filterPass.uniforms.mipSize.value=S;C.filterPass.uniforms.gloss.value=WALK.LIGHT_PROBE_GLOSS_FOR_MIP[E];m||(U=O.createCubeTexture(S,!1),D.setFilteredTextureNoLod(U,E));W=C.filterPass;var va=C.targetCubeRaw,ta=C.targetFiltered,qa=C.pixelBuf,ha=m?E:0,F=U;if(WALK.DEBUG_LIGHT_PROBE_MIPS)for(var J=qa,Z=255*ha/WALK.LIGHT_PROBE_MIPS_COUNT,M=0;M<4*S*S;M+=4)J[M]=Z,J[M+1]=Z,J[M+2]=Z,J[M+3]=31.875;for(J=0;6>J;J+=1)WALK.DEBUG_LIGHT_PROBE_MIPS||
(W.uniforms.face.value=J,W.render(O,ta,va),b(O,S,qa)),O.copyBufferToCubeFaceMip(ha,S,J,qa,F)}O.enableScissorTest(!1);C.autoClearAlter.restore();WALK.log("Cube generation time "+A.elapsedSec())}var v,y=r.threeScene,C=new f(q,r),A=new WALK.Timer,I=new WALK.CubeCamera(.15,r.camera.far);this.assignLightProbesToObjects=function(){A.reset();void 0===v&&(v=new WALK.ObjectDistanceQuery(q,r.gpuMeshes,r.camera.far));for(var D=0;D<r.gpuMeshes.length;D+=1)r.gpuMeshes[D].lightProbe=null;for(D=0;D<r.lightProbes.length;D+=
1){var E=r.lightProbes[D],O=v.updateCubeMapAndFindVisibleObjects(E.position);WALK.log("Have visible objects "+O.length);e(E,O)}WALK.log("Light probe assigment time "+A.elapsedSec());k(r.lightProbes,WALK.filter(r.gpuMeshes,function(S){return null===S.lightProbe}))};this.findBounds=function(D){I.position.copy(D.position);I.updateMatrixWorld();C.autoClearAlter.set(!0,!0,!1);l(C,I,D);C.autoClearAlter.restore()};this.createLightProbeTexture=function(D,E){var O=new Set;c(y,O);w(D,E);d(y,O)};this.createAllLightProbeTextures=
function(){var D=new Set;c(y,D);for(var E=0;E<r.lightProbes.length;E+=1)w(r.lightProbes[E],!1);d(y,D)};this.dispose=function(){C.dispose();v&&v.dispose()}}})();(function(){function a(f){if(f.empty())return 0;f.size(d);return d.x*d.y*d.z}function b(f){if(f.empty())return 0;f.size(d);f=d.x*d.y;return 1>d.x||1>d.y||1.9>d.z||1.5>f?0:f*d.z}function c(f){var g=[],e=[];g.push(f);this.addFilledBox=function(h){e.push(h)};this.findBestFilledBoxes=function(){function h(n){return n[1]}function l(n){n=n[0];n=n.max.x<u.min.x+.2||n.min.x>u.max.x-.2||n.max.y<u.min.y+.2||n.min.y>u.max.y-.2||n.max.z<u.min.z+.2||n.min.z>u.max.z-.2?!1:!0;return!n}var r=[],q=[];for(e.forEach(function(n){q.push([n,
a(n)])});0<q.length&&10>r.length;){var m=WALK.indexOfMax(q,h);var u=q[m][0];r.push(u);q=q.filter(l)}return r};this.isEnclosedInFilledBox=function(h){return WALK.any(e,function(l){l=l.min.x-.1<=h.min.x&&h.max.x<=l.max.x+.1&&l.min.y-.1<=h.min.y&&h.max.y<=l.max.y+.1&&l.min.z-.1<=h.min.z&&h.max.z<=l.max.z+.1?!0:!1;return l})};this.findLargestEmptyBox=function(){var h=WALK.indexOfMax(g,a);return null!==h?g[h]:null};var k=function(){var h=[];h[0]=new THREE.Box3;h[1]=new THREE.Box3;h[2]=new THREE.Box3;h[3]=
new THREE.Box3;h[4]=new THREE.Box3;h[5]=new THREE.Box3;return function(l,r,q){h[0].max.copy(l.max);h[0].min.copy(l.min);h[0].min.z=r.max.z;h[1].max.copy(l.max);h[1].max.z=r.min.z;h[1].min.copy(l.min);h[2].max.copy(l.max);h[2].min.copy(l.min);h[2].min.x=r.max.x;h[3].max.copy(l.max);h[3].max.x=r.min.x;h[3].min.copy(l.min);h[4].max.copy(l.max);h[4].min.copy(l.min);h[4].min.y=r.max.y;h[5].max.copy(l.max);h[5].max.y=r.min.y;h[5].min.copy(l.min);var m=WALK.indexOfMax(h,b);0!==b(h[m])&&(q.push(h[m].clone()),
0===m?l.max.z=r.max.z:1===m?l.min.z=r.min.z:2===m?l.max.x=r.max.x:3===m?l.min.x=r.min.x:4===m?l.max.y=r.max.y:5===m&&(l.min.y=r.min.y),k(l,r,q))}}();this.split=function(h){for(var l=[],r=0;r<g.length;r+=1){var q=g[r];q.isIntersectionBox(h)?k(q,h,l):l.push(q)}g=l}}var d;WALK.arrangeLightProbes=function(f,g,e){function k(A){var I=new WALK.LightProbe({id:f.lightProbes.length});A.center(I.position);I.position.z=A.min.z+1.3;I.enableBoundingBox();I.boxMin.copy(A.min);I.boxMax.copy(A.max);f.lightProbes.push(I)}
var h=new c(f.boundingBox.clone()),l=new THREE.Box3,r=new THREE.Box3,q=new THREE.Vector3,m=new WALK.Timer;d=new THREE.Vector3;for(var u=new WALK.LightProbe({id:0}),n=0;200>n;n+=1){var w=h.findLargestEmptyBox();if(null===w)break;w.center(u.position);u.position.z=w.min.z+1.3;u.enableBoundingBox();r.makeEmpty();for(var v=0;5>v;v+=1){g.findBounds(u);if(!u.isBoundingBoxInitialized())break;l.set(u.boxMin,u.boxMax);var y=b(l);if(0===y)break;if(h.isEnclosedInFilledBox(l))break;l.center(q);q.z=l.min.z+1.3;
var C=u.position.distanceToSquared(q);a(r)<y&&.25>C&&r.set(l.min,l.max);if(.04>C)break;u.position.copy(q)}r.empty()?(w.center(l.min),w.center(l.max),h.split(l)):(h.addFilledBox(r.clone()),h.split(r))}WALK.log("Light probes arrangement time "+m.elapsedSec());g=h.findBestFilledBoxes();(g.reduce(function(A,I){return A+a(I)},0)>.2*a(f.boundingBox)||e)&&g.forEach(k);0===f.lightProbes.length&&e&&k(f.boundingBox)}})();/*
 Copyright (C) 2015-present Shapespark
*/
(function(){function a(k,h){k=document.getElementsByClassName(k);for(var l=0;l<k.length;l+=1)h(k[l])}function b(k){var h=[];a(k,function(r){h.push(r)});for(var l=0;l<h.length;l+=1)h[l].classList.remove(k)}function c(k,h){k.style.display=h?"":"none"}function d(k,h){c($(k),h)}function f(k,h){a(k,function(l){c(l,h)})}function g(k){c(k,!0);k.style.opacity=0;WALK.defer(function(){k.style.opacity=1})}function e(k){k.style.opacity=0;var h=window.getComputedStyle(k).transitionDuration;if(h){var l=parseFloat(h);
-1===h.indexOf("ms")&&(l*=1E3);setTimeout(function(){c(k,!1);k.style.opacity=1},l)}else c(k,!1),k.style.opacity=1}WALK.Menu=function(k,h,l,r,q){function m(ia){return function(V){V.stopPropagation();ia();WALK.DETECTOR.ios||$("walk-canvas").focus()}}function u(ia,V){ia.addEventListener("click",m(V))}function n(ia,V){u($(ia),V)}function w(ia){if(ia){var V=null===ea?[]:ea.visibleViews(),xa;for(xa=0;xa<V.length&&V[xa]!==ia;xa+=1);ia=$("view-list-items").children;if(xa<ia.length)return ia[xa]}return null}
function v(ia){return function(){ia.classList.remove("active-view");ia.classList.remove("next-active-view")}}function y(){for(var ia=$("view-list-items").children,V=0;V<ia.length;V+=1)ia[V].classList.remove("active-view"),ia[V].classList.remove("next-active-view")}function C(){$("tour-button").classList.add("tour-on")}function A(){$("tour-button").classList.remove("tour-on");y()}function I(){Q.isRunning()?Q.stop():Q.start()}function D(){return Q.isRunning()?(Q.stop(),!0):!1}function E(ia){y();(ia=
w(ia.view))&&ia.classList.add("next-active-view")}function O(ia){if(ia=w(ia.view))ia.classList.remove("next-active-view"),ia.classList.add("active-view"),setTimeout(v(ia),WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)}function S(ia){return m(function(){var V=D();ya.switchToView(ia,V?0:void 0)})}function W(){var ia=$("info-bar"),V=$("info-bar-slide"),xa=$("view-list"),Ea=$("view-list-slide"),Ia=$("menu-bar"),Qa=$("menu-bar-slide"),L=$("menu-bar-folder");c(L,ea&&!ba);if(M.visible){ia.style.pointerEvents=null;
V.style.left=0;xa.style.pointerEvents=null;Ea.style.top=0;Ia.style.pointerEvents=null;Qa.style.right=0;L.style.pointerEvents=null;L.children[0].style.transform="";if(null!==M.cover){Ia=M.cover.title;Ea=M.cover.author;Qa=M.cover.authorHref;xa=M.cover.engineLogoOn;ia=M.cover.engineLogoText;V=M.cover.engineLogoUrl;L=M.cover.authorLogoUrl;M.cover.authorLogo&&(L=WALK.getExtraAssetUrl(M.cover.authorLogo.path));var pa=$("author-logo"),ca=pa.firstElementChild;L?(Qa&&(pa.href=Qa),ca.src=L):(c(pa,!1),ca.removeAttribute("src"));
L=null===ea||null!==Da;d("info-text",L&&(Ia||Ea));L&&(WALK.setTextContent($("info-title"),Ia),WALK.setTextContent($("info-author"),Ea),Qa&&($("info-author").href=Qa));Ia=Ia?Ia:"3D scene";Ea&&(Ia+=" by "+Ea);document.title=Ia;Ea=$("engine-logo");c(Ea,xa);xa&&(ia&&(xa=$("engine-logo-text"),c(xa,!0),WALK.setTextContent(xa,ia)),V&&(Ea.href=V))}ia=null===ea?[]:ea.visibleViews();V=$("view-list-items");d("view-list",0<ia.length&&!ba);if(0<ia.length){xa=V.children[0];for(v(xa)();1!==V.children.length;)V.removeChild(V.children[V.children.length-
1]);for(Ea=0;Ea<ia.length;Ea+=1)Ia=ia[Ea],Ia.hideFromMenu||(WALK.setTextContent(xa,Ia.name),xa.onclick=S(Ia),V.appendChild(xa),xa=xa.cloneNode(!0))}d("menu-buttons",ea&&!ba);ea&&ea.canStartAutoTour()&&!ja?d("tour-button",!0):(Q&&Q.isRunning()&&Q.stop(),d("tour-button",!1))}else pa=$("menu-bar-content"),ia.style.pointerEvents="none",V.style.left=-V.offsetWidth+"px",xa.style.pointerEvents="none",Ea.style.top=-Ea.offsetHeight+"px",Ia.style.pointerEvents="none",L.style.pointerEvents="auto",Qa.style.right=
-pa.offsetWidth+"px",L.children[0].style.transform="rotate(180deg)";ia=ra&&!(ja&&WALK.DETECTOR.mobile)&&!ba;WALK.DETECTOR.mobile?d("mobile-help",ia):(d("desktop-help",ia),ra&&(ia=$("desktop-help-switch"),V=$("desktop-help-content"),xa=za?1:0,ia.children[xa].classList.add("selected"),c(V.children[xa],!0),ia.children[1-xa].classList.remove("selected"),c(V.children[1-xa],!1)))}function U(){M.visible=!na}function va(){ra=!ra;W()}function ta(){za=!1;W()}function qa(){za=!0;W()}function ha(){var ia=D();
ya.switchToPreviousVisibleView(ia?0:void 0)}function F(){var ia=D();ya.switchToNextVisibleView(ia?0:void 0)}function J(ia){if(!(ia.ctrlKey||ia.altKey||ia.metaKey)){var V=ia.target||ia.srcElement;V=V.nodeType===Node.ELEMENT_NODE?V.nodeName.toUpperCase():"";if(!/INPUT|SELECT|TEXTAREA/.test(V))if(67===ia.keyCode&&WALK.DEBUG)ia.shiftKey?WALK.DETECTOR.extension("WEBGL_lose_context").restoreContext():WALK.DETECTOR.extension("WEBGL_lose_context").loseContext();else if(null!==ea){switch(ia.keyCode){case 27:D();
break;case 70:R&&r();break;case 76:ka&&q();break;case 72:va();break;case 77:U();break;case 86:K&&l();break;case 80:k||(ia.shiftKey?fa.screenToLocalImage(!0,4E3,2E3):fa.screenToLocalImage(!1,window.innerWidth,window.innerHeight));break;case 219:ha();break;case 221:F()}V=ia.keyCode-48;if(1<=V&&9>=V){--V;var xa=null===ea?[]:ea.visibleViews();V=xa.length>V?xa[V]:null;null!==V&&S(V)(ia)}}}}function Z(ia){switch(ia.action){case WALK.GAMEPAD_ACTION.PREVIOUS:ha();break;case WALK.GAMEPAD_ACTION.NEXT:F()}}
var M=this,ma={type:"visibilityChanged"},ea=null,ya=null,Q=null,fa=null,K=!1,R=!1,ka=!1,ba=!1,ja=!1,na=!0,ra=!1,za=!1,Da=null;this.cover=null;Object.defineProperty(this,"visible",{get:function(){var ia=ja&&WALK.DETECTOR.mobile;return na&&!ia},set:function(ia){var V=this.visible;na=ia;V!==this.visible&&this.dispatchEvent(ma);W()}});this.updateCover=function(ia){this.cover=ia;null!==Da&&clearTimeout(Da);Da=setTimeout(function(){Da=null;W()},5E3);W()};this.refresh=function(){W()};this.onFullScreenChange=
function(ia){};this.onPointerLockChange=function(ia){ba=ia;W()};this.onVrChange=function(ia){var V=this.visible;ja=ia;V!==this.visible&&this.dispatchEvent(ma);W()};this.onResize=function(){if(!this.visible){var ia=$("info-bar-slide"),V=$("menu-bar-slide"),xa=$("view-list-slide");ia.style.transition="none";V.style.transition="none";xa.style.transition="none";W();ia.style.transition="";V.style.transition="";xa.style.transition=""}};this.enablePlayButton=function(ia){var V=$("play-button");V.addEventListener("click",
ia);c(V,!0)};this.setVrSupported=function(ia){K=ia;f("vr-specific",ia)};this.setFullScreenSupported=function(){(R=!k)&&f("fullscreen-specific",!0)};this.setPointerLockSupported=function(){ka=!k};this.addExtraButton=function(ia){var V=$("tour-button"),xa=document.createElement("img");xa.src=ia;ia=document.createElement("div");ia.className="menu-button menu-item ui-hoverable ui-panel";ia.appendChild(xa);V.parentNode.insertBefore(ia,V);return ia};this.removeExtraButton=function(ia){ia.remove()};this.getExtraButonIcon=
function(ia){return ia.firstElementChild};this.sceneLoadStarted=function(ia){d("play-button",!1);d("primary-progress",!0);ia&&va()};this.loadProgress=function(ia){ia=ia.totalDone()/ia.total;if(null===ea){var V=Math.max(314.159*(1-ia),0);$("primary-progress-done").style.strokeDashoffset=V}ia=Math.floor(100*ia);$("secondary-progress-done").style.width=ia+"%"};this.sceneReadyToDisplay=function(ia,V,xa,Ea){ea=ia;ya=V;ya.addEventListener("teleportStarted",E);ya.addEventListener("teleportDone",O);Q=xa;
Q.addEventListener("tourStarted",C);Q.addEventListener("tourStopped",A);fa=Ea;e($("cover-image"));e($("primary-progress"));g($("secondary-progress"));ea.addEventListener("viewAdded",W);ea.addEventListener("viewRemoved",W);ea.addEventListener("viewShifted",W);document.body.style.backgroundImage="none";document.body.style.backgroundColor="#000";W()};this.sceneLoadComplete=function(){d("secondary-progress",!1)};this.init=function(){k&&(f("viewer-specific",!1),f("editor-specific",!0));a("ui-panel",function(xa){u(xa,
function(){})});WALK.DETECTOR.mobile&&b("ui-hoverable");var ia=$("author-logo"),V=ia.firstElementChild;V.onload=function(){c(ia,!0)};V.onerror=function(){c(ia,!1)};document.addEventListener("keydown",J,!1);n("help-button",va);n("fullscreen-button",r);n("vr-button",l);n("tour-button",I);n("menu-bar-folder",U);n("view-list-folder",U);n("basic-desktop-help-option",ta);n("advanced-desktop-help-option",qa);n("close-desktop-help-button",va);n("close-mobile-help-button",va);h.addEventListener("actionActivated",
Z);W()};this.contextLost=function(){ea=ya=Q=fa=null;W()}};THREE.EventDispatcher.prototype.apply(WALK.Menu.prototype)})();(function(){WALK.USER_MSG=new function(){this.hideInfo=function(){$("info-message").style.display="none"};this.info=function(a,b){var c=$("info-message");c.innerHTML=a;c.style.display="";setTimeout(this.hideInfo,b||15E3)};this.error=function(a){var b=$("error-message");b.innerHTML=a;b.style.display=""}}})();(function(){WALK.Timer=function(){this.clock=performance||Date;this.reset()};WALK.Timer.prototype={constructor:WALK.Timer,reset:function(){this.startMS=this.clock.now()},elapsedMSec:function(){return this.clock.now()-this.startMS},elapsedSec:function(){return.001*this.elapsedMSec()}};WALK.Perf=function(){var a=new WALK.Timer,b=[];this.begin=function(){a.reset()};this.end=function(){b.push(a.elapsedSec());0===b.length%100&&(b.sort(),console.log("Best "+b[0]+" Median "+b[Math.floor(.5*b.length)]+" 95 "+
b[Math.floor(.95*b.length)]))}};WALK.DeferringExecutor=function(a,b){function c(){d=null;a()}var d=null;this.deferRun=function(){null!==d&&clearTimeout(d);d=setTimeout(c,b)}}})();(function(){WALK.AnimationController=function(a,b,c){function d(){u(a.vrEnabled())}function f(){u(!1)}var g=this,e=new THREE.Clock,k=!1,h=!1,l=!1,r=0,q=!1,m=function(){h||(k||e.getDelta(),h=!0,a.vrEnabled()?a.requestAnimationFrame(d):requestAnimationFrame(f))};var u=function(n){q&&(h=!1,l?(console.assert(!n),c(e.getDelta(),r)?(r+=1,m()):l=!1):(k=!0,b(e.getDelta(),n),WALK.ALWAYS_RENDER&&g.requestFrame(),k=!1,h||(l=!0,r=0,m())))};this.requestFrame=function(){q&&(l=!1,m())};this.disable=function(){q=
!1};this.enable=function(){q=!0;h=!1;this.requestFrame()};this.isEnabled=function(){return q}}})();(function(){WALK.ExposureController=function(a,b,c){var d=a.camera,f=!1,g=0,e,k,h,l=new WALK.Timer,r=function(u){h=u;g=u-d.exposure;k=Math.sign(g);g=Math.abs(g);e=g/1};this.adaptExposure=function(){if(f&&d.autoExposure){l.reset();var u=c.measureReflectedLuma();0>u?g=0:(r(Math.log2(d.autoExposureDarkness/u)),.3>g&&(g=0))}};this.exposureNeedsUpdate=function(){return 0<g};var q=new THREE.Vector3(Infinity,Infinity,Infinity),m=function(){return function(){if(!f||!d.autoExposure){for(var u=a.cameraVolumes.length-
1;0<=u;--u){var n=a.cameraVolumes[u];if(n.worldCoordinatesInside(q)){r(n.exposure);d.setGamma(n.gamma);return}}r(d.defaultExposure);d.setGamma(d.defaultGamma)}}}();a.addEventListener("cameraVolumeAdded",function(u){u.cameraVolume.addEventListener("updated",m);m()});a.addEventListener("cameraVolumeShifted",m);a.addEventListener("cameraVolumeRemoved",function(u){u.cameraVolume.removeEventListener("cameraVolumeUpdated",m);m()});d.addEventListener("updated",m);this.update=function(u){var n=b.cameraWorldPosition();
q.equals(n)||(q.copy(n),m());this.exposureNeedsUpdate()&&(u=Math.min(e*u,g),g-=u,1E-5>g?(g=0,d.exposure=h):d.exposure+=u*k)};this.updateWithoutDelay=function(){this.update(1)};this.enableAutoExposure=function(){f=!0;g=0};this.disableAutoExposure=function(){f=!1;m()}}})();(function(){function a(b,c){for(var d=0,f=0,g=0;65536>g;++g){var e=4*g;e=b[e]+255*b[e+1];0!==e&&(f+=1,c[e]+=1,d=Math.max(d,e))}if(256>f)return-1;g=b=0;for(e=1;e<=d;++e)if(c[e]+b<.3*f)b+=c[e],c[e]=0;else break;for(e=d;0<=e;--e)if(c[e]+g<.1*f)g+=c[e],c[e]=0;else break;e=0;for(var k=1;k<=d;++k)e+=c[k]*Math.log(k/255),c[k]=0;return Math.exp(e/(f-b-g))}WALK.LumaMeter=function(b,c){function d(q){g||(console.assert(!g),g=b.createRenderTarget(256,256,{minFilter:GLC.NEAREST,magFilter:GLC.NEAREST,format:GLC.RGBA,
stencilBuffer:!1,generateMipmaps:!1}),e=new WALK.AutoClearAlter(b),k=new Uint8Array(262144),h=new Uint32Array(65280),l=new WALK.LumaMaterial(!0),r=new WALK.LumaMaterial(!1));q=q?l:r;e.set(!0,!0,!1);var m=c.gpuMeshes.filter(function(u){return!u.material.transparent});b.renderMeshes(m,q,f,g);b.readPixels(256,256,k);b.setRenderTarget(null);e.restore();return a(k,h)}var f=c.camera,g,e,k,h,l,r;this.measureIncidentLuma=function(){return d(!0)};this.measureReflectedLuma=function(){return d(!1)}}})();(function(){function a(){var b={uniforms:{inputBuffer:{type:"t",value:null},weight:{type:"f",value:1}},vertexShader:WALK.getShader("accumulate_vertex.glsl"),fragmentShader:WALK.getShader("accumulate_fragment.glsl")};b=new THREE.ShaderPass(b,"inputBuffer");b.material.depthTest=!1;b.material.depthWrite=!1;b.material.blending=THREE.CustomBlending;b.material.blendEquation=GLC.FUNC_ADD;b.material.blendDst=GLC.ONE_MINUS_SRC_ALPHA;b.material.blendSrc=GLC.SRC_ALPHA;return b}WALK.SsaaRenderer=function(b,c){var d,
f,g=0,e=[[.375,.4375],[.625,.0625],[.875,.1875],[.125,.0625],[.375,.6875],[.875,.4375],[.625,.5625],[.375,.9375],[.625,.3125],[.125,.5625],[.125,.8125],[.375,.1875],[.875,.9375],[.875,.6875],[.125,.3125],[.625,.8125]],k=new THREE.RenderPass(c.threeScene,c.camera),h=a(),l=new THREE.ShaderPass(THREE.CopyShader);l.renderToScreen=!0;var r=new WALK.AutoClearAlter(b);this.reset=function(){g=0};this.renderSample=function(){console.assert(g<e.length);r.set(!0,!0,!1);var q=f.width,m=f.height,u=e[g][0]-.5,
n=e[g][1]-.5,w=c.camera,v=q/m,y=Math.tan(.5*THREE.Math.degToRad(w.fov));y=w.near*y/w.zoom;var C=-y,A=C*v;v*=y;q=(v-A)/q;m=(y-C)/m;w.projectionMatrix.makeFrustum(A-u*q,v-u*q,C-n*m,y-n*m,w.near,w.far);k.render(b,d);r.restore();r.set(!1,!1,!1);h.uniforms.weight.value=1/(g+1);h.render(b,f,d);r.restore();c.camera.updateProjectionMatrix();g+=1};this.renderedSamplesCount=function(){return g};this.allSamplesRendered=function(){return g===e.length};this.renderAccumulatedSamplesToScreen=function(){r.set(!0,
!0,!1);l.render(b,void 0,f);r.restore()};this.copyAccumulatedSamplesToBuffer=function(){var q=f.width,m=f.height,u=new Uint8Array(q*m*4);b.readPixels(q,m,u);return u};this.setTargets=function(q,m){console.assert(q.width===m.width&&q.height===m.height);d=q;f=m};this.dispose=function(){h.material.dispose()}}})();(function(){function a(b){return b.split("\n").map(function(c,d){return d+1+": "+c}).join("\n")}WALK.createWebGLShader=function(b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);var f=!1===b.getShaderParameter(c,b.COMPILE_STATUS);f&&console.error("Shader failed to compile.");if(f||WALK.LOG_INFO)b=b.getShaderInfoLog(c),""!==b&&console.warn("Shader info log: ",b,a(d));return c}})();(function(){WALK.WebGLState=function(a,b){var c=Array(16).fill(0),d=Array(16).fill(null),f=c.map(function(){return 0}),g=null,e=null,k=null,h=null,l=null,r=null,q=null,m=null,u=null,n=null,w=null,v=null,y=null,C=null,A=null,I=null;this.resetAttributeStates=function(){for(var D=0,E=c.length;D<E;D++)c[D]=0};this.disableAttributeStates=function(){for(var D=0,E=c.length;D<E;D++)a.disableVertexAttribArray(D),c[D]=0};this.enableAttributeArray=function(D){2!==c[D]&&(a.enableVertexAttribArray(D),c[D]=2)};
this.disableAttributeArray=function(D,E){1!==c[D]&&(a.disableVertexAttribArray(D),c[D]=1);d[D]!==E&&(2===E.length?a.vertexAttrib2fv(D,E):3===E.length?a.vertexAttrib3fv(D,E):4===E.length&&a.vertexAttrib4fv(D,E),d[D]=E)};this.resetAttributeDivisors=function(){for(var D=0,E=f.length;D<E;D++)f[D]&&(b.vertexAttribDivisorANGLE(D,0),f[D]=0)};this.setAttributeDivisor=function(D,E){b.vertexAttribDivisorANGLE(D,E);f[D]=E};this.setBlending=function(D){var E=D.blending;E!==g&&(E===THREE.NoBlending?a.disable(a.BLEND):
E===THREE.AdditiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):E===THREE.SubtractiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):E===THREE.MultiplyBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):E===THREE.CustomBlending?a.enable(a.BLEND):(a.enable(a.BLEND),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,
a.ONE_MINUS_SRC_ALPHA)),g=E);if(E===THREE.CustomBlending){E=D.blendEquation;var O=D.blendEquationAlpha||E,S=D.blendSrc,W=D.blendDst,U=D.blendSrcAlpha||S;D=D.blendDstAlpha||W;if(E!==e||O!==l)a.blendEquationSeparate(E,O),e=E,l=O;if(S!==k||W!==h||U!==r||D!==q)a.blendFuncSeparate(S,W,U,D),k=S,h=W,r=U,q=D}else q=r=l=h=k=e=null};this.setDepthTest=function(D){m!==D&&(D?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),m=D)};this.setDepthWrite=function(D){u!==D&&(a.depthMask(D),u=D)};this.setColorWrite=function(D){n!==
D&&(a.colorMask(D,D,D,D),n=D)};this.setDoubleSided=function(D){w!==D&&(D?a.disable(a.CULL_FACE):a.enable(a.CULL_FACE),w=D)};this.setFlipSided=function(D){v!==D&&(D?a.frontFace(a.CW):a.frontFace(a.CCW),v=D)};this.setViewport=function(D,E,O,S){if(y!==D||C!==E||A!==O||I!==S)a.viewport(D,E,O,S),y=D,C=E,A=O,I=S}}})();(function(){function a(d,f){var g=f.index0AttributeName,e=d.createProgram(),k=WALK.createWebGLShader(d,d.VERTEX_SHADER,f.generateVertexShader()),h=WALK.createWebGLShader(d,d.FRAGMENT_SHADER,f.generateFragmentShader());d.attachShader(e,k);d.attachShader(e,h);void 0!==g&&d.bindAttribLocation(e,0,g);d.linkProgram(e);g=d.getProgramInfoLog(e);!1===d.getProgramParameter(e,d.LINK_STATUS)&&console.error("Shader link error: "+d.getError(),"validate status: ",d.getProgramParameter(e,d.VALIDATE_STATUS));""!==
g&&"\x00"!==g&&console.warn("program info log: "+g);d.deleteShader(k);d.deleteShader(h);k={};h=0;for(g=b.length;h<g;h++){var l=b[h];k[l]=d.getUniformLocation(e,l)}this.transformUniformCache=k;k=f.uniforms;h={i:[],f:[],v2:[],v3:[],c:[],v4:[],m4:[],t:[]};var r;for(q in k)k.hasOwnProperty(q)&&(g=d.getUniformLocation(e,q))&&(l=k[q].type,console.assert(h.hasOwnProperty(l)),"i"===l||"f"===l||"t"===l?r=null:"v2"===l?r=[null,null]:"v3"===l||"c"===l?r=[null,null,null]:"v4"===l?r=[null,null,null,null]:"m4"===
l?r=null:console.assert(!1),h[l].push({id:q,value:r,location:g}));this.materialUniformCache=h;f=f.attributes;r={};var q=0;for(k=f.length;q<k;q++)h=f[q],r[h]=d.getAttribLocation(e,h);this.attributes=r;this.attributesKeys=Object.keys(this.attributes);this.id=c++;this.usedTimes=1;this.program=e;return this}var b="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition".split(" "),c=0;WALK.WebGLProgramStore=function(d){var f=new Map;this.assignProgramToMaterial=function(g){console.assert(g instanceof
WALK.BaseMaterial);var e=g.generateProgramId(),k=f[e];k?k.usedTimes++:(k=new a(d,g),f[e]=k);g.program&&this.resetProgramAssignment(g);g.program=k};this.resetProgramAssignment=function(g){var e=g.program;g.program=null;--e.usedTimes;if(0===e.usedTimes){for(var k in f)if(f.hasOwnProperty(k)&&f[k]===e){delete f[k];break}d.deleteProgram(e.program)}}}})();(function(){function a(){this.texture=null;this.locked=!1;this.usedCount=0}function b(c){for(var d=[],f=0;f<c;f+=1)d[f]=new a;return d}WALK.WebGLTextureSlotter=function(c){var d=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),f=b(d);this.setSlot=function(g,e){var k=g.__webglSlot;if(null!==k){var h=f[k];h.usedCount+=1;h.locked=h.locked||e;return!1}for(var l=Infinity,r=0;r<d;r+=1)h=f[r],!h.locked&&h.usedCount<l&&(l=h.usedCount,k=r);null===k&&(console.warn("Not enough texture units"),k=0);h=f[k];h.texture&&
(h.texture.__webglSlot=null);h.texture=g;h.usedCount=1;h.locked=e;g.__webglSlot=k;return!0};this.unlockAllSlots=function(){for(var g=0;g<d;g+=1)f[g].locked=!1};this.freeSlot=function(g){if(null!==g.__webglSlot){var e=f[g.__webglSlot];g.__webglSlot=null;e.texture=null;e.locked=!1;e.usedCount=0}}};WALK.WebGLTextureSlotterSequential=function(c){var d=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),f=0;this.setSlot=function(g,e){f===d&&(console.warn("Not enough texture units"),f=0);g.__webglSlot=f;e&&(f+=1);
return!0};this.unlockAllSlots=function(){f=0};this.freeSlot=function(g){g.__webglSlot=null}}})();(function(){function a(c,d){for(var f={HALF_FLOAT_OES:"OES_texture_half_float",COMPRESSED_RGB_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT3_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT5_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGB_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",
COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_ETC1_WEBGL:"WEBGL_compressed_texture_etc1",COMPRESSED_RGBA_ASTC_4x4_KHR:"WEBGL_compressed_texture_astc"},g=$jscomp.makeIterator(Object.entries(GLC)),e=g.next();!e.done;e=g.next()){var k=$jscomp.makeIterator(e.value);e=k.next().value;k=k.next().value;var h=f[e];void 0!==h?(h=d.extension(h))&&console.assert(h[e]===k):console.assert(c[e]===k)}}function b(c){return WALK.DETECTOR.disableTextureSlotReuse?new WALK.WebGLTextureSlotterSequential(c):
new WALK.WebGLTextureSlotter(c)}WALK.WebGLRenderer=function(c,d){function f(){ha=WALK.DETECTOR.instances;U=W=null;va=-1;qa=ta=null;F=new WALK.WebGLState(d,ha);J=new WALK.WebGLProgramStore(d);d.clearColor(0,0,0,1);d.clearDepth(1);d.clearStencil(0);d.enable(d.DEPTH_TEST);d.depthFunc(d.LEQUAL);d.frontFace(d.CCW);d.cullFace(d.BACK);d.enable(d.CULL_FACE);d.enable(d.BLEND);d.blendEquation(d.FUNC_ADD);d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);F.setViewport(0,0,c.width,c.height);d.clearColor(I.r,I.g,
I.b,D);d.pixelStorei(d.UNPACK_COLORSPACE_CONVERSION_WEBGL,d.NONE)}function g(K){K=K.target;K.removeEventListener("dispose",g);delete K.__webglInit;K=K.attributes;for(var R in K)if(K.hasOwnProperty(R)){var ka=K[R];void 0!==ka.buffer&&(d.deleteBuffer(ka.buffer),delete ka.buffer)}F.disableAttributeStates();ta=null}function e(K){K=K.target;K.removeEventListener("dispose",e);ea.freeSlot(K);K.__webglTexture&&(d.deleteTexture(K.__webglTexture),K.__webglTexture=null)}function k(K){K=K.target;K.removeEventListener("dispose",
k);ea.freeSlot(K);K.__webglTexture&&(d.deleteTexture(K.__webglTexture),K.__webglTexture=null);if(K.isCube)for(var R=0;6>R;R++)d.deleteFramebuffer(K.__webglFramebuffer[R]),d.deleteRenderbuffer(K.__webglRenderbuffer[R]);else d.deleteFramebuffer(K.__webglFramebuffer),d.deleteRenderbuffer(K.__webglRenderbuffer);K.__webglFramebuffer=null;K.__webglRenderbuffer=null}function h(K){K=K.target;K.removeEventListener("dispose",h);J.resetProgramAssignment(K)}function l(K,R,ka){var ba=ka.attributes,ja=R.attributes;
R=R.attributesKeys;ka=16*(ka.instanceId||0);for(var na=0,ra=R.length;na<ra;na++){var za=R[na],Da=ja[za];if(0<=Da){var ia=ba[za];if(void 0!==ia){za=ia.itemSize;var V=ia.glType;d.bindBuffer(d.ARRAY_BUFFER,ia.buffer);ia=ia.divisor||0;F.enableAttributeArray(Da);d.vertexAttribPointer(Da,za,V,!1,0,ka*ia);ha&&F.setAttributeDivisor(Da,ia)}else F.disableAttributeArray(Da,K.defaultAttributeValues[za])}}}function r(K,R){var ka=WALK.DETECTOR;d.texParameteri(K,d.TEXTURE_WRAP_S,R.wrapS);d.texParameteri(K,d.TEXTURE_WRAP_T,
R.wrapT);d.texParameteri(K,d.TEXTURE_MAG_FILTER,R.magFilter);d.texParameteri(K,d.TEXTURE_MIN_FILTER,R.minFilter);var ba=ka.extension("EXT_texture_filter_anisotropic");ba&&1<R.anisotropy&&d.texParameterf(K,ba.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(R.anisotropy,ka.maxAnisotropy))}function q(K,R){var ka=K.material,ba=R.material,ja=ka.program,na=ba.program;return ja&&na&&ja.id!==na.id?ja.id-na.id:ka.id-ba.id||K.id-R.id}function m(K,R){var ka=K.material.transparentRenderOrder-R.material.transparentRenderOrder;
return ka?ka:R.cameraDistance-K.cameraDistance||K.id-R.id}function u(K,R,ka){if(ka||!1!==K.visible){K instanceof THREE.Mesh&&(!1===K.frustumCulled||!0===Z.intersectsObject(K))&&((R||K.material).transparent?(!0===S.sortObjects&&(K.cameraDistance=Z.nearPlaneDistanceToCenter(K)),O.push(K)):E.push(K));for(var ba=0,ja=K.children.length;ba<ja;ba++)u(K.children[ba],R,ka)}}function n(K){F.setDoubleSided(K.side===THREE.DoubleSide);F.setFlipSided(K.side===THREE.BackSide)}function w(K){K.__webglTexture||(K.addEventListener("dispose",
e),K.__webglTexture=d.createTexture());d.activeTexture(d.TEXTURE0+K.__webglSlot);d.bindTexture(d.TEXTURE_2D,K.__webglTexture);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,K.flipY);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha);d.pixelStorei(d.UNPACK_ALIGNMENT,K.unpackAlignment);var R=K.image,ka=THREE.Math.isPowerOfTwo(R.width)&&THREE.Math.isPowerOfTwo(R.height),ba=K.format,ja=K.type;r(d.TEXTURE_2D,K);var na=K.mipmaps;if(K instanceof WALK.DataTexture)if(0<na.length&&ka){for(var ra=0,za=
na.length;ra<za;ra++)R=na[ra],d.texImage2D(d.TEXTURE_2D,ra,ba,R.width,R.height,0,ba,ja,R.data),K.releaseOnLoadedToGpu&&(R.data=null);K.generateMipmaps=!1}else d.texImage2D(d.TEXTURE_2D,0,ba,R.width,R.height,0,ba,ja,R.data),K.releaseOnLoadedToGpu&&(R.data=null);else if(K instanceof WALK.CompressedTexture)for(ra=0,za=na.length;ra<za;ra++)R=na[ra],K.format!==GLC.RGBA&&K.format!==GLC.RGB?d.compressedTexImage2D(d.TEXTURE_2D,ra,ba,R.width,R.height,0,R.data):d.texImage2D(d.TEXTURE_2D,ra,ba,R.width,R.height,
0,ba,ja,R.data),K.releaseOnLoadedToGpu&&(R.data=null);else if(0<na.length&&ka){ra=0;for(za=na.length;ra<za;ra++)R=na[ra],d.texImage2D(d.TEXTURE_2D,ra,ba,ba,ja,R);K.releaseOnLoadedToGpu&&(K.mipmaps=null);K.generateMipmaps=!1}else d.texImage2D(d.TEXTURE_2D,0,ba,ba,ja,K.image),K.releaseOnLoadedToGpu&&(K.image=null);K.generateMipmaps&&ka&&d.generateMipmap(d.TEXTURE_2D);K.needsUpdate=!1}function v(K){F.setBlending(K);F.setDepthTest(K.depthTest);F.setDepthWrite(K.depthWrite);F.setColorWrite(K.colorWrite)}
function y(K,R,ka){if(ka){var ba=ka;v(ba);n(ba)}for(var ja=0,na=K.length;ja<na;ja+=1){var ra=K[ja],za=ra.geometry,Da=ra.material;ka?ka.doNotOverrideSide&&Da&&n(Da):(ba=Da,v(ba),n(ba));Da=ba;if(!1!==Da.visible&&0!==za.vertexCnt){var ia=R;var V=Da;V.programNeedsUpdate&&(J.assignProgramToMaterial(V),V.addEventListener("dispose",h),V.programNeedsUpdate=!1);console.assert(!V.morphTargets);var xa=!1,Ea=!1;var Ia=V.program;var Qa=Ia.transformUniformCache;var L=V.uniforms;Ia.id!==W&&(d.useProgram(Ia.program),
W=Ia.id,Ea=xa=!0);V.id!==va&&(va=V.id,Ea=!0);if(xa||ia!==qa)d.uniformMatrix4fv(Qa.projectionMatrix,!1,ia.projectionMatrix.elements),ia!==qa&&(qa=ia),console.assert(V instanceof WALK.BaseMaterial),null!==Qa.cameraPosition&&(ma.setFromMatrixPosition(ia.matrixWorld),d.uniform3f(Qa.cameraPosition,ma.x,ma.y,ma.z)),null!==Qa.viewMatrix&&d.uniformMatrix4fv(Qa.viewMatrix,!1,ia.matrixWorldInverse.elements);V.refreshPerObjectUniforms&&V.refreshPerObjectUniforms(ra,L)&&(Ea=!0);if(Ea){var pa=Ia;Ea=L;xa=pa.materialUniformCache.i;
V=0;for(L=xa.length;V<L;V+=1){var ca=xa[V];var Aa=ca.id;var Ca=Ea[Aa].value;ca.value!==Ca&&(d.uniform1i(ca.location,Ca),ca.value=Ca)}xa=pa.materialUniformCache.f;V=0;for(L=xa.length;V<L;V+=1)ca=xa[V],Aa=ca.id,Ca=Ea[Aa].value,ca.value!==Ca&&(d.uniform1f(ca.location,Ca),ca.value=Ca);xa=pa.materialUniformCache.v2;V=0;for(L=xa.length;V<L;V+=1){ca=xa[V];Aa=ca.id;Ca=Ea[Aa].value;var Oa=Ca.x;var Ma=Ca.y;if(ca.value[0]!==Oa||ca.value[1]!==Ma)d.uniform2f(ca.location,Oa,Ma),ca.value[0]=Oa,ca.value[1]=Ma}xa=
pa.materialUniformCache.v3;V=0;for(L=xa.length;V<L;V+=1)if(ca=xa[V],Aa=ca.id,Ca=Ea[Aa].value,Oa=Ca.x,Ma=Ca.y,Aa=Ca.z,ca.value[0]!==Oa||ca.value[1]!==Ma||ca.value[2]!==Aa)d.uniform3f(ca.location,Oa,Ma,Aa),ca.value[0]=Oa,ca.value[1]=Ma,ca.value[2]=Aa;xa=pa.materialUniformCache.c;V=0;for(L=xa.length;V<L;V+=1)if(ca=xa[V],Aa=ca.id,Ca=Ea[Aa].value,Oa=Ca.r,Ma=Ca.g,Aa=Ca.b,ca.value[0]!==Oa||ca.value[1]!==Ma||ca.value[2]!==Aa)d.uniform3f(ca.location,Oa,Ma,Aa),ca.value[0]=Oa,ca.value[1]=Ma,ca.value[2]=Aa;xa=
pa.materialUniformCache.v4;V=0;for(L=xa.length;V<L;V+=1)if(ca=xa[V],Aa=ca.id,Ca=Ea[Aa].value,Oa=Ca.x,Ma=Ca.y,Aa=Ca.z,Ca=Ca.w,ca.value[0]!==Oa||ca.value[1]!==Ma||ca.value[2]!==Aa||ca.value[3]!==Ca)d.uniform4f(ca.location,Oa,Ma,Aa,Ca),ca.value[0]=Oa,ca.value[1]=Ma,ca.value[2]=Aa,ca.value[3]=Ca;xa=pa.materialUniformCache.m4;V=0;for(L=xa.length;V<L;V+=1)ca=xa[V],Aa=ca.id,d.uniformMatrix4fv(location,!1,Ea[Aa].value.elements);xa=pa.materialUniformCache.t;V=0;for(L=xa.length;V<L;V+=1)if(ca=xa[V],Aa=ca.id,
Ma=Ea[Aa].value,Aa=ea.setSlot(Ma,!0),pa=Ma.__webglSlot,ca.value!==pa&&(d.uniform1i(ca.location,pa),ca.value=pa),Aa||Ma.needsUpdate)if(Ma.isCube){if(ca=Ma,d.activeTexture(d.TEXTURE0+ca.__webglSlot),d.bindTexture(d.TEXTURE_CUBE_MAP,ca.__webglTexture),ca.needsUpdate){d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,ca.flipY);pa=ca instanceof WALK.CompressedTexture;Aa=ca.image;Ma=ca.format;Oa=ca.type;r(d.TEXTURE_CUBE_MAP,ca);for(Ca=0;6>Ca;Ca++)if(pa)for(var $a=Aa[Ca].mipmaps,cb=0,wb=$a.length;cb<wb;cb++){var xb=$a[cb];
ca.format!==GLC.RGBA&&ca.format!==GLC.RGB?d.compressedTexImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,cb,Ma,xb.width,xb.height,0,xb.data):d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,cb,Ma,xb.width,xb.height,0,Ma,Oa,xb.data);ca.releaseOnLoadedToGpu&&(xb.data=null)}else d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,0,Ma,Ma,Oa,Aa[Ca]),ca.releaseOnLoadedToGpu&&(Aa[Ca]=null);ca.generateMipmaps&&d.generateMipmap(d.TEXTURE_CUBE_MAP);ca.needsUpdate=!1}}else ca=Ma,ca.needsUpdate?w(ca):(d.activeTexture(d.TEXTURE0+
ca.__webglSlot),d.bindTexture(d.TEXTURE_2D,ca.__webglTexture));ea.unlockAllSlots()}L=ia;ia=Qa;ra.matrixWorld?(Q.multiplyMatrices(L.matrixWorldInverse,ra.matrixWorld),L=Q):L=L.matrixWorldInverse;d.uniformMatrix4fv(ia.modelViewMatrix,!1,L.elements);ia.normalMatrix&&(fa.getNormalMatrix(L),d.uniformMatrix3fv(ia.normalMatrix,!1,fa.elements));null!==Qa.modelMatrix&&(ra.matrixWorld?d.uniformMatrix4fv(Qa.modelMatrix,!1,ra.matrixWorld.elements):d.uniformMatrix4fv(Qa.modelMatrix,!1,ya));ia=Ia;L=!1;if(za.id!==
ta||ia.id!==W)ta=za.id,L=!0;console.assert(ra instanceof THREE.Mesh);ra=d.TRIANGLES;(V=za.attributes.index)?(Ia=V.glType,Qa=za.indexUint?4:2,L&&(l(Da,ia,za),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,V.buffer)),void 0!==za.indexOffset?(Da=za.indexCnt,Qa*=za.indexOffset):(Da=V.length,Qa=0),za.isInstanced?ha.drawElementsInstancedANGLE(ra,Da,Ia,Qa,za.instanceCount):d.drawElements(ra,Da,Ia,Qa)):(L&&l(Da,ia,za),Da=za.attributes.position,void 0!==za.vertexOffset?(Ia=za.vertexCnt,Da=za.vertexOffset):(Ia=Da.length/
Da.itemSize,Da=0),za.isInstanced?ha.drawArraysInstancedANGLE(ra,Da,Ia,za.instanceCount):d.drawArrays(ra,Da,Ia));ha&&F.resetAttributeDivisors()}}}function C(K,R){d.bindRenderbuffer(d.RENDERBUFFER,K);R.depthBuffer?(d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,R.width,R.height),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,K)):d.renderbufferStorage(d.RENDERBUFFER,d.RGBA4,R.width,R.height)}function A(K,R){R.addEventListener("dispose",k);R.__webglTexture=d.createTexture();
var ka=R.format,ba=R.type;ea.setSlot(R,!1);d.activeTexture(d.TEXTURE0+R.__webglSlot);if(K){d.bindTexture(d.TEXTURE_CUBE_MAP,R.__webglTexture);r(d.TEXTURE_CUBE_MAP,R);for(K=0;6>K;K++){R.__webglFramebuffer[K]=d.createFramebuffer();R.__webglRenderbuffer[K]=d.createRenderbuffer();d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,ka,R.width,R.height,0,ka,ba,null);var ja=d.TEXTURE_CUBE_MAP_POSITIVE_X+K,na=R.__webglTexture;d.bindFramebuffer(d.FRAMEBUFFER,R.__webglFramebuffer[K]);d.framebufferTexture2D(d.FRAMEBUFFER,
d.COLOR_ATTACHMENT0,ja,na,0);C(R.__webglRenderbuffer[K],R)}R.generateMipmaps&&d.generateMipmap(d.TEXTURE_CUBE_MAP)}else R.__webglFramebuffer=d.createFramebuffer(),R.__webglRenderbuffer=R.shareDepthFrom?R.shareDepthFrom.__webglRenderbuffer:d.createRenderbuffer(),d.bindTexture(d.TEXTURE_2D,R.__webglTexture),r(d.TEXTURE_2D,R),d.texImage2D(d.TEXTURE_2D,0,ka,R.width,R.height,0,ka,ba,null),ka=d.TEXTURE_2D,ba=R.__webglTexture,d.bindFramebuffer(d.FRAMEBUFFER,R.__webglFramebuffer),d.framebufferTexture2D(d.FRAMEBUFFER,
d.COLOR_ATTACHMENT0,ka,ba,0),R.shareDepthFrom?R.depthBuffer&&d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,R.__webglRenderbuffer):C(R.__webglRenderbuffer,R),R.generateMipmaps&&d.generateMipmap(d.TEXTURE_2D);d.bindRenderbuffer(d.RENDERBUFFER,null);d.bindFramebuffer(d.FRAMEBUFFER,null)}var I=new THREE.Color(0),D=0,E=[],O=[];this.domElement=c;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;var S=this,W,U,va,ta,qa,ha,
F,J,Z=new WALK.Frustum,M=new THREE.Matrix4,ma=new THREE.Vector3;f();a(d,WALK.DETECTOR);this.webGLContextRestored=function(){f()};this.context=d;this.state=F;var ea=b(d),ya=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setCanvasSize=function(K,R){c.width=K;c.height=R;null===U&&this.setViewport(0,0,K,R)};this.setViewport=function(K,R,ka,ba){F.setViewport(K,R,ka,ba)};this.setScissor=function(K,R,ka,ba){d.scissor(K,R,ka,ba)};this.enableScissorTest=function(K){K?d.enable(d.SCISSOR_TEST):d.disable(d.SCISSOR_TEST)};
this.setClearColor=function(K,R){I.copy(K);D=void 0!==R?R:1;d.clearColor(I.r,I.g,I.b,D)};this.getClearColor=function(){return I};this.getClearAlpha=function(){return D};this.clear=function(K,R,ka){var ba=0;K&&(ba|=d.COLOR_BUFFER_BIT);R&&(ba|=d.DEPTH_BUFFER_BIT);ka&&(ba|=d.STENCIL_BUFFER_BIT);d.clear(ba)};this.clearColor=function(){d.clear(d.COLOR_BUFFER_BIT)};this.clearDepth=function(){d.clear(d.DEPTH_BUFFER_BIT)};this.clearStencil=function(){d.clear(d.STENCIL_BUFFER_BIT)};var Q=new THREE.Matrix4,
fa=new THREE.Matrix3;this.setRenderTarget=function(K){if(K){var R=K.isCube?K.__webglFramebuffer[K.activeCubeFace]:K.__webglFramebuffer;var ka=K.x;var ba=K.y;var ja=K.width;K=K.height}else R=null,ba=ka=0,ja=c.width,K=c.height;R!==U&&(d.bindFramebuffer(d.FRAMEBUFFER,R),U=R);F.setViewport(ka,ba,ja,K)};this.render=function(K,R,ka,ba){this.renderMeshes(K.children,K.overrideMaterial,R,ka,ba)};this.renderMeshes=function(K,R,ka,ba,ja,na){ta=null;va=-1;qa=null;ka.matrixWorldInverse.getInverse(ka.matrixWorld);
M.multiplyMatrices(ka.projectionMatrix,ka.matrixWorldInverse);Z.setFromMatrix(M);E.length=0;O.length=0;na=void 0===na?!1:na;for(var ra=0;ra<K.length;ra+=1)u(K[ra],R,na);!0===S.sortObjects&&(E.sort(q),O.sort(m));this.setRenderTarget(ba);(this.autoClear||ja)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);y(E,ka,R);y(O,ka,R);ba&&ba.generateMipmaps&&(K=ea.setSlot(ba,!1),d.activeTexture(d.TEXTURE0+ba.__webglSlot),ba.isCube?(K&&d.bindTexture(d.TEXTURE_CUBE_MAP,ba.__webglTexture),
d.generateMipmap(d.TEXTURE_CUBE_MAP)):(K&&d.bindTexture(d.TEXTURE_2D,ba.__webglTexture),d.generateMipmap(d.TEXTURE_2D)));F.setDepthTest(!0);F.setDepthWrite(!0);F.setColorWrite(!0);F.resetAttributeStates()};this.uploadNewBuffers=function(K){var R=K.geometry;K=R.attributes;var ka=R.attributesKeys;void 0===R.__webglInit&&(R.__webglInit=!0,R.addEventListener("dispose",g));console.assert(R instanceof THREE.BufferGeometry);R=0;for(var ba=ka.length;R<ba;R+=1){var ja=ka[R],na=K[ja];ja="index"===ja?d.ELEMENT_ARRAY_BUFFER:
d.ARRAY_BUFFER;if(na.buffer)!0===na.needsUpdate&&console.assert(!1);else{na.buffer=d.createBuffer();d.bindBuffer(ja,na.buffer);var ra=na.array;WALK.DETECTOR.ios&&ja===d.ARRAY_BUFFER&&console.assert(0===na.itemSize*ra.BYTES_PER_ELEMENT%4);d.bufferData(ja,ra,d.STATIC_DRAW);ra instanceof Float32Array?na.glType=d.FLOAT:ra instanceof Int8Array?na.glType=d.BYTE:ra instanceof Int16Array?na.glType=d.SHORT:ra instanceof Uint16Array?na.glType=d.UNSIGNED_SHORT:ra instanceof Uint32Array?na.glType=d.UNSIGNED_INT:
console.assert(!1);na.releaseOnLoadedToGpu&&(na.array=null);na.needsUpdate=!1}}};this.uploadTexture=function(K){ea.setSlot(K,!1);w(K)};this.copyBufferToCubeFaceMip=function(K,R,ka,ba,ja){ea.setSlot(ja,!1);d.activeTexture(d.TEXTURE0+ja.__webglSlot);d.bindTexture(d.TEXTURE_CUBE_MAP,ja.__webglTexture);d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+ka,K,d.RGBA,R,R,0,d.RGBA,d.UNSIGNED_BYTE,ba)};this.createCubeTexture=function(K,R){var ka=new WALK.Texture;ka.isCube=!0;ka.minFilter=R?GLC.LINEAR_MIPMAP_NEAREST:
GLC.LINEAR;ka.generateMipmaps=!1;ka.needsUpdate=!1;ka.addEventListener("dispose",e);ka.__webglTexture=d.createTexture();ea.setSlot(ka,!1);d.activeTexture(d.TEXTURE0+ka.__webglSlot);d.bindTexture(d.TEXTURE_CUBE_MAP,ka.__webglTexture);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR);R?d.texParameteri(d.TEXTURE_CUBE_MAP,
d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_NEAREST):d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR);for(var ba=0;6>ba;ba+=1)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+ba,0,d.RGBA,K,K,0,d.RGBA,d.UNSIGNED_BYTE,null);R&&d.generateMipmap(d.TEXTURE_CUBE_MAP);return ka};this.createFrameBufferRenderTarget=function(K){return new WALK.WebGLRenderTargetVR(K)};this.createRenderTarget=function(K,R,ka){K=new WALK.WebGLRenderTarget(K,R,ka);A(!1,K);return K};this.createRenderTargetCube=function(K,R,
ka){K=new WALK.WebGLRenderTargetCube(K,R,ka);A(!0,K);return K};this.readPixels=function(K,R,ka){d.readPixels(0,0,K,R,d.RGBA,d.UNSIGNED_BYTE,ka)}}})();(function(){var a={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!1};WALK.createGlobalDetector=function(b){b=new WALK.Detector(b);b.reportToConsole();WALK.DETECTOR=b};WALK.createRenderer=function(b,c){void 0===c.alpha&&(c.alpha=!1);void 0===c.depth&&(c.depth=!0);void 0===c.stencil&&(c.stencil=!1);void 0===c.premultipliedAlpha&&(c.premultipliedAlpha=!0);void 0===c.antialias&&(c.antialias=!0);void 0===c.preserveDrawingBuffer&&(c.preserveDrawingBuffer=!1);
try{var d=b.getContext("webgl",c)||b.getContext("experimental-webgl",c)}catch(f){d=null}c=d;if(!c)return null;WALK.createGlobalDetector(c);return new WALK.WebGLRenderer(b,c)};WALK.createWebwalkRenderer=function(b){if(b=WALK.createRenderer(b,{antialias:!WALK.FORCE_FXAA}))b.autoClear=!0,b.autoClearColor=!1,b.autoClearDepth=!0,b.autoClearStencil=!1,b.sortObjects=!0;return b};WALK.Renderer=function(b,c,d,f){var g=null,e,k,h=d.camera,l=d.threeScene,r=function(){var q=new WALK.Frustum,m=new THREE.Matrix4;
return function(u){if(0!==d.mirrors.length){u.matrixWorldInverse.getInverse(u.matrixWorld);m.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse);q.setFromMatrix(m);for(var n=0;n<d.mirrors.length;n+=1){var w=d.mirrors[n];w.updateCameraPosition(u,q);w.inFrustum()&&w.render(b)}}}}();this.resize=function(q){if(!q){var m=window.innerWidth;var u=window.innerHeight;var n=m*window.devicePixelRatio;var w=u*window.devicePixelRatio;h.aspect=n/w;h.updateProjectionMatrix();b.setCanvasSize(n,w);b.domElement.style.width=
m+"px";b.domElement.style.height=u+"px";e&&(e.configureTarget(n,w,a),k.setTargets(e.renderTarget1,e.renderTarget2));g&&g.uniforms.resolution.value.set(1/n,1/w)}m=w;q?(q=n/2,n=70):(q=n,n=h.fov);u=q/m;for(w=0;w<d.mirrors.length;w+=1)d.mirrors[w].configure(q,m,u,n)};this.renderIdle=function(q,m){0===m&&(f.adaptExposure(),k&&k.reset());if(f.exposureNeedsUpdate())return this.renderToScreen(q,!1),!0;if(!k)return!1;k.renderSample();4<=k.renderedSamplesCount()&&k.renderAccumulatedSamplesToScreen();return!k.allSamplesRendered()};
this.renderToScreen=function(q,m){f.update(q);m?c.render(l,h.matrixWorld,r):(r(h),g?e.render(q):b.render(l,h))};this.enableAutoExposure=function(){f.enableAutoExposure()};this.disableAutoExposure=function(){f.disableAutoExposure()};(function(){if(WALK.DETECTOR.antialiasPostprocess){e=new THREE.EffectComposer(b);if(!WALK.DETECTOR.antialiasNative){WALK.log("using FXAA");b.autoClear=!1;g=new THREE.ShaderPass(THREE.FXAAShader);g.clear=!1;g.renderToScreen=!0;g.material.depthTest=!1;g.material.depthWrite=
!1;g.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight);var q=new THREE.RenderPass(l,h);e.addPass(q);e.addPass(g)}k=new WALK.SsaaRenderer(b,d)}})()}})();(function(){WALK.ScreenshotTaker=function(a,b,c){function d(){var q=(document.body.offsetWidth-document.body.offsetHeight*e)/2,m=q+"px";q=Math.max(q,0)+"px";k.style.width=q;h.style.width=q;l.style.left=m;l.style.right=m}function f(q,m,u,n){var w=new WALK.CubeCamera(b.camera.near,b.camera.far);w.rotateZ(m);w.position.copy(q);w.updateMatrixWorld();q=a.createRenderTargetCube(4096,4096,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(m=0;6>m;m+=1)q.activeCubeFace=
m,a.render(b.threeScene,w.sideCameras[m],q);w=a.createRenderTarget(u,n,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1});m={uniforms:{panoramaCube:{type:"t",value:null}},vertexShader:WALK.getShader("cube_to_equirect_vertex.glsl"),fragmentShader:WALK.getShader("cube_to_equirect_fragment.glsl")};m=new THREE.ShaderPass(m,"panoramaCube");m.render(a,w,q);m.dispose();q.dispose();q=new Uint8Array(u*n*4);a.readPixels(u,n,q);w.dispose();return q}function g(q,
m){var u=a.createRenderTarget(q,m,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1});q=a.createRenderTarget(q,m,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});m=new WALK.SsaaRenderer(a,b);for(m.setTargets(u,q);!m.allSamplesRendered();)m.renderSample();var n=m.copyAccumulatedSamplesToBuffer();u.dispose();q.dispose();m.dispose();return n}var e=null,k=null,h=null,l=null,r=new THREE.Vector3;
this.markArea=function(q){function m(n,w){n.style.zIndex=1;n.style.pointerEvents="none";n.style.position="absolute";n.style.top=0;n.style.bottom=0;n.style[w]=0;n.style.backgroundColor="rgba(0, 0, 0, 0.5)"}function u(n){n.style.zIndex=1;n.style.pointerEvents="none";n.style.position="absolute";n.style.boxSizing="border-box";n.style.top=0;n.style.bottom=0;n.style.border="4px solid rgba(35, 181, 233, 0.5)"}l||(k=document.createElement("div"),m(k,"left"),h=document.createElement("div"),m(h,"right"),l=
document.createElement("div"),u(l),document.body.appendChild(k),document.body.appendChild(h),document.body.appendChild(l),window.addEventListener("resize",d));e=q;d()};this.unmarkArea=function(){l&&(k.remove(),h.remove(),l.remove(),window.removeEventListener("resize",d),l=h=k=e=null)};this.screenToBuffer=function(q,m,u){return q?f(c.cameraWorldPosition(),c.getYawAngle(),m,u):g(m,u)};this.screenToDataUrl=function(q,m,u){q=this.screenToBuffer(q,m,u);for(var n=0;n<u;++n)for(var w=0;w<m;++w){var v=4*
(n*m+w);if(n<u/2)for(var y=4*((u-n-1)*m+w),C=0;3>C;++C){var A=q[v+C];q[v+C]=q[y+C];q[y+C]=A}q[v+3]=255}q=new Uint8ClampedArray(q);q=new ImageData(q,m,u);n=document.createElement("canvas");n.width=m;n.height=u;n.getContext("2d").putImageData(q,0,0);return n.toDataURL("image/jpeg")};this.screenToLocalImage=function(q,m,u){q=this.screenToDataUrl(q,m,u);navigator.msSaveOrOpenBlob?fetch(q).then(function(n){return n.blob()}).then(function(n){return navigator.msSaveOrOpenBlob(n,"screen.jpg")}):(m=document.createElement("a"),
document.body.appendChild(m),m.style.cssText="display: none",m.href=q,m.download="screenshot",m.click(),window.URL.revokeObjectURL(q),m.parentNode.removeChild(m))};this.coverToServer=function(q,m){var u=g(q,m);WALK.ajaxPost("screenshot?width="+q+"&height="+m,"application/binary",u)};this.panoramaToServer=function(q,m){q.position?r.fromArray(q.position):r.copy(c.cameraWorldPosition());var u=void 0!==q.width?q.width:8E3,n=void 0!==q.height?q.height:4E3,w=$jscomp,v=w.makeIterator;var y=Math.min(WALK.MAX_PANORAMA_SIZE,
WALK.DETECTOR.maxRenderBufferSize);if(u<=y&&n<=y)u=[u,n];else{var C=u/n;u=u>n?[y,Math.floor(y/C)]:[Math.floor(y*C),y]}n=v.call(w,u);u=n.next().value;n=n.next().value;w=void 0!==q.rotation?THREE.Math.degToRad(q.rotation):0;w=f(r,w,u,n);WALK.ajaxPost("panorama?width="+u+"&height="+n+"&name="+q.name,"application/binary",w,m,m)}}})();(function(){WALK.InteractionDispatcher=function(a,b,c,d,f,g,e,k){function h(D,E){D=D?f:d;for(var O=0;O<D.length;O+=1)if(D[O](E.object,E.point,E.distance))return!0;return!1}function l(){return b.findIntersectionAtPosition(0,0,!0,w)}function r(){h(!1,w)}function q(D,E,O){k&&k.reset();return b.findIntersectionAtPosition(D,E,!0,C)?h(O,C):!1}function m(D){k&&k.reset();D.action===WALK.GAMEPAD_ACTION.TRIGGER&&q(0,0,!1)}function u(D,E){for(var O=0;O<g.length&&!g[O](D,E);O+=1);}var n=!1,w=new WALK.RayIntersection,
v=null;k&&k.setGazeHandlers(l,r);var y=new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.INTERACTION_DISPATCHER);a=y.callbacks;var C=new WALK.RayIntersection,A=null,I=null;a.onPointerMove=function(D,E){console.assert(n);0!==g.length&&(A=D,I=E,c());return!1};a.onClick=function(D,E){return q(D,E,!1)};a.onDoubleClick=function(D,E){return q(D,E,!0)};e.addEventListener("actionActivated",m);this.handleHover=function(){if(n&&0!==g.length){var D=b.findObstacleMeshAtPosition(A,I);null===D?v&&(u(v,!1),v=
null):D!==v&&(v&&u(v,!1),u(D,!0),v=D)}};this.enable=function(){n=!0;y.enable();console.assert(null===v)};this.disable=function(){n=!1;null!==v&&(u(v,!1),v=null);y.disable()};this.dispose=function(){this.disable();e.removeEventListener("actionActivated",m)};this.enable()}})();(function(){function a(T,wa){return ra.renderIdle(T,wa)}function b(T,wa){wa&&zb.update();Ea.update(T);R.enableCollisions&&!wa&&za.handleCollisions(T);V&&V.handleHover();fa.update(T);Da&&Da.updateCameraHeight(T);ia&&ia.updateCameraHeight();wa&&!Ea.teleportingToPoint&&(ya.update(),K.requestFrame());Ia&&(wa&&!zb.hasGamepads()?Ia.update(T):Ia.reset());for(var Ha=$jscomp.makeIterator(na.getAnimatedMeshes()),Fa=Ha.next();!Fa.done;Fa=Ha.next())Fa.value.update(T,fa.cameraWorldPosition());Ha=!1;Fa=$jscomp.makeIterator(na.getAnimatedMaterials());
for(var la=Fa.next();!la.done;la=Fa.next())la=la.value,la.isPlaying&&(la.update(T),Ha=!0);Ha&&K.requestFrame();pa&&pa.update(T);da._update(T);ra.renderToScreen(T,wa);Aa&&Aa.animate()}function c(T){T.view&&(Da&&Da.disable(),V&&V.disable())}function d(T){!Da||Da.isEnabled()||ya.vrEnabled()||Da.enable();if(ia&&ya.vrEnabled())ia.onTeleportDone();T.view&&V&&V.enable();ya.vrEnabled()&&fa.hmdReset()}function f(){if("hidden"===document.visibilityState){if(na)for(var T=$jscomp.makeIterator(na.getAnimatedMaterials()),
wa=T.next();!wa.done;wa=T.next())wa.value.sleepAnimation()}else if("visible"===document.visibilityState&&na){T=$jscomp.makeIterator(na.getAnimatedMaterials());for(wa=T.next();!wa.done;wa=T.next())wa.value.wakeAnimation();K.requestFrame()}}function g(){WALK.DETECTOR.ios&&(document.documentElement.style.height=window.innerHeight+"px",0!==document.body.scrollTop&&window.scrollTo(0,0));ra.resize(ya.vrEnabled());K.requestFrame();eb.onResize()}function e(){return document.pointerLockElement===M||document.mozPointerLockElement===
M||document.webkitPointerLockElement===M}function k(){return document.fullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}function h(){if(e()){fa.mousePressLook=!1;eb.onPointerLockChange(!0);var T=WALK.urlHashContains("gazeinpointerlock");T?xb.enableMode():xb.disableMode();da.anchorsVisible=T}else fa.mousePressLook=!0,eb.onPointerLockChange(!1),xb.disableMode(),da.anchorsVisible=!0;Aa&&dat.GUI.toggleHide()}
function l(){if(k())eb.onFullScreenChange(!0),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary");else eb.onFullScreenChange(!1)}function r(){var T=document.body;return void 0!==document.fullscreenEnabled||void 0!==document.webkitFullscreenEnabled||void 0!==document.mozFullScreenEnabled||void 0!==document.msFullscreenEnabled?!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled):void 0!==T.mozRequestFullScreen||
void 0!==T.webkitRequestFullscreen||void 0!==T.msRequestFullscreen||void 0!==T.requestFullscreen}function q(T){ea.uploadNewBuffers(T);K&&K.requestFrame()}function m(T){ea.uploadTexture(T);T.isAtlas()?T.forEachAtlasEntry(function(wa){console.assert(null===wa.isCutout);Ca.isCutoutTexture(wa)}):null===T.isCutout&&Ca.isCutoutTexture(T);K&&K.requestFrame()}function u(T){T=[];var wa=[],Ha=[];T.push(da._clickListener);var Fa=da._createHoverListener();Fa&&Ha.push(Fa);xa=new WALK.ClickNavigator(za,fa,Ea);
wa.push(xa.onMeshClicked);ma||T.push(xa.onMeshClicked);V=new WALK.InteractionDispatcher(ka,za,function(){K.requestFrame()},T,wa,Ha,zb,Ia)}function n(){Da&&Da.disable();ia&&ia.enable();fa.mouseControlsPitch=!1;fa.hmdReset();Ea.onVrChange(!0);xb.enableMode();eb.onVrChange(!0);da._vrChange(!0);g()}function w(T){K.isEnabled()&&(T?n():(fa.resetRollAngle(),fa.resetPitchAngle(),fa.mouseControlsPitch=!0,console.assert(!ya.vrEnabled()),ia&&ia.disable(),Da&&Da.enable(),Ea.onVrChange(!1),xb.disableMode(),eb.onVrChange(!1),
da._vrChange(!1),g(),setTimeout(g,1E3)))}function v(T){ma||WALK.DETECTOR.mobile&&!WALK.ALLOW_MOBILE_VR||(WALK.DETECTOR.ios||WALK.DETECTOR.mobile&&WALK.DETECTOR.firefox)&&WALK.DETECTOR.inCrossOriginIframe||eb.setVrSupported(T)}function y(T,wa){if(ia&&null!==wa)ia.onHmdPositionUpdate(wa);fa.onHmdUpdate(T,wa)}function C(T,wa){T&&fa.cameraWorldPosition().set(T[0],T[1],T[2]);wa&&(T=new WALK.Euler,T.setFromDegTriple(wa),fa.setYawAngle(T.yaw),fa.setPitchAngle(T.pitch))}function A(T){for(var wa=0;wa<T.length;wa+=
1)if(!T[wa].lightProbe)return!1;return!0}function I(T,wa,Ha){za=new WALK.Collider(T,wa,Ha);wa.visitAllNodes(function(Fa){Fa.mesh&&za.addStaticObstacle(Fa.mesh)})}function D(){var T=THREE.Scene.prototype.add;THREE.Object3D.prototype.add=function(wa){wa instanceof THREE.Mesh&&ea.uploadNewBuffers(wa);T.call(this,wa)}}function E(T){var wa=WALK.urlHashGetArgument("view"),Ha=null;wa&&(Ha=T.findViewByName(wa));return Ha||T.views[0]}function O(T){function wa(){K.requestFrame()}na=T;na.adjustSkiesAndCameraFarToSpanWholeScene();
na.headLight=WALK.HEAD_LIGHT;na.addEventListener("updated",function(){return K.requestFrame()});na.addEventListener("anyViewUpdated",function(){return eb.refresh()});na.disableLightProbesForMaterials();fa.enable();na.threeScene.updateMatrixWorld(!0);ya.setCameraFar(na.camera.far);ra=new WALK.Renderer(ea,ya,na,ja);ka=new WALK.PointerEventDispatcher(ea.domElement,ma);((T=R.enableCollisions)||ma)&&I(ea,na,fa);Ea=new WALK.Teleport(na,fa,za,K);Ea.addEventListener("teleportStarted",c);Ea.addEventListener("teleportDone",
d);L=new WALK.AutoTour(na,Ea);T&&na.camera.autoClimb&&(Da=new WALK.StepsClimber(za,fa,K));T&&(ia=new WALK.VRHeightController(fa,za));Ea.switchToView(E(na),0);ja.updateWithoutDelay();Qa=new WALK.HashChangeTeleport(na,Ea);Oa=new WALK.ScreenshotTaker(ea,na,fa);T&&!WALK.urlHashContains("nogazeteleport")&&(Ia=new WALK.GazePointer(na,fa,wa,xb));da._sceneReadyToDisplay(ea,na,fa,Ea,L,za,Oa,ba,xb,ka,K);u(T);document.addEventListener("visibilitychange",f);window.addEventListener("resize",function(){WALK.DETECTOR.ios?
setTimeout(g,1E3):g()},!1);r()&&eb.setFullScreenSupported();WALK.DETECTOR.mobile||WALK.DETECTOR.opera||void 0===document.pointerLockElement&&void 0===document.mozPointerLockElement&&void 0===document.webkitPointerLockElement||eb.setPointerLockSupported();eb.sceneReadyToDisplay(na,Ea,L,Oa);g();WALK.DEBUG&&WALK.DebugUI&&(Aa=new WALK.DebugUI(na,fa,g,K));WALK.DETECTOR.ios||M.focus();WALK.DEBUG_SHARED_BUFFERS&&(na.threeScene.overrideMaterial=new WALK.DebugMaterial);na.startAutoTourOnLoad()&&L.start();
K.enable();ya.vrEnabled()&&n();wb=ca.elapsedLoadTimeSec()}function S(T){ma||WALK.urlHashContains("nostats")||0!==Ma||eb.cover.sendStats&&WALK.ajaxPost("./stats/"+T,null,null)}function W(T,wa){function Ha(La){function db(){Ua.delete(pb);null!==T.findLightProbe(pb.id)&&(wa.assignLightProbesToObjects(),wa.createLightProbeTexture(pb,!1),K.requestFrame())}var pb=La.target;La=Ua.get(pb);void 0===La&&(La=new WALK.DeferringExecutor(db,1E3),Ua.set(pb,La));La.deferRun()}function Fa(La){La=La.target;wa.createLightProbeTexture(La,
!0);if(!La.isBoundingBoxInitialized()){var db=La.boxMax;La.boxMin.copy(La.position).addScalar(-1);db.copy(La.position).addScalar(1);La.enableBoundingBox()}}function la(La){for(La=0;La<T.materials.length;La+=1)T.materials[La].forceObjectUniformsRefresh()}var Ua=new Map;T.addEventListener("lightProbeAdded",function(La){La=La.lightProbe;wa.assignLightProbesToObjects();wa.createLightProbeTexture(La,!0);La.isBoundingBoxInitialized()||La.disableBoundingBox();La.addEventListener("boundsInit",Fa);La.addEventListener("positionUpdated",
Ha);La.addEventListener("boundsUpdated",la)});T.addEventListener("lightProbeRemoved",function(){wa.assignLightProbesToObjects()});for(var Xa=0;Xa<T.lightProbes.length;Xa+=1)T.lightProbes[Xa].addEventListener("positionUpdated",Ha),T.lightProbes[Xa].addEventListener("boundsInit",Fa),T.lightProbes[Xa].addEventListener("boundsUpdated",la)}function U(T,wa,Ha){function Fa(Ua){if(Ua===T.length)Ha();else{var Xa=T[Ua],La=Xa.name;la.has(La)?Fa(Ua+1):(la.add(La),wa.panoramaToServer(Xa,function(){return Fa(Ua+
1)}))}}var la=new Set;Fa(0)}function va(T){function wa(){if(R.onSceneLoaded)R.onSceneLoaded(new WALK.EditorHooks(T,eb,fa,Ea,pa,Q,Oa,K));eb.sceneLoadComplete();for(var La=$jscomp.makeIterator(T.getAnimatedMaterials()),db=La.next();!db.done;db=La.next())db.value.play();da._sceneLoadComplete();K.requestFrame();La=ca.elapsedLoadTimeSec();S("loaded?readyToDisplayTime="+wb.toFixed(1)+"&loadTime="+La.toFixed(1));ca=null}var Ha=WALK.urlHashContains("headless");Ca.dispose();Ca=null;if(0<T.lightProbes.length||
ma){var Fa=new WALK.LightProbeMaker(T,ea,WALK.DETECTOR.textureLod,WALK.DETECTOR.mirrorCubeMaps,ma);0===T.lightProbes.length&&ma&&T.autoAddLightProbes&&WALK.arrangeLightProbes(T,Fa,Ha);if(0<T.lightProbes.length){A(T.gpuMeshes)||(console.warn("Some objects do not have light probes assigned, this is not optimal."),Fa.assignLightProbesToObjects());var la;for(la=0;la<T.views.length&&"orbit"===T.views[la].mode;la+=1);la===T.views.length&&(la=0);Ea.executeWithViewVisibilitySettings(T.views[la],function(){Fa.createAllLightProbeTextures()});
T.enableLightProbesForMaterials()}}T.hasLightMap()&&ra.enableAutoExposure();if(ma){Fa?W(T,Fa):console.warn("Cube maps support is required in the edit mode");la=new WALK.LightControls(T,K);var Ua=new WALK.LightProbeControls(T,K),Xa=new WALK.CameraVolumeControls(T,K);pa=new WALK.EditorSelector(ka,T,ea,za,la,Ua,Xa,K,fa);Oa.coverToServer(WALK.EDITOR_COVER_WIDTH,WALK.EDITOR_COVER_HEIGHT);C(R.forcedInitialCameraPosition,R.forcedInitialCameraRotation)}else Fa&&(Fa.dispose(),Fa=null);0<T.lights.length&&WALK.DETECTOR.dynamicLights&&
WALK.DYNAMIC_LIGHTS&&(la=new WALK.LightAssigner(ea,T.camera.far,T.lights,T.materials,T.logicalMeshes),la.assignLightLookupMaps(),la.dispose());ma&&Ha?U(ca.panoramas,Oa,wa):wa()}function ta(){$a&&($a=!1,ca.load(),eb.sceneLoadStarted(WALK.urlHashContains("help")),S("play"))}function qa(T){eb.updateCover(T);Q.updateConfig(T.extensions||[]);ma||Q.startExtensions();da._viewerConfigLoaded(T);Ca=new WALK.CutoutTextureDetector(ea);$a=!0;T=new WALK.Scene(fa.camera());ca=new WALK.SceneLoader(T,R.assetsUrl,
ma,P);ba=new WALK.LumaMeter(ea,T);ja=new WALK.ExposureController(T,fa,ba);ca.onProgress=eb.loadProgress;ca.onTextureLoaded=m;ca.onMeshBuffersLoaded=q;ca.onReadyToDisplay=O;ca.onComplete=va;WALK.urlHashContains("autoplay")||cb||0<Ma?ta():WALK.urlHashContains("hideplay")||eb.enablePlayButton(ta)}function ha(T){T.preventDefault();Ma+=1;K.disable();!ma&&null===ca&&Ma<=WALK.CONTEXT_LOST_RESTORE_LIMIT?(Q.stopExtensions(),da._contextLost(),Qa.dispose(),Qa=null,V.dispose(),V=null,xa&&(xa.dispose(),xa=null),
eb.contextLost()):WALK.USER_MSG.error("Graphics context lost, reload to retry.")}function F(T){T.preventDefault();!ma&&null===ca&&Ma<=WALK.CONTEXT_LOST_RESTORE_LIMIT&&(WALK.USER_MSG.info("Graphics context switched, reloading the scene to use the new context.",5E3),WALK.createGlobalDetector(ea.context),ea.webGLContextRestored(),qa(eb.cover))}function J(){WALK.ajaxGet(WALK.COVER_JSON_URL,!1,qa,function(){WALK.USER_MSG.error("Failed to initialize the scene.")})}function Z(T){D();R=T;if(ea=WALK.createWebwalkRenderer(M))if(WALK.DETECTOR.missingCapabilities)WALK.USER_MSG.error(WALK.DETECTOR.missingCapabilities);
else{M.addEventListener("webglcontextlost",ha,!1);M.addEventListener("webglcontextrestored",F,!1);eb.init();Q=new WALK.ExtensionsManager;T=null;try{WALK.urlHashContains("vrlo")?WebXRConfig.cardboardConfig.BUFFER_SCALE*=.5:WALK.urlHashContains("vrhi")&&(WebXRConfig.cardboardConfig.BUFFER_SCALE*=1.5),T=new WebXRPolyfill(WebXRConfig)}catch(wa){WALK.log("Failed to initialize WebXR polyfill")}ya=new WALK.VRManager(ea,zb,T,v,y,function(wa){wa?K.disable():K.enable()},w);K=new WALK.AnimationController(ya,
b,a);K.disable();T=new WALK.Camera;fa=new WALK.Controls(T,M,zb,K);fa.mousePressLook=!0;WALK.urlHashContains("flipmouse")&&(fa.flipMouseLook=!0);fa.disable();J();WALK.getExtraAssetUrl=function(wa){return wa.startsWith("extra-assets/")?R.assetsUrl+wa:R.assetsUrl+"extra-assets/"+wa}}else WALK.USER_MSG.error(window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a> or your browser has WebGL disabled.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>':
'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a>.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>')}var M=$("walk-canvas"),ma=WALK.EDIT_MODE,ea,ya,Q,fa,K,R,ka,ba,ja,na,ra,za,Da,ia,V,xa,Ea,Ia,Qa,L,pa,ca=null,Aa=null,Ca,Oa,Ma=0,$a=!1,cb=!1,wb,xb=new WALK.GazeModeObserver;var zb=new WALK.GamepadManager;var eb=new WALK.Menu(ma,zb,function(){ya.vrEnabled()?ya.disableVr():(L.isRunning()&&
L.stop(),ya.enableVr(ea.context))},function(){if(k())k()&&(document.exitFullScreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,document.exitFullScreen&&document.exitFullScreen());else{var T=document.body;(T.mozRequestFullScreen||T.webkitRequestFullscreen||T.msRequestFullscreen||T.requestFullscreen).call(T);document.addEventListener("fullscreenchange",l,!1);document.addEventListener("mozfullscreenchange",l,!1);document.addEventListener("webkitfullscreenchange",
l,!1);document.addEventListener("MSFullscreenChange",l,!1)}},function(){e()?e()&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()):(M.requestPointerLock=M.requestPointerLock||M.mozRequestPointerLock||M.webkitRequestPointerLock,M.requestPointerLock(),document.addEventListener("pointerlockchange",h,!1),document.addEventListener("mozpointerlockchange",h,!1),document.addEventListener("webkitpointerlockchange",
h,!1))});var P=new WALK.MergeConfig;ma&&P.setAllMaterialsEditable();var da=new WALK.Viewer(ma,eb,P);var Ba={FontAwesomeSolid:"\uf2b9",FontAwesomeRegular:"\uf2b9",FontAwesomeBrands:"\uf293"};WALK.loadFontFamilies=function(T,wa){var Ha={};T.forEach(function(Fa){console.assert(Ba[Fa],"Font "+JSON.stringify(Fa)+" is not supported.");Ha[Fa]=Ba[Fa]});WebFont.load({custom:{families:T,testStrings:Ha},active:wa,fontinactive:function(Fa){console.error("Cannot load font: "+Fa);WALK.USER_MSG.info("Cannot load required fonts.")}})};
WALK.getViewerAssetUrl=function(){var T=function(){for(var wa=document.getElementsByTagName("script"),Ha=0;Ha<wa.length;++Ha){var Fa=wa[Ha].src.match(/^(.*\/)walk(\.min)?\.js$/);if(Fa)return Fa[1]}console.error("Cannot determine webwalk URL.");return"/webwalk/"}();return function(wa){return T+wa}}();WALK.initEditMode=function(T){var wa=document.createElement("base");wa.target="_blank";document.head.appendChild(wa);WALK.loadFontFamilies(Object.keys(Ba),function(){Z(T)})};WALK.init=function(T){ma||
Z(T)};WALK.play=function(){$a?ta():cb=!0};WALK.getViewer=function(){return da};WALK.Extensions={}})();(function(){WALK.ExtensionsManager=function(){this.extensionTypes=WALK.Extensions};WALK.ExtensionsManager.prototype={constructor:WALK.ExtensionsManager,updateConfig:function(a){this.extensions=[];a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this._createExtensionFromConfig(b.value)},_createExtensionFromConfig:function(a){function b(f,g){return f.some(function(e){return e.name===g&&e.config.type===a.type})}a.name=a.name.toString();for(var c=a.name,d=2;b(this.extensions,a.name);)a.name=
c+d.toString(),d+=1;c=new this.extensionTypes[a.type](a);this.extensions.push(c);return c},startExtensions:function(){var a=this;this._loadFontAwesomeIfNeeded(function(){for(var b=0;b<a.extensions.length;b+=1)a.extensions[b].start()})},_loadFontAwesomeIfNeeded:function(a){var b=this,c=this.extensions.map(function(d){return b._getFonts(d.config)}).concat(WALK.FONT_FAMILIES_TO_LOAD).reduce(function(d,f){return d.concat(f)},[]).filter(function(d,f,g){return f===g.indexOf(d)});0<c.length&&!WALK.EDIT_MODE?
WALK.loadFontFamilies(c,a):a()},_getFonts:function(a){return this.extensionTypes[a.type].definition.properties.map(function(b){return"trigger"===b.type&&a[b.id]&&a[b.id].icon&&WALK.ICONS[a[b.id].icon].fontFamily}).filter(function(b){return b})},stopExtensions:function(){for(var a=0;a<this.extensions.length;a+=1)this.extensions[a].stop()},getEditableExtensionDefinitions:function(){for(var a=[],b=$jscomp.makeIterator(Object.entries(this.extensionTypes||{})),c=b.next();!c.done;c=b.next()){var d=$jscomp.makeIterator(c.value);
c=d.next().value;d=d.next().value;d.definition.hideFromEditor||a.push({type:c,definition:d.definition})}return a},getEditableExtensions:function(){for(var a=[],b=$jscomp.makeIterator(this.extensions),c=b.next();!c.done;c=b.next())c=c.value,c.definition.hideFromEditor||a.push(c);return a},addExtension:function(a){a=this._createExtensionFromConfig(a);a.start();return a},removeExtension:function(a){a.stop();for(var b=0;b<this.extensions.length;b+=1)if(this.extensions[b]===a){this.extensions.splice(b,
1);break}},getConfig:function(){return this.extensions.map(function(a){return a.config})}}})();(function(){function a(){}function b(d,f){var g=new THREE.Vector3,e=new THREE.Vector3;if("node"!==f.type){g.fromArray(f.position);var k=f.radius}else k=WALK.Extensions.MaterialPicker.VR_RADIUS;this.getPosition=function(h){"node"===f.type&&(e.copy(d.getCameraPosition()),e.sub(h),e.normalize().multiplyScalar(k),g.copy(h).add(e));return g};this.getRadius=function(){return k}}var c={"\uf2b9":"address-book","\uf2bb":"address-card","\uf1fe":"area-chart","\uf047":"arrows","\uf062":"arrow-up","\uf063":"arrow-down",
"\uf2a2":"assistive-listening-systems","\uf069":"asterisk","\uf29e":"audio-description","\uf1fa":"at","\uf0c9":"bars","\uf0f3":"bell","\uf02d":"book","\uf02e":"bookmark","\uf0a1":"bullhorn","\uf1ec":"calculator","\uf030":"camera","\uf080":"chart-bar","\uf200":"chart-pie","\uf0c2":"cloud","\uf013":"cog","\uf075":"comment","\uf14e":"compass","\uf09d":"credit-card","\uf05b":"crosshairs","\uf019":"download","\uf0e0":"envelope","\uf08e":"external-link","\uf06e":"eye","\uf1fb":"eye-dropper","\uf008":"film",
"\uf024":"flag","\uf07b":"folder","\uf06b":"gift","\uf025":"headphones","\uf015":"home","\uf03e":"image","\uf090":"sign-in","\uf129":"info","\uf0eb":"lightbulb","\uf0d0":"magic","\uf076":"magnet","\uf041":"map-marker","\uf276":"map-pin","\uf277":"map-signs","\uf1fc":"paint-brush","\uf040":"pencil","\uf095":"phone","\uf128":"question","\uf064":"share","\uf1e0":"share-alt","\uf07a":"shopping-cart","\uf1de":"sliders","\uf005":"star","\uf0e4":"tachometer","\uf02b":"tag","\uf03d":"video","\uf0ad":"wrench",
"\uf04b":"play","\uf16a":"youtube","\uf27d":"vimeo","\uf09a":"facebook","\uf099":"twitter","\uf16d":"instagram"};WALK.Extension=function(d){function f(h){return g.definition.properties.some(function(l){return l.id===h})}var g=this;this.triggers=[];var e=[];this.definition=this.constructor.definition;this.viewerApi=WALK.getViewer();this.running=!1;var k=[];this.config=WALK.readOnlyCopy(function(h){h=WALK.cloneObject(h);if(void 0!==h.anchor&&void 0===h.trigger&&!f("anchor")&&f("trigger")){var l=h.anchor;
l.icon&&l.icon.font&&(l.icon=c[l.icon.value]);h.trigger=l;h.anchor=void 0}l=$jscomp.makeIterator(g.definition.properties);for(var r=l.next();!r.done;r=l.next())r=r.value,void 0===h[r.id]&&void 0!==r.defaultValue&&(h[r.id]=r.defaultValue);return h}(d));Object.defineProperty(this,"name",{get:function(){return this.config.name}});this.cloneConfig=function(){return WALK.cloneObject(this.config)};this.updateConfig=function(h){this.stop();this.config=WALK.readOnlyCopy(h);this.start()};this.doStop=this.doStart=
a;this.start=function(){this.running||(this.doStart(),this.running=!0)};this.stop=function(){if(this.running){this.doStop();for(var h=$jscomp.makeIterator(e),l=h.next();!l.done;l=h.next())this.viewerApi.removeAnchor(l.value);h=$jscomp.makeIterator(k);for(l=h.next();!l.done;l=h.next())l=l.value,this.viewerApi.removeOnNodeTypeClicked(l[0],l[1]);k.length=0;this.triggers.length=0;e.length=0;this.running=!1}};this._vrChanged=function(h){h&&!this.definition.vrCompatible?this.stop():h||this.definition.vrCompatible||
this.start()};this.addTrigger=function(h,l){function r(q,m,u){l(q,m,u);return!0}"node"===h.type?(h=h.nodeType,k.push([h,r]),this.viewerApi.onNodeTypeClicked(h,r),this.triggers.push.apply(this.triggers,$jscomp.arrayFromIterable(this.viewerApi.findNodesOfType(h)))):(h=this.viewerApi.addAnchor(h,l),h.extension=this,e.push(h),this.triggers.push(h))};this.viewerApi.onVrChange(this._vrChanged.bind(this))};WALK.Extensions.HtmlLabel=function(d){function f(g){if(g instanceof HTMLVideoElement||g instanceof
HTMLIFrameElement)return!0;g=$jscomp.makeIterator(g.children);for(var e=g.next();!e.done;e=g.next())if(f(e.value))return!0;return!1}WALK.Extension.call(this,d);this.id=WALK.Extensions.HtmlLabel.nextId;++WALK.Extensions.HtmlLabel.nextId;this.toggleDisplay=function(){var g=this,e=g.viewerApi,k=document.getElementById("ext-html-label"),h=k.dataset.id===this.id.toString(),l=void 0!==k.dataset.animatedMaterialsSleeping,r=k.querySelector("#ext-html-label-content");h?(k.style.display="none",delete k.dataset.id,
r.innerHTML="",l&&(e.wakeAnimatedMaterials(),delete k.dataset.animatedMaterialsSleeping)):(void 0===k.dataset.id&&(k.style.display=""),k.dataset.id=this.id,r.innerHTML=this.config.content,f(r)?l||(e.sleepAnimatedMaterials(),k.dataset.animatedMaterialsSleeping=""):l&&(e.wakeAnimatedMaterials(),delete k.dataset.animatedMaterialsSleeping),k.querySelector("#ext-html-label-close").onclick=function(){g.toggleDisplay()})};this.doStart=function(){var g=this;g.viewerApi.onSceneReadyToDisplay(function(){g.addTrigger(g.config.trigger,
function(){g.toggleDisplay()})})};this.doStop=function(){this.display&&this.toggleDisplay()}};WALK.Extensions.HtmlLabel.definition={name:"HTML label",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"content",type:"textArea",label:"Content",optional:"true",defaultValue:"Content to display..."}],vrCompatible:!1};WALK.Extensions.HtmlLabel.nextId=0;WALK.Extensions.Audio=function(d){function f(){u?r.pause():r.play()}function g(){var n=e.config;n.trigger&&e.addTrigger(n.trigger,f);n.menuButton&&
(q=k.addMenuButton(l.src),q.addEventListener("click",f),m=k.getMenuButtonIcon(q));n.autoplay&&f()}d.url&&!d.file&&(d.file={file:d.url.split("/").pop(),url:d.url},delete d.url);d.file.path&&d.file.url&&delete d.file.url;WALK.Extension.call(this,d);var e=this,k=this.viewerApi,h=null,l=null,r=null,q=null,m=null,u=!1;this.doStart=function(){WALK.log("Audio start");this.config.menuButton&&!h&&(h=WALK.preloadImage(k.getViewerAssetUrl("img/audio-on.svg")),l=WALK.preloadImage(k.getViewerAssetUrl("img/audio-off.svg")));
r=document.createElement("audio");this.config.file&&(this.config.file.path?r.src=WALK.getExtraAssetUrl(this.config.file.path):this.config.file.url&&(r.src=this.config.file.url));r.src&&(r.loop=this.config.loop,r.addEventListener("play",function(){u=!0;m&&(m.src=h.src)}),r.addEventListener("pause",function(){u=!1;m&&(m.src=l.src)}),document.body.appendChild(r),k.onSceneReadyToDisplay(g))};this.doStop=function(){WALK.log("Audio stop");u=!1;q&&(this.viewerApi.removeMenuButton(q),m=q=null);r.pause();
r.remove();r=null}};WALK.Extensions.Audio.definition={name:"Audio",properties:[{id:"file",type:"file",label:"File",fileType:"audio"},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!1},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"menuButton",type:"bool",label:"Show menu button",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.MaterialPicker=function(d){function f(){return(l.config.toReplace?[l.config.toReplace]:[]).concat(l.config.toPick||
[])}function g(u){l.viewerApi.apiUserChangeState(m,u.name)}function e(u,n){console.assert(u===m);if(u=l.viewerApi.findMaterial(n))for(n=0;n<r.length;n+=1)l.viewerApi.setMaterialForMesh(u,r[n])}function k(u,n,w){u=f().map(function(v){return l.viewerApi.findMaterial(v)});l.viewerApi.openMaterialPicker(u,g,q.getPosition(n),q.getRadius())}function h(){l.addTrigger(l.config.trigger,k);r=l.viewerApi.findMeshesWithMaterial(l.config.toReplace||[])}WALK.Extension.call(this,d);var l=this,r=[],q=new b(l.viewerApi,
l.config.trigger),m="MaterialPicker:"+this.name;this.config.materials&&(d=WALK.cloneObject(this.config),0<d.materials.length&&(d.toReplace=d.materials[0],d.toPick=d.materials.slice(1)),d.materials=void 0,this.config=WALK.readOnlyCopy(d));l.viewerApi.isSceneReadyToDisplay()||f().map(function(u){l.viewerApi.setMaterialEditable(u)});this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(h);this.viewerApi.onApiUserStateChanged(m,e)};this.doStop=function(){var u=l.viewerApi.findMaterial(l.config.toReplace);
u&&g(u);this.viewerApi.removeOnApiUserStateChanged(m,e)}};WALK.Extensions.MaterialPicker.VR_RADIUS=.07;WALK.Extensions.MaterialPicker.definition={name:"Material picker",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"toReplace",type:"material",label:"Material to replace"},{id:"toPick",type:"list",elementType:"material",label:"Materials to pick"}],vrCompatible:!0};WALK.Extensions.MaterialComboPicker=function(d){function f(){for(var y=new Set,C=$jscomp.makeIterator(v),A=C.next();!A.done;A=
C.next()){A=$jscomp.makeIterator(A.value);for(var I=A.next();!I.done;I=A.next())I=I.value,y.add(I.toReplace),y.add(I.toUse)}return y}function g(){for(var y=[v[0][0].toReplace],C=$jscomp.makeIterator(v),A=C.next();!A.done;A=C.next())y.push(A.value[0].toUse);return y}function e(){for(var y=0;y<v.length;++y)for(var C=0;C<v[y].length;++C)for(var A=w.findMaterial(v[y][C].toReplace),I=$jscomp.makeIterator(m[y][C]),D=I.next();!D.done;D=I.next())w.setMaterialForMesh(A,D.value)}function k(y,C){w.apiUserChangeState(n,
C)}function h(y,C){console.assert(y===n);e();if(0!==C)for(y=C-1,C=0;C<v[y].length;++C){var A=w.findMaterial(v[y][C].toUse);if(A)for(var I=$jscomp.makeIterator(m[y][C]),D=I.next();!D.done;D=I.next())w.setMaterialForMesh(A,D.value)}}function l(y,C,A){y=g().map(function(I){return w.findMaterial(I)});w.openMaterialPicker(y,k,u.getPosition(C),u.getRadius())}function r(){q.addTrigger(q.config.trigger,l);for(var y=0;y<v.length;++y){m[y]=[];for(var C=$jscomp.makeIterator(v[y]),A=C.next();!A.done;A=C.next())m[y].push(w.findMeshesWithMaterial(A.value.toReplace))}}
WALK.Extension.call(this,d);var q=this,m=[],u=new b(q.viewerApi,q.config.trigger),n="MaterialComboPicker:"+this.name,w=this.viewerApi,v=q.config.options;w.isSceneReadyToDisplay()||f().forEach(function(y){w.setMaterialEditable(y)});this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(r);this.viewerApi.onApiUserStateChanged(n,h)};this.doStop=function(){e();this.viewerApi.removeOnApiUserStateChanged(n,h)}};WALK.Extensions.MaterialComboPicker.definition={name:"Material combo picker",hideFromEditor:!0,
properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"options",type:"list",label:"Options",elementType:{type:"list",label:"option",elementType:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toUse",type:"material",label:"Material to use"}]}}],vrCompatible:!0};WALK.Extensions.VideoTextureControl=function(d){function f(){h.isPlaying?h.pause():h.play()}function g(){var l=h.baseColorTexture,r=k.config;l.loop=r.loop;if(!r.autoplay)l.pause(),l.muted=r.muted;else if(!r.muted)k.viewerApi.onPageFirstInteraction(function(){l.muted=
!1});r.trigger&&k.addTrigger(r.trigger,f)}function e(){var l=k.config;(h=k.viewerApi.findMaterial(l.material))?h.baseColorTexture&&h.baseColorTexture instanceof WALK.VideoTexture?h.baseColorTexture.addLoadedListener(g):(console.error("Material '"+l.material+"' for video texture control '"+(l.name+"' does not have a video texture")),h=null):console.error("Material '"+l.material+"' for video texture control '"+(l.name+"' does not exist"))}WALK.Extension.call(this,d);var k=this,h=null;this.viewerApi.isSceneReadyToDisplay()||
this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){this.viewerApi.onSceneLoadComplete(e)};this.doStop=function(){h&&(h.baseColorTexture.muted=!0,h.pause(),h=null)}};WALK.Extensions.VideoTextureControl.definition={name:"Video texture control",properties:[{id:"material",type:"material",label:"Material with video"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},
{id:"muted",type:"bool",label:"Muted",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.OpenWebsite=function(d){function f(){g.viewerApi.openUrl(g.config.url,g.config.newWindow)}WALK.Extension.call(this,d);var g=this;this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(function(){g.addTrigger(g.config.trigger,f)})}};WALK.Extensions.OpenWebsite.definition={name:"Open URL",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"url",type:"text",label:"URL"},{id:"newWindow",type:"bool",
label:"New window",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.ChangeView=function(d){function f(){g.viewerApi.switchToView(g.config.views[e],void 0,g.config.doNotMoveCamera);e=(e+1)%g.config.views.length}WALK.Extension.call(this,d);var g=this,e=0;this.doStart=function(){var k=this.viewerApi;e=0;k.onSceneReadyToDisplay(function(){g.addTrigger(g.config.trigger,f)})}};WALK.Extensions.ChangeView.definition={name:"Change view",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"views",
type:"list",elementType:"view",label:"Views to toggle"},{id:"doNotMoveCamera",type:"bool",label:"Do not move camera",defaultValue:!1}],vrCompatible:!0};WALK.Extensions.HideAnchors=function(d){function f(){k.anchorsVisible=!k.anchorsVisible}function g(m){q.src=m?h.src:l.src}WALK.Extension.call(this,d);var e=this,k=e.viewerApi,h=WALK.preloadImage(k.getViewerAssetUrl("img/anchors-on.svg")),l=WALK.preloadImage(k.getViewerAssetUrl("img/anchors-off.svg")),r=null,q=null;this.doStart=function(){k=e.viewerApi;
k.onAnchorsVisibilityChanged(g);r=k.addMenuButton(h.src);q=k.getMenuButtonIcon(r);r.addEventListener("click",f);var m=e.config;k.onSceneReadyToDisplay(function(){return k.anchorsVisible=m.visibleOnStart})};this.doStop=function(){k.removeAnchorsVisibilityChangedListener(g);k.removeMenuButton(r);q=r=null;k.anchorsVisible=!0}};WALK.Extensions.HideAnchors.definition={name:"Hide triggers",properties:[{id:"visibleOnStart",type:"bool",label:"Visible on start",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.Script=
function(d){function f(){try{(new Function('"use strict"; '+g.config.code))()}catch(e){console.error("Script extension error: "+e)}}WALK.Extension.call(this,d);var g=this;this.doStart=function(){var e=this;if(this.config.trigger)this.viewerApi.onSceneReadyToDisplay(function(){return e.addTrigger(e.config.trigger,f)});else f()}};WALK.Extensions.Script.definition={name:"Script",properties:[{id:"code",type:"textArea",label:"Code",defaultValue:"\x3c!-- Put your JavaScript code here. If a trigger is set, the code is executed when the trigger is clicked. Otherwise the code is executed when a page is loaded --\x3e"},
{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.ProjectionScreen=function(d){function f(){var v=w.getVideoTexture1();u.baseColorTexture=v?v:n}function g(){WALK.log("Presentation stop");w&&(w.uuid===m.myUuid&&m.stopShareScreen(),w.removeEventListener("dispose",g),w.removeEventListener("avatarUpdated",f));w=null;u.baseColorTexture=n;r.triggers[0].material.highlightMix=0}function e(){var v=m.myUuid;w&&w.getVideoTexture1()?w.uuid===v&&(WALK.log("Requesting presentation stop"),
r.viewerApi.apiUserChangeState(q,null)):(WALK.log("Requesting scren share "+v),m.startShareScreen(function(){r.viewerApi.apiUserChangeState(q,v)},function(){r.viewerApi.apiUserChangeState(q,null)},function(){}))}function k(v,y){console.assert(v===q);y?(w&&w.uuid!==y&&(WALK.log("Changing presenting user"),g()),w||(WALK.log("New presenting user "+y),(w=r.viewerApi.findAvatar(y)||null)?(w.addEventListener("dispose",g),w.addEventListener("avatarUpdated",f),v=r.triggers[0].material,v.highlight=w.getMainMaterial().baseColor,
v.setUniforms(),v.highlightMix=.7,f()):console.log("Cannot attach presentation stream of a user "+y+" The user was not found."))):g()}function h(){k(q,r.viewerApi.getApiUserState(q))}function l(v){var y=r.config;(u=r.viewerApi.findMaterial(y.material))?(m=v,n=u.baseColorTexture,r.addTrigger(y.trigger,e),r.viewerApi.onApiUserStateChanged(q,k),r.viewerApi._onAvatarListChanged(h)):(console.error("Material for a projection screen is missing"),u=null)}WALK.Extension.call(this,d);var r=this,q="ProjectionScreen:"+
this.name,m=null,u=null,n=null,w=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){this.viewerApi._onMeetingJoined(l)};this.doStop=function(){this.viewerApi._removeOnMeetingJoined(l);m&&(this.viewerApi.removeOnApiUserStateChanged(q,k),this.viewerApi._removeOnAvatarListChanged(h));u=m=null}};WALK.Extensions.ProjectionScreen.definition={name:"Meeting projection screen",properties:[{id:"material",type:"material",label:"Material to project on"},
{id:"trigger",type:"trigger",label:"Trigger"}],vrCompatible:!0};WALK.Extensions.SwitchObjects=function(d){function f(){if(0!==g.config.nodeTypes.length){for(var r=$jscomp.makeIterator(h),q=r.next();!q.done;q=r.next())q.value.hide();k+=1;if(k===g.config.nodeTypes.length){if(g.config.hideAllAfterLast){k=-1;h.length=0;e.requestFrame();return}k=0}h=e.findNodesOfType(g.config.nodeTypes[k]);r=$jscomp.makeIterator(h);for(q=r.next();!q.done;q=r.next())q.value.show();e.requestFrame()}}WALK.Extension.call(this,
d);var g=this,e=this.viewerApi,k,h;if(!e.isSceneReadyToDisplay()){d=$jscomp.makeIterator(this.config.nodeTypes);for(var l=d.next();!l.done;l=d.next())e.setNodeTypeEditable(l.value)}this.doStart=function(){var r=this;e.onSceneReadyToDisplay(function(){for(var q=0;q<r.config.nodeTypes.length;++q)if(0<q||r.config.hideAllOnStart){var m=e.findNodesOfType(r.config.nodeTypes[q]),u=$jscomp.makeIterator(m);for(m=u.next();!m.done;m=u.next())m.value.hide()}if(0<r.config.nodeTypes.length&&!r.config.hideAllOnStart)for(k=
0,h=e.findNodesOfType(r.config.nodeTypes[0]),q=$jscomp.makeIterator(h),m=q.next();!m.done;m=q.next())m.value.show();else k=-1,h=[];r.addTrigger(r.config.trigger,f);e.requestFrame()})};this.doStop=function(){for(var r=0;r<this.config.nodeTypes.length;++r)if(r!==k){var q=e.findNodesOfType(this.config.nodeTypes[r]);q=$jscomp.makeIterator(q);for(var m=q.next();!m.done;m=q.next())m.value.show()}e.requestFrame()}};WALK.Extensions.SwitchObjects.definition={name:"Switch objects",properties:[{id:"trigger",
type:"trigger",label:"Trigger"},{id:"nodeTypes",type:"list",elementType:"nodeType",label:"Objects to switch"},{id:"hideAllOnStart",type:"bool",label:"Hide all on start",defaultValue:!1},{id:"hideAllAfterLast",type:"bool",label:" Hide all after last",defaultValue:!1}],vrCompatible:!0}})();(function(){function a(){if(WALK.isLocalhost())return"http://cloud.localhost:5001";var F=window.location.hostname;return F.endsWith(".shapespark.com")?"https://cloud"+F.substr(F.indexOf(".")):F.endsWith(".shapespark.com.cn")?"https://cloud.shapespark.com.cn":"https://cloud.shapespark.com"}function b(F){F=new Date(F);var J=new Date;return J.getDate()===F.getDate()&&J.getMonth()===F.getMonth()&&J.getFullYear()===F.getFullYear()?F.toLocaleTimeString():F.toLocaleDateString()+" "+F.toLocaleTimeString()}
function c(F,J){document.getElementById(F).onclick=J}function d(F,J){F.style.display=J?"":"none"}function f(F,J){J?F.classList.add("ext-meeting-button-highlight"):F.classList.remove("ext-meeting-button-highlight")}function g(F){F.classList.add("ext-meeting-input-missing");window.setTimeout(function(){F.classList.remove("ext-meeting-input-missing")},200)}function e(F,J,Z,M){var ma=document.createElement("li");ma.classList.add("ext-meeting-list-entry");var ea=ma.appendChild(document.createElement("span"));
ea.classList.add("ext-meeting-list-name");ea.innerText=F;ea.style.color=Z;M&&(ma.onclick=M,ma.style.cursor="pointer");J&&(ma.appendChild(document.createElement("br")),F=ma.appendChild(document.createElement("small")),F.innerText=J,F.style.color="white");return ma}function k(F,J,Z){return{color:"#0775e8",icon:"edit",opacity:1,position:[F,J,Z],radius:.07,type:"sphere"}}function h(F){var J=null;this.showDismiss=!0;this.onDismiss=this.onClose=null;this.foremost=this.top=!1;this.open=function(){var Z=
this;null===J&&(J=document.createElement("div"),document.body.appendChild(J),J.innerHTML='\n       <div class="ext-popup '+(this.top?"ui-top ui-center":"ui-all-center")+" "+(this.foremost?"ui-foremost":"")+'">\n         <div class="ext-popup-content">\n           '+F+"\n         </div>"+(this.showDismiss?'<div class="ext-popup-close-button-panel ui-close-hoverable">\n           <div class="ext-popup-close-button"></div>\n         </div>':"")+"\n       </div>",this.showDismiss&&(J.getElementsByClassName("ext-popup-close-button")[0].onclick=
function(){return Z.dismiss()}))};this.dismiss=function(){if(null!==J&&(this.close(),this.onDismiss))this.onDismiss()};this.close=function(){if(null!==J&&(document.body.removeChild(J),J=null,this.onClose))this.onClose()}}function l(F,J){J=J.attach();F=F.createTextureFromHtmlVideo(J);F.play();return F}function r(F){F.detach().forEach(function(J){return J.remove()})}function q(F){return F&&F.isStarted&&F.isEnabled&&!F.isStopped}function m(F,J){this._viewer=F;this._uuid=J;F=parseInt(J.substring(2));
this._color=qa[F%qa.length];this._twilioParticipant=this._avatar=this._displayName=null}function u(F,J,Z){m.call(this,F,J);this._displayName=Z;this._setUpAvatar();this._avatar.hideBody();this._dataTrack=new Twilio.Video.LocalDataTrack({name:"data",maxPacketLifeTime:1E3});this._isCreatingCameraTrack=this._isCreatingMicTrack=!1;this._lastPosition=this._screenTrack=this._cameraTrack=this._micTrack=null;this._positionMessage=[J,Z,null];this._onCameraTrackStateChanged=this._onMicTrackStateChanged=this._resendInterval=
null}function n(F,J,Z){m.call(this,F,J);this._onUiRefreshNeeded=Z;this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=this._micTrackStateChangedBound=this._screenTrack=this._cameraTrack=this._micTrack=this._dataTrack=null;this._trackSubscribedBound=this._trackSubscribed.bind(this);this._trackUnsubscribedBound=this._trackUnsubscribed.bind(this);this._disposed=!1}function w(F,J,Z,M,ma,ea){var ya=new PubNub({publishKey:J.publishKey,subscribeKey:J.subscribeKey,authKey:J.authKey,uuid:F.uuid,ssl:!0}),
Q=J.channel;ya.subscribe({channels:[Q],withPresence:!0});ya.addListener({message:function(fa){WALK.log("listener received message",fa);"SceneState"===fa.message.type&&ma(fa.message.state)},presence:function(fa){fa.uuid!==F.uuid&&(WALK.log("listener presence event",fa),"join"===fa.action?Z(fa.uuid):"leave"===fa.action&&M(fa.uuid))},status:function(fa){"PNAccessDeniedCategory"!==fa.category&&"PNNetworkIssuesCategory"!==fa.category&&"PNNetworkDownCategory"!==fa.category&&"PNTimeoutCategory"!==fa.category||
ea(fa.category)}});ya.hereNow({channels:[Q],includeUUIDs:!0,includeState:!0},function(fa,K){WALK.log("herenow",fa,K);K.channels[Q].occupants.forEach(function(R){R.uuid!==F.uuid&&Z(R.uuid)})});this.dispose=function(){ya.unsubscribeAll()}}function v(F,J,Z,M,ma,ea,ya){function Q(za){var Da=za.identity.match(/^u-\d+/);Da=Da&&Da[0];return Da?Da:(WALK.warn("Unknown participant",za.identity),null)}function fa(za){WALK.log('Participant "%s" connected',za.identity);var Da=Q(za);Da&&Z(Da,za)}function K(za){WALK.log('Participant "%s" disconnected',
za.identity);var Da=Q(za);Da&&M(Da,za)}var R=J.avToken,ka=J.channel,ba=["NotAllowedError","NotFoundError","NotReadableError","OverconstrainedError","TypeError"],ja=null,na=!1,ra=0;this.isConnected=function(){return na};this.disconnect=function(){na=!1;ja.disconnect();F.disconnectedFromTwilio()};this.dispose=function(){this.disconnect()};this.connect=function(){console.assert(!na);na=!0;WALK.log('Connecting to room "%s"',ka);Twilio.Video.connect(R,{name:ka,tracks:F.getAllTracks()}).then(function(za){ja=
za;WALK.log("Connected to room");ja.participants.forEach(fa);ja.on("participantConnected",fa);ja.on("participantDisconnected",K);ja.on("reconnecting",function(Da){ra+=1});ja.on("reconnected",function(Da){ra=0});ja.once("disconnected",function(Da){na&&(ja.participants.forEach(K),F.disconnectedFromTwilio(),0<ra?ea("TDisconnected"+Da.code):ya())});F.connectedToTwilio(ja.localParticipant)}).catch(function(za){ba.includes(za.name)?ma(za):ea("T"+za.code)})}}function y(F,J){function Z(ya,Q){var fa=document.createElement("span");
fa.classList.add("ext-meeting-list-name");fa.innerText=ya;fa.style.color=Q;return fa}function M(ya){var Q=document.createElement("span");Q.classList.add("ext-meeting-list-mic-indicator");ya?Q.classList.add("fa-microphone"):Q.classList.add("fa-microphone-slash");return Q}var ma=document.getElementById("ext-meeting-status"),ea=document.getElementById("ext-meeting-who-list");this.update=function(ya){for(;ea.firstChild;)ea.removeChild(ea.firstChild);var Q=ea.appendChild,fa=document.createElement("li");
fa.classList.add("ext-meeting-list-entry");fa.appendChild(Z(F.displayName+" (me)",F.color));var K=q(F.micTrack);fa.appendChild(M(K));Q.call(ea,fa);ya=$jscomp.makeIterator(Object.values(ya));for(Q=ya.next();!Q.done;Q=ya.next())if(K=Q.value,K.hasDisplayName){Q=ea;fa=Q.appendChild;var R=document.createElement("li");R.classList.add("ext-meeting-list-entry");var ka=Z(K.displayName,K.color);ka.onclick=K.seeAvatar.bind(K);ka.style.cursor="pointer";R.appendChild(ka);R.appendChild(M(K.micTrack&&K.micTrack.isEnabled));
fa.call(Q,R)}};this.show=function(){ma.style.display=""};this.hide=function(){ma.style.display="none"};this.update([]);this.show()}function C(F){return'\n      <div>\n        <textarea id="ext-meeting-note-text"\n          class="ext-meeeting-note-edit"\n          placeholder="'+F+'"></textarea>\n      </div>\n      <button id="ext-meeting-note-publish"\n        class="ext-meeting-button ext-meeting-right">\n        Publish\n      </button>\n    '}function A(F,J){var Z="extMtg:"+F+":";this.getTimeStampOfLastReadEntry=
function(M){return localStorage.getItem(Z+":"+M.id)||-1};this.isNoteRead=function(M){return M.entries[M.entries.length-1].ts<=this.getTimeStampOfLastReadEntry(M)};this.markNoteAsRead=function(M){localStorage.setItem(Z+":"+M.id,M.entries[M.entries.length-1].ts)}}function I(F,J,Z,M,ma){function ea(za){if(za===J.displayName)return J.color;for(var Da=$jscomp.makeIterator(Object.values(Z)),ia=Da.next();!ia.done;ia=Da.next())if(ia=ia.value,ia.displayName===za)return ia.color;return"#ffffff"}function ya(){K=
!1;M.show();ta.style.cursor="default";R.dismiss();ka.close()}function Q(za,Da){function ia(Qa,L){if(!K){ja&&ja.close();Ia.classList.remove("ext-meeting-note-list-unread");Ia.classList.add("ext-meeting-note-list-selected");L&&Ia.scrollIntoView();Qa.material.highlightMix=.7;F.requestFrame();L="";for(var pa=new Map,ca=ma.getTimeStampOfLastReadEntry(za),Aa=0;Aa<za.entries.length;++Aa){var Ca=za.entries[Aa],Oa="ext-meeting-note-text"+Aa,Ma="ext-meeting-note-author"+Aa,$a="ext-meeting-note-entry";Ca.ts>
ca&&($a+=" ext-meeting-note-unread");L+='<div class="'+$a+'">\n            <strong id="'+Ma+'"\n                style="color: '+ea(Ca.author)+'">\n            </strong> <span>'+b(Ca.ts)+'</span>\n            <div id="'+Oa+'">\n            </div>\n          </div>';pa.set(Oa,Ca.text);pa.set(Ma,Ca.author)}ja=new h(L+C("Type your response"));ja.top=!0;ja.onClose=function(){ma.markNoteAsRead(za);Ia.classList.remove("ext-meeting-note-list-selected");Qa.material.highlightMix=0;F.requestFrame();ja=null};
ja.open();pa.forEach(function(cb,wb){document.getElementById(wb).innerText=cb});c("ext-meeting-note-publish",function(){var cb=document.getElementById("ext-meeting-note-text"),wb=cb.value.trim();wb?(za.entries.push({author:J.displayName,text:wb,ts:Date.now()}),F.apiUserChangeState("MeetingNotes",ba),ia(Qa,!0)):g(cb)})}}var V=F.addAnchor(k(za.x,za.y,za.z,"#0775e8"),function(Qa){return ia(Qa,!0)});V.material.highlight=va;V.material.setUniforms();fa.push(V);var xa=za.entries[za.entries.length-1],Ea=
xa.author;var Ia=e(Ea,b(xa.ts),ea(Ea),function(){F.seeItem(V);ia(V,!1)});ma.isNoteRead(za)||Ia.classList.add("ext-meeting-note-list-unread");Da.appendChild(Ia)}var fa=[],K=!1,R=new h("\n      <h2>\n        Click a place to leave a note there.\n      </h2>");R.top=!0;var ka=new h(C("Type your note"));ka.top=!0;var ba=F.getApiUserState().MeetingNotes||[],ja=null;c("ext-meeting-add-note",function(){K=!0;M.hide();ta.style.cursor="pointer";ja&&ja.close();F.onNodeTypeClicked(ra);R.onDismiss=function(){F.removeOnNodeTypeClicked(ra);
ya()};R.open()});var na=new THREE.Vector3;var ra=function(za,Da,ia){ta.style.cursor="default";na.copy(Da);WALK.movePointTowards(na,F.getCameraPosition(),.1);F.removeOnNodeTypeClicked(ra);var V=F.addAnchor(k(na.x,na.y,na.z));V.material.highlight=va;V.material.setUniforms();V.material.highlightMix=.7;R.close();ka.onClose=function(){F.removeAnchor(V);ya()};ka.open();c("ext-meeting-note-publish",function(){var xa=document.getElementById("ext-meeting-note-text"),Ea=xa.value.trim();Ea?(xa=Date.now(),Ea=
{id:J.displayName+":"+xa,entries:[{author:J.displayName,text:Ea,ts:Date.now()}],x:na.x,y:na.y,z:na.z},ba.push(Ea),ma.markNoteAsRead(Ea),F.apiUserChangeState("MeetingNotes",ba)):g(xa)});return!0};F.onApiUserStateChanged("MeetingNotes",function(za,Da){console.assert("MeetingNotes"===za);ba=Da.sort(function(V,xa){var Ea=ma.isNoteRead(V),Ia=ma.isNoteRead(xa);return Ea!==Ia?Ea?-1:1:V.entries[V.entries.length-1].ts-xa.entries[xa.entries.length-1].ts});ya();za=$jscomp.makeIterator(fa);for(Da=za.next();!Da.done;Da=
za.next())F.removeAnchor(Da.value);fa.length=0;for(za=document.getElementById("ext-meeting-note-list");za.firstChild;)za.removeChild(za.firstChild);ja&&ja.close();Da=$jscomp.makeIterator(ba);for(var ia=Da.next();!ia.done;ia=Da.next())Q(ia.value,za),za.lastChild.scrollIntoView()})}function D(F,J){function Z(){Q=ya=null;ea.pointerX=null;ea.pointerY=null;ea.pointerZ=null;F._enableControls()}function M(){ea.isEnabled()?(ta.style.cursor="default",Z(),K.disable(),fa.close(),J.show()):(ta.style.cursor="pointer",
fa.open(),K.enable(),fa.onDismiss=M,J.hide())}var ma=this,ea=this,ya=null,Q=null,fa=new h("\n      <h2>\n        Point a place by clicking.\n      </h2>");fa.top=!0;var K=F._createPointerEventHelper(0);K.disable();this.pointerZ=this.pointerY=this.pointerX=null;this.isEnabled=function(){return K.isEnabled()};this.showPointer=function(){return null!==this.pointerX};F.onBeforeRender(function(){if(null!==ya){var R=F._findIntersectionAtPosition(ya,Q);Infinity!==R.distance&&(ma.pointerX=R.point.x,ma.pointerY=
R.point.y,ma.pointerZ=R.point.z)}});K.callbacks.onPointerDown=function(R,ka){ya=R;Q=ka;F._disableControls();F.requestFrame();return!0};K.callbacks.onPointerMove=function(R,ka){if(null===ya)return!1;ya=R;Q=ka;F.requestFrame();return!0};K.callbacks.onPointerUp=function(){Z();F.requestFrame();return!0};c("ext-meeting-pointer",function(){M()})}function E(){var F=[0,0,0,0,0],J=[0,0,0,0,0,0,0,0],Z=null,M=!1;this.newUpdateWithPointer=function(){M=!1;Z!==J&&(M=!0,Z=J)};this.newUpdateNoPointer=function(){M=
!1;Z!==F&&(M=!0,Z=F)};this.set=function(ma,ea){Z[ma]!==ea&&(Z[ma]=ea,M=!0)};this.getFilledArray=function(){return M?Z:null}}function O(){var F=document.getElementById("ext-meeting-mic-toggle"),J=document.getElementById("ext-meeting-camera-toggle"),Z=document.getElementById("ext-meeting-camera-preview"),M=null;this.refreshMicControls=function(ma){q(ma)?(f(F,!1),d(F.children[0],!0),d(F.children[1],!1)):(f(F,!0),d(F.children[0],!1),d(F.children[1],!0))};this.refreshCameraControls=function(ma){q(ma)?
(M||(M=ma.attach(),Z.appendChild(M)),Z.style.display="",f(J,!1),d(J.children[0],!0),d(J.children[1],!1)):(M&&(ma.detach(),M.remove(),M=null),Z.style.display="none",f(J,!0),d(J.children[0],!1),d(J.children[1],!0))};this.setToggleButtonHandlers=function(ma,ea){F.onclick=ma;J.onclick=ea}}function S(F,J,Z,M){function ma(ca){WALK.USER_MSG.error("Connection lost. Reload the page to rejoin the meeting.<br/>(Code:"+ca+")")}function ea(ca){WALK.USER_MSG.info("Failed to acquire media.<br/>"+ca.message,6E3)}
function ya(){za.toggleMic(ea)}function Q(){za.toggleCamera(ea)}function fa(ca){ia.update(Da)}function K(ca){var Aa=Da[ca];Aa||(Aa=new n(na,ca,fa),Da[ca]=Aa);return Aa}function R(ca){ca in Da&&(Da[ca].dispose(),delete Da[ca],ia.update(Da),pa.isConnected()&&0===Object.keys(Da).length&&pa.disconnect())}function ka(ca){Ia=ca;for(var Aa=$jscomp.makeIterator(Object.keys(ca)),Ca=Aa.next();!Ca.done;Ca=Aa.next())Ca=Ca.value,na.apiUserChangeState(Ca,ca[Ca])}function ba(ca){Qa.showPointer()?(ra.newUpdateWithPointer(),
ra.set(5,WALK.round(Qa.pointerX,3)),ra.set(6,WALK.round(Qa.pointerY,3)),ra.set(7,WALK.round(Qa.pointerZ,3))):ra.newUpdateNoPointer();ca=na.getCameraPosition();var Aa=na.getCameraRotation();ra.set(0,WALK.round(ca.x,3));ra.set(1,WALK.round(ca.y,3));ra.set(2,WALK.round(ca.z,3));ra.set(3,WALK.round(Aa.yaw,1));ra.set(4,WALK.round(Aa.pitch,1));(ca=ra.getFilledArray())&&za.updatePosition(ca)}function ja(){WALK.USER_MSG.error("The meeting has ended. Maximum duration of meeting reached.)");pa.dispose();L.dispose();
for(var ca in Da)Da.hasOwnProperty(ca)&&Da[ca].dispose();ia.update({})}var na=WALK.getViewer(),ra=new E;this.myUuid=M.uuid;var za=new u(na,this.myUuid,F),Da={},ia=new y(za,na),V=new O,xa=M.id,Ea=M.meetingKey,Ia;V.setToggleButtonHandlers(ya,Q);za.setAvTracksStateHandlers(function(ca){V.refreshMicControls(ca);ia.update(Da)},function(ca){V.refreshCameraControls(ca)});J&&ya();Z&&Q();var Qa=new D(na,ia);WALK.urlHashContains("meeting-notes")&&(document.getElementById("ext-meeting-notes-preview").style.display=
"",I(na,za,Da,ia,new A(xa,F)));null!==M.sceneState&&ka(M.sceneState);var L=new w(za,M,function(ca){K(ca);pa.isConnected()||pa.connect()},R,ka,ma);var pa=new v(za,M,function(ca,Aa){K(ca).connectedToTwilio(Aa)},function(ca,Aa){R(ca)},ea,ma,function(){WALK.USER_MSG.error("The meeting has been ended.")});na.onBeforeRender(ba);ba();na.onApiUserStateChanged(function(ca,Aa){ca=na.getApiUserState();WALK.deepEqual(ca,Ia)||(ca={meetingKey:Ea,sceneState:ca},WALK.ajaxPost(a()+"/meetings/"+xa+"/scene-state","application/json",
JSON.stringify(ca),function(){return WALK.log("State updated.")},function(){return WALK.log("Failed to update state.")}))});this.startShareScreen=function(ca,Aa,Ca){WALK.log("Screen share start requested");za.startShareScreen(ca,Aa,Ca)};this.stopShareScreen=function(){WALK.log("Screen share stop requested");za.stopShareScreen()};null!==M.remainingTimeSeconds&&setTimeout(ja,1E3*(M.remainingTimeSeconds+5))}function W(F){var J=document.getElementById("help-and-primary-progress");J.classList.add("ui-blur");
var Z=new h('\n      <div class="ext-meeting-join-row">\n        <div class="ext-meeting-join-label">Name:</div>\n        <input type="text" id="ext-meeting-join-name">\n      </div>\n      <div class="ext-meeting-join-row">\n        <div class="ext-meeting-join-label">Join with:</div>\n        <div class="ext-meeting-join-settings">\n          <label>\n            <input type="checkbox" id="ext-meeting-join-mic" checked>\n             Microphone\n           </label>\n          <label>\n            <input type="checkbox" id="ext-meeting-join-camera" checked>\n            Camera\n          </label>\n        </div>\n      </div>\n      <div class="ext-meeting-join-row">\n        <button id="ext-meeting-join-button"\n          class="ext-meeting-button ext-meeting-right">\n          Join 3D meeting\n        </button>\n      </div>\n      <div class="ext-meeting-join-footer">\n        By joining, you agree to the\n        <a href="https://www.shapespark.com/terms" target="_blank">\n         Terms of Service\n       </a> and <a href="https://www.shapespark.com/privacy" target="_blank">\n         Privacy Policy\n       </a>.\n      </div>\n    ');
Z.showDismiss=!1;Z.foremost=!0;Z.open();var M=document.getElementById("ext-meeting-join-name"),ma=document.getElementById("ext-meeting-join-mic"),ea=document.getElementById("ext-meeting-join-camera"),ya=localStorage.getItem("extMtgDisplayName");ya&&(M.value=ya);c("ext-meeting-join-button",function(){if(ya=M.value.trim()){localStorage.setItem("extMtgDisplayName",ya);Z.close();J.classList.remove("ui-blur");J.classList.add("ui-unblur");var Q=new S(ya,ma.checked,ea.checked,F);WALK.getViewer()._meetingJoined(Q)}else g(M)})}
function U(F){WALK.getViewer().onSceneLoadComplete(function(){var J=WALK.getViewerAssetUrl("3dassets/avatar.obj");WALK.loadGeometriesFromObj(J,function(Z){WALK.setAvatarGeometries(Z);F()},function(){return WALK.USER_MSG.error("Failed to load the meeting")})})}if(WALK.urlHashContains("meeting-key")||WALK.urlHashContains("meeting")){WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeSolid");WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeRegular");var va=new THREE.Color(0,1,0),ta=document.getElementById("walk-canvas"),
qa="#65ffcc #dfe592 #99dd92 #cc96b1 #94c4d3 #93d8b9 #65c4ff #ff6565 #cca499 #b394cc #e29191 #ff65f4 #656bff #ffa560 #6bff63 #949ace #ad65ff #ff6584".split(" ");m.prototype={constructor:m,_setUpAvatar:function(){console.assert(this._displayName,"Display name must be known to set up the avatar");WALK.log("Setting up avatar for %s:%s",this._uuid,this._displayName);this._avatar=this._viewer.addAvatar(this._uuid,{displayName:this._displayName,color:this._color})},get uuid(){return this._uuid},get color(){return this._color},
get displayName(){return this._displayName},get hasDisplayName(){return null!==this._displayName},updatePosition:function(F){if(this.hasDisplayName){var J=this._avatar;J.setPositionFromArray(F);J.rotate(F[3],F[4]);6<=F.length?J.placePointer(F[5],F[6],F[7]):J.hidePointer();J.visible&&(J.updateMatrixWorld(!0),this._viewer.requestFrame())}},dispose:function(){this._avatar&&(this._viewer.removeAvatar(this._avatar),this._avatar=null,this._viewer.requestFrame())}};u.prototype=Object.create(m.prototype);
u.prototype.constructor=u;Object.defineProperty(u.prototype,"dataTrack",{get:function(){return this._dataTrack}});Object.defineProperty(u.prototype,"micTrack",{get:function(){return this._micTrack}});Object.defineProperty(u.prototype,"cameraTrack",{get:function(){return this._cameraTrack}});Object.defineProperty(u.prototype,"screenTrack",{get:function(){return this._screenTrack}});u.prototype.getAllTracks=function(){var F=[this._dataTrack];this._micTrack&&F.push(this._micTrack);this._cameraTrack&&
F.push(this._cameraTrack);this._screenTrack&&F.push(this._screenTrack);return F};u.prototype._sendPosition=function(F){this._positionMessage[2]=F;this._dataTrack.send(JSON.stringify(this._positionMessage))};u.prototype._resendLastPosition=function(){null!==this._lastPosition&&this._sendPosition(this._lastPosition)};u.prototype.connectedToTwilio=function(F){var J=this;this._twilioParticipant=F;this._twilioParticipant.publishTracks(this.getAllTracks());this._resendLastPosition();this._resendInterval=
setInterval(function(){return J._resendLastPosition()},1E3)};u.prototype.disconnectedFromTwilio=function(){this._twilioParticipant=null;clearInterval(this._resendInterval);this._resendInterval=null};Object.defineProperty(u.prototype,"isConnectedToTwilio",{get:function(){return null!==this._twilioParticipant}});u.prototype.updatePosition=function(F){WALK.log("Update local position",F);m.prototype.updatePosition.call(this,F);this._lastPosition=F;this.isConnectedToTwilio&&this._sendPosition(F)};u.prototype.setAvTracksStateHandlers=
function(F,J){this._onMicTrackStateChanged=F;this._onCameraTrackStateChanged=J};u.prototype._removeStoppedMicTrack=function(){console.assert(this._micTrack&&this._micTrack.isStopped);WALK.log("Removing stopped local mic track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local mic track"),this._twilioParticipant.unpublishTrack(this._micTrack));this._micTrack=null};u.prototype._createMicTrack=function(F){var J=this;WALK.log("Creating local mic track");if(this._isCreatingMicTrack)WALK.log("Local mic track is already being created");
else{this._isCreatingMicTrack=!0;var Z=null;Twilio.Video.createLocalAudioTrack({name:"mic"}).then(function(M){Z=M;if(J.isConnectedToTwilio)return WALK.log("Publishing local mic track"),J._twilioParticipant.publishTrack(Z)}).then(function(){WALK.log("Local mic track published");J._micTrack=Z;var M=function(){J._onMicTrackStateChanged&&J._onMicTrackStateChanged(J._micTrack)};J._micTrack.on("started",M);J._micTrack.on("enabled",M);J._micTrack.on("disabled",M);J._micTrack.on("stopped",function(){M();
J._removeStoppedMicTrack()});M();J._isCreatingMicTrack=!1}).catch(function(M){Z&&Z.stop();F(M);J._isCreatingMicTrack=!1})}};u.prototype.toggleMic=function(F){this._micTrack?this._micTrack.isEnabled?(WALK.log("Disabling local mic track"),this._micTrack.disable()):(WALK.log("Enabling local mic track"),this._micTrack.enable()):this._createMicTrack(F)};u.prototype._removeStoppedCameraTrack=function(){console.assert(this._cameraTrack&&this._cameraTrack.isStopped);WALK.log("Removing stopped local camera track");
this._twilioParticipant&&(WALK.log("Unpublishing stopped local camera track"),this._twilioParticipant.unpublishTrack(this._cameraTrack));this._cameraTrack=null};u.prototype._createCameraTrack=function(F){var J=this;WALK.log("Creating local camera track");if(this._isCreatingCameraTrack)WALK.log("Local camera track is already being created");else{this._isCreatingCameraTrack=!0;var Z=null;Twilio.Video.createLocalVideoTrack({name:"camera",facingMode:"user"}).then(function(M){Z=M;if(J.isConnectedToTwilio)return J._twilioParticipant.publishTrack(Z)}).then(function(){WALK.log("Local camera track published");
J._cameraTrack=Z;var M=function(){J._onCameraTrackStateChanged&&J._onCameraTrackStateChanged(J._cameraTrack)};J._cameraTrack.on("started",M);J._cameraTrack.on("enabled",M);J._cameraTrack.on("disabled",M);J._cameraTrack.on("stopped",function(){M();J._removeStoppedCameraTrack()});M();J._isCreatingCameraTrack=!1}).catch(function(M){Z&&Z.stop();F(M);J._isCreatingCameraTrack=!1})}};u.prototype.toggleCamera=function(F){this._cameraTrack?this._cameraTrack.stop():this._createCameraTrack(F)};u.prototype.startShareScreen=
function(F,J,Z){var M=this;null!==this._screenTrack?F():(WALK.log("Share screen start"),navigator.mediaDevices.getDisplayMedia().then(function(ma){WALK.log("share screen - stream:",ma);var ea=new Twilio.Video.LocalVideoTrack(ma.getTracks()[0],{name:"screen"});M._screenTrack=ea;ma=l(M._viewer,ea);M._avatar.setVideoTexture1(ma);M._viewer.requestFrame();M.isConnectedToTwilio&&M._twilioParticipant.publishTrack(ea);F();ea.once("stopped",function(){WALK.log("Screen track stopped");M.isConnectedToTwilio&&
M._twilioParticipant.unpublishTrack(ea);M._avatar.setVideoTexture1(null);r(ea);M._screenTrack=null;M._viewer.requestFrame();J()})}).catch(function(ma){Z()}))};u.prototype.stopShareScreen=function(){null!==this._screenTrack&&(WALK.log("Share screen stop"),this._screenTrack.stop())};u.prototype.dispose=function(){this._screenTrack&&this.stopShareScreen();m.prototype.dispose.call(this)};n.prototype=Object.create(m.prototype);n.prototype.constructor=n;Object.defineProperty(n.prototype,"micTrack",{get:function(){return this._micTrack}});
Object.defineProperty(n.prototype,"cameraTrack",{get:function(){return this._cameraTrack}});n.prototype._refreshUi=function(){this._onUiRefreshNeeded&&this._onUiRefreshNeeded(this)};n.prototype._setUpMicTrack=function(){var F=this;WALK.log("Setting up remote mic track for %s:%s",this._uuid,this._displayName);this._micTrackStateChangedBound=function(){F._refreshUi()};this._micTrack.on("enabled",this._micTrackStateChangedBound);this._micTrack.on("disabled",this._micTrackStateChangedBound);this._micTrack.attach()};
n.prototype._tearDownMicTrack=function(){WALK.log("Tearing down remote mic track for %s:%s",this._uuid,this._displayName);r(this._micTrack);this._micTrack.removeListener("enabled",this._micTrackStateChangedBound);this._micTrack.removeListener("disabled",this._micTrackStateChangedBound);this._micTrackStateChangedBound=null};n.prototype._setUpCameraTrack=function(){var F=this;WALK.log("Setting up remote camera track for %s:%s",this._uuid,this._displayName);var J=l(this._viewer,this._cameraTrack);this._cameraTrackEnabledBound=
function(){F._avatar.setVideoTexture0(J)};this._cameraTrackDisabledBound=function(){F._avatar.setVideoTexture0(null)};this._cameraTrack.on("enabled",this._cameraTrackEnabledBound);this._cameraTrack.on("disabled",this._cameraTrackDisabledBound);this._avatar.setVideoTexture0(J)};n.prototype._tearDownCameraTrack=function(){WALK.log("Tearing down remote camera track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture0(null);r(this._cameraTrack);this._cameraTrack.removeListener("enabled",
this._cameraTrackEnabledBound);this._cameraTrack.removeListener("disabled",this._cameraTrackDisabledBound);this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=null};n.prototype._setUpScreenTrack=function(){WALK.log("Setting up remote screen track for %s:%s",this._uuid,this._displayName);var F=l(this._viewer,this._screenTrack);this._avatar.setVideoTexture1(F)};n.prototype._tearDownScreenTrack=function(){WALK.log("Tearing down remote screen track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture1(null);
r(this._screenTrack)};n.prototype._setDisplayName=function(F){WALK.log("Remote display name known for %s:%s",this._uuid,F);this._displayName=F;this._setUpAvatar();this._micTrack&&this._setUpMicTrack();this._cameraTrack&&this._setUpCameraTrack();this._screenTrack&&this._setUpScreenTrack();this._refreshUi()};n.prototype._trackSubscribed=function(F){var J=this;WALK.log("Remote %s:%s track subscribed for %s:%s",F.kind,F.name,this._uuid,this._displayName);this._disposed||("data"===F.kind&&"data"===F.name?
this._dataTrack?WALK.log("Ignoring duplicate data track"):(this._dataTrack=F,F.on("message",function(Z){Z=JSON.parse(Z);var M=Z[1];Z=Z[2];J.hasDisplayName||J._setDisplayName(M);J.updatePosition(Z)})):"audio"===F.kind&&"mic"===F.name?this._micTrack?WALK.log("Ignoring duplicate mic track"):(this._micTrack=F,this.hasDisplayName&&(this._setUpMicTrack(),this._refreshUi())):"video"===F.kind&&("camera"===F.name?this._cameraTrack?WALK.log("Ignoring duplicate camera track"):(this._cameraTrack=F,this._avatar&&
(this._setUpCameraTrack(),this._viewer.requestFrame())):"screen"===F.name&&(this._screenTrack?WALK.log("Ignoring duplicate screen track"):(this._screenTrack=F,this._avatar&&(this._setUpScreenTrack(),this._viewer.requestFrame())))))};n.prototype._trackUnsubscribed=function(F){WALK.log("Remote %s:%s track unsubscribed for %s:%s",F.kind,F.name,this._uuid,this._displayName);this._disposed||(F===this._dataTrack?this._dataTrack=null:F===this._micTrack?(this.hasDisplayName&&this._tearDownMicTrack(),this._micTrack=
null,this._refreshUi()):F===this._cameraTrack?(this._avatar&&(this._tearDownCameraTrack(),this._viewer.requestFrame()),this._cameraTrack=null):F===this._screenTrack&&(this._avatar&&(this._tearDownScreenTrack(),this._viewer.requestFrame()),this._screenTrack=null))};n.prototype.connectedToTwilio=function(F){var J=this;this._twilioParticipant=F;F.on("trackSubscribed",this._trackSubscribedBound);F.on("trackUnsubscribed",this._trackUnsubscribedBound);F.tracks.forEach(function(Z){Z.isSubscribed&&J._trackSubscribed(Z.track)})};
n.prototype.seeAvatar=function(){this._avatar&&this._viewer.seeItem(this._avatar)};n.prototype.dispose=function(){this._onUiRefreshNeeded=null;this._micTrack&&this._trackUnsubscribed(this._micTrack);this._cameraTrack&&this._trackUnsubscribed(this._cameraTrack);this._screenTrack&&this._trackUnsubscribed(this._screenTrack);this.isConnectedToTwilio&&(this._twilioParticipant.removeListener("trackSubscribed",this._trackSubscribedBound),this._twilioParticipant.removeListener("trackUnsubscribed",this._trackUnsubscribedBound),
this._twilioParticipant=null);m.prototype.dispose.call(this);this._disposed=!0};var ha=document.createElement("script");ha.onload=function(){var F=WALK.urlHashGetArgument("meeting"),J=WALK.urlHashGetArgument("meeting-key"),Z=WALK.urlHashGetArgument("av-mode");var M=WALK.isLocalhost()?"http://friend.localhost:5001"+window.location.pathname:window.location.href;M={url:M};F&&(M.meetingName=F);J&&(M.meetingKey=J);Z&&(M.avMode=Z);WALK.ajaxPost(a()+"/meetings/join","application/json",JSON.stringify(M),
function(ma){return U(function(){return W(ma)})},function(ma,ea){void 0!==ea?WALK.USER_MSG.error(ea):WALK.USER_MSG.error("Failed to join the meeting. Is your link valid?")})};ha.src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.21.7.min.js";ha.type="text/javascript";document.body.appendChild(ha);ha=document.createElement("script");ha.src="https://media.twiliocdn.com/sdk/js/video/releases/2.7.0/twilio-video.min.js";ha.type="text/javascript";document.body.appendChild(ha);WALK.play()}})();
